Array.implement({pick:function(){for(var i=0,l=this.length;i<l;i++){if(this[i]!=null)return this[i];}
return null;},binarySearch:function(find,comparator){var low=0,high=this.length-1,i,comparison;while(low<=high){i=Math.floor((low+high)/2);comparison=comparator(this[i],find);if(comparison<0){low=i+1;continue;};if(comparison>0){high=i-1;continue;};return i;}
return null;}});(function(window,$){var defaultPositions=['centerBottom','centerTop','centerRight','centerLeft','center'];Element.implement({autoposition:function(options){var positions=options.positions||defaultPositions,offsets=options.offsets||[],edges=options.edges||defaultPositions,returnPos=options.returnPos,windowSize=window.getSize(),windowScroll=window.getScroll(),viewPort={top:windowScroll.y,bottom:windowScroll.y+windowSize.y,left:windowScroll.x,right:windowScroll.x+windowSize.x},size=this.getDimensions({computeSize:true}),position=null;options.returnPos=true;var fudge=5;for(var i=0;i<positions.length;i++){options.position=positions[i];options.offset=offsets[i]||{x:0,y:0};options.edge=edges[i];position=this.position(options);if(position.top>viewPort.top&&position.left>viewPort.left&&(position.left+size.width+fudge)<viewPort.right&&(position.top+size.height+fudge)<viewPort.bottom){break;}}
if(i==positions.length){options.position=position=positions[0];options.edge=edges[0];options.offset=offsets[0]||{x:0,y:0};}
if(returnPos){return position;}else{options.returnPos=false;for(var i=0,l=defaultPositions.length;i<l;i++){this.removeClass(defaultPositions[i])}
this.addClass(options.position);return this.position(options);}},relativeToViewport:function(viewport){var coords=this.getCoordinates();if(coords.bottom<viewport.top)return-1;if(coords.top>viewport.bottom)return 1;return 0;}});})(this,document.id);(function(window,$,undef){function storeValue(current,prop,value){if(prop==undefined){current.push(value);}else{var as_array=false;if(prop.match(/\[\]$/)){prop=prop.substr(0,prop.length-2);as_array=true;}
if(as_array||current[prop]){current[prop]=current[prop]?Array.from(current[prop]):[];current[prop].push(value);}else{current[prop]=value;}}}
function getValue(element){return(element.get('tag')=='select')?element.getSelected().map(function(opt){return $(opt).get('value');}):((element.type=='radio'||element.type=='checkbox')&&!element.checked)?null:element.get('value');}
Element.implement({serialize:function(options){if(typeOf(options)!='object')options={};var isFormObject=this.hasClass('formObject');if(!isFormObject)this.addClass('formObject');this.eliminate('serialize:object');var objects=this.getElements('.formObject');objects.each(function(o){o.eliminate('serialize:object');});var fields=this.getElements(options.fieldSelector||'.formField');fields.each(function(field){var name=field.get('name')||field.get('id');if(!name||name.length<1)return;var getter=field.retrieve('serialize:getter',getValue);var value=getter(field);if(options.ignoreEmptyValues){if(value==undefined||value.length<1)return;}
var parent=field.getParent('.formObject'),current=parent.retrieve('serialize:object',{}),names=name.split(/[:.]/),prop=name;if(names.length>1){for(var i=0,l=names.length-1;i<l;i++){name=names[i];if(!current[name])current[name]=current={};else current=current[name];}
prop=names[names.length-1];}
storeValue(current,prop,value);},this);objects.each(function(o){var value=o.retrieve('serialize:object');if(!value)return;var parent=o.getParent('.formObject'),name=o.get('name')||o.get('id'),current=parent.retrieve('serialize:object',name?{}:[]);storeValue(current,name,value);});if(!isFormObject)this.removeClass('formObject');return this.retrieve('serialize:object');}});})(this,document.id);(function(){Element.implement({toJSON:function(pre){json={};this.getElements('input, select, textarea, .formulaEditor').each(function(el){if(el.disabled||el.type=='submit'||el.type=='reset'||el.type=='file'){return;}
function parseDijitEditor(id){var value=replaceNBSP($(id).get('html'));return value;}
function replaceNBSP(value){if(value.match('\xA0')){value=value.replace('\xA0','&nbsp;');return replaceNBSP(value);}else{return value;}}
function parseFormData(el){var value=null;if(el.get('tag').toLowerCase()=='select'){value=Element.getSelected(el).map(function(opt){return opt.value;});}else if((el.type=='radio'||el.type=='checkbox')&&!el.checked){value=null;}else{if(el.hasClass('formulaEditor')){value=parseDijitEditor(el.get('id'));}else{value=el.get('value');}}
return value;}
var value=parseFormData(el);$splat(value).each(function(val){if(typeof val!=undefined){defineValueType(json,el,pre,val);}});function defineValueType(json,el,pre,value){var type=el.type;var key;switch(type){case'checkbox':key=getPrefixKey(el.name,pre);if($type(json[key])!='array'){json[key]=[value];}else{json[key].push(value);}
break;case'radio':key=getPrefixKey(el.name,pre);json[key]=value;break;default:key=getPrefixKey(el.id,pre);json[key]=value;}}
function getPrefixKey(key,pre){if(pre){return key.replace(pre,'');}else{return key;}}});return json;}});})();var UID=0;var mergeOne=function(source,key,current){switch(typeof current){case'object':if(typeof source[key]==='object')Hash.merge(source[key],current);else source[key]=Object.clone(current);break;case'array':source[key]=current.clone();break;default:source[key]=current;}
return source;};String.implement({uniqueID:function(){return(UID++).toString(36);}});String.implement({toElement:function(){return new Element('div',{html:this}).getFirst();}});Hash.implement({merge:function(source,k,v){if(typeof k==='string')return mergeOne(source,k,v);for(var i=1,l=arguments.length;i<l;i++){var object=arguments[i];for(var key in object)mergeOne(source,key,object[key]);}
return source;}});Array.implement({pick:function(){for(var i=0,l=this.length;i<l;i++){if(this[i]!=null)return this[i];}
return null;}});Function.implement({bindWithArgs:function(bind,args){var self=this;return function(){var params=(args)?Array.slice(arguments).concat($splat(args)):arguments;var returns=function(){return self.apply(bind,params);};return returns();};}});FakeDOMElement=new Class({initialize:function(tag){this.tag=tag;this.properties={};this.children=[];},getElement:function(selector){return this.getElements(selector)[0];},getElements:function(selector){var matches=[];this.children.each(function(child){if(child.tag==selector){matches.push(child);}
var child_matches=child.getElements(selector);if(child_matches.length){matches.append(child_matches);}});return matches;},getChildren:function(){return this.children;},adopt:function(child){if(this.children.length==0){this.firstChild=child;}
this.children.push(child);},set:function(properties){for(var key in properties){this[key]=properties[key];}},get:function(property){return this[property];},setProperty:function(property,value){this.properties[property]=value;},getProperty:function(property){return this.properties[property];}});XmlElement=new Class({initialize:function(xml){var root;if(window.ActiveXObject){root=new ActiveXObject('Microsoft.XMLDOM');root.async=false;root.loadXML(xml);root=this.createXml(root);}else{root=new DOMParser().parseFromString(xml,'text/xml');}
return root;},createXml:function(xml,parent){if(!parent)parent=new FakeDOMElement(xml.nodeName);if(!xml.childNodes.length)return parent;var i,j,currChildNode;for(i=0;i<xml.childNodes.length;i++){currChildNode=xml.childNodes[i];if(currChildNode.nodeType==1){var el=new FakeDOMElement(currChildNode.nodeName);if(currChildNode.attributes.length){for(j=0;j<currChildNode.attributes.length;j++){tmp=currChildNode.attributes[j];el.setProperty(tmp.nodeName,tmp.nodeValue);}}
el.set({'text':currChildNode.firstChild.nodeValue});parent.adopt(el);if(currChildNode.childNodes.length)this.createXml(currChildNode,el);}}
return parent;}});Function.implement({delayed:function(delay,that){var self=this,args=arguments.length>2?Array.slice(arguments,2):null;return function(){var length=arguments.length;setTimeout(self.pass(args&&length?args.concat(Array.slice(arguments)):args||arguments,that),delay);};}});Class.refactor(Cookie,{initialize:function(key,options){if(key.indexOf('{}')==0){var parts=key.substr(2).split('_');key=parts.shift();this.location=parts;this.asObject=(this.location&&this.location.length)?true:false;}
this.previous(key,options);},write:function(value){this.read();if(this.asObject){this.targetObject[this.targetKey]=value;value=JSON.encode(this.data);}
return this.previous(value);},read:function(){var value=this.previous();if(this.asObject){this.data=(value)?JSON.decode(value):this._getObject(this.location[0]);var current=this.data;for(var i=0;i<this.location.length-1;i++){if(!current[this.location[i]]){current[this.location[i]]=this._getObject(this.location[i+1]);}
current=current[this.location[i]];}
this.targetKey=this.location[this.location.length-1];this.targetObject=current;value=this.targetObject[this.targetKey];}
return value;},dispose:function(){if(this.asObject){this.read();delete(this.targetObject[this.targetKey]);return this;}
else{return this.previous();}},_getObject:function(key){return isNaN(parseInt(key))?{}:[];}});WA=new Class({});WA.Util=new Class({Extends:WA,initialize:function(options){this.IE=/*@cc_on Number(String(@_jscript_version).split('.')[1]) + @*/0;this.tablet=navigator.userAgent.match(/iPad/i)?1:0;},testWA:function(){this.log('wa.js is loaded');},validator:function(){if(this._validator===undefined){this._validator=new FormValidation();}
return this._validator;},fixZOrder:function(){var z=9998;var divs=$$('#webAssign #top div');for(var i=0;i<divs.length;i++){if(!divs[i].getStyle('z-index')){divs[i].setStyle('z-index',z--);}}},isPreview:function(){var is_preview=$('is_preview').get('value');if(is_preview==1){console.log("returning true");return true;}
return false;},parseRelevantData:function(obj,match){var relevant={};for(var key in obj){if(key.match(match)){var truncatedKey=key.replace(match,'');relevant[truncatedKey]=obj[key];}}
return relevant;},submit_one:function(path,pre,num,onSuccess){var elementID=pre+num;var domElement=$(elementID);if(domElement){var match=pre+'_'+num+'_';var elementList=[];var elementData=domElement.toJSON();elementData=this.parseRelevantData(elementData,match);elementList.push(elementData);var jsonRequest=new Request({url:path,onSuccess:function(responseText,responseXML){var response=JSON.decode(responseText);if(onSuccess){onSuccess(response);}},onFailure:function(xhr){waUtil.log(xhr);},onTimeout:function(xhr){var response=JSON.decode(xhr.responseText);waUtil.log(xhr);}}).send(JSON.encode(elementList));}},submit_all:function(path,pre,onSuccess){var elements=$$('.wa_'+pre);if(elements){var elementList=[];elements.each(function(element){var num=element.get('id').replace(pre,'');var elementData=element.toJSON();var match=pre+'_'+num+'_';elementData=this.parseRelevantData(elementData,match);elementList.push(elementData);}.bind(this));var jsonRequest=new Request.JSON({url:path,onSuccess:function(responseJSON,responseString){if(onSuccess){onSuccess(responseJSON,responseString);}},onFailure:function(xhr){this.log('failed: '+xhr.status+' text: '+xhr.responseText);},onTimeout:function(){this.log('timeout');}}).send(JSON.encode(elementList));}},logout:function(){return this.submitAction('logout');},submitAction:function(action,formData){if($('host')){if(!formData)formData={};var form=new Element('form',{'action':'/v4cgi/'+$('usertype').get('value')+'.pl','enctype':'x-www-form-urlencoded','id':'wa','method':'post','target':(formData.target)?formData.target:''});if($('deployment')&&!formData.hasOwnProperty('deployment')){new Element('input',{'type':'hidden','name':'deployment','value':$('deployment').get('value')}).inject(form);}
formData.action=action;formData.UserPass=$('sid').get('value');for(var fieldName in formData){if(formData.hasOwnProperty(fieldName)){var element=new Element('input',{'type':'hidden','name':fieldName,'value':formData[fieldName]}).inject(form);}}
form.inject($(document.body));try{form.submit(this);}
catch(e){}}else{var waForm=$('wa');$('action').set('value',action);for(var fieldName in formData){if($(fieldName)){$(fieldName).set('value',formData[fieldName]);}else{new Element('input',{'type':'hidden','id':fieldName,'name':fieldName,'value':formData[fieldName]}).inject(waForm);}}
waForm.submit(this);}
return false;},post:function(url,data){if(!url){url=document.URL;}
var json=JSON.encode(data);var form=new Element('form',{action:url,enctype:'text/plain',id:'wa',method:'post'});new Element('input',{type:'hidden',name:'data',value:json}).inject(form);form.inject($(document.body));try{form.submit(this);}
catch(e){}
return false;},openWindow:function(comp,name,attr){if(typeof name!=="undefined"&&name!==null){name=String(name).replace(/\s/g,'_').replace(/[^a-z0-9_]/gi,'');}
var newWindow=window.open(comp,name,attr);newWindow.focus();},recordActivityAnalytics:function(analyticsData){if(!analyticsData||!analyticsData.records||analyticsData.records.constructor!==Array){return;}
var host=window.location.host;var productPlatform='webassign';var productEnvironment='develop';var userEnvironment='integration';var userPlatform='sso';if(host.indexOf('www.webassign.net')!==-1){userEnvironment='production';productEnvironment='production';}else if(host.indexOf('demo')!==-1){userEnvironment='demo';productEnvironment='demo';userPlatform='webassign';}else if(host.indexOf('editorial')!==-1){userEnvironment='editorial';productEnvironment='editorial';userPlatform='webassign';}else if(host.indexOf('perf')!==-1){userEnvironment='performance';productEnvironment='performance';}else if(host.indexOf('staging')!==-1){userEnvironment='qa';productEnvironment='staging';}else if(host.indexOf('integration')!==-1){userEnvironment='integration';productEnvironment='integration';}
var eventTime=this.getLocalDateISOString();var eventUri=[location.protocol,'//',location.host,location.pathname].join('');analyticsData.records.forEach(function(activity){activity.productEnvironment=productEnvironment;activity.productPlatform=productPlatform;activity.userEnvironment=userEnvironment;activity.userPlatform=userPlatform;activity.eventTime=eventTime;activity.eventUri=eventUri;});var url=analyticsData.url;var apiKey=analyticsData.apiKey;delete analyticsData.url;delete analyticsData.apiKey;var xhr=new XMLHttpRequest();xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/json;charset=UTF-8');xhr.setRequestHeader('x-api-key',apiKey);xhr.send(JSON.stringify(analyticsData));},getLocalDateISOString:function(){var now=new Date();var tzo=now.getTimezoneOffset();var pad=function(num,len){var norm=Math.abs(Math.floor(num)).toString();if(norm.length>len){return norm;}
else{var padding='';for(var i=0;i<len-norm.length;i++){padding+='0';}
return padding+norm;}};return now.getFullYear().toString().concat('-',pad(now.getMonth()+1,2),'-',pad(now.getDate(),2),'T',pad(now.getHours(),2),':',pad(now.getMinutes(),2),':',pad(now.getSeconds(),2),'.',pad(now.getMilliseconds(),3),tzo<0?'+':'-',pad(Math.abs(tzo)/60,2),':',pad(Math.abs(tzo)%60,2));},openVideo:function(videoUrl,analyticsData){var attr='scrollbars=yes,resizable=yes,width=640,height=550';this.recordAnalyticsAndOpenWindow(videoUrl,'BCEnhanced',attr,analyticsData);},openStudentHeaderLink:function(href,title,attr,analyticsData){this.recordAnalyticsAndOpenWindow(href,title,attr,analyticsData);},openEbook:function(serverName,waAlias,ebookUrl,ebookId,secflag,analyticsData){var winUrl=ebookUrl;var winOptions='';if(secflag==="on"){var userPass=$('UserPass').value;winUrl='https://'+serverName+'/'+waAlias+'/extra/ebookwrapper/index.tpl?';winUrl+='ebook_url='+ebookUrl;winUrl+='&UserPass='+userPass;winOptions='toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbar=no,resizable,copyhistory=yes,width=960,height=720,left=25,top=25,screenX=25,screenY=25';}
if(this.recordAnalyticsAndOpenWindow){this.recordAnalyticsAndOpenWindow(winUrl,ebookId,winOptions,analyticsData);}else{this.openWindow(winUrl,ebookId,winOptions);return false;}},recordAnalyticsAndOpenWindow:function(href,title,attr,analyticsData){this.recordActivityAnalytics(analyticsData);this.openWindow(href,title,attr);return false;},openMindtapReader:function(isbn,extra){if(arguments.length>2){var server=arguments[0];var tk=arguments[1];var ebook_code=arguments[2];var page=arguments[3];var win_url='https://'+server+'/nb/service/launch?';win_url+='token='+tk;win_url+='&eISBN='+ebook_code;if(page!==''){win_url+='&'+page;}
var win_options='';this.openWindow(win_url,'Mindtap Reader',win_options);return false;}else{var win_url='/web/User/Cengage/mtr?isbn='+isbn;if(extra!==''){win_url+='&'+extra;}
var win_options='';this.openWindow(win_url,'Mindtap Reader',win_options);return false;}},log:function(data){if(window.console&&console.log){console.log(data);}},onBeforeUnload:function(){var rtn;var l=this._unload_events.length;for(var i=0;i<l;i++){var msg=this._unload_events[i]();if(msg){rtn=msg;}}
return rtn;},addUnloadEvent:function(method){if(!this.hasOwnProperty('_unload_events')){this._unload_events=[];window.onbeforeunload=this.onBeforeUnload.bind(this);}
this.removeUnloadEvent(method);this._unload_events.push(method);},removeUnloadEvent:function(method){if(this.hasOwnProperty('_unload_events')){for(var i=this._unload_events.length;--i>=0;){if(this._unload_events[i]===method){this._unload_events.splice(i,1);break;}}}},dump:function(object,tabs){if(object==null){object=this;}
if(tabs==null){tabs='';}
for(var key in object){if(typeOf(object[key])=='array'||typeOf(object[key])=='object'){this.log(tabs+key+' : ');this.dump(object[key],tabs+'    ');}else if(typeof(object[key])!='function'){this.log(tabs+key+' : '+object[key]);}}}});if(!JSON.stringifyPolyfilled){var _json_stringify=JSON.stringify;JSON.stringify=function(value){var _array_tojson=Array.prototype.toJSON;delete Array.prototype.toJSON;var r=_json_stringify(value);Array.prototype.toJSON=_array_tojson;return r;};JSON.stringifyPolyfilled=1;}
var waUtil=new WA.Util();var openWindow=waUtil.openWindow;WA.Effect=new Class({});WA.Effect.Expand=new Class({Implements:[Events,Options],options:{open:false,cookie:''},initialize:function(link,content,options){this.setOptions(options);this.link=link;if(!link)return;this.content=content||link.getNext();this.cookie=this.options.cookie?this.options.cookie:'';this.expandIcon=this.link.getElement('.expand')||this.link;this.effect=new Fx.Slide(this.content,{duration:200,resetHeight:true,transition:Fx.Transitions.Pow.easeOut,onStart:this.onSlideStart.bind(this),onComplete:this.onSlideComplete.delayed(1,this)});this.link.addEvent('click',this.onLinkClick.bind(this));this.link.addEvent('keydown',this.onLinkKeyDown.bind(this));if(this.cookie&&Cookie.read(this.cookie)!=null){this.options.open=(Cookie.read(this.cookie)==1)?true:false;}
if(this.options.open){if(this.expandIcon)this.expandIcon.swapClass('close','open');this.updateOverflow('visible');}else{if(this.expandIcon)this.expandIcon.swapClass('open','close');this.effect.hide();this.updateOverflow('hidden');}
this.content.removeClass('hide');this.link.store('expand',this);this.updateCookie();},onLinkClick:function(event){if(event){event.stop();}
this.effect.toggle('vertical');},onLinkKeyDown:function(event){if(event&&event.key===" "||event.key.toLowerCase()==="enter"||event.key.toLowerCase()==="spacebar"||event.key.toLowerCase()==="space"){event.stop();this.effect.toggle('vertical');}},onSlideStart:function(){this.updateOverflow('hidden');},onSlideComplete:function(){if(this.isOpen()){this.fireEvent('show');this.updateOverflow('visible');if(this.expandIcon)this.expandIcon.swapClass('close','open');}else{this.fireEvent('hide');if(this.expandIcon)this.expandIcon.swapClass('open','close');}
this.updateCookie();},show:function(){this.effect.show();this.updateOverflow('visible');this.updateCookie();},hide:function(){this.effect.hide();this.updateOverflow('hidden');this.updateCookie();},isOpen:function(){return this.effect.open;},updateOverflow:function(value){this.content.setStyle('visibility',value);this.content.setStyle('overflow',value);this.content.getParent().setStyle('overflow',value);},updateCookie:function(){if(!this.cookie){return;}
Cookie.write(this.cookie,this.isOpen()?1:0,this.options.cookieOptions);}});WA.Components=new Class({});WA.Components.Overlay=new Class({Implements:[Events,Options],options:{offset:{x:0,y:0},windowPadding:{x:0,y:0}},initialize:function(className,options){this.className=className;this.setOptions(options);},show:function(){$(this).show();this.fireEvent('show',[this]);},hide:function(){$(this).hide();this.fireEvent('hide',[this]);},fill:function(contents){var container=$(this).getElement('.tip-text');container.empty();if(typeof contents=='string')container.set('html',contents);else container.adopt(contents);},toElement:function(){if(this.element)return this.element;this.element=new Element('div',{'class':this.className+' container',styles:{position:'absolute',top:0,left:0,visibility:'visible',display:'none'}}).adopt(new Element('div',{'class':'tip-top'}).adopt(new Element('div',{'class':'nw'}).adopt(new Element('div',{'class':'n'}))),new Element('div',{'class':'tip'}).adopt(new Element('div',{'class':'tip-text container'})),new Element('div',{'class':'tip-bottom'}).adopt(new Element('div',{'class':'sw'}).adopt(new Element('div',{'class':'s'})))).inject(document.body);this.fireEvent('build',[this]);return this.element;}});WA.Components.Tip=new Class({Implements:[Events,Options],options:{stopPropagation:false,className:'y-tip new',id:null,content:null,height:null,positions:['centerBottom','centerTop','centerRight','centerLeft'],edges:['upperLeft','bottomRight','upperLeft','upperRight'],offsets:[{x:-60,y:0},{x:62,y:8},{x:0,y:-44},{x:0,y:-44}],cache:true},initialize:function(element,options){this.showing=false;this.element=element;this.setOptions(options);this.initContent();this.initOverlay();this.addShowEvents();this.element.store('tip',this);},initContent:function(){var content=this.options.content||this.element.getNext();this.setHeight(content);this.content=content?content.dispose():new Element('div',{text:'tool tip'});this.content.setStyle('display','block');this.content.getElements('.bClose').addEvent('click',this.hide.bind(this));if(this.options.id){this.content.set('id',this.options.id);}},getContent:function(){return this.content;},initOverlay:function(){this.carets=$$(new Element('div',{'class':'nCarrot'}),new Element('div',{'class':'sCarrot'}),new Element('div',{'class':'wCarrot'}),new Element('div',{'class':'eCarrot'}));this.overlay=(this.options.cache&&WA.Components.Tip.instances[this.options.className])?WA.Components.Tip.instances[this.options.className]:new WA.Components.Overlay(this.options.className,{onBuild:function(overlay){this.carets.inject(overlay);}.bind(this)});if(this.options.cache){WA.Components.Tip.instances[this.options.className]=this.overlay;}},isShowing:function(){return this.showing;},addShowEvents:function(){this.element.addEvent('click',this.onShowEvent.bind(this));},addHideEvents:function(){if(!this.hasOwnProperty('boundOnHideEvent')){this.boundOnHideEvent=this.onHideEvent.bind(this);}
$(document.body).addEvent('mousedown',this.boundOnHideEvent);},removeHideEvents:function(){$(document.body).removeEvent('mousedown',this.boundOnHideEvent);},onShowEvent:function(event){if(this.options.stopPropagation){event.stopPropagation();}
this.show();},onHideEvent:function(event){if(this.options.stopPropagation){event.stopPropagation();}
var object=Element.getParent($(event.target),'.'+this.options.className.split(' ').join('.'));if(object||this.element==$(event.target)){return;}
this.hide();},show:function(){if(this.showing)return;this.carets.removeClass('hide');var regex=/w([\d]+)/;$(this.overlay).setStyle('width',regex.exec(this.content.get('class'))[1]+'px');this.overlay.fill(this.content);$(this.overlay).autoposition({positions:this.options.positions,edges:this.options.edges,offsets:this.options.offsets,relativeTo:this.element});this.overlay.show();this.addHideEvents();this.showing=true;this.fireEvent('show',[this]);},hide:function(event){if(!this.showing)return;this.overlay.hide();this.content=this.content.dispose();this.removeHideEvents();this.showing=false;this.fireEvent('hide',[this]);},setHeight:function(content){if(this.options.height&&content){var contentHeight=content.measure(function(){return this.getSize().y;});var maxHeightInt=parseInt(this.options.height);if(contentHeight>maxHeightInt){content.setStyles({'max-height':this.options.height,'overflow':'auto'});}}}});WA.Components.Tip.instances={};WA.Components.DragTip=new Class({Extends:WA.Components.Tip,options:{draggable:true,title:null,cache:false},show:function(){this.parent();if(this.options.draggable&&!this.drag){this.detach();}
if(this.titleElement){this.titleElement.setStyle('display','none');}},detach:function(){var overlay=$(this.overlay);this.handle=new Element('div',{'class':'bHandle'});this.shim=new Element('div',{'class':'bShim'});this.shim.inject(overlay);this.handle.inject(overlay);if(!this.drag){this.drag=new Drag(overlay,{snap:0,handle:this.handle,onStart:function(){this.carets.addClass('hide');this.tipTitle(overlay);}.bind(this)});}
this.shim.addEvent('click',function(){this.hide();}.bind(this));},tipTitle:function(overlay){if(this.options.title){if(!this.titleElement){this.titleElement=new Element('div',{'html':'<p>'+this.options.title+'</p>','class':'bTitle'});this.titleElement.inject(overlay);}
else{this.titleElement.setStyle('display','block');}}}});WA.Assignment=new Class({initialize:function(element,singleDelivery){if(!element)return
var self=this;this.element=element;this.questions=[];this.singleDelivery=singleDelivery;this.initializeCookie();this.initializeSummary();this.initializeQuestions();this._boundQuestionFocus=this._onQuestionFocus.bind(this);['keydown','keyup','mousedown','mouseup','click'].each(function(e){$(document.body).addEvent(e+':relay(.waQBox)',this._boundQuestionFocus);}.bind(this));if(!this.singleDelivery){var bound=this.checkViewport.bind(this);window.addEvent('scroll:pause(250)',bound);window.addEvent('resize:pause(250)',bound);this.checkViewport.delay(1,this);}
if(location.hash.substring(0,4)==='#QID'){this.goToQuestionId(location.hash.substring(4));}
this.element.store('assignment',this);},aggregateTAQData:function(){var times={};for(var i=0;i<this.questions.length;i++){var question=this.questions[i];if(question.inViewport){question.stopTAQ();}
times[question.id]=question.timeInViewport;}
var deployment=$('deployment');if(deployment){deployment=$('deployment').get('value');var payload={deployment:deployment,questionTAQ:times};jQuery.ajax({async:false,cache:false,type:'POST',dataType:'json',data:JSON.stringify(payload),url:"/web/Rest/SubmitTAQ/submit_taq"});}
return void(0);},initializeCookie:function(){var deployment_value;if($('deployment')){deployment_value=$('deployment').get('value');}
else if($('dep')){deployment_value=$('dep').get('value');}
else{deployment_value='';}
var authUser=$('authuser');if(authUser){authUser=authUser.get('value');}
var uri=new URI();this.cookie={key:'{}waUser'+authUser+'Deployment'+deployment_value,options:{path:uri.parsed.directory,duration:7}};},checkViewport:function(){var size=window.getSize(),scroll=window.getScroll(),viewport={left:scroll.x,top:scroll.y,right:scroll.x+size.x,bottom:scroll.y+size.y},index=this.questions.binarySearch(viewport,this.inViewport.bind(this));if(index!=null){this.questions[index].requireCompleteInit();var i=index,l=this.questions.length;while(--i>=0&&this.inViewport(this.questions[i],viewport)==0){this.questions[i].requireCompleteInit();}
i=index;while(++i<l&&this.inViewport(this.questions[i],viewport)==0){this.questions[i].requireCompleteInit();}}
},checkTAQViewport:function(){for(var i=0;i<this.questions.length;i++){var question=this.questions[i];if(question.isInViewport()&&!question.inViewport){question.startTAQ();}else if(!question.isInViewport()&&question.inViewport){question.stopTAQ();}}},inViewport:function(question,viewport){return question.element.relativeToViewport(viewport);},_onQuestionFocus:function(event,question){if(question.hasClass('focused'))return;var obj=question.retrieve('question');obj.onFocus();},initializeSummary:function(){if(!this.element||!this.element.getElement('.assignmentSummary'))return
if(this.singleDelivery){this.nextLinks=$$('.nextQuestionLink');this.previousLinks=$$('.previousQuestionLink');this.positionIndicators=$$('.currentPosition');}
this.element.getElement('.assignmentQuestionDetails .columnContent').addEvent('click:relay(.questionNumber)',this.followDashboardLink.bind(this));this.element.getElement('.assignmentQuestionDetails .columnContent').addEvent('click:relay(.points)',this.followDashboardLink.bind(this));this.element.getElements('.assignmentSummary .waExpand .first .titleBar').each(function(link){new WA.Effect.Expand(link,link.getNext(),{open:true});});},followDashboardLink:function(event,link){this.goToQuestion(link.getParent().getChildren().indexOf(link));},goToQuestionId:function(questionId){var i;for(i=0;i<this.questions.length;i++){if(this.questions[i].id===questionId){this.goToQuestion(i);return;}}},updateQuestionIndex:function(num){this.currentIndex=num;},goToQuestion:function(position){if(this.singleDelivery){this.questions.each(function(q){q.element.addClass('invisible');if(q.smw){q.smw.hideOverlay();}});this.currentIndex=position;this.questions[position].element.removeClass('invisible');if(this.questions[position].smw){this.questions[position].smw.showOverlay();}
this.updateLinks();var event=document.createEvent('Event');var bubbles=true;var cancelable=true;event.initEvent('question_ready',bubbles,cancelable);document.dispatchEvent(event);}else{document.location.href='#Q'+(position+1);}
this.questions[position].onFocus();},nextQuestion:function(){var pos=this.currentIndex+1;if(pos<this.questions.length)this.goToQuestion(pos);},previousQuestion:function(){var pos=this.currentIndex-1;if(pos>=0)this.goToQuestion(pos);},updateLinks:function(){var pos=this.currentIndex;if(pos==this.questions.length-1)this.nextLinks.addClass('hide');else this.nextLinks.removeClass('hide');if(pos==0)this.previousLinks.addClass('hide');else this.previousLinks.removeClass('hide');this.positionIndicators.set('text',pos+1);},initializeQuestions:function(){var question_elements=$(document.body).getElements('.waQBox');var l=question_elements.length;for(var i=0;i<l;i++){var element=question_elements[i];var options={labsCookie:this.getLabsCookie(i),type:element.hasClass('cxp')?'CXPItem':'QWS',};var question=this.createQuestion(element,options);this.questions.push(question);if(this.singleDelivery&&!question.element.hasClass('invisible')){this.currentIndex=i;question.onFocus();}}},getLabsCookie:function(index){return{key:this.cookie.key+'Labs'+'_'+index,options:this.cookie.options};},createQuestion:function(element,options){return new WA.Question(element,options);},isTimed:function(){return false;}});WA.Assignment.retrieve=function(deployment_id){var elementId='assignment'+deployment_id;var html=$(elementId);if(html){return html.retrieve('assignment');}
return;};(function(){var pkg="WA.Assignment";var ctx=(typeof window!=='undefined')?window:global;pkg=pkg.split('.');for(var i=0;i<pkg.length;++i)ctx=ctx[pkg[i]]=(ctx[pkg[i]]||{});})();WA.Assignment.AutosaveManager=new Class({Implements:[Events],initialize:function(assignment,config){this.assignment=assignment;this._delay=0;this._lastSavedTime=null;this._lastError=null;this._timer=null;this._state=null;this._handleTimerExpired=this._handleTimerExpired.bind(this);this.configure(config);},delay:function(delay){if(delay!==undefined){this._trace("set delay",{delay:delay});delay=parseInt(delay);this._delay=Math.max(0,(delay?delay:0))}
return this._delay;},lastSavedTime:function(date){if(date!==undefined){date=new Date(date);this._lastSavedTime=date;}
return this._lastSavedTime;},configure:function(config){config=config||{};this._trace("configure",{config:config});function has(k){return(config[k]!==undefined);}
if(has('delay')){this.delay(config.delay);}
if(has('lastSavedTime')){this.lastSavedTime(config.lastSavedTime);}
this.reset();},reset:function(){var delay=this.delay();this._trace("reset: ",this);this.elInfo=$$(".autosaveInfo");this._state='initial';if(this.lastSavedTime()){this._state='saved';}
if(this._lastError){this._state='offline';}
this._resetTimer();this.updateDisplay();},_resetTimer:function(){this._trace("_resetTimer: ",this);if(this._timer!==null){clearTimeout(this._timer);this._timer=null;this._startTimer();}},_startTimer:function(){var delay=this.delay();this._trace("_startTimer: ",this);if(delay>0){this._timer=setInterval(this._handleTimerExpired,delay);}},_handleTimerExpired:function(){this._trace("handleTimerExpired",{state:this._state});switch(this._state){case'initial':case'saved':this.saveIfNeeded();break;case'offline':break;}},saveIfNeeded:function(){var assignment=this.assignment;assignment.updateCache();if(assignment.isChanged()){this._trace("saveIfNeeded: starting save");this.goState('saving');assignment.saveAll(null);}},handleSaveSucceeded:function(options){options=options||{};this._trace("handleSaveSuccess",options);this._lastError=null;if(options.delay!==undefined){this.delay(options.delay);}
this.lastSavedTime(Date.now());clearTimeout(this._timer);this._timer=null;this.reset();},handleSaveFailed:function(err){this._trace("handleSaveFailure",err);var autosaveEnabled=(this.delay()>0);if(autosaveEnabled){var message="Assignment not saved\n"+
"Your assignment could not be saved.\n\n"+
"If you are not using a proctoring service\n"+
"Continue working. WebAssign will keep trying to save your assignment.\n"+
"If you close the assignment, you might lose work.\n\n"+
"If you are using an online proctoring service (like ProctorU)\n"+
"The proctor might have accidentally signed you out of WebAssign.\n"+
"Work completed after you were signed out will be lost.\n\n"+
"1. Close your assignment.\n"+
"2. Sign in to WebAssign again.\n"+
"3. Start your assignment again.\n";window.alert(message);}
this._lastError=err||new Error("Unknown Error");this.reset();},handleQuestionTouched:function(){if(this._timer===null){this._startTimer();}else{this._resetTimer();}},goState:function(s){this._state=s;this.updateDisplay();},updateDisplay:function(){var elInfo=this.elInfo;var elSavedTime=elInfo.getElements('.autosaveInfo-savedTime')[0];var elError=$$('.autosaveError');var elSaved=elInfo.getElements('.autosaveInfo-saved')[0];var elSaving=elInfo.getElements('.autosaveInfo-saving')[0];var eventOptions={weekday:'long',month:'long',day:'numeric',year:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true};var legacyOptions={weekday:'long',month:'long',day:'numeric',year:'numeric',hour:'2-digit',minute:'2-digit',hour12:true};var formattedTime;var lastSavedTime=this.lastSavedTime();if(lastSavedTime){formattedTime=lastSavedTime.toLocaleDateString("en-US",eventOptions);elSavedTime.set('text',lastSavedTime.toLocaleDateString("en-US",legacyOptions));}
if(this._lastError){elError.getElement('span').set('text',"Error, unable to save. Try again.");}
var autosaveEnabled=(this.delay()>0);var autosaveOnline=(autosaveEnabled&&(this._state!=='offline'));if(autosaveEnabled){elInfo.removeClass('hide');}else{elInfo.addClass('hide');}
$$(elError,elSaved,elSaving).addClass('hide');switch(this._state){case'initial':break;case'saved':elSaved.removeClass('hide');document.dispatchEvent(new CustomEvent('autosave_savedTime',{bubbles:true,detail:{getDate:function(){return formattedTime;}}}));break;case'saving':elSaving.removeClass('hide');break;case'offline':elError.removeClass('hide');document.dispatchEvent(new CustomEvent('autosave_error',{bubbles:true}));if(lastSavedTime){elSaved.removeClass('hide');}
break;}
if(autosaveOnline){this.assignment.setOptions({showInlineAssignmentControls:false,showUserSaveControls:false});this.assignment.addTag('autosave');}else{this.assignment.setOptions({showInlineAssignmentControls:true,showUserSaveControls:true});this.assignment.removeTag('autosave');}},_trace:function(msg,ctx){}});if(typeof exports!=='undefined'){exports.AutosaveManager=WA.Assignment.AutosaveManager;}
WA.Assignment.Tutorial=new Class({tutorialSkipStep:function(skip_step){var deployment=$('deployment').get('value');var data={tutorial:{skip_step:skip_step,deployment:deployment}};this._tutorialPost(data);return false;},tutorialStartSubsteps:function(substep){var deployment=$('deployment').get('value');var data={tutorial:{substep:substep,deployment:deployment,start_substeps:1}};this._tutorialPost(data);return false;},tutorialSkipSubstep:function(next_substep){var deployment=$('deployment').get('value');var data={tutorial:{next_substep:next_substep,deployment:deployment}};this._tutorialPost(data);return false;},tutorialStart:function(qid_pos,next_step){var deployment=$('deployment').get('value');var data={tutorial:{deployment:deployment,next_step:next_step,tutorial_start:1}};this._tutorialPost(data);return false;},tutorialSubmit:function(qid_pos){if(this.focusedQuestion){this.focusedQuestion.updateResponseCache();}
var deployment=$('deployment').get('value');var data={deployment:deployment,responses:this.getResponses(false,this.focusedQuestion,true,false),smw:this.getResponses(false,this.focusedQuestion,true,true),tutorial:{deployment:deployment}};this._formPost(false,data);return false;},_tutorialPost:function(data){this._send('tutorial',{},data);}});WA.Assignment.Tutorial.Helper=new Class({Implements:[Options],options:{removeKey:null,disable:null,enable:null}});WA.Assignment.Tutorial.Helper.Chempad=new Class({Extends:WA.Assignment.Tutorial.Helper,Implements:[Options],Binds:['_iteratePadElements','processAllTutorials','_processPadElements','processTutorial','_removeContentFromElements','removeClass','removeContent','removeKey','removeResponse'],options:{tutorials:null,stepsIndicator:null,complete:null,chemPads:null,padIdentifier:null,chemPadElements:null,keyElement:null,classElement:null,responseElement:null},initialize:function(options){this.setOptions(options);if(this.options.tutorials.length==0){return false;}
this.tutorialChildren=[];this.childPads=[];this.chemPads=[];this.collectChemPads();this.processAllTutorials.delay(12);},collectChemPads:function(){var chem=new RegExp(this.options.padIdentifier);for(var w in window){if(chem.exec(w)){this.chemPads.push(window[w]);}}},processAllTutorials:function(){this.options.tutorials.each(this.processTutorial);},processTutorial:function(tutorial){var children=tutorial.getChildren(this.options.stepsIndicator);if(children.length==0){return false;}
this.childPads=[];children.each(this._fetchPadsFromElement.bind(this));if(this._tutorialIsComplete(tutorial)){this.disablePads(children);}
else{var padsToClean=this._fetchPadsFromElement(children.getLast());padsToClean.each(this._removeContentFromElements)
var chemPads=children;chemPads.splice(chemPads.length-1,1);this.disablePads(chemPads);}},disablePads:function(elements){var pads=this._getChemPads(elements);pads.each(this._disable);var chemPads=elements.getChildren(this.options.chemPadElements);chemPads.each(this._iteratePadElements);},_iteratePadElements:function(chemPadElements){var responseElement=this.options.responseElement;var keyElement=this.options.keyElement;chemPadElements.each(function(padElement){padElement.getChildren(responseElement).removeProperty('disabled').setProperty('readonly','readonly').setStyle('background','#EEE').removeEvents('click');padElement.getChildren(responseElement).removeEvents('keyup');padElement.getChildren(keyElement).removeEvents('click');});},_clean:function(element){this.cleanElement(element);},_disable:function(pad){if(pad){pad.disable();}},_fetchPadsFromElement:function(e){var padsInElement=[];var pads=e.getChildren(this.options.chemPadElements);if(pads.length){padsInElement.push(pads);}
return padsInElement;},_removeContentFromElements:function(elements){if(elements instanceof Array){elements.each(this._clean.bind(this));}
else{this._clean(elements);}},_tutorialIsComplete:function(steps){var lastStep=steps.getLast();if(lastStep.hasClass('conclusion')){return 1;}
return 0;},_getChemPads:function(elements){var chemPadElements=this.options.chemPadElements;var padElements=[];elements.each(function(e){var padsInElement=e.getChildren(chemPadElements);if(padsInElement.length){padElements.push(padsInElement);}});this.pads=[];padElements.each(this._processPadElements);return this.pads;},_processPadElements:function(p){p.each(this._getPadsFromElement.bind(this));},_getPadsFromElement:function(element){var myPad=this.findPad(element.get('id'));this.pads.push(myPad);},cleanElement:function(element){element.getChildren(this.options.keyElement).each(this.removeKey);element.getChildren(this.options.classElement).each(this.removeClass);element.getChildren(this.options.responseElement).each(this.removeResponse);},findPad:function(padId){var singlePad='';this.chemPads.each(function(pad){this.finder=new RegExp(pad.id);if(this.finder.exec(padId)){singlePad=pad;}});return singlePad;},removeClass:function(pad){pad.removeClass('incorrect');if(pad.get('value')=='No Response'){pad.set('text','');}},removeResponse:function(pad){if(pad.get('value')=='No Response'){pad.set('value','');}},removeContent:function(elements){var lastSet=elements[elements.length-1];lastSet.each(this.clean);},removeKey:function(pad){pad.dispose();}});WA.Assignment.Submittable=new Class({Extends:WA.Assignment,Implements:[Events,WA.Assignment.Tutorial,Options],options:{showInlineAssignmentControls:true,showUserSaveControls:true},initialize:function(element,singleDelivery){this.boundOnFocus=this.onQuestionFocus.bind(this);this.boundOnRevert=this.revert.bind(this);this.boundOnRandomize=this.rerandomize.bind(this);this.killCookie=true;this._posted=false;this._changed_questions=[];this._bound_unload=this.onBeforeUnload.bind(this);this._saveButtons=$$('.finalSubmitBox input[name=SaveAll]');this.parent(element,singleDelivery);this.updateDisplay();if(Cookie.read('focusedQuestionId')){window.location.hash='#'+Cookie.read('focusedQuestionId');}
waUtil.addUnloadEvent(this._bound_unload);window.addEvent('submission_collected',this.showSubmitConfirmation);this.overlay=new waOverlay($('webAssign'),{duration:0});this._tags=new Hash({});},addTag:function(tagname){this._tags.set(tagname,true);},removeTag:function(tagname){this._tags.erase(tagname);},tags:function(){return this._tags.getKeys();},hasTags:function(){return this._tags.getLength()?1:0;},setOptions:function(options){Options.prototype.setOptions.call(this,options);this.updateDisplay();},showSubmitConfirmation:function(el){el.set('reveal');el.wink(3000);},createQuestion:function(element,options){var question;if(options&&'type'in options&&options.type==='CXPItem'){question=new WA.Question.CXPItem(this,element,options);}else{question=new WA.Question.Submittable(this,element,options);}
question.addEvent('focus',this.boundOnFocus);question.addEvent('revertQuestion',this.boundOnRevert);question.addEvent('randomizeQuestion',this.boundOnRandomize);return question;},submitQuestion:function(question){this._saveSubmit(false,question,false);return false;},submitAll:function(question){if(!question){for(var i=0;i<this.questions.length;i++){if(this.questions[i].isSaved()){this.questions[i].requireCompleteInit();}}}
this._saveSubmit(false,question,true);return false;},saveQuestion:function(question){this._saveSubmit(true,question,false);return false;},saveAll:function(question,cb){this._saveSubmit(true,question,true,cb);return false;},revert:function(question){this._send('revert',question?{pos:question.position}:{});return false;},rerandomize:function(question){this._send('randomize',question?{pos:question.position}:{});return false;},viewKey:function(){this._send('view_key');},isPreview:function(){if($('is_preview')){return true;}else{return false;}},toggleSaveValue:function(saveButton){var dataName='origValue';if(saveButton.data(dataName)){saveButton.val(saveButton.data(dataName));saveButton.removeData(dataName);}
else{saveButton.data(dataName,saveButton.val());saveButton.val('Saving...');}},updateDisplay:function(){if(this.options.showUserSaveControls){this._saveButtons.removeClass('hide');}else{this._saveButtons.addClass('hide');}
var focusedQuestion=this.focusedQuestion;if(focusedQuestion){focusedQuestion.setOptions({showInlineAssignmentControls:this.options.showInlineAssignmentControls,showUserSaveControls:this.options.showUserSaveControls});focusedQuestion.updateButtons(this._changed_questions.slice());}},_onQuestionFocus:function(event,waQBoxElement){this.parent(event,waQBoxElement);this._fireQuestionTouchedEvent();},_saveSubmit:function(save,question,entire,cb){jQuery('input[type=submit]').attr('disabled','disabled');jQuery('input[type=submit]').blur();this.updateCache();var deployment=$('deployment')&&$('deployment').get('value');var user=$('user')&&$('user').get('value');var files=this.getFileInputs();var data={deployment:deployment,user:user,responses:this.getResponses(save,question,entire,false),smw:this.getResponses(save,question,entire,true)};if(save&&!files.length){this._ajaxPost(question,data,cb);}else{this._formPost(save,data,files);}},_fireAssignmentSavedEvent:function(settingsFromServer){var evt={eventName:'assignmentSaved',assignment:this,settings:{}};settingsFromServer=(typeof settingsFromServer==='object')&&settingsFromServer||{};evt.settings=Object.append(evt.settings,settingsFromServer);this.fireEvent(evt.eventName,evt);return evt;},_fireAssignmentSaveFailedEvent:function(error){var evt={eventName:'assignmentSaveFailed',assignment:this,error:error};this.fireEvent(evt.eventName,evt);return evt;},_fireQuestionTouchedEvent:function(){var evt={eventName:'questionTouched',assignment:this};this.fireEvent(evt.eventName,evt);return evt;},_ajaxPost:function(question,data,cb){var saveButton=question?jQuery(question.element).find('input[name=save], input[name=SaveAll]').filter(':visible'):jQuery('#SaveAll');this.toggleSaveValue(saveButton);var ended=false;function end(err,result){if(ended)return;ended=true;if(err){if(err.httpStatus){console.error('Error: %s (%i)',err.httpStatusText,err.httpStatus);}else{console.error('Error',err);}
this._fireAssignmentSaveFailedEvent(err);}else{try{if(result){var updater=new WA.HtmlUpdater(this.element);updater.update(result.live_update);this.updateOriginalResponses();this.updateChangedList();this.updateDisplay();}}catch(ex){console.error('Save was successful, but an error occurred while applying the resulting live update',ex);}
var saveResponse=result;var settingsFromServer=saveResponse&&saveResponse.result&&saveResponse.result.settings||{};this._fireAssignmentSavedEvent(settingsFromServer);}
jQuery('input[type=submit]').removeAttr('disabled');this.toggleSaveValue(saveButton);cb?cb(err,result):'';}
end=end.bind(this);var Request=MooTools.Request||window.Request;try{var params={};if(data.deployment){params.dep=data.deployment;}
if(data.user){params.user=data.user;}
var postUrl=this._constructAjaxUrl(params);new Request.JSON({url:postUrl,data:JSON.encode(data),async:false,onSuccess:function(resultText){end(null,resultText)},onFailure:function(xhr){var err=new Error("while saving assignment");err.httpStatusText=xhr.statusText;err.httpStatus=xhr.status;end(err)}}).post();}catch(err){if(!(err instanceof Error)){err=new Error('Unknown Error: while initiating ajax request');}
end(err)}
return false;},_formPost:function(save,data,files){waUtil.removeUnloadEvent(this._bound_unload);this._send(save?'save':'submit',{},data,files);},_setPreviewForm:function(form){var question_id=$('question_id').get('value');var submission_count=$('submission_count').get('value');var template_id=$('template_id').get('value');form.action='/web/Faculty/Question/preview'+'?'+'question_id='+question_id+'&submission_count='+submission_count+'&template_id='+template_id;return form;},_constructAjaxUrl:function(params){var url='/web/Rest/Response/save';params=new Hash(params);if(this.hasTags()){params.extend({tags:this.tags().join(',')});}
if(params.getLength()){url+='?'+Hash.toQueryString(params);}
return url;},_constructSubmitUrl:function(action,params){params=new Hash(params);if(this.hasTags()){params.extend({tags:this.tags().join(',')});}
var url='/web/Student/Assignment-Responses/'+action+'?'+Hash.toQueryString(params);return url;},_send:function(action,queryHash,data,files){if(this._posted&&action!='submit'&&action!='revert'){return false;}
this._posted=true;if(!queryHash)queryHash={};if(!data)data={};if(!files)files=[];if(this.hasOwnProperty('currentIndex')&&!queryHash.hasOwnProperty('pos')){queryHash.pos=this.questions[this.currentIndex].position;}
var deployment=$('deployment')&&$('deployment').get('value');queryHash.dep=deployment;if($('wa')){$('wa').destroy();}
var form=new Element('form',{action:this._constructSubmitUrl(action,queryHash),enctype:'multipart/form-data',id:'wa',method:'post'});if($('context')){action=form.action.replace(/\web\//,'web/'+$('context').get('value')+'/');form.setProperty('action',action);if($('context').get('value')==='Mindtap'){this.element.getElements('.sButton').set('disabled','disabled');this.overlay.open();}}
if(this.isPreview()){form=this._setPreviewForm(form);}
if(waUtil.IE==7){form.setProperty('encoding','multipart/form-data');}
data.stamp=$('stamp')&&$('stamp').get('value');new Element('input',{type:'hidden',name:'data',value:JSON.encode(data)}).inject(form);for(var i=0;i<files.length;i++){files[i].inject(form);}
form.inject($(document.body));if(this.focusedQuestion){Cookie.write('focusedQuestionId',this.focusedQuestion.element.id);}
this.killCookie=false;try{form.submit(this);}
catch(e){};},onBeforeUnload:function(){this.updateCache();if(this.killCookie)Cookie.dispose('focusedQuestionId');var changed=this.isChanged();return changed?'You have unsaved, unsubmitted answers.':false;},onQuestionFocus:function(question){if(this.focusedQuestion){this.focusedQuestion.killFocus();this.updateChangedList();}
this.focusedQuestion=question;this.updateDisplay();},updateCache:function(){if(this.focusedQuestion){this.focusedQuestion.updateResponseCache();}else{for(var i=0;i<this.questions.length;i++){this.questions[i].updateResponseCache();}}},updateChangedList:function(){var changed=[];for(var i=0;i<this.questions.length;i++){if(this.questions[i].isChanged()){if(changed.length==9){changed.push('...');break;}
else{changed.push($(this.questions[i].element).get('data-view-position'));}}}
this._changed_questions=changed;},isChanged:function(question){if(this.isPreview()){return false;}
if(question){return question.isChanged();}
for(var i=0;i<this.questions.length;i++){if(this.questions[i].isChanged()){return true;}}
return false;},getResponses:function(save,question,entire,smw){var responses=[];var checker=smw?'isSmwChanged':'isBoxChanged';var getter=smw?'getSmwResponse':'getResponses';if(!entire){if(question&&((smw&&question.smw)||!smw)&&(question[checker]()||(!save&&question.isSaved()))){responses.push(question[getter]());}}
else{var questions=this.questions;for(var i=0;i<questions.length;i++){var current=questions[i];if(smw&&!current.smw){continue;}
if(!save&&question&&question.id!=current.id&&!current[checker]()){continue;}
if(current[checker]()||(!save&&current.isSaved())){responses.push(current[getter]());}}}
return responses;},updateOriginalResponses:function(question){if(question){question.updateOriginalResponses();}
else{for(var i=0;i<this.questions.length;i++){this.questions[i].updateOriginalResponses();}}},getFileInputs:function(){var inputs=[];for(var i=0;i<this.questions.length;i++){var q_inputs=this.questions[i].getFileInputs();if(q_inputs&&q_inputs.length){inputs=inputs.combine(q_inputs);}}
return inputs;}});function changeNotesIcon(id){waUtil.log('FIX THE changeNotesIcon IMPLEMENTATION');$('notes_link_'+id).addClass('has_note');}
WA.Assignment.Standalone=new Class({Extends:WA.Assignment,Implements:[Events,WA.Assignment.Tutorial],initialize:function(element,singleDelivery,submitUri){this._changed_questions=[];this.submitUri=submitUri;this.parent(element,singleDelivery);},createQuestion:function(element,options){return new WA.Question.Standalone(this,element,options);},submitQuestion:function(question){this._submit(false,question,false);return false;},submitAll:function(){for(var i=0;i<this.questions.length;i++){if(this.questions[i].isSaved()){this.questions[i].requireCompleteInit();}}
this._submit(false,null,true);return false;},getResponses:function(question){var responses=[];if(question){responses.push(question.getResponses());}else{var questions=this.questions;for(var i=0;i<questions.length;i++){var current=questions[i];responses.push(current.getResponses());}}
return responses;},setResponses:function(responses,question){if(question){question.setResponses(responses[0]);}else{var questions=this.questions;for(var i=0;i<questions.length;i++){var current=questions[i];if(!current||(typeof current.setResponses==="undefined")){continue;}
current.setResponses(responses[i]);}}},updateOriginalResponses:function(question){if(question){question.updateOriginalResponses();}
else{for(var i=0;i<this.questions.length;i++){this.questions[i].updateOriginalResponses();}}},getFileInputs:function(){var inputs=[];for(var i=0;i<this.questions.length;i++){var q_inputs=this.questions[i].getFileInputs();if(q_inputs&&q_inputs.length){inputs=inputs.combine(q_inputs);}}
return inputs;},updateCache:function(){if(this.focusedQuestion){this.focusedQuestion.updateResponseCache();}else{for(var i=0;i<this.questions.length;i++){this.questions[i].updateResponseCache();}}},_submit:function(question){this.updateCache();var files=this.getFileInputs();var data=this.getResponses(question);this._send({},data,files);},_constructSubmitUrl:function(params){var url=new URI(this.submitUri);url.setData(params,true);return url.toString();},_send:function(queryHash,data,files){if(!queryHash)queryHash={};if(!data)data={};if(!files)files=[];if($('wa')){$('wa').destroy();}
var form=new Element('form',{action:this._constructSubmitUrl(queryHash),enctype:'multipart/form-data',id:'wa',method:'post'});if(waUtil.IE==7){form.setProperty('encoding','multipart/form-data');}
data.stamp=$('stamp')&&$('stamp').get('value');new Element('input',{type:'hidden',name:'data',value:JSON.encode(data)}).inject(form);for(var i=0;i<files.length;i++){files[i].inject(form);}
form.inject($(document.body));try{form.submit(this);}
catch(e){};},tutorialSkipStep:function(skip_step){var tutorialAction={skip_step:skip_step};this._tutorialPost(tutorialAction);return false;},tutorialStartSubsteps:function(substep){var tutorialAction={substep:substep,start_substeps:1};this._tutorialPost(tutorialAction);return false;},tutorialSkipSubstep:function(next_substep){var tutorialAction={next_substep:next_substep};this._tutorialPost(tutorialAction);return false;},tutorialStart:function(qid_pos,next_step){var tutorialAction={next_step:next_step,tutorial_start:1};this._tutorialPost(tutorialAction);return false;},tutorialSubmit:function(qid_pos){if(this.focusedQuestion){this.focusedQuestion.updateResponseCache();}
this._tutorialPost();return false;},_tutorialPost:function(tutorialData){if(tutorialData){var form=document.getElementById('standaloneQuestion');new Element('input',{type:'hidden',name:'tutorialAction',id:'tutorialAction',value:JSON.encode(tutorialData)}).inject(form);}
return handleSubmit();}});WA.Assignment.PreviousAnswers=new Class({Extends:WA.Assignment,initialize:function(element,singleDelivery){this.parent(element,singleDelivery);},getLabsCookie:function(index){return false;}});WA.Assignment.Print=new Class({initialize:function(element,options){if(!element){return;}
this.imageSizeMax=500;this.deBug=false;this.element=element;this.element.store('WA.Assignment.Print',this);this.registerClick();this.encrypted_logstruct=options.encrypted_logstruct;},registerClick:function(){this.element.addEvent('click',function(e){e.stop();this.formatContent();window.print();this.complete();this.logPrint();if(this.deBug){console.log('Print process completed!');}}.bind(this));},complete:function(){$$('.printedFormat').destroy();if(this.deBug){if(this.deBug&&($$('.printedFormat').length>0)){console.log('yes there are still print versions in the page!');}else{console.log('print versions were destroyed!');}}
$$('.accordion, .waExpand').setProperty('style','');$$('.accordion, .waExpand').setStyle('display','block');$$('.qContent img').removeClass('bigImg');},formatContent:function(){var images=$$('.qContent img');if(images){images.each(function(image){var imageSize=image.getSize();if(imageSize.x>this.imageSizeMax){image.addClass('bigImg');}}.bind(this));}
var accordions=$$('.accordion, .waExpand');if(accordions){accordions.each(function(accordion){var clonedAccordion=accordion.clone();var clonedLIs=clonedAccordion.getElements('.waExpand > li, .accordion > li');clonedLIs.each(function(li){li.getFirst().getNext().removeProperty('style');li.getFirst().getNext().getFirst().removeProperty('style');if(accordion.hasClass('waExpand')&&accordion.getParent('div.smw')){var smwContainer=accordion.getParent('div.smw');var qid=smwContainer.getElement('input.qid').value;var pos=smwContainer.getElement('input.smwPos').value;var smwStorageId='#smw_'+pos+'_'+qid+'_work';var dijitValue=smwContainer.getElement(smwStorageId).value;var printSmwDiv=new Element('div',{'class':'smwTextArea','html':dijitValue});printSmwDiv.replaces(li.getElement('.smwTextArea'));}});clonedAccordion.addClass('printedFormat');clonedAccordion.inject(accordion,'after');accordion.setStyle('display','none');if(this.deBug&&($$('.printedFormat').length>0)){console.log('yes printed version was created!');}});}},setDebug:function(state){this.deBug=state;},logPrint:function(){var up=$('UserPass');var up_val='';if(up){up_val=up.value;var req=new Request({method:'post',url:'/wx/print/log_print',data:{log:this.encrypted_logstruct,UserPass:up_val},onComplete:function(resp){}}).send();}}});window.addEvent('domready',function(){function dependencies(){var dependencies=($('dependencies'))?$('dependencies').value:'';var dependencyArray=dependencies.split('|');var arrayLength=dependencyArray.length;var formDOM=$('webAssign');if(dependencies){for(var i=0;i<arrayLength;i=i+2){var fieldID=dependencyArray[i];var fieldDependantsArray=dependencyArray[i+1].split(',');if(fieldDependantsArray){var fieldDependantsArrayLength=fieldDependantsArray.length;var firstForm=formDOM;var fieldElement=firstForm.getElementById(fieldID);if(fieldElement){if(fieldElement.value==''){fieldElement.set('disabled','disabled');fieldElement.setStyle('background','#ddd');addBubbleHint(fieldElement);}
for(var j=0;j<fieldDependantsArrayLength;j++){setInputObj(j,fieldDependantsArray,firstForm,fieldElement);}}}}}}
function addBubbleHint(fieldElement){var disabledWrap=new Element('span',{'class':'disabledWrap'});var bLink=new Element('span',{'class':'bLink disabledLink'});var bContent=new Element('span',{'class':'bContent w220|x40|y4 disabledContent','html':'<p>You must complete other answer boxes first for this answer box to be available.</p>'});bLink.inject(disabledWrap,'bottom');bContent.inject(disabledWrap,'bottom');disabledWrap.inject(fieldElement,'before');var removedField=fieldElement.dispose();removedField.inject(disabledWrap,'top');if(window.WA&&window.WA.Components){new WA.Components.Tip(bLink);}
else{new tip({container:bLink,content:bLink.getNext()});}}
function setInputObj(num,dependantArray,form,textField){var checkField=form.getElementById(dependantArray[num]);if(checkField){var checkVar='check'+textField.get('id');var selfDependantValueArray=new Array();var fieldDependantsArrayLength=dependantArray.length;for(var i=0;i<fieldDependantsArrayLength;i++){selfDependantValueArray.push(form.getElementById(dependantArray[i]));}
checkField.store(checkVar,selfDependantValueArray);checkField.addEvent('keyup',function(){var disabled=true;var currentField=textField;var checkFieldsLength=this.retrieve(checkVar).length;for(var j=0;j<checkFieldsLength;j++){if(!($defined(this.retrieve(checkVar)[j]))||this.retrieve(checkVar)[j].value!=''){disabled=false;}else{disabled=true;break;}}
if(!disabled){currentField.removeProperty('disabled');currentField.setStyle('background','#fff');var disabledSpan=currentField.getParent();if(disabledSpan.hasClass('disabledWrap')){currentField.replaces(disabledSpan);}}});}}
dependencies();});WA.Question=new Class({Implements:[Events,Options],options:{},initialize:function(element,options){this.setOptions(options);this.element=element;var parts=element.getAttribute('id').match(/^question([0-9]+)_([0-9]+)$/);this.id=parts[1];this.position=Number(parts[2]);this.viewPosition=element.getAttribute('data-view-position');this.inViewport=false;this.timeInViewport=0;this.timeEnteredViewport;this.element.store('question',this);this.initializeLabs();},requireCompleteInit:function(){if(this.element.hasClass('initialized'))return;this.completeInit();},completeInit:function(){this.dom={};this.dom.questionContent=this.element.getElement('.qContent');this.element.swapClass('uninitialized','initialized');var link=this.element.getElement('.detailsLink.expand');var details=this.element.getElement('.questionDetail');this.detailsExpand=new WA.Effect.Expand(link,details,{onShow:this.onShowDetails.bind(this),onHide:this.onHideDetails.bind(this)});if(typeof loadPads=='function'){loadPads(this.id,this.position);}
this.element.getElements('.symimage').each(this.loadSymImage.bind(this));this.initializeBoxes();},initializeBoxes:function(){var potential_boxes=this.dom.questionContent.getElements('.wa_question_box');var l=potential_boxes.length;for(var i=0;i<l;i++){var question_box=potential_boxes[i];var id=question_box.get('value');var matches=WA.Question.Box.ID_TESTER.exec(id);if(!matches||matches.length==0)continue;var box=this.createBox(id,matches,question_box);var pos=parseInt(matches[3])+1;var boxnum=parseInt(matches[4])+1;var mark=new WA.Question.Mark($(id+'_mark'),{title:pos+'.'+boxnum,box:box});if(box){this.boxes.push(box);}}},isInViewport:function(){var rect=this.element.getBoundingClientRect();return(rect.left>=0&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)&&((rect.top>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight))||(rect.top<0&&rect.bottom>(window.innerHeight||document.documentElement.clientHeight))||(rect.top<0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.bottom>0)||(rect.top>=0&&rect.top<=(window.innerHeight||document.documentElement.clientHeight)&&rect.bottom>(window.innerHeight||document.documentElement.clientHeight))));},startTAQ:function(){this.inViewport=true;this.timeEnteredViewport=new Date();},stopTAQ:function(){var startTime=this.timeEnteredViewport;var endTime=new Date();this.timeInViewport+=endTime-startTime;this.inViewport=false;this.timeEnteredViewport=false;},createBox:function(id,matches,question_box){return false;},loadSymImage:function(input){var url=input.get('value');var img=input.getNext();img.set('src',url);},initializeLabs:function(){var count=0;this.element.getElements('.accordion').each(function(accordion,accordion_count){var state_element=accordion.getPrevious();var states=state_element.get('value').split(',');accordion.getElements('li.slide').each(function(li,part_count){var title=li.getFirst('.titleBar');var options={open:(states[part_count]=='open')};if(this.options.labsCookie){options.cookie=this.options.labsCookie.key+'_'+count++;options.cookieOptions=this.options.labsCookie.options;}
var expand=new WA.Effect.Expand(title,title.getNext(),options);}.bind(this));}.bind(this));},onFocus:function(e){this.requireCompleteInit();this.element.addClass('focused');this.fireEvent('focus',this);},onShowDetails:function(){this.element.getElements('.box_num').setStyle('display','inline');},onHideDetails:function(){this.element.getElements('.box_num').setStyle('display','none');}});WA.Question.retrieve=function(qid_pos){var elementId='question'+qid_pos;var html=$(elementId);if(html){return html.retrieve('question');}
return;}
function noUncheck(obj){obj.checked='checked';};WA.Question.Submittable=new Class({Extends:WA.Question,options:{showInlineAssignmentControls:true,showUserSaveControls:true},initialize:function(assignment,element,options){this.assignment=assignment;this.parent(element,options);this.boxes=[];},completeInit:function(){this.parent();this.dom.buttonWrap=this.element.getElement('.qButtons');this.dom.submitOneButtons=this.element.getElement('.submitSaveStandard');this.dom.submitAllButtons=this.element.getElement('.submitSaveAll');this.dom.pavButtons=this.element.getElement('.pavButtons');this.dom.questionCount=this.element.getElement('.questionCount');this.dom.saveButtons=this.element.getElements('.submitSaveStandard input[name=save], .submitSaveAll input[name=SaveAll]');this.initializeSMW();this.updateResponseCache();},setOptions:function(options){Options.prototype.setOptions.call(this,options);},isSaved:function(){return this.element.getElement('.qUtility.qAlert')?true:false;},submit:function(){return this.assignment.submitQuestion(this);},submitAll:function(){return this.assignment.submitAll(this);},save:function(){return this.assignment.saveQuestion(this);},saveAll:function(){return this.assignment.saveAll(this);},revert:function(){this.fireEvent('revertQuestion',this);return false;},rerandomize:function(){this.fireEvent('randomizeQuestion',this);return false;},killFocus:function(){this.element.removeClass('focused');if(this.dom.buttonWrap){this.dom.buttonWrap.addClass('invisible');}
this.updateResponseCache();},updateButtons:function(changedQuestions){if(!this.dom.buttonWrap)return;if(this.dom.submitOneButtons){this._updateSubmitButtons(changedQuestions);if(this.dom.pavButtons){this._updatePavButtons(changedQuestions);}}
this.dom.buttonWrap.removeClass('invisible');},_updateSubmitButtons:function(changedQuestions){changedQuestions.erase(this.viewPosition);if(changedQuestions.length&&this.options.showInlineAssignmentControls){this.dom.submitOneButtons.addClass('hide');this.dom.submitAllButtons.removeClass('hide');this.dom.questionCount.set('text',changedQuestions.join(', '));}else{this.dom.submitOneButtons.removeClass('hide');this.dom.submitAllButtons.addClass('hide');}
if(this.options.showUserSaveControls){this.dom.saveButtons.removeClass('hide');}else{this.dom.saveButtons.addClass('hide');}},_updatePavButtons:function(changedQuestions){var parent=changedQuestions.length&&this.options.showInlineAssignmentControls?this.dom.submitAllButtons:this.dom.submitOneButtons;if(this.dom.pavButtons.getParent()!=parent){this.dom.pavButtons.inject(parent);}},initializeSMW:function(){var smw=this.dom.questionContent.getElement('.smw');if(smw){this.smw=new WA.Question.Box.ShowMyWork(this,smw);}},createBox:function(id,matches,question_box){if(question_box.hasClass('static')){return false;}
var field=this.element.getElement('[name='+id+']');if(!field){return false;}
var boxType=matches[1];var boxSettingsField=$(id+'_settings');var boxSettings=boxSettingsField?JSON.decode(boxSettingsField.get('value')):{}
var boxPackage=WA.Question.Box.hasOwnProperty(boxType)?WA.Question.Box[boxType]:WA.Question.Box;return new boxPackage(this,field,boxType,boxSettings);},updateResponseCache:function(){for(var i=0;i<this.boxes.length;i++){this.boxes[i].updateResponseCache();}
if(this.smw){this.smw.updateResponseCache();}},isChanged:function(){var changed=this.isBoxChanged()||this.isSmwChanged();return changed;},isBoxChanged:function(){for(var i=0;i<this.boxes.length;i++){if(this.isPreview()||this.boxes[i].isChanged()){return true;}}
return false;},isPreview:function(){if($('is_preview')){return true;}else{return false;}},getResponses:function(){var responses=[];for(var i=0;i<this.boxes.length;i++){var box=this.boxes[i];if(this.isPreview()||box.isChanged()||this.isSaved()){responses.push(box.getResponseJson());}}
return responses.length?{id:this.id,position:this.position,responses:responses}:null;},setResponses:function(response){var responsesByBoxNum={};response.responses.forEach(function(response){responsesByBoxNum[response.box]=response;});this.boxes.forEach(function(box){var response=responsesByBoxNum[box.boxNum];if(!response){return;}
box.setResponseJson(response);});},isSmwChanged:function(){if(this.smw&&this.smw.isChanged()){return true;}
return false;},getSmwResponse:function(){if(this.smw&&(this.smw.isChanged()||this.isSaved())){return{question:this.id,position:this.position,work:this.smw.getResponse()}}
return null;},getFileInputs:function(){var inputs=[];for(var i=0;i<this.boxes.length;i++){var box=this.boxes[i];if(box.isChanged()&&box.boxType=='F'){inputs.push(box.element);}}
return inputs;},updateOriginalResponses:function(){for(var i=0;i<this.boxes.length;i++){this.boxes[i].updateOriginalResponse();}
if(this.smw){this.smw.updateOriginalResponse();}
this.updateResponseCache();}});WA.Question.Standalone=new Class({Extends:WA.Question.Submittable,getResponses:function(){var responses=[];for(var i=0;i<this.boxes.length;i++){var box=this.boxes[i];responses.push(box.getResponseJson());}
var responseObj={id:this.id,position:this.position,responses:responses,numChanges:this.numberOfBoxesChanged(),numNonEmpty:this.numberOfNonEmptyBoxes()};var previousResponses=this.getPreviousResponsesObject();if(previousResponses&&previousResponses.responses){responseObj.responses=this.combineTutorialPreviousResponses(previousResponses.responses,responses);}
var tutorialAction=this.getTutorialAction();if(tutorialAction){responseObj.tutorialData=tutorialAction;}
if(previousResponses&&previousResponses.tutorialData){responseObj.tutorialData=this.buildTutorialActions(previousResponses.tutorialData,responseObj.tutorialData);}
return responseObj;},getPreviousResponsesObject:function(){var lastResponseInput=document.getElementById('previousResponse');if(!lastResponseInput||!lastResponseInput.value){return;}
return JSON.parse(lastResponseInput.value)[0];},combineTutorialPreviousResponses:function(previousResponses,responses){var combinedResponses={};previousResponses.forEach(function(response){combinedResponses[response.box]=response.response;});responses.forEach(function(response){combinedResponses[response.box]=response.response;});var newResponses=[];for(var box in combinedResponses){newResponses.push({box:box,response:combinedResponses[box]});}
responses=newResponses;return responses;},buildTutorialActions:function(previousTutorialData,currentTutorialAction){if(!currentTutorialAction){return previousTutorialData;}
var tutorialData=previousTutorialData;tutorialData=tutorialData.concat(currentTutorialAction);return tutorialData;},getTutorialAction:function(){var tutorialActionInput=document.getElementById('tutorialAction');if(tutorialActionInput&&tutorialActionInput.value){var tutorialAction=JSON.parse(tutorialActionInput.value);return[tutorialAction];}},numberOfBoxesChanged:function(){var num=0;this.boxes.forEach(function(box){if(box.isChanged())num++;})
return num;},numberOfNonEmptyBoxes:function(){var num=0;this.boxes.forEach(function(box){if(box.normalizedResponse()!=='')num++;})
return num;}});WA.Question.Box=new Class({Implements:Events,initialize:function(question,element,boxType,boxSettings){this.question=question;this.id=element.getAttribute('name');this.element=element;this.boxType=boxType;var matches=WA.Question.Box.ID_TESTER.exec(this.id);if(matches){this.pos=matches[3];this.boxNum=matches[4];}
this.boxSettings=boxSettings;this.noEnterKey=1;this.init();if(this.noEnterKey)
this.disableEnterKey();this.element.store('box',this);},toElement:function(){return this.element;},getBoxInterfaceInfo:function(){return{elements:this.element,events:['click','mouseup','keyup','change']};},init:function(){},updateResponseCache:function(){var response=String(this._getBoxValue()).trim();var normalized=this._normalizeForCompare(response);if(!this.hasOwnProperty('_original')){this._original=normalized;}
if(normalized!=''||!this.hasOwnProperty('_response')){this._response=response;}
else{this._response=this._original;}
return this._response;},isChanged:function(){return this._original!=this._normalizeForCompare(this._response);},inFlux:function(){this.updateResponseCache();return this.isChanged();},getResponse:function(){return this._response;},getResponseJson:function(){return{box:this.boxNum,response:this.getResponse()};},setResponse:function(response){this._setBoxValue(response);this.updateResponseCache();},setResponseJson:function(obj){this.setResponse(obj.response);},updateOriginalResponse:function(){delete(this._original);this.updateResponseCache();},disableEnterKey:function(){this.disableEnterKeyForElement(this.element);},disableEnterKeyForElement:function(el){el.addEvent('keypress',function(evt){if(evt.key=='enter'){evt.stop();}});},normalizedResponse:function(){return this._normalizeForCompare(this._response);},_normalizeForCompare:function(value){return value;},_getBoxValue:function(){return this.element.get('value');},_setBoxValue:function(value){this.element.set('value',value);}});WA.Question.Box.ID_TESTER=/^RP?([A-Z])_(\d+)_(\d+)_(\d+)_(\d+)$/;function openLearnit(obj){waUtil.openWindow('/v4cgi/student/practice.tpl?struct='+
obj.struct+
'&UserPass='+
obj.userPass,);return;}
WA.Question.Mark=new Class({options:{box:'',title:''},initialize:function(element,options){if(!element)return;this.element=element;this.options=options;this.feedbackTitle=this.options.title;this.badgeImg=this.element.getElement('.badge img');this.activeTitle=this.badgeImg.get('title');this.altTitle=this.badgeImg.get('waAltTitle');this.activeAlt=this.badgeImg.get('alt');this.altAlt=this.badgeImg.get('waAlt');this._setFeedback();this._setMarkEvents();},_setMarkEvents:function(){if(!this.element.hasClass('mGrey')&&this.options.box){var boxInfo=this.options.box.getBoxInterfaceInfo();boxInfo.events.each(function(event){if(typeOf(boxInfo.elements)=='elements'){boxInfo.elements.each(function(boxElement){boxElement.addEvent(event,this._changeEvent.bind(this));},this);}else{try{$(boxInfo.elements).addEvent(event,this._changeEvent.bind(this));}catch(e){}}},this);}},_changeEvent:function(){(function(){if(this.options.box.inFlux()){this._flux(true);}else{this._flux(false);}}).bind(this).delay(50);},_flux:function(changed){if(changed){this.element.addClass('mGrey');this.badgeImg.set('title',this.altTitle);this.badgeImg.set('alt',this.altAlt);if(this.altFeedback){this.altFeedback.setStyle('display','block');}}else{this.element.removeClass('mGrey');this.badgeImg.set('title',this.activeTitle);this.badgeImg.set('alt',this.activeAlt);if(this.altFeedback){this.altFeedback.setStyle('display','none');}}},_setFeedback:function(){var content=this.element.getElement('.feedbackContent');this.altFeedback=this.element.getElement('.altFeedback');if(!content)return;if(!this.element.hasClass('mGrey')){if(this.altFeedback){this.altFeedback.setStyle('display','none');}}
new WA.Components.DragTip(this.element.getElement('.badge'),{'id':this.element.get('id')+'_feedback','height':'225px','content':content,'title':this.feedbackTitle,'className':'qContent y-tip new'});}});WA.Question.Box.A=new Class({Extends:WA.Question.Box,init:function(){if(this.boxSettings.pad&&!this.boxSettings.js_version){this.swf=new WA.Question.Box.SWF(this.boxSettings.pad+'pad_obj_'+this.id,'getXML',this.element);}},getBoxInterfaceInfo:function(){if(this.boxSettings.pad){return{elements:this.element,events:['padChanged']}}
else{return this.parent();}},_getBoxValue:function(){if(this.boxSettings.pad){if(this.boxSettings.js_version){if(jQuery.INST){return jQuery.INST().xmlGenerator.getXmlData('#editable-math-'+this.id);}}else{return this.swf.getValue();}}
return this.parent();},_setBoxValue:function(response){if(this.boxSettings.pad){if(this.boxSettings.js_version){if(jQuery.INST){var latex=jQuery.INST().externalXml.xmlToLaTex(response);var mqElement=jQuery('#editable-math-'+this.id).get(0);MathQuill(mqElement).latex(latex);}}}}});WA.Question.Box.E=new Class({Extends:WA.Question.Box,init:function(){this.noEnterKey=0;}});WA.Question.Box.B=new Class({Extends:WA.Question.Box.A,_getBoxValue:function(){return this.parent();},_setBoxValue:function(value){if(this.boxSettings.matrix){matrix_initialize_from_string(this.id,value);}
else{this.element.set('value',value);}},getBoxInterfaceInfo:function(){if(this.boxSettings.matrix){return{elements:this.element,events:['matrixChanged']};}
else if(this.boxSettings.marvin){return{elements:this.element,events:['marvinChanged']};}
else{return this.parent();}},_normalizeForCompare:function(value){if(this.boxSettings.matrix){return value.replace(/[\[\]]/g,'');}
return this.parent(value);}});WA.Question.Box.G=new Class({Extends:WA.Question.Box,init:function(){this.normalizer=new RegExp('(<[of]s>.+</[of]s>|<nosol\\s*/>)','i');},toElement:function(){return this.element;},getBoxInterfaceInfo:function(){return{elements:this.element,events:['click','mouseup']};},_getBoxValue:function(){var value=this.parent();value=value.replace(/[\r\n]/g,'');value=value.replace(/<k>.*<\/k>/,'');return value;},_setBoxValue:function(value){},_normalizeForCompare:function(value){var matches=this.normalizer.exec(value);return(matches&&matches.length)?matches[0]:'';}});WA.Question.Box.I=new Class({Extends:WA.Question.Box,init:function(){this.cursor=this.question.element.getElement('#C'+this.id+'_0');this.img=$(this.id+'_0');this.container=$('container4'+this.id+'_0');if(this.container){this.container.addEvent('click',this.moveCursor.bind(this));}
this.noEnterKey=0;},_getBoxValue:function(){return this.element.get('value');},toElement:function(){return this.cursor;},getBoxInterfaceInfo:function(){return{elements:this.container,events:['click','mouseup']};},moveCursor:function(event){var imgPos=this.getImgPos();var newPos={x:event.page.x-imgPos.x,y:event.page.y-imgPos.y};this.setCursorPos(newPos);this.saveValue(newPos);},getImgPos:function(){return this.img.getPosition();},setCursorPos:function(newPos){this.cursor.setPosition(newPos);},saveValue:function(pos){this.element.value=pos.x+','+pos.y;}});WA.Question.Box.S=new Class({Extends:WA.Question.Box,init:function(){this.choices=this.question.element.getElements('input[name='+this.id+']');if($('static_mc')){for(var i=0;i<this.choices.length;i++){this.choices[i].addEvent('click',this.staticInput.bind(this.choices[i]));}}
this.noEnterKey=0;},toElement:function(){return this.choices;},getBoxInterfaceInfo:function(){return{elements:this.choices,events:['click','mouseup']};},_getBoxValue:function(){var selected=[];for(var i=0;i<this.choices.length;i++){if(this.choices[i].checked){selected.push(this.choices[i].get('value'));}}
return selected.join(',');},_setBoxValue:function(response){var selected=response.split(',');for(var i=0;i<this.choices.length;i++){var value=this.choices[i].get('value');var elemSelected=selected.filter(function(el){return el===value;});if(this.choices[i].type!=='hidden'){if(elemSelected.length){this.choices[i].checked=true;}else{this.choices[i].checked=false;}}}},staticInput:function(checkbox){checkbox.target.disabled=true;}});WA.Question.Box.C=new Class({Extends:WA.Question.Box,init:function(){this.initialResponse=this._getBoxValue;if(!this.boxSettings.pulldown){this.choices=this.question.element.getElements('input[name='+this.id+']');}else{this.choices=this.question.element.getElements('select#'+this.id);}
if($('static_mc')){for(var i=0;i<this.choices.length;i++){this.choices[i].addEvent('click',this.staticInput.bind(this.choices[i]));}}},toElement:function(){return this.choices;},getBoxInterfaceInfo:function(){if(!this.boxSettings.pulldown){return{elements:this.choices,events:['click','mouseup','keyup']};}else{return{elements:this.choices,events:['change']};}},disableEnterKey:function(){for(var i=0;i<this.choices.length;i++){this.disableEnterKeyForElement(this.choices[i]);}},_getBoxValue:function(){if(this.boxSettings.pulldown){return this.parent();}
for(var i=0;i<this.choices.length;i++){if(this.choices[i].checked){return this.choices[i].get('value');}}
return'';},_setBoxValue:function(response){if(this.boxSettings.pulldown){return this.parent(response);}
for(var i=0;i<this.choices.length;i++){var value=this.choices[i].get('value');if(value===response){this.choices[i].checked=true;break;}}},staticInput:function(checkbox){checkbox.target.disabled=true;}});WA.Question.Box.R=new Class({Extends:WA.Question.Box,getBoxInterfaceInfo:function(){return{elements:this.element,events:['numberlineChanged']};},_setBoxValue:function(value){jQuery('#nl_div_'+this.id).trigger('numberline.load-state',value);}});WA.Question.Box.L=new Class({Extends:WA.Question.Box,init:function(){this.swf=new WA.Question.Box.SWF('pencilpad_swf_'+this.id,'getXMLfromFlash',this.element);this.normalizer=new RegExp('<cv>.*</cv>','i');},_getBoxValue:function(){return this.swf.getValue();},_normalizeForCompare:function(value){var matches=this.normalizer.exec(value);return(matches&&matches.length)?matches[0]:'';}});WA.Question.Box.Q=new Class({Extends:WA.Question.Box.A});WA.Question.Box.F=new Class({Extends:WA.Question.Box,updateOriginalResponse:function(){this._original='';},getResponseJson:function(){var value=this._getBoxValue();var data=this.parent();if(!value&&this.question.isSaved()){var previous=$('prevPtr_'+this.id);if(previous&&previous.get('value')){data.ptr=previous.get('value');data.response=$('prevFile_'+this.id).get('value');}}
return data;}});WA.Question.Box.M=new Class({Extends:WA.Question.Box,init:function(){this.choices=this.question.element.getElements('select[name='+this.id+']');},disableEnterKey:function(){for(var i=0;i<this.choices.length;i++){this.disableEnterKeyForElement(this.choices[i]);}},_getBoxValue:function(){var selected=[];for(var i=0;i<this.choices.length;i++){selected.push(this.choices[i].get('value'));}
return selected.join(',');}});WA.Question.Box.J=new Class({Extends:WA.Question.Box,init:function(){if(this.boxSettings.jme){this.smiles=$(this.id+'_smiles');this.subType=this.smiles?'jme':'';}
else{if(this.boxSettings.hasOwnProperty('aname')){this._externalApiInit('appletname');if(this.input_name){this.applet=document.applets[this.input_name];if(this.applet){this.subType='applet';this._initApplet();}}}
else if(this.boxSettings.hasOwnProperty('jname')){this._externalApiInit('javascriptname');if(this.input_name){this.subType='javascript';this._setJSField(this.boxSettings.numAnim,this.hiddenResponse);this._refreshJSCanvas(this.boxSettings.numAnim);}}}
this.noEnterKey=0;},getBoxInterfaceInfo:function(){if(this.boxSettings.jme){return{elements:this.element,events:['jmeChanged']}}
else{return this.parent();}},_externalApiInit:function(prefix){var name_field=$(prefix+'_'+this.boxSettings.numAnim);this.input_name=name_field?name_field.get('value'):'';if(this.input_name){var response_field=$(this.input_name+'_response')
var response=response_field?response_field.get('value'):'';this.hiddenResponse=response;}},_initApplet:function(){if(this.applet.isActive()){this.applet.setResponse(this.hiddenResponse||'');window.blur();window.focus();}else{this._initApplet.delay(100,this);}},_normalizeForCompare:function(value){switch(this.subType){case'applet':case'javascript':if(value){value=value.split('\t');if(value.length==3){return value[2];}}
return'';case'jme':return this.smiles.value;default:return value;}},_getBoxValue:function(){switch(this.subType){case'applet':case'javascript':return this._isCorrect()+'\t'+this._computeFeedback()+'\t'+this._getResponse();case'jme':return this.parent();default:return'';}},_isCorrect:function(){switch(this.subType){case'applet':if(this.applet.isActive()){return this.applet.isCorrect()?1:0;}
return 0;case'javascript':return this._isJSCorrect(this.boxSettings.numAnim);default:return 0;}},_computeFeedback:function(){switch(this.subType){case'applet':return this.applet.isActive()?this.applet.computeFeedback():'';case'javascript':return this._computeJSFeedback(this.boxSettings.numAnim);default:return'';}},_getResponse:function(){switch(this.subType){case'applet':return this.applet.isActive()?this.applet.getResponse():this.hiddenResponse;case'javascript':return this._getJSResponse(this.boxSettings.numAnim);case'jme':return this.parent();default:return'';}},_computeJSFeedback:function(index){try{return eval('computeFeedback_'+index+'()');}catch(e){}},_getJSResponse:function(index){try{return eval('getResponse_'+index+'()');}catch(e){}},_isJSCorrect:function(index){try{return eval('isCorrect_'+index+'()');}catch(e){}},_refreshJSCanvas:function(index){try{eval('refreshCanvas_'+index+'(jg_'+index+')');}catch(e){}},_setJSField:function(index,value){var jsFieldName="jsField"+index;var jsResponseField=this.question.element.getElement("input[name='"+jsFieldName+"']");if(jsResponseField){jsResponseField.value=value;}else{try{eval('setResponse_'+index+'("'+value+'")');}catch(e){}}}});(function(window){function resetAllApplets(){$$('input[name=reset]').each(function(reset){eval(reset.get('value'));});}
function resetApplet(num,assignment,formNum,js){var name=$((js?'javascriptname_':'appletname_')+num).get('value');var value=$(name+'_response').get('value');if(js){try{eval('setResponse_'+num+'("'+value+'")');eval('refreshCanvas_'+num+'(jg_'+num+')');}catch(e){}}else{document.applets[name].setResponse(value);}}
window.addEvent('load',function(){resetAllApplets.delay(500);});})(this);WA.Question.Box.ShowMyWork=new Class({Extends:WA.Question.Box,initialize:function(question,element){var id=element.getAttribute('id');var work=element.getElement('#'+id+'_work');this.smw_object=element;this.parent(question,work,'smw',{});},_getBoxValue:function(){var value=this.parent();value=value.replace(/^(<\s*\/?\s*(br|BR)\s*\/?>\s*)+/g,'');value=value.replace(/(<\s*\/?\s*(br|BR)\s*\/?>\s*)+$/g,'');return value;},hideOverlay:function(){var smw=this.smw_object.retrieve('smw');if(smw.overlay.id)smw.overlay.close();},showOverlay:function(){var smw=this.smw_object.retrieve('smw');if(smw.overlay.id)smw.overlay.open();}});Swiff.Uploader=new Class({Extends:Swiff,Implements:Events,options:{path:null,target:null,zIndex:9999,height:30,width:100,callBacks:null,params:{wMode:'opaque',menu:'false',allowScriptAccess:'always'},typeFilter:null,multiple:true,queued:true,verbose:false,url:null,method:'get',data:null,mergeData:true,fieldName:null,fileSizeMin:1,fileSizeMax:null,allowDuplicates:true,timeLimit:(Browser.Platform.linux)?0:30,buttonImage:null,policyFile:null,fileListMax:null,fileListSizeMax:null,instantStart:false,appendCookieData:false,fileClass:null,deBug:0
},initialize:function(options){this.addEvent('load',this.initializeSwiff,true)
.addEvent('select',this.processFiles,true)
.addEvent('complete',this.update,true)
.addEvent('fileRemove',function(file){this.fileList.erase(file);}.bind(this),true);this.setOptions(options);this.deBug=this.options.deBug;if(this.options.callBacks){Hash.each(this.options.callBacks,function(fn,name){this.addEvent(name,fn);},this);}
this.options.callBacks={fireCallback:this.fireCallback.bind(this)};var path=this.options.path;if(!path.contains('?'))path+='?noCache='+$time();this.options.container=this.box=new Element('span',{'class':'swiff-uploader-box'}).inject($(this.options.container)||document.body);this.target=$(this.options.target);if(this.target){var scroll=window.getScroll();this.box.setStyles({position:'absolute',visibility:'visible',zIndex:this.options.zIndex,overflow:'hidden',height:1,width:1,top:scroll.y,left:scroll.x});this.parent(path,{params:{wMode:'transparent'},height:'100%',width:'100%'});this.target.addEvent('mouseenter',this.reposition.bind(this,[]));this.addEvents({buttonEnter:this.targetRelay.bind(this,['mouseenter']),buttonLeave:this.targetRelay.bind(this,['mouseleave']),buttonDown:this.targetRelay.bind(this,['mousedown']),buttonDisable:this.targetRelay.bind(this,['disable'])});this.reposition();window.addEvent('resize',this.reposition.bind(this,[]));}else{this.parent(path);}
this.inject(this.box);this.fileList=[];this.size=this.uploading=this.bytesLoaded=this.percentLoaded=0;if(Browser.Plugins.Flash.version<9){this.fireEvent('fail',['flash']);}else{this.verifyLoad.delay(1000,this);}},verifyLoad:function(){if(this.loaded)return;if(!this.object.parentNode){this.fireEvent('fail',['disabled']);}else if(this.object.style.display=='none'){this.fireEvent('fail',['hidden']);}else if(!this.object.offsetWidth){this.fireEvent('fail',['empty']);}},fireCallback:function(name,args){if(name.substr(0,4)=='file'){if(args.length>1)this.update(args[1]);var data=args[0];var file=this.findFile(data.id);this.fireEvent(name,file||data,5);if(file){var fire=name.replace(/^file([A-Z])/,function($0,$1){return $1.toLowerCase();});file.update(data).fireEvent(fire,[data],10);}}else{this.fireEvent(name,args,5);}},update:function(data){$extend(this,data);this.fireEvent('queue',[this],10);return this;},findFile:function(id){for(var i=0;i<this.fileList.length;i++){if(this.fileList[i].id==id)return this.fileList[i];}
return null;},initializeSwiff:function(){this.remote('xInitialize',{width:this.options.width,height:this.options.height,typeFilter:this.options.typeFilter,multiple:this.options.multiple,queued:this.options.queued,url:this.options.url,method:this.options.method,data:this.options.data,mergeData:this.options.mergeData,fieldName:this.options.fieldName,verbose:this.options.verbose,fileSizeMin:this.options.fileSizeMin,fileSizeMax:this.options.fileSizeMax,allowDuplicates:this.options.allowDuplicates,timeLimit:this.options.timeLimit,buttonImage:this.options.buttonImage,policyFile:this.options.policyFile});this.loaded=true;this.appendCookieData();},targetRelay:function(name){if(this.target)this.target.fireEvent(name);},reposition:function(coords){coords=coords||(this.target&&this.target.offsetHeight)?this.target.getCoordinates(this.box.getOffsetParent()):{top:window.getScrollTop(),left:0,width:40,height:40}
this.box.setStyles(coords);this.fireEvent('reposition',[coords,this.box,this.target]);},setOptions:function(options){if(options){if(options.url)options.url=Swiff.Uploader.qualifyPath(options.url);if(options.buttonImage)options.buttonImage=Swiff.Uploader.qualifyPath(options.buttonImage);this.parent(options);if(this.loaded)this.remote('xSetOptions',options);}
return this;},setEnabled:function(status){this.remote('xSetEnabled',status);},start:function(){this.fireEvent('beforeStart');this.remote('xStart');},stop:function(){this.fireEvent('beforeStop');this.remote('xStop');},remove:function(){this.fireEvent('beforeRemove');this.remote('xRemove');},fileStart:function(file){this.remote('xFileStart',file.id);},fileStop:function(file){this.remote('xFileStop',file.id);},fileRemove:function(file){this.remote('xFileRemove',file.id);},fileRequeue:function(file){this.remote('xFileRequeue',file.id);},appendCookieData:function(){var append=this.options.appendCookieData;if(!append)return;var hash={};document.cookie.split(/;\s*/).each(function(cookie){cookie=cookie.split('=');if(cookie.length==2){hash[decodeURIComponent(cookie[0])]=decodeURIComponent(cookie[1]);}});var data=this.options.data||{};if($type(append)=='string')data[append]=hash;else $extend(data,hash);this.setOptions({data:data});},processFiles:function(successraw,failraw,queue){var cls=this.options.fileClass||Swiff.Uploader.File;var fail=[],success=[];if(successraw){successraw.each(function(data){var ret=new cls(this,data);if(!ret.validate()){ret.remove.delay(10,ret);fail.push(ret);}else{this.size+=data.size;this.fileList.push(ret);success.push(ret);ret.render();}},this);this.fireEvent('selectSuccess',[success],10);}
if(failraw||fail.length){fail.extend((failraw)?failraw.map(function(data){return new cls(this,data);},this):[]).each(function(file){file.invalidate().render();});this.fireEvent('selectFail',[fail],10);}
this.update(queue);if(this.options.instantStart&&success.length)this.start();}});$extend(Swiff.Uploader,{STATUS_QUEUED:0,STATUS_RUNNING:1,STATUS_ERROR:2,STATUS_COMPLETE:3,STATUS_STOPPED:4,log:function(){if(!this.deBug){return;}
if(window.console&&console.info)console.info.apply(console,arguments);},unitLabels:{b:[{min:1,unit:'B'},{min:1024,unit:'kB'},{min:1048576,unit:'MB'},{min:1073741824,unit:'GB'}],s:[{min:1,unit:'s'},{min:60,unit:'m'},{min:3600,unit:'h'},{min:86400,unit:'d'}]},formatUnit:function(base,type,join){var labels=Swiff.Uploader.unitLabels[(type=='bps')?'b':type];var append=(type=='bps')?'/s':'';var i,l=labels.length,value;if(base<1)return'0 '+labels[0].unit+append;if(type=='s'){var units=[];for(i=l-1;i>=0;i--){value=Math.floor(base/labels[i].min);if(value){units.push(value+' '+labels[i].unit);base-=value*labels[i].min;if(!base)break;}}
return(join===false)?units:units.join(join||', ');}
for(i=l-1;i>=0;i--){value=labels[i].min;if(base>=value)break;}
return(base/value).toFixed(1)+' '+labels[i].unit+append;}});Swiff.Uploader.qualifyPath=(function(){var anchor;return function(path){(anchor||(anchor=new Element('a'))).href=path;return anchor.href;};})();Swiff.Uploader.File=new Class({Implements:Events,initialize:function(base,data){this.base=base;this.update(data);},update:function(data){return $extend(this,data);},validate:function(){var options=this.base.options;if(options.fileListMax&&this.base.fileList.length>=options.fileListMax){this.validationError='fileListMax';return false;}
if(options.fileListSizeMax&&(this.base.size+this.size)>options.fileListSizeMax){this.validationError='fileListSizeMax';return false;}
return true;},invalidate:function(){this.invalid=true;this.base.fireEvent('fileInvalid',this,10);return this.fireEvent('invalid',this,10);},render:function(){return this;},setOptions:function(options){if(options){if(options.url)options.url=Swiff.Uploader.qualifyPath(options.url);this.base.remote('xFileSetOptions',this.id,options);this.options=$merge(this.options,options);}
return this;},start:function(){this.base.fileStart(this);return this;},stop:function(){this.base.fileStop(this);return this;},remove:function(){this.base.fileRemove(this);return this;},requeue:function(){this.base.fileRequeue(this);}});Fx.ProgressBar=new Class({Extends:Fx,options:{text:null,url:null,transition:Fx.Transitions.Circ.easeOut,fit:true,link:'cancel'},initialize:function(element,options){this.element=$(element);this.parent(options);var url=this.options.url;if(url){this.element.setStyles({'background-image':'url('+url+')','background-repeat':'no-repeat'});}
if(this.options.fit){url=url||this.element.getStyle('background-image').replace(/^url\(["']?|["']?\)$/g,'');if(url){var fill=new Image();fill.onload=function(){this.fill=fill.width;fill=fill.onload=null;this.set(this.now||0);}.bind(this);fill.src=url;if(!this.fill&&fill.width)fill.onload();}}else{this.set(0);}},start:function(to,total){return this.parent(this.now,(arguments.length==1)?to.limit(0,100):to/total*100);},set:function(to){this.now=to;var css=(this.fill)?(((this.fill/-2)+(to/100)*(this.element.width||1)||0).round()+'px'):((100-to)+'%');this.element.setStyle('backgroundPosition',css+' 0px').title=Math.round(to)+'%';var text=$(this.options.text);if(text)text.set('text',Math.round(to)+'%');return this;}});if(!window.FancyUpload3)var FancyUpload3={};FancyUpload3.Attach=new Class({Extends:Swiff.Uploader,options:{queued:false,instantStart:true,method:'get'},initialize:function(list,selects,options){this.list=$(list);this.selects=$(selects)?$$($(selects)):$$(selects);this.fileCount=this.list.children.length;if(this.list.getFirst().hasClass('noFilesCurrent')){this.fileCount=0;}
options.target=this.selects[0];options.fileClass=options.fileClass||FancyUpload3.Attach.File;this.parent(options);var self=this;this.selects.addEvents({click:function(){return false;},mouseenter:function(){this.addClass('hover');self.reposition();},mouseleave:function(){this.removeClass('hover');this.blur();},mousedown:function(){this.focus();}});if(this.selects.length==2){this.selects[1].setStyle('display','none');this.addEvents({'selectSuccess':this.onSelectSuccess,'fileRemove':this.onFileRemove});}},onSelectSuccess:function(){if(this.fileList.length>0){this.selects[0].setStyle('display','none');this.selects[1].setStyle('display','inline');this.target=this.selects[1];this.reposition();}},onFileRemove:function(){if(this.fileList.length==0){this.selects[0].setStyle('display','inline');this.selects[1].setStyle('display','none');this.target=this.selects[0];this.reposition();}},start:function(){if(Browser.Platform.linux&&window.confirm(MooTools.lang.get('FancyUpload','linuxWarning')))return this;return this.parent();}});FancyUpload3.Attach.File=new Class({Extends:Swiff.Uploader.File,render:function(){if(this.invalid){if(this.validationError){var msg=MooTools.lang.get('FancyUpload','validationErrors')[this.validationError]||this.validationError;this.validationErrorMessage=msg.substitute({name:this.name,size:Swiff.Uploader.formatUnit(this.size,'b'),fileSizeMin:Swiff.Uploader.formatUnit(this.base.options.fileSizeMin||0,'b'),fileSizeMax:Swiff.Uploader.formatUnit(this.base.options.fileSizeMax||0,'b'),fileListMax:this.base.options.fileListMax||0,fileListSizeMax:Swiff.Uploader.formatUnit(this.base.options.fileListSizeMax||0,'b')});}
this.remove();return;}
this.addEvents({'open':this.onOpen,'remove':this.onRemove,'requeue':this.onRequeue,'progress':this.onProgress,'stop':this.onStop,'complete':this.onComplete,'error':this.onError});this.ui={};this.ui.element=new Element('li',{'class':'file',id:'file-'+this.id});this.ui.title=new Element('span',{'class':'file-title',text:this.name});this.ui.size=new Element('span',{'class':'file-size',text:Swiff.Uploader.formatUnit(this.size,'b')});this.ui.cancel=new Element('a',{'class':'file-cancel',text:'Cancel',href:'#'});this.ui.cancel.addEvent('click',function(){this.remove();return false;}.bind(this));this.ui.element.adopt(this.ui.title,this.ui.size,this.ui.cancel).inject(this.base.list).highlight();var progress=new Element('img',{'class':'file-progress',src:'/static/show_my_work/img/progress-bar/bar.gif'}).inject(this.ui.size,'after');this.ui.progress=new Fx.ProgressBar(progress,{fit:true}).set(0);this.base.reposition();return this.parent();},onOpen:function(){this.ui.element.addClass('file-uploading');if(this.ui.progress)this.ui.progress.set(0);},onRemove:function(){this.ui=this.ui.element.destroy();},onProgress:function(){if(this.ui.progress)this.ui.progress.start(this.progress.percentLoaded);},onStop:function(){this.remove();},onComplete:function(){this.ui.element.removeClass('file-uploading');if(this.response.error){var msg=MooTools.lang.get('FancyUpload','errors')[this.response.error]||'{error} #{code}';this.errorMessage=msg.substitute($extend({name:this.name},this.response));this.base.fireEvent('fileError',[this,this.response,this.errorMessage]);this.fireEvent('error',[this,this.response,this.errorMessage]);return;}
if(this.ui.progress)this.ui.progress=this.ui.progress.cancel().element.destroy();this.ui.cancel=this.ui.cancel.destroy();var response=this.response.text||'';this.base.fireEvent('fileSuccess',[this,response]);},onError:function(){this.ui.element.addClass('file-failed');}});(function(){var phrases={'fileName':'{name}','cancel':'Cancel','cancelTitle':'Click to cancel and remove this entry.','validationErrors':{'duplicate':'File <em>{name}</em> is already added, duplicates are not allowed.','sizeLimitMin':'File <em>{name}</em> (<em>{size}</em>) is too small, the minimal file size is {fileSizeMin}.','sizeLimitMax':'The maximum file size limit is 10MB.','fileListMax':'File <em>{name}</em> could not be added, amount of <em>{fileListMax} files</em> exceeded.','fileListSizeMax':'The maximum file size limit is 10MB.'},'errors':{'httpStatus':'Server returned HTTP-Status #{code}','securityError':'Security error occured ({text})','ioError':'Error caused a send or load operation to fail ({text})'},'linuxWarning':'Warning: Due to a misbehaviour of Adobe Flash Player on Linux,\nthe browser will probably freeze during the upload process.\nDo you want to start the upload anyway?'};if(MooTools.lang){MooTools.lang.set('en-US','FancyUpload',phrases);}else{MooTools.lang={get:function(from,key){return phrases[key];}};}})();var Cengage=Cengage||{};Cengage.WebAssign=Cengage.WebAssign||{};Cengage.WebAssign.ShowMyWork=Cengage.WebAssign.ShowMyWork||{};(function(){var UploadWidget=function(rootDomId,data){this.rootDomId=rootDomId;this.data=data;data.MAX_FILES=10;this.showingError=false;this._uploadDiv=undefined;this.render();};UploadWidget.prototype.render=function(){new Cengage.WebAssign.ShowMyWork.UploadWidget.Container(this.rootDomId,this.data);}
Cengage.WebAssign.ShowMyWork.UploadWidget=UploadWidget;})();(function(){var Container=function(rootDomId,data){this.rootDomId=rootDomId;this.data=data;this.filesChangedCallback=this.filesChangedCallback.bind(this);this.selectCallback=this.selectCallback.bind(this);this.errorCallback=this.errorCallback.bind(this);this.cancelCallback=this.cancelCallback.bind(this);this.deleteCallback=this.deleteCallback.bind(this);this.fileList=undefined;this.state={files:[],error:"",manager:new Cengage.WebAssign.FileUpload.Manager({filesChangedCallback:this.filesChangedCallback,context:this.data.context,initialFiles:this.data.files})};this.render();this.state.manager.init();};Container.prototype.filesChangedCallback=function(files){this.state.files=files;this.fileList.rerender(this.state.files);};Container.prototype.progressCallback=function(fileId,progress){console.log(fileId,progress);};Container.prototype.selectCallback=function(selectedFiles){this.state.manager.add(selectedFiles);};Container.prototype.errorCallback=function(error){this._createError(error);};Container.prototype.cancelCallback=function(fileId){this.state.manager.cancel(fileId);};Container.prototype.deleteCallback=function(fileId){this.state.manager.delete(fileId);};Container.prototype.render=function(){var containerDivId=this.rootDomId;var containerDiv=document.getElementById(containerDivId);containerDiv.setAttribute("class",(this.data.context.instructor_upload?"waInstructorUploadWrap":"waUploadWrap"));var uploadDiv=document.createElement("div");uploadDiv.setAttribute("class","waUpload");this._createHeader(uploadDiv);this.fileList=new Cengage.WebAssign.ShowMyWork.UploadWidget.FileList(uploadDiv,this.state.files,this.cancelCallback,this.deleteCallback,this.data.context.show_controls);this._createFileSelector(uploadDiv,this.errorCallback,this.selectCallback);this._uploadDiv=uploadDiv;containerDiv.appendChild(uploadDiv);};Container.prototype._createHeader=function(rootDom){var h2=document.createElement("h2");var strong=document.createElement("strong");var strongText=document.createTextNode("Uploaded File");var spaceText=document.createTextNode(" ");var span=document.createElement("span");span.setAttribute("class","fileMax");var spanText=document.createTextNode("("+this.data.MAX_FILES+" file maximum)");h2.appendChild(strong).appendChild(strongText);h2.appendChild(spaceText);h2.appendChild(span).appendChild(spanText);rootDom.appendChild(h2);};Container.prototype._createFileSelector=function(rootDom,errorCallback,successCallback){var callback=function(selectedFiles,error){if(error){errorCallback(error);return;}
successCallback(selectedFiles);};var selector=new Cengage.WebAssign.FileUpload.Selector({rootDom:rootDom,callback:callback,});if(this.data.context.show_controls){this._createUploadButton(rootDom,selector);}};Container.prototype._createUploadButton=function(rootDom,selector){var fileUplodBtn=document.createElement("a");fileUplodBtn.setAttribute("class","waAttach");fileUplodBtn.setAttribute("title","Upload a file from my computer.");fileUplodBtn.setAttribute("href","#");var fileUplodBtnText=document.createTextNode("Upload File");rootDom.appendChild(fileUplodBtn).appendChild(fileUplodBtnText);fileUplodBtn.addEventListener("click",function(evt){evt.stopPropagation();evt.preventDefault();selector.click();Cengage.WebAssign.ShowMyWork.UploadWidget.Container.prototype._clearError();});};Container.prototype._createError=function(error){var prevErrorDiv=document.getElementsByClassName("fileInvalid container")[0];if(prevErrorDiv){return;}
this.showingError=true;var rootDom=this._uploadDiv;var message="ERROR";var style="uploadErrMsgCurrent uploadWarning";if(error==='MaxFileSizeError'){message="The maximum file size limit is 10MB.";style="uploadWarning";}else if(error==='InvalidExtensionError'){message="File extension not supported.";style="uploadWarning";}else if(error==='InvalidFilenameError'){message="File name contains invalid characters.";style="uploadWarning";}else{}
var errorDiv=document.createElement("div");errorDiv.setAttribute("class",style);var errorIcon=document.createElement("li");errorIcon.setAttribute("class","fileInvalid container");var errorSpan=document.createElement("span");var errorText=document.createTextNode(message);rootDom.appendChild(errorDiv).appendChild(errorIcon).appendChild(errorSpan).appendChild(errorText);}
Container.prototype._clearError=function(errorDiv){var errorDiv=document.getElementsByClassName("fileInvalid container")[0];if(errorDiv){this.showingError=false;errorDiv.remove();}}
Cengage.WebAssign.ShowMyWork.UploadWidget.Container=Container;})();(function(){var FileList=function(rootDom,files,cancelCallback,deleteCallback,show_controls){this.rootDom=rootDom;this.cancelCallback=cancelCallback;this.deleteCallback=deleteCallback;this._fileList=undefined;this.show_controls=show_controls;this.render(files);};FileList.prototype.render=function(files){var hr=document.createElement("hr");this.rootDom.appendChild(hr);this._fileList=document.createElement("ul");this._fileList.setAttribute("class","fileList");this.subrender(files);this.rootDom.appendChild(this._fileList);var hr2=document.createElement("hr");this.rootDom.appendChild(hr2);};FileList.prototype.subrender=function(files){var numFiles=files.length;if(numFiles>0){for(var i=0;i<numFiles;i++){new Cengage.WebAssign.ShowMyWork.UploadWidget.FileItem(this._fileList,files[i],this.cancelCallback,this.deleteCallback,this.show_controls);}}else{var fileItem=document.createElement("li");fileItem.setAttribute("class","noFilesCurrent");var fileText=document.createTextNode("No Files to Display");fileItem.appendChild(fileText);this._fileList.appendChild(fileItem);}};FileList.prototype.rerender=function(files){while(this._fileList.firstChild){this._fileList.removeChild(this._fileList.firstChild);}
this.subrender(files);};Cengage.WebAssign.ShowMyWork.UploadWidget.FileList=FileList;})();(function(){var FileItem=function(rootDom,file,cancelCallback,deleteCallback,show_controls){this.rootDom=rootDom;this.file=file;this.show_controls=show_controls;this.cancelCallback=cancelCallback;this.deleteCallback=deleteCallback;this.render();};FileItem.prototype.render=function(){if(this.file.isUploaded()){var fileItem=document.createElement("li");var downloadLink=document.createElement("a");var href=this.file.download_url;downloadLink.setAttribute("href",href);downloadLink.setAttribute("class",this.file.type);downloadLink.setAttribute("target","_blank");var title='Open: ';title+=this.file.name;title+=' ('+Cengage.WebAssign.FileUpload.Util.displayBytes(this.file.size,2)+') | ';downloadLink.setAttribute("title",title);var downloadLinkText=document.createTextNode(this.file.name);fileItem.appendChild(downloadLink).appendChild(downloadLinkText);var span=document.createElement("span");span.setAttribute("class","trash-span");if(this.show_controls){var deleteBtn=document.createElement("a");deleteBtn.setAttribute("class","trash-file");deleteBtn.setAttribute("title","Remove file from Show My Work");deleteBtn.setAttribute("href","#");deleteBtn.setAttribute("data-file-id",this.file.id);var self=this;deleteBtn.addEventListener("click",function(evt){evt.stopPropagation();evt.preventDefault();var fileId=this.getAttribute("data-file-id");fileId=parseInt(fileId,10);self.deleteCallback(fileId);});span.appendChild(deleteBtn);}
fileItem.appendChild(span);this.rootDom.appendChild(fileItem);}
else{var fileItem=document.createElement("li");var start_red=255;var start_green=255;var start_blue=150;var end_red=217;var end_green=230;var end_blue=239;var red=start_red-Math.round((start_red-end_red)*this.file.progress/100);var green=start_green-Math.round((start_green-end_green)*this.file.progress/100);var blue=start_blue+Math.round((end_blue-start_blue)*this.file.progress/100);var background_color="background-color: rgb("+red+", "+green+", "+blue+")";var cancelBtn=document.createElement("a");cancelBtn.setAttribute("class","file-cancel");cancelBtn.setAttribute("href","#");var cancelBtnText=document.createTextNode("Cancel");cancelBtn.setAttribute("data-file-id",this.file.id);var self=this;cancelBtn.addEventListener("click",function(evt){evt.stopPropagation();evt.preventDefault();var fileId=this.getAttribute("data-file-id");fileId=parseInt(fileId,10);self.cancelCallback(fileId);});fileItem.appendChild(cancelBtn).appendChild(cancelBtnText);fileItem.setAttribute("class","file");fileItem.setAttribute("style",background_color);var spanName=document.createElement("span");spanName.setAttribute("class","file-title");var spanNameText=document.createTextNode(this.file.name);fileItem.appendChild(spanName).appendChild(spanNameText);var spanSize=document.createElement("span");spanSize.setAttribute("class","file-size");var spanSizeText=document.createTextNode(Cengage.WebAssign.FileUpload.Util.displayBytes(this.file.size,1));fileItem.appendChild(spanSize).appendChild(spanSizeText);new Cengage.WebAssign.ShowMyWork.UploadWidget.ProgressBar(fileItem,this.file.progress);this.rootDom.appendChild(fileItem);}};Cengage.WebAssign.ShowMyWork.UploadWidget.FileItem=FileItem;})();(function(){var ProgressBar=function(rootDom,progress){this.rootDom=rootDom;this.progress=progress;this.render();};ProgressBar.prototype.render=function(){var progressBar=document.createElement("img");progressBar.setAttribute("class","file-progress");progressBar.setAttribute("src","/static/show_my_work/img/progress-bar/bar.gif");var horizontal_position=397;if(this.progress>=3){horizontal_position=400-Math.round(this.progress*(126/100));}
var progress_title=this.progress+"%";var progress_style="border: 1px solid black; background-position: -"+horizontal_position+"px 0px;";progressBar.setAttribute("title",progress_title);progressBar.setAttribute("style",progress_style);this.rootDom.appendChild(progressBar);};Cengage.WebAssign.ShowMyWork.UploadWidget.ProgressBar=ProgressBar;})();var DijitEditor=new Class({Implements:[Options,Events],options:{context:'student'},initialize:function(selector,container,options){this.setOptions(options);this.container=container;this.context=this.options.context;this.editor=dojo.query(selector,this.container)[0];this.deBug=false;if(this.editor){this.initDijitEditor();}
return this;},initDijitEditor:function(){if(!dojo.hasClass(this.editor,'dijitEditor')){this.smwEditor=new dijit.Editor({height:'175px',plugins:['bold','italic','underline','strikethrough','superscript','subscript','|','foreColor','hiliteColor','insertOrderedList','insertUnorderedList','indent','outdent','insertImage'],extraPlugins:['mathjax'],styleSheets:'/out/meTool/css/mj_plugin.css',onBlur:(!this.deBug)?this.onBlur.bind(this):function(){console.info('**debug mode**');}},this.editor);}},getEditorValue:function(){return dijit.byId(this.editor.id).getValue(false);},setFocusToEditor:function(){dijit.byId(this.editor.id).focus();},updateDijitData:function(dijitValue){var dijitHiddenInputID=this.editor.id.replace('_div','');var hiddenStorageField=$(dijitHiddenInputID);if(hiddenStorageField){dijitValue=this.htmlEncode(dijitValue);hiddenStorageField.value=dijitValue;}},htmlEncode:function(dijitValue){dijitValue=dijitValue.replace(/\'/g,'&#39;');return dijitValue;},onBlur:function(){this.fireEvent('onEditorUnload');},destroyEditor:function(){var meToolDivInitialClass=(this.options.context=='student')?'smwTextArea container':'smwComments formulaEditor container';var editorId=this.editor.id;var editorContainerId=this.editor.id+'_container';dijit.byId(this.editor.id).destroyRecursive();this.editor=dojo.create('div',{'id':editorId,'class':meToolDivInitialClass},editorContainerId,'first');return this.editor;}});DijitEditor.processMeeToolData=function(selector,dijitValue){var parsedStorage="";var collection=dojo.query(selector);if(collection.length>0){collection.forEach(function(element){parsedStorage="";var currentValue=(dijitValue)?dijitValue:element.innerHTML;element.innerHTML=currentValue;var mjNodes=currentValue.match(/\<(div|DIV) class\=['"]?mjEditorSource['"]?\>.*?\<\/(div|DIV)\>/gi);currentValue=currentValue.replace(/\$/g,'\\$');if(mjNodes){mjNodes.forEach(function(meToolNode,index){var splicedNodes=currentValue.split(meToolNode);parsedStorage+=splicedNodes[0];if(typeof parsedStorage!='undefined'){var nodeInnerHTML=meToolNode.replace(/\<(div|DIV) class\=['"]?mjEditorSource['"]?\>(.*?)\<\/(div|DIV)\>/gi,"$2");var formula=dojo.fromJson(nodeInnerHTML);var ts=new lib.ts.Stream(lib.ts.charEntities,formula);parsedStorage+="$$ \\begin{alignat}{2}\\quad\\quad\\quad&"+ts.result()+" \\end{alignat} $$";currentValue=currentValue.replace(splicedNodes[0]+meToolNode,'');}});}
parsedStorage+=currentValue;element.innerHTML=parsedStorage;MathJax.Hub.Queue(["Typeset",MathJax.Hub,element]);});}}
Widget=new Class({});window.addEvent('domready',function(){$(document.body).addClass('tundra');var smwStudentContainers=$$('.smw.smwStudent');var smwFacultyContainers=$$('.smw.smwFaculty');dojo.require("dijit.Editor");dojo.require("dojo.parser");dojo.require("lib.plugins.MathJax");dojo.require("dijit._editor.plugins.TextColor");dojo.require("dijit._editor.plugins.LinkDialog");dojo.require("dijit._editor.plugins.AlwaysShowToolbar");dojo.require("lib.ts.Stream");dojo.require("lib.ts.charEntities");if(smwStudentContainers.length){smwStudentContainers.each(function(smw){new Widget.ShowMyWork.Student(smw);});}else if(smwFacultyContainers.length){smwFacultyContainers.each(function(smw){new Widget.ShowMyWork.Faculty(smw);});}
DijitEditor.processMeeToolData('.smwTextArea.faculty');DijitEditor.processMeeToolData('.smwStudent .smwAnswer');});Widget.ShowMyWork=new Class({Implements:[Events],initialize:function(container){this.container=$(container);this.dom={};this.overlay={};this.deBug=true;this.is_new_page=String.test(document.URL,/(Student\/Assignment\-Responses)|(assignment\/preview)/);this.container.store('smw',this);},initDijitEditor:function(selector){var options=this.setDijitOptions();this.smwEditor=new DijitEditor(selector,this.container,options);this.smwEditor.setFocusToEditor();this.overlay.close();},initFileUpload:function(url,context){var qid=this.container.getElement('.questionId').get('value');var dep=this.container.getElement('.questionDep').get('value');var pos=this.container.getElement('.questionPos').get('value');var user=this.container.getElement('.questionUserId').get('value');var rnum=this.container.getElement('.questionRnum').get('value');var UserPass=this.is_new_page?$('sid').get('value'):$('UserPass').get('value');var fileList='fileList'+pos+'Current';var attach='waAttach'+pos;if($(attach)){this.fileUpload=new WAUploader(fileList,attach,{container:this.container,path:'/out/show_my_work/js/uploads/Swiff.Uploader.swf?noCache='+$time()+'question='+qid,url:url+'?session='+UserPass+'&question='+qid+'&deployment='+dep+'&user='+user,method:'get',qid:qid,dep:dep,pos:pos,user:user,context:context,fileSizeMax:10*1024*1024,errDiv:this.container.getElement('.uploadErrMsgCurrent'),defaultListItem:this.container.getElement('.noFilesCurrent'),smwContainer:this.container,verbose:true});fileList=$(fileList);fileList.store('fileUpload',this.fileUpload);if(this.fileUpload&&this.fileUpload.list.children.length>=10){$(attach).hide();this.fileUpload.options.errDiv.set('html','<span class="fileWarning">10 files have been uploaded.</span>');}}}});Widget.ShowMyWork.confirmDelete=function(name,url,requestData){var answer=confirm("Are you sure you want to Delete file "+name+" from the Upload File list?");if(answer){var data={};requestData=JSON.decode(requestData);for(var d in requestData){if(requestData.hasOwnProperty(d)){data[d]=requestData[d];}}
data=JSON.encode(data);var decodedData=JSON.decode(data);var deleteListItem=decodedData.file?$('file-'+decodedData.file):$('link-'+decodedData.link_id);var fileList=deleteListItem.getParent();var noFilesListItem=deleteListItem.getPrevious('.noFilesCurrent');var uploadButton=fileList.getNext('a.waAttach');var myFileButton=fileList.getNext('.myFiles');var req=new Request.JSON({url:url,data:data,onSuccess:function(result){fileList.retrieve('fileUpload').fileCount--;if(!uploadButton.isDisplayed()&&fileList.retrieve('fileUpload').fileCount<10){uploadButton.show();if(myFileButton){myFileButton.show();}
uploadButton.getPrevious('.uploadErrMsgCurrent').set('text','');}
deleteListItem.hide();if(fileList.retrieve('fileUpload').fileCount===0){if(!fileList.getFirst()){var noFiles=new Element('li',{'text':'No Files to Display','class':'noFiles'});noFiles.inject(fileList,'top');}else{fileList.getFirst().show();}}}}).post();}}
Widget.ShowMyWork.Student=new Class({Extends:Widget.ShowMyWork,initialize:function(container){this.parent(container);this.defaultText=0;if(this.is_new_page){this.onSmwResponseLoaded();}else{this.retrieveSmwResponse();}},createReferences:function(){this.dom.text_area=this.container.getElement('.smwTextArea');this.textarea_text=this.dom.text_area.get('text');this.textarea_text=this.textarea_text.replace(/[\n\s+]/g,'');this.container_id=this.dom.text_area.get('id');this.container_id+='_container';this.dom.textAreaContainer=this.container.getElement('.smwTextContainer');this.dom.textAreaContainer.set('id',this.container_id);this.dom.textAreaContainer.setStyle('position','relative');this.dom.textAreaContainer.setStyle('overflow','hidden');},removeDefaultText:function(e){var target=$(e.target);target.set('html','');target.removeEvent('click',this.boundClickEvent);target.setStyle('color','#000000');target.setStyle('font-size','13px');},initContainer:function(){if(this.container.getElement('.expand')){if(this.is_new_page){var li=this.container.getElement('li.first');var link=li.getElement('.titleBar');var waExpand=new WA.Effect.Expand(link,link.getNext(),{open:this.container.getElement('.expand').hasClass('open'),onShow:function(){this.setStyle('padding','10px 0 0 0');}.bind(li),onHide:function(){this.setStyle('padding','10px 0');}.bind(li)});}else{new expand({lists:this.container.getElement('ul'),trigger:0,state:this.container.getElement('.expand').hasClass('open')?'open':'close',onShow:function(){this.li.setStyle('padding','10px 0 0 0');},onHide:function(){this.li.setStyle('padding','10px 0');}});}}
var inlineHelp=this.container.getElement('.bLink');if(inlineHelp){if(this.is_new_page){new WA.Components.Tip(inlineHelp,{stopPropagation:true});}else{new tip({container:inlineHelp,content:inlineHelp.getNext()});}}},initTextArea:function(textAreaContainer){if(!this.dom.text_area.hasClass('disabled')){var smwId=this.container.get('id')+'_work';var text='You can submit show my work an unlimited number of times.';if($(smwId)&&($(smwId).get('value')!=='')){text=$(smwId).get('value');}
window.addEvent('domready',function(){this.overlay=new meeToolLoader(textAreaContainer,{spinner:false,color:'#fff',opacity:100,id:textAreaContainer.get('id')+'_overlay',text:text,styles:{left:'-1px',top:'-1px',overflow:'auto'},onClick:function(){this.fireEvent('meeToolLoader.click',textAreaContainer.get('id').replace('_work_div_container',''));}.bind(this)});if(!this.container.getParent('.waQBox').hasClass('invisible')){this.overlay.open();}else{this.overlay.close();}
DijitEditor.processMeeToolData('#'+this.overlay.id,text);}.bind(this));}},onSmwResponseLoaded:function(){this.createReferences();this.initContainer();this.initTextArea(this.dom.textAreaContainer);this.initFileUpload();this.addEvent('meeToolLoader.click',this.initDijitEditor.bind(this,'.smwTextArea',this.container));},retrieveSmwResponse:function(){var question=this.container.getElement('input[class=qid]').get('value');var deployment=this.container.getElement('input[class=smwDeploy]').get('value');var username=this.container.getElement('input[class=smwUser]').get('value');var assignment=this.container.getElement('input[class=smwAssignment]').get('value');var question_pos=this.container.getElement('input[class=smwPos]').get('value');var lastResponse=$('lastResponse');if(lastResponse){lastResponse=lastResponse.get('value');}
var data=Hash.toQueryString({deployment_id:deployment,question_id:question,username:username,aid:assignment,question_pos:question_pos,lastResponse:lastResponse});var req=new Request.HTML({async:false,url:'/wx/smw/get_response',data:data,append:this.container,onSuccess:this.onSmwResponseLoaded.bind(this)}).post();},initDijitEditor:function(){this.parent('.smwTextArea');},setDijitOptions:function(){return{context:'student',onEditorUnload:this.onEditorUnload.bind(this)};},onEditorUnload:function(){if(!this.smwEditor){return;}
var dijitValue=this.smwEditor.getEditorValue();this.overlay.setHTML(dijitValue);if(!this.container.getParent('.waQBox').hasClass('invisible')){this.overlay.open();}
this.smwEditor.updateDijitData(dijitValue);this.smwEditor.destroyEditor();delete this.smwEditor;DijitEditor.processMeeToolData('#'+this.overlay.id,dijitValue);var smwDataId=this.container.get('id')+'_work';var smwWidgetNodeId=this.container.get('id')+'_work_div';$(smwWidgetNodeId).set('html',dijitValue);},initFileUpload:function(){this.parent('/web/Student/Upload-SmwResponse/upload','SmwResponse');}});Widget.ShowMyWork.Faculty=new Class({Extends:Widget.ShowMyWork,initialize:function(container){this.parent(container);this.smwWidgetWorkId='smwscore'+this.container.get('id').replace(/smw_[0-9]+/g,'')+'_comment';this.createReferences();this.initContainer();if(this.dom.textAreaContainer){this.initTextArea(this.dom.textAreaContainer);this.onSmwGradingLoaded();this.initFileUpload();}},createReferences:function(){this.container=$(this.container);this.dom.text_area=Element.getElements(this.container,'.smwTextArea')[0];this.dom.modeSetting=Element.getElements(this.container,'.modeText')[0];this.dom.mode=this.dom.modeSetting.get('html').replace(/\(/,'').replace(/\)/,'');this.dom.textAreaContainer=Element.getElement(this.container,'.smwCommentContainer');this.dom.textArea=Element.getElement(this.container,'.smwComments');},initTextArea:function(textAreaContainer){var text='';if($(this.smwWidgetWorkId)&&($(this.smwWidgetWorkId).get('html')!=='')){text=$(this.smwWidgetWorkId).get('html');}
window.addEvent('domready',function(){this.overlay=new meeToolLoader(textAreaContainer,{spinner:false,color:'#fff',opacity:100,id:textAreaContainer.get('id')+'_overlay',text:text,styles:{left:'-1px',top:'-1px',overflow:'auto',border:'1px solid #7F9DB9'},onClick:function(){this.fireEvent('meeToolLoader.click',textAreaContainer.get('id').replace('_work_div_container',''));}.bind(this)});if(!this.container.getParent('.waQBox').hasClass('invisible')){this.overlay.open();}else{this.overlay.close();}
DijitEditor.processMeeToolData('#'+this.overlay.id,text);}.bind(this));},initContainer:function(){switch(this.dom.mode){case'Disabled':this.container.hide();break;case'Optional':this.container.getElement('.titleBar').setStyle('cursor','default');break;case'Required':this.container.getElement('.titleBar').setStyle('cursor','default');this.dom.modeSetting.addClass('required');break;}},onSmwGradingLoaded:function(){this.addEvent('meeToolLoader.click',this.initDijitEditor.bind(this,'.smwComments',this.container));},initDijitEditor:function(){this.parent('.smwComments');},initFileUpload:function(){this.parent('/web/Faculty/Upload-SmwScore/upload','SmwScore');},onEditorUnload:function(){if(!this.smwEditor){return;}
var dijitValue=this.smwEditor.getEditorValue();this.overlay.setHTML(dijitValue);if(!this.container.getParent('.waQBox').hasClass('invisible')){this.overlay.open();}
this.smwEditor.updateDijitData(dijitValue);this.dom.textArea=this.smwEditor.destroyEditor();delete this.smwEditor;DijitEditor.processMeeToolData('#'+this.overlay.id,dijitValue);$(this.smwWidgetWorkId).set('html',dijitValue);},setDijitOptions:function(){return{context:'faculty',onEditorUnload:this.onEditorUnload.bind(this)};}});var BrowserCheck=new Class({checkBrowser:function($){this.CHROME_VERSION=65;this.FF_VERSION=59;this.SAFARI_VERSION=11;this.NEW_IE_VERSION=11;this.EDGE_VERSION=16;var warningString='';var link='';if($('ldb_status')){var ldb_status=$('ldb_status').get('value');if(ldb_status==='curr'){return;}else{warningString="This version of Lockdown Browser is not supported. ";}}else{if(Browser.Platform.android||Browser.Platform.ios||(!Browser.Platform.mac&&!Browser.Platform.win&&!Browser.Platform.linux)){var userAgent=navigator.userAgent.toLowerCase();var regex;if(Browser.safari&&this._statusForBrowserVersion(parseFloat(Browser.version),this.SAFARI_VERSION)==0&&/ipad/i.test(userAgent)&&(regex=/cpu os (\d+)_(\d+)/i)&&userAgent.match(regex)[1]>=6){warningString='WebAssign is supported for Safari on iPad, but some features and content do not work. ';link=this._createHelpLink('c_a_ipad_issues.htm','More information');}else{warningString='WebAssign is not supported for this device. Some features or content might not work. ';link=this._createHelpLink('common/system-requirements.htm','System requirements');}
}else{var status=this._checkDesktopBrowsers();if(status==0){return;}else{warningString='WebAssign is not supported for this browser version. Some features or content might not work. ';link=this._createHelpLink('common/system-requirements.htm','System requirements');}}}
var span=new Element('span',{html:warningString});if(link){link.inject(span);}
var div=new Element('div',{'class':'browserWarning'});span.inject(div);if($('paymentBar')){div.inject($('paymentBarBuffer'),'after');}else if($('webAssignShell')){div.inject($('webAssignShell'),'top');}},_createHelpLink:function(topic,text){return new Element('a',{href:"javascript:browser_check.openHelp('"+topic+"')",html:text});},_checkDesktopBrowsers:function(){var status=0;var version=parseFloat(Browser.version);if(this._isEdge()){status=this._statusForEdgeBrowserVersion(this.EDGE_VERSION);}else if(Browser.chrome){status=this._statusForBrowserVersion(version,this.CHROME_VERSION);}else if(Browser.firefox){status=this._statusForBrowserVersion(version,this.FF_VERSION);}else if(Browser.safari){status=this._statusForBrowserVersion(version,this.SAFARI_VERSION);}else if(this._isNewIE()){status=this._statusForNewIEBrowserVersion(this.NEW_IE_VERSION);}else{status=2;}
return status;},_statusForBrowserVersion:function(version,supportedVersion){if(version<supportedVersion){return 1;}
return 0;},_isNewIE:function(){var userAgent=navigator.userAgent.toLowerCase();var engine_search=/Trident\/\d+.\d+/i
return engine_search.test(userAgent);},_isEdge:function(){var userAgent=navigator.userAgent.toLowerCase();var engine_search=/Edge\/\d+.\d+/i
return engine_search.test(userAgent);},_statusForEdgeBrowserVersion:function(supportedVersion){var version_search=/Edge\/(\d+)/i
return this._statusForMicrosoftBrowserVersion(supportedVersion,version_search);},_statusForNewIEBrowserVersion:function(supportedVersion){var version_search=/rv:(\d+)/i
return this._statusForMicrosoftBrowserVersion(supportedVersion,version_search);},_statusForMicrosoftBrowserVersion:function(supportedVersion,version_search){var userAgent=navigator.userAgent.toLowerCase();var result=version_search.exec(userAgent);if(!result||result.length<2){return 1;}
return this._statusForBrowserVersion(result[1],supportedVersion);},openHelp:function(topic){if(/instructor/i.test($$('.help').get('href'))){openWindow('/manual/instructor_guide/?q='+topic,'Help','width=950,height=700,scrollbars=yes,resizable=yes,menubar=no,toolbar=yes,location=yes');}else{openWindow('/manual/student_guide/?q='+topic,'support','width=950,height=700,scrollbars=yes,resizable=yes');}}});BrowserCheck.getInstance=function(){if(BrowserCheck.__instance__==null){BrowserCheck.__instance__=new BrowserCheck();}
return BrowserCheck.__instance__;};var browser_check=BrowserCheck.getInstance();window.addEvent('domready',function(){browser_check.checkBrowser(document.id);});var waOverlay=new Class({Implements:[Options,Events],options:{id:'overlay',color:'#fff',duration:500,opacity:0.4,zIndex:999999,spinner:false,spinnerContainer:'waSpinner',placement:'bottom',position:'absolute',styles:{}},initialize:function(container,options){this.setOptions(options);this.container=$(container);this.id=this.options.id;this.color=this.options.color;this.opacity=this.options.opacity;this.duration=this.options.duration;this.spinnerContainer=this.options.spinnerContainer;this.placement=this.options.placement;this.position=this.options.position;this.styles=this.options.styles;this.overlay=new Element('div',{id:this.id,'class':'waOverlay',styles:{position:this.position,background:this.color,left:0,top:0,'z-index':this.options.zIndex},events:{click:function(){this.fireEvent('click');}.bind(this)}});this.overlay.setStyles(this.styles);this.overlay.inject(this.container);this.tween=new Fx.Tween(this.overlay,{duration:this.options.duration,link:'cancel',property:'opacity',onStart:function(){var size=this.container.getScrollSize();this.overlay.setStyles({width:'100%',height:'100%'});}.bind(this),onComplete:function(){this.fireEvent(this.overlay.get('opacity')==this.options.opacity?'show':'hide');}.bind(this)});},open:function(){this.fireEvent('open');this.tween.start(this.options.opacity);this.spinner('open');},close:function(){this.fireEvent('close');this.tween.start(0);this.spinner('close');},spinner:function(option){if(this.options.spinner&&option=='open'){this.waspin=new waspinner(this.spinnerContainer);$('waSpinner').setStyles({'margin':'0','width':'70px','top':'50%','left':'50%','position':'fixed'});this.waspin.show();}else if(this.options.spinner&&option=='close'){this.waspin.remove();}}});var waspinner=new Class({Implements:[Options,Events,Class.Occlude],options:{innerRadius:17,outerRadius:27,strokeCount:12,strokeWidth:7,strokeColor:'#666'},initialize:function(container,options){this.setOptions(options);this.container=(container)?document.id(container):$(document.body);this.innerRadius=this.options.innerRadius.toInt();this.outerRadius=this.options.outerRadius.toInt();this.strokeCount=this.options.strokeCount.toInt();this.strokeWidth=this.options.strokeWidth.toInt();this.strokeColor=this.options.strokeColor;this.opacity=[];this.sectors=[];this.sectorsCount;this.tick;this.r;if(this.occlude('spinny',this.container)){return this.occluded;}
this.container.store('spinny',this);},show:function(){this.waSpin=spinner(this.container,this.innerRadius,this.outerRadius,this.strokeCount,this.strokeWidth,this.strokeColor);},remove:function(){this.waSpin.clear();}});function spinner(holderid,R1,R2,count,stroke_width,colour){var sectorsCount=count||12,color=colour||"#fff",width=stroke_width||15,r1=Math.min(R1,R2)||35,r2=Math.max(R1,R2)||60,cx=r2+width,cy=r2+width,r=Raphael(holderid,r2*2+width*2,r2*2+width*2),sectors=[],opacity=[],beta=2*Math.PI/sectorsCount,pathParams={stroke:color,"stroke-width":width,"stroke-linecap":"round"};Raphael.getColor.reset();for(var i=0;i<sectorsCount;i++){var alpha=beta*i-Math.PI/2,cos=Math.cos(alpha),sin=Math.sin(alpha);opacity[i]=1/sectorsCount*i;sectors[i]=r.path([["M",cx+r1*cos,cy+r1*sin],["L",cx+r2*cos,cy+r2*sin]]).attr(pathParams);if(color=="rainbow"){sectors[i].attr("stroke",Raphael.getColor());}}
var tick;(function ticker(){opacity.unshift(opacity.pop());for(var i=0;i<sectorsCount;i++){sectors[i].attr("opacity",opacity[i]);}
r.safari();tick=setTimeout(ticker,1000/sectorsCount);})();return r;}
var meeToolLoader=new Class({Extends:waOverlay,options:{text:'',styles:null},initialize:function(container,options){this.setOptions(options);this.parent(container,options);this.text=this.options.text;this.overlay.setStyles({visibility:'visible',opacity:100,border:'1px solid #ccc',top:'-1px',left:'-1px',overflow:'auto',cursor:'text'});if(this.options.styles){this.overlay.setStyles(this.options.styles);}
this.overlay.addClass('waOverlay');this.textDiv=new Element('div',{styles:{background:this.color,padding:'10px',left:0,top:0,'z-index':this.options.zIndex}}).inject(this.overlay);},setHTML:function(value){this.textDiv.set('html',value);}});FormValidation=new Class({enforceRange:function(field,minValue,maxValue,defaultValue){var value=Number(field.get('value'));if(isNaN(value)){field.set('value',defaultValue||0);}else if(value<minValue){field.set('value',minValue);}else if(value>maxValue){field.set('value',maxValue);}}});WA.HtmlUpdater=new Class({Extends:WA,initialize:function(rootElement){this.root=rootElement;},update:function(data){var root=new XmlElement(data);root.firstChild.getChildren().each(this.handleUpdate.bind(this));},handleUpdate:function(node){var command=node.get('tag');var scope=node.getElement('scope').get('text');var targets=this.root.getElements(scope);switch(command){case'set':var property=node.getElement('field').get('text');var value=node.getElement('value').get('text');var decoded=decodeURIComponent(value);targets.set(property,decoded);break;default:throw new Error('Unsupported HtmlUpdater command:  '+command);break;}}});WAUploader=new Class({Extends:FancyUpload3.Attach,options:{dep:null,qid:null,pos:null,context:null,smwContainer:null,errDiv:null,defaultListItem:null,onSelectFail:function(files){files.each(function(file){this.errorMsg=new Element('li',{'class':'fileInvalid container',events:{click:function(){this.destroy();}}}).adopt(new Element('span',{html:file.validationErrorMessage||file.validationError})).inject(this.options.errDiv,'bottom');this.options.errDiv.addClass('uploadWarning');this.startDissolveWithDelay.delay(5000,this,this.errorMsg);},this);},onFileSuccess:function(file){var data={};data.deployment=this.options.dep;data.question=this.options.qid;data.question_num=this.options.pos;data.user=this.options.user;encodedData=JSON.encode(data);var req=new Request.JSON({url:'/web/Rest/'+this.options.context+'/info',data:encodedData,onSuccess:function(result){if(result.extended){this.fileCount++;var last_upload=result.extended.files.getLast();var file_metadata='Open File: '+last_upload.name+
' Size: ('+last_upload.size/1024+
'kB) Modified: '+last_upload.upload_date;var list_item=new Element('li',{id:'file-'+last_upload.id,'class':'container'});var link=new Element('a',{href:last_upload.url,target:'_blank',text:last_upload.name,title:file_metadata,'class':last_upload.type});var trash_span=new Element('span',{'class':'trash-span'});var trash_link=new Element('a',{'class':'trash-file',href:'javascript:ShowMyWork.confirmDelete("'+last_upload.name+
'","'+last_upload.delete_url+
'","{question:'+data.question+
',deployment:'+data.deployment+
',user:'+data.user+
',file:'+last_upload.id+'}");',title:'Remove file from Show My Work'});trash_link.inject(trash_span);link.inject(list_item);trash_span.inject(list_item);list_item.replaces(file.ui.element);if(this.options.defaultListItem&&this.options.defaultListItem.isDisplayed()){this.options.defaultListItem.hide();}
if(this.fileCount>=10){this.selects.each(function(e){e.hide();});if(this.list.getNext('.myFiles')){this.list.getNext('.myFiles').hide();}
this.options.errDiv.set('html','<span class="fileWarning">10 files have been uploaded.</span>');}}}.bind(this)}).post();},onFileError:function(file){this.serverMsg=new Element('span',{html:file.errorMessage,'class':'file-error'}).inject(this.options.errDiv);this.startDissolveWithDelay.delay(5000,this,this.serverMsg);},onFileRequeue:function(file){file.ui.element.getElement('.file-error').destroy();file.ui.cancel.set('html','Cancel').removeEvents().addEvent('click',function(){file.remove();return false;});this.start();}},startDissolveWithDelay:function(el){new Fx.Reveal(el,{onComplete:el.destroy.bind(el)}).dissolve();}});WA.Assignment.Timer=new Class({Implements:[Events,Options],options:{deBug:false,warning:60,serverCheck:120,reminders:[2700,1800,900]},initialize:function(element,options){this.setOptions(options);this.element=element;this.timeLeft=null;this.interval=1000;this.init();this.connect(false);},init:function(){this.arrow=this.element.getElement('.arrow');this.hours=this.element.getElement('.hours');this.minutes=this.element.getElement('.minutes');this.seconds=this.element.getElement('.seconds');this.progressBar=this.element.getElement('.timeLeft');this.timerBg=this.element.getElement('.timerWrap');this.timerMessage=this.element.getElement('.timerMessage');this.message=this.timerMessage.getFirst();},toElement:function(){return this.element;},run:function(){if((this.timeLeft%this.options.serverCheck==0)||(this.timeLeft==null)){this.connect();}
if(this.timeLeft==0){this.fireEvent('timerComplete',this);}
var hourResult=this._toHours(this.timeLeft);var minuteResult=this._toMinutes(hourResult.remainder);this.updateTime(hourResult.hours,minuteResult.minutes,minuteResult.remainder);this.updateProgressBar();this.updateBackground();this.checkReminders();this.timeLeft--;},connect:function(init){var data={'deployment':$('deployment').get('value'),'user':$('user').get('value')};jQuery.ajax({url:'/web/Rest/LogTimer/info',dataType:'json',type:'POST',contentType:'application/json',data:JSON.stringify(data),async:(init)?init:true,error:function(xhr){this.setMessage('server connection failure, try reloading the page.');}.bind(this),ajaxSend:function(){this.setMessage('checking server...');}.bind(this),success:function(result){if(result){this.timeLeft=result.data.timer.timeLeft;this.totalTime=result.data.timer.totalTime;if(this.timeLeft==0){this.setMessage('time is up');}else{this.setMessage('time left...');}
if(this.intervalId==null){this.intervalId=this.run.periodical(this.interval,this);}}}.bind(this)});},updateBackground:function(){if((this.timeLeft)&&this.timeLeft<=this.options.warning){this.timerBg.addClass('bRed');this.timerBg.removeClass('bBlue');}else{this.timerBg.addClass('bBlue');this.timerBg.removeClass('bRed');}},updateProgressBar:function(){if(this.timeLeft<=this.options.warning){this.progressBar.addClass('red');this.progressBar.removeClass('blue');}else{this.progressBar.addClass('blue');this.progressBar.removeClass('red');}
var barWidth=((this.timeLeft/this.totalTime)*100);this.progressBar.setStyle('width',barWidth+'%');},effects:function(){this.easeOut=new Fx.Morph($('timer'),{transition:Fx.Transitions.Back.easeOut,duration:500});this.easeIn=new Fx.Morph($('timer'),{transition:Fx.Transitions.Back.easeIn,duration:500});},clickHandle:function(){this.state='show';this.element.addEvent('click',function(){if(this.state=='show'){this.hide();}else{this.show();}}.bind(this));},show:function(){this.easeOut.start({'margin-top':-20});this.arrow.setStyle('background','url(/wastatic/common/img/timer/arrowUp.png) no-repeat');this.state='show';fireEvent('WA.Assignment.Timer.show');},hide:function(){this.easeIn.start({'margin-top':-100});this.arrow.setStyle('background','url(/wastatic/common/img/timer/arrowDown.png) no-repeat');this.state='hide';fireEvent('WA.Assignment.Timer.hide');},checkReminders:function(){for(var i=0;i<this.options.reminders.length;i++){if((this.timeLeft%this.options.reminders[i])==0){this.show();}
if((this.timeLeft%(this.options.reminders[i]-10))==0){this.hide();}}},setMessage:function(text){this.message.set('html','<h2>'+text+'</h2>');},updateTime:function(hours,minutes,seconds){minutes=(minutes<10)?'0'+minutes:minutes;seconds=(seconds<10)?'0'+seconds:seconds;this.hours.set('html','<h3>'+hours+'</h3>');this.minutes.set('html','<h3>'+minutes+'</h3>');this.seconds.set('html','<h3>'+seconds+'</h3>');},_toHours:function(seconds){var hours=(seconds/3600);secondsRemainder=Math.round((hours%1)*3600);hours=(hours<1)?0:Math.floor(hours);return{hours:hours,remainder:secondsRemainder};},_toMinutes:function(){var minutes=(secondsRemainder/60);secondsRemainder=Math.round((minutes%1)*60);minutes=(minutes<1)?0:Math.floor(minutes);return{minutes:minutes,remainder:secondsRemainder};}});WA.Assignment.StudentAssignmentTimer=new Class({Extends:WA.Assignment.Timer,initialize:function(element,options){if(!$('deployment'))return;this.parent(element,options);this.boundOnComplete=this.complete.bind(this);this.addEvent('timerComplete',this.boundOnComplete);},init:function(){this.parent();this.content=$('waTimerModal');if(this.content){this.element.store('WA.Assignment.StudentAssignmentTimer',this);this.modal=new WA.Components.Modal(document.body,{content:this.content});this.setTimedAssignment();this.updateBackground();this.effects();this.clickHandle();this.show.delay(2000,this);}},complete:function(){clearInterval(this.intervalId);document.body.addEvent('WA.Components.Modal.show',this.options.can_submit?this._autoSave.delay(15000):this._autoReturn.delay(15000));this.content.setStyle('display','block');this.modal.show();},setTimedAssignment:function(){WA.Assignment.implement({isTimed:function(){return true;}});},_autoSave:function(){var deployment=$('deployment');var assignmentStorageElement=$('assignment'+deployment.get('value'));var assignment=assignmentStorageElement.retrieve('assignment');assignment.submitAll();},_autoReturn:function(){var studentView=0;var studentViewField=$('openStudentView');if(studentViewField){studentView=studentViewField.get('value');}
window.location='/v4cgi/student.pl?openStudentView='+studentView;}});Mask=new Class({Implements:[Options,Events],Binds:['position'],options:{style:{},'class':'mask',maskMargins:false,useIframeShim:true,iframeShimOptions:{}},initialize:function(target,options){this.target=document.id(target)||document.id(document.body);this.target.store('mask',this);this.setOptions(options);this.render();this.inject();},render:function(){this.element=new Element('div',{'class':this.options['class'],id:this.options.id||'mask-'+String.uniqueID(),styles:Object.merge({},this.options.style,{display:'none'}),events:{click:function(event){this.fireEvent('click',event);if(this.options.hideOnClick)this.hide();}.bind(this)}});this.hidden=true;},toElement:function(){return this.element;},inject:function(target,where){where=where||(this.options.inject?this.options.inject.where:'')||this.target==document.body?'inside':'after';target=target||(this.options.inject&&this.options.inject.target)||this.target;this.element.inject(target,where);if(this.options.useIframeShim){this.shim=new IframeShim(this.element,this.options.iframeShimOptions);this.addEvents({show:this.shim.show.bind(this.shim),hide:this.shim.hide.bind(this.shim),destroy:this.shim.destroy.bind(this.shim)});}},position:function(){this.resize(this.options.width,this.options.height);this.element.position({relativeTo:this.target,position:'topLeft',ignoreMargins:!this.options.maskMargins,ignoreScroll:this.target==document.body});return this;},resize:function(x,y){var opt={styles:['padding','border']};if(this.options.maskMargins)opt.styles.push('margin');var dim=this.target.getComputedSize(opt);if(this.target==document.body){this.element.setStyles({width:0,height:0});var win=window.getScrollSize();if(dim.totalHeight<win.y)dim.totalHeight=win.y;if(dim.totalWidth<win.x)dim.totalWidth=win.x;}
this.element.setStyles({width:Array.pick([x,dim.totalWidth,dim.x]),height:Array.pick([y,dim.totalHeight,dim.y])});return this;},show:function(){if(!this.hidden)return this;window.addEvent('resize',this.position);this.position();this.showMask.apply(this,arguments);return this;},showMask:function(){this.element.setStyle('display','block');this.hidden=false;this.fireEvent('show');},hide:function(){if(this.hidden)return this;window.removeEvent('resize',this.position);this.hideMask.apply(this,arguments);if(this.options.destroyOnHide)return this.destroy();return this;},hideMask:function(){this.element.setStyle('display','none');this.hidden=true;this.fireEvent('hide');},toggle:function(){this[this.hidden?'show':'hide']();},destroy:function(){this.hide();this.element.destroy();this.fireEvent('destroy');this.target.eliminate('mask');}});Element.Properties.mask={set:function(options){var mask=this.retrieve('mask');if(mask)mask.destroy();return this.eliminate('mask').store('mask:options',options);},get:function(){var mask=this.retrieve('mask');if(!mask){mask=new Mask(this,this.retrieve('mask:options'));this.store('mask',mask);}
return mask;}};Element.implement({mask:function(options){if(options)this.set('mask',options);this.get('mask').show();return this;},unmask:function(){this.get('mask').hide();return this;}});WA.Components.Modal=new Class({Extends:Mask,Implements:Options,options:{trigger:null,content:null,execute:null,'class':'waModal',waiAria:true,focusTarget:null,is_password_modal:false},initialize:function(target,options){this.setOptions(options);this.parent(target,options);this.contents();this.trigger();this.effect=new Fx.Morph(this.element,{duration:500,transition:Fx.Transitions.Quad.easeInOut});this._setActionButton();},toElement:function(){return this.options.content;},trigger:function(){if(!this.options.trigger||(typeOf(this.options.trigger)!='elements'&&typeOf(this.options.trigger)!='element'))return;this.options.trigger.addEvent('click',this.show.bind(this));},contents:function(){if(this.options.content){this.options.content.store('modal',this);this.modalShim=new Element('div',{'class':'waModalShim container'});this.modalPanelWrap=new Element('div',{'class':'waModalPanelWrap container'});this.modalPanel=new Element('div',{'class':'waModalPanel container'});if(typeof this.options.content=='string'){this.modalPanel.set('html',this.options.content);}else{this.modalPanel.adopt(this.options.content);}
this.modalPanel.inject(this.modalPanelWrap);this.modalPanelWrap.inject(this.modalShim);this.modalShim.inject(this.element);if(this.options.content.get('id')){this.id=this.options.content.get('id');if(this.options.waiAria&&this.options.trigger){this.attachWaiAria();}}}},show:function(e){if(e)e.preventDefault();this.parent();setTimeout(function(){this._give_focus()}.bind(this),100);},_give_focus:function(){if(this.options.focusTarget){this.options.focusTarget.focus();}
else{this.options.content.getElement("input").focus();}
if(this.options.is_password_modal){this.options.focusTarget.select();}},showMask:function(){this.element.setStyle('display','block');this.effect.start({'opacity':1});this.hidden=false;this.fireEvent('show');this.fireEvent('WA.Components.Modal.show');},hideMask:function(){this.effect.start({'opacity':0}).chain(function(){this.element.setStyle('display','none');});this.hidden=true;this.fireEvent('hide');this.fireEvent('WA.Components.Modal.hide');},attachWaiAria:function(element){var id=this.id;this.options.content.set('role','modal');if(id)this.options.trigger.set('aria-describedby',id);if(!this.waiAria){this.waiAria={show:function(){this.options.content.set('aria-hidden','false');},hide:function(){this.options.content.set('aria-hidden','true');}};}
this.addEvents(this.waiAria);},detachWaiAria:function(element){if(this.waiAria){this.options.content.erase('role');this.options.content.erase('aria-hidden');this.removeEvents(this.waiAria);}},_setActionButton:function(){if(!this.options.action)return;this.actionButton=this.options.content.getElement('.action');if(this.actionButton){this.actionButton.addEvent('click',this._boundAction.bind(this));this.actionEvents={show:function(){if(!this.options.focusTarget){this.actionButton.focus();}}};this.addEvents(this.actionEvents);}},_boundAction:function(){this.options.action();if(this.options.focusTarget){this._give_focus();}}});WA.Components.Modal.Restrictions=new Class({Extends:WA.Components.Modal,initialize:function(target,options){this.parent(target,options);this._setLDBLink();this._enable_enter_key_for_passwords(this);},_enable_enter_key_for_passwords:function(){var that=this;if(this.options.focusTarget&&this.options.is_password_modal){this.options.focusTarget.addEvent('keyup:keys(enter)',function(){that.options.action();setTimeout(function(){that._give_focus()}.bind(that),100);});}},show:function(e){this.parent();},_setLDBLink:function(){var downloadLDBLink=this.options.content.getElement('.downloadLink');if(downloadLDBLink){var uPass=$('UserPass').value;downloadLDBLink.addEvent('click',function(){window.open("/v4cgi/ldb/download.tpl?UserPass="+uPass,'Download_LDB','location=no,menubar=no,toolbar=no,scrollbars=no,resizable=yes,status=no,titlebar=no,width=483,height=400');return false;});}},_onShow:function(){var data={'deployment':this.options.deployment,'user':this.options.user};new Request.JSON({url:'/web/Rest/LogTimer/info',data:JSON.encode(data),onFailure:function(xhr){},onRequest:function(){}.bind(this),onSuccess:function(result){if(result){this.timeLeft=result.data.timer.timeLeft;this.totalTime=result.data.timer.totalTime;this._setTimeInModal(this.timeLeft);}}.bind(this)}).post();},_setTimeInModal:function(timeLeft){var timeContent=this.options.content.getElement('.modalTimeMessage');timeContent.set('html',this._formatTimeForModal());},_formatTimeForModal:function(){var timeOutput='';var hours=(this.timeLeft/3600);var secondsRemainder=Math.round((hours%1)*3600);hours=(hours<1)?0:Math.floor(hours);var minutes=(secondsRemainder/60);secondsRemainder=Math.round((minutes%1)*60);minutes=(minutes<1)?0:Math.floor(minutes);if(hours>0&&minutes>0){timeOutput=hours+" hour(s) and "+minutes+" minute(s)";}else if(hours>0){timeOutput=hours+" hour(s)";}else{timeOutput=minutes+" minute(s)";}
return timeOutput;}});var studentPurchase=new Class({Implements:Events,initialize:function(){this.form=document.getElement('form');this.struct=$('struct');this._getPurchaseStruct();this._getHomeStruct();this.setNormalPurchaseAccessButton();this.setEbookLeewayLinks();this.setEbookAndAccessLinks();this.setReadItLinks();},setNormalPurchaseAccessButton:function(){if(!this._inIframe())return;var continueToPaymentButton=$$('.continueToPayment')[0];if(!continueToPaymentButton)return;var purchaseModal=this._createModal(this._cleanTrigger(continueToPaymentButton));var orderOnlineEl=$('order_online');if(orderOnlineEl){orderOnlineEl.addEvent('click',function(){continueToPaymentButton.addEvent('click',function(){purchaseModal.show();}.bind(this));}.bind(this));}},setEbookLeewayLinks:function(){var leewayAccessLinks=$$('a.leewayView');if(leewayAccessLinks.length==0){var eBookAnchor=$('my_ebooks_anchor');if(eBookAnchor){leewayAccessLinks=$('my_ebooks_anchor').retrieve('tip').getContent().getElements('a.leewayView');}}
if(leewayAccessLinks&&leewayAccessLinks.length==0)return;leewayAccessLinks.each(function(trigger){this._createModal(this._cleanTrigger(trigger),true,this._getTriggerAction(trigger),trigger.getElement('.leeway_date').get('html'));},this);},setEbookAndAccessLinks:function(){var leewayAccessLinks=$$('.aboutClassLeewayView');if(leewayAccessLinks&&leewayAccessLinks.length>0){leewayAccessLinks.each(function(trigger){this._createModal(this._cleanTrigger(trigger),true,this._getTriggerAction(trigger),trigger.getElement('.leeway_date').get('html'));},this);}},setReadItLinks:function(){var readItLinks=$$('.leewayStudentView');if(readItLinks&&readItLinks.length==0){return;}
readItLinks.each(function(trigger){this._createModal(this._cleanTrigger(trigger),true,this._getTriggerAction(trigger),trigger.getElement('.leeway_date').get('html'));},this);return;},_createModal:function(trigger,leeway,leewayAction,leewayDate){var content=this._setModalContent(leeway,leewayDate);if(!leeway){var iframeModal=new WA.Components.Modal(document.body,{trigger:trigger,content:content,onShow:function(){this._setPurchaseContent(content);this._setPostTab();}.bind(this),onHide:function(){this._setPurchaseContent.pass(content).delay(1000);this._setPostCurrent();}.bind(this)});this._setContentStyles(content);content.getElement('.completePurchase').addEvent('click',this._setFinalContent.pass(content,this));content.getElement('.cancel').addEvent('click',function(){this.hide();}.bind(iframeModal));content.getElement('.purchaseLater').addEvent('click',function(){this.hide();}.bind(iframeModal));content.getElement('.startWebAssign').addEvent('click',this._goHome.bind(this));return iframeModal;}else{content.getElement('.purchaseStep').setStyle('display','none');content.getElement('.finalStep').setStyle('display','none');var graceModal=new WA.Components.Modal(document.body,{trigger:trigger,content:content,onHide:function(){this._setGracePeriodHeader.pass(content).delay(1000);}.bind(this)});this._setContentStyles(content);content.getElement('.continue').addEvent('click',this._continueViewingBook.pass([graceModal,leewayAction],this));content.getElement('.completePurchase').addEvent('click',this._setFinalContent.pass(content,this));content.getElement('.cancel').addEvent('click',function(){this.hide();}.bind(graceModal));content.getElement('.purchaseLater').addEvent('click',function(){this.hide();}.bind(graceModal));content.getElement('.startWebAssign').addEvent('click',this._goHome.bind(this));return graceModal;}},_setGracePeriodHeader:function(content){content.getElement('h1').setProperty('html','Grace Period');content.getElement('.graceStep').setStyle('display','block');content.getElement('.purchaseStep').setStyle('display','none');content.getElement('.finalStep').setStyle('display','none');},_continueViewingBook:function(graceModal,leewayAction){leewayAction=leewayAction.replace("return","");eval(leewayAction);graceModal.hide();},_getPurchaseStruct:function(){this.purchaseStruct=$('modalPurchaseStruct');this.purchaseStruct=(this.purchaseStruct)?this.purchaseStruct.value:null;},_getHomeStruct:function(){this.homeStruct=$('modalHomeStruct');this.homeStruct=(this.homeStruct)?this.homeStruct.value:null;},_setStruct:function(value){$('struct').value=value;},_setPurchaseContent:function(content){content.getElement('.purchaseStep').setStyle('display','block');content.getElement('.finalStep').setStyle('display','none');},_setFinalContent:function(content){if(this.purchaseStruct){this._setPostTab();this._setStruct(this.purchaseStruct);this._submitForm();}else{waUtil.submitAction("purchase",{target:'_blank'});}
content.getElement('.purchaseStep').setStyle('display','none');content.getElement('.finalStep').setStyle('display','block');},_setPostTab:function(){this.form.setProperty('target','_blank');},_setPostCurrent:function(){this.form.removeProperty('target');},_setContentStyles:function(content){content.getElement('.completePurchase a').setStyle('background-image','url(/wastatic/common/img/popout.png)');},_inIframe:function(){if(window.top!==window.self){return true;}else{return false;}},_cleanFormAction:function(){var formAction=this.form.getProperty('action');if(formAction){formAction=formAction.replace(/\&purchase\=[0-9].*/,'');formAction+='&purchase='+Math.floor(Math.random()*1000000001);this.form.set('action',formAction);}},_cleanTrigger:function(element){var onclickVal=element.getProperty('onclick');if(element.get('tag')=='a'){var newElement=new Element('a',{href:'#','class':element.get('class'),html:element.get('html')});newElement.replaces(element);element=newElement;}
element.removeEvents('click');element.removeProperty('href');element.removeProperty('onclick');var hasLink=element.getElement('a');if(hasLink){this._cleanTrigger(hasLink);}
return element;},_getTriggerAction:function(element){return element.getProperty('onclick');},_goHome:function(){this._setPostCurrent();this._cleanFormAction();if(this.struct){this.struct.value=this.homeStruct;this._submitForm();}else{waUtil.submitAction("home/index");}},_submitForm:function(){this._cleanFormAction();document.forms[0].submit();this._cleanFormAction();},_setModalContent:function(leeway,leewayDate){var securityPaymentHtml=["<h1>WebAssign Payment</h1>","<div class='purchaseStep'>","<p>WebAssign uses PayPal to process payments. For security, your transaction will be completed in a new browser window.<br /><br /></p>","<div class='modalButton container'>","<span>","<span class='completePurchase iButton'>","<a>Complete My Purchase on PayPal</a>","</span>","<span class='cancel tButton'>","<a>Cancel</a>","</span>","</span>","</div>","</div>","<div class='finalStep'>","<p>Did you successfully purchase WebAssign access?<br /><br /></p>","<div class='modalButton container'>","<span>","<span class='startWebAssign sButton'>","<a>Yes, start using WebAssign</a>","</span>","<span class='purchaseLater tButton'>","<a>No, purchase access later</a>","</span>","</span>","</div>","</div>"].join("");var gracePeriodHtml=["<h1>Grace Period</h1>","<div class='graceStep'>","<p>The grace period for this class ends "+leewayDate+".<br /><br /></p>","<p>To use the eBook after the grace period, you must purchase access or provide an access code. ","<a href='/manual/student_guide/?t=purchase_access' target='_blank'>More information</a>","</p>","<div class='modalButton container'>","<span>","<span class='continue sButton'>","<a>Continue</a>","</span>","</span>","</div>","</div>","<div class='purchaseStep'>","<p>WebAssign uses PayPal to process payments. For security, your transaction will be completed in a new browser window.<br /><br /></p>","<div class='modalButton container'>","<span>","<span class='completePurchase iButton'>","<a>Complete My Purchase on PayPal</a>","</span>","<span class='cancel tButton'>","<a>Cancel</a>","</span>","</span>","</div>","</div>","<div class='finalStep'>","<p>Did you successfully purchase WebAssign access?<br /><br /></p>","<div class='modalButton container'>","<span>","<span class='startWebAssign sButton'>","<a>Yes, start using WebAssign</a>","</span>","<span class='purchaseLater tButton'>","<a>No, purchase access later</a>","</span>","</span>","</div>","</div>",].join("");return new Element('div',{'class':'waModalStandard purchaseModalContent waRestrictionsModal container','styles':{'width':'395px'},'html':(leeway)?gracePeriodHtml:securityPaymentHtml});}});var swfobject=function(){var b="undefined",Q="object",n="Shockwave Flash",p="ShockwaveFlash.ShockwaveFlash",P="application/x-shockwave-flash",m="SWFObjectExprInst",j=window,K=document,T=navigator,o=[],N=[],i=[],d=[],J,Z=null,M=null,l=null,e=false,A=false;var h=function(){var v=typeof K.getElementById!=b&&typeof K.getElementsByTagName!=b&&typeof K.createElement!=b,AC=[0,0,0],x=null;if(typeof T.plugins!=b&&typeof T.plugins[n]==Q){x=T.plugins[n].description;if(x&&!(typeof T.mimeTypes!=b&&T.mimeTypes[P]&&!T.mimeTypes[P].enabledPlugin)){x=x.replace(/^.*\s+(\S+\s+\S+$)/,"$1");AC[0]=parseInt(x.replace(/^(.*)\..*$/,"$1"),10);AC[1]=parseInt(x.replace(/^.*\.(.*)\s.*$/,"$1"),10);AC[2]=/r/.test(x)?parseInt(x.replace(/^.*r(.*)$/,"$1"),10):0}}else{if(typeof j.ActiveXObject!=b){var y=null,AB=false;try{y=new ActiveXObject(p+".7")}catch(t){try{y=new ActiveXObject(p+".6");AC=[6,0,21];y.AllowScriptAccess="always"}catch(t){if(AC[0]==6){AB=true}}if(!AB){try{y=new ActiveXObject(p)}catch(t){}}}if(!AB&&y){try{x=y.GetVariable("$version");if(x){x=x.split(" ")[1].split(",");AC=[parseInt(x[0],10),parseInt(x[1],10),parseInt(x[2],10)]}}catch(t){}}}}var AD=T.userAgent.toLowerCase(),r=T.platform.toLowerCase(),AA=/webkit/.test(AD)?parseFloat(AD.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,q=false,z=r?/win/.test(r):/win/.test(AD),w=r?/mac/.test(r):/mac/.test(AD);/*@cc_on q=true;@if(@_win32)z=true;@elif(@_mac)w=true;@end@*/return{w3cdom:v,pv:AC,webkit:AA,ie:q,win:z,mac:w}}();var L=function(){if(!h.w3cdom){return}f(H);if(h.ie&&h.win){try{K.write("<script id=__ie_ondomload defer=true src=//:><\/script>");J=C("__ie_ondomload");if(J){I(J,"onreadystatechange",S)}}catch(q){}}if(h.webkit&&typeof K.readyState!=b){Z=setInterval(function(){if(/loaded|complete/.test(K.readyState)){E()}},10)}if(typeof K.addEventListener!=b){K.addEventListener("DOMContentLoaded",E,null)}R(E)}();function S(){if(J.readyState=="complete"){if(J.parentNode)J.parentNode.removeChild(J);E()}}function E(){if(e){return}if(h.ie&&h.win){var v=a("span");try{var u=K.getElementsByTagName("body")[0].appendChild(v);u.parentNode.removeChild(u)}catch(w){return}}e=true;if(Z){clearInterval(Z);Z=null}var q=o.length;for(var r=0;r<q;r++){o[r]()}}function f(q){if(e){q()}else{o[o.length]=q}}function R(r){if(typeof j.addEventListener!=b){j.addEventListener("load",r,false)}else{if(typeof K.addEventListener!=b){K.addEventListener("load",r,false)}else{if(typeof j.attachEvent!=b){I(j,"onload",r)}else{if(typeof j.onload=="function"){var q=j.onload;j.onload=function(){q();r()}}else{j.onload=r}}}}}function H(){var t=N.length;for(var q=0;q<t;q++){var u=N[q].id;if(h.pv[0]>0){var r=C(u);if(r){N[q].width=r.getAttribute("width")?r.getAttribute("width"):"0";N[q].height=r.getAttribute("height")?r.getAttribute("height"):"0";if(c(N[q].swfVersion)){if(h.webkit&&h.webkit<312){Y(r)}W(u,true)}else{if(N[q].expressInstall&&!A&&c("6.0.65")&&(h.win||h.mac)){k(N[q])}else{O(r)}}}}else{W(u,true)}}}function Y(t){var q=t.getElementsByTagName(Q)[0];if(q){var w=a("embed"),y=q.attributes;if(y){var v=y.length;for(var u=0;u<v;u++){if(y[u].nodeName=="DATA"){w.setAttribute("src",y[u].nodeValue)}else{w.setAttribute(y[u].nodeName,y[u].nodeValue)}}}var x=q.childNodes;if(x){var z=x.length;for(var r=0;r<z;r++){if(x[r].nodeType==1&&x[r].nodeName=="PARAM"){w.setAttribute(x[r].getAttribute("name"),x[r].getAttribute("value"))}}}t.parentNode.replaceChild(w,t)}}function k(w){A=true;var u=C(w.id);if(u){if(w.altContentId){var y=C(w.altContentId);if(y){M=y;l=w.altContentId}}else{M=G(u)}if(!(/%$/.test(w.width))&&parseInt(w.width,10)<310){w.width="310"}if(!(/%$/.test(w.height))&&parseInt(w.height,10)<137){w.height="137"}K.title=K.title.slice(0,47)+" - Flash Player Installation";var z=h.ie&&h.win?"ActiveX":"PlugIn",q=K.title,r="MMredirectURL="+j.location+"&MMplayerType="+z+"&MMdoctitle="+q,x=w.id;if(h.ie&&h.win&&u.readyState!=4){var t=a("div");x+="SWFObjectNew";t.setAttribute("id",x);u.parentNode.insertBefore(t,u);u.style.display="none";var v=function(){u.parentNode.removeChild(u)};I(j,"onload",v)}U({data:w.expressInstall,id:m,width:w.width,height:w.height},{flashvars:r},x)}}function O(t){if(h.ie&&h.win&&t.readyState!=4){var r=a("div");t.parentNode.insertBefore(r,t);r.parentNode.replaceChild(G(t),r);t.style.display="none";var q=function(){t.parentNode.removeChild(t)};I(j,"onload",q)}else{t.parentNode.replaceChild(G(t),t)}}function G(v){var u=a("div");if(h.win&&h.ie){u.innerHTML=v.innerHTML}else{var r=v.getElementsByTagName(Q)[0];if(r){var w=r.childNodes;if(w){var q=w.length;for(var t=0;t<q;t++){if(!(w[t].nodeType==1&&w[t].nodeName=="PARAM")&&!(w[t].nodeType==8)){u.appendChild(w[t].cloneNode(true))}}}}}return u}function U(AG,AE,t){var q,v=C(t);if(v){if(typeof AG.id==b){AG.id=t}if(h.ie&&h.win){var AF="";for(var AB in AG){if(AG[AB]!=Object.prototype[AB]){if(AB.toLowerCase()=="data"){AE.movie=AG[AB]}else{if(AB.toLowerCase()=="styleclass"){AF+=' class="'+AG[AB]+'"'}else{if(AB.toLowerCase()!="classid"){AF+=" "+AB+'="'+AG[AB]+'"'}}}}}var AD="";for(var AA in AE){if(AE[AA]!=Object.prototype[AA]){AD+='<param name="'+AA+'" value="'+AE[AA]+'" />'}}v.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+AF+">"+AD+"</object>";i[i.length]=AG.id;q=C(AG.id)}else{if(h.webkit&&h.webkit<312){var AC=a("embed");AC.setAttribute("type",P);for(var z in AG){if(AG[z]!=Object.prototype[z]){if(z.toLowerCase()=="data"){AC.setAttribute("src",AG[z])}else{if(z.toLowerCase()=="styleclass"){AC.setAttribute("class",AG[z])}else{if(z.toLowerCase()!="classid"){AC.setAttribute(z,AG[z])}}}}}for(var y in AE){if(AE[y]!=Object.prototype[y]){if(y.toLowerCase()!="movie"){AC.setAttribute(y,AE[y])}}}v.parentNode.replaceChild(AC,v);q=AC}else{var u=a(Q);u.setAttribute("type",P);for(var x in AG){if(AG[x]!=Object.prototype[x]){if(x.toLowerCase()=="styleclass"){u.setAttribute("class",AG[x])}else{if(x.toLowerCase()!="classid"){u.setAttribute(x,AG[x])}}}}for(var w in AE){if(AE[w]!=Object.prototype[w]&&w.toLowerCase()!="movie"){F(u,w,AE[w])}}v.parentNode.replaceChild(u,v);q=u}}}return q}function F(t,q,r){var u=a("param");u.setAttribute("name",q);u.setAttribute("value",r);t.appendChild(u)}function X(r){var q=C(r);if(q&&(q.nodeName=="OBJECT"||q.nodeName=="EMBED")){if(h.ie&&h.win){if(q.readyState==4){B(r)}else{j.attachEvent("onload",function(){B(r)})}}else{q.parentNode.removeChild(q)}}}function B(t){var r=C(t);if(r){for(var q in r){if(typeof r[q]=="function"){r[q]=null}}r.parentNode.removeChild(r)}}function C(t){var q=null;try{q=K.getElementById(t)}catch(r){}return q}function a(q){return K.createElement(q)}function I(t,q,r){t.attachEvent(q,r);d[d.length]=[t,q,r]}function c(t){var r=h.pv,q=t.split(".");q[0]=parseInt(q[0],10);q[1]=parseInt(q[1],10)||0;q[2]=parseInt(q[2],10)||0;return(r[0]>q[0]||(r[0]==q[0]&&r[1]>q[1])||(r[0]==q[0]&&r[1]==q[1]&&r[2]>=q[2]))?true:false}function V(v,r){if(h.ie&&h.mac){return}var u=K.getElementsByTagName("head")[0],t=a("style");t.setAttribute("type","text/css");t.setAttribute("media","screen");if(!(h.ie&&h.win)&&typeof K.createTextNode!=b){t.appendChild(K.createTextNode(v+" {"+r+"}"))}u.appendChild(t);if(h.ie&&h.win&&typeof K.styleSheets!=b&&K.styleSheets.length>0){var q=K.styleSheets[K.styleSheets.length-1];if(typeof q.addRule==Q){q.addRule(v,r)}}}function W(t,q){var r=q?"visible":"hidden";if(e&&C(t)){C(t).style.visibility=r}else{V("#"+t,"visibility:"+r)}}function g(s){var r=/[\\\"<>\.;]/;var q=r.exec(s)!=null;return q?encodeURIComponent(s):s}var D=function(){if(h.ie&&h.win){window.attachEvent("onunload",function(){var w=d.length;for(var v=0;v<w;v++){d[v][0].detachEvent(d[v][1],d[v][2])}var t=i.length;for(var u=0;u<t;u++){X(i[u])}for(var r in h){h[r]=null}h=null;for(var q in swfobject){swfobject[q]=null}swfobject=null})}}();return{registerObject:function(u,q,t){if(!h.w3cdom||!u||!q){return}var r={};r.id=u;r.swfVersion=q;r.expressInstall=t?t:false;N[N.length]=r;W(u,false)},getObjectById:function(v){var q=null;if(h.w3cdom){var t=C(v);if(t){var u=t.getElementsByTagName(Q)[0];if(!u||(u&&typeof t.SetVariable!=b)){q=t}else{if(typeof u.SetVariable!=b){q=u}}}}return q},embedSWF:function(x,AE,AB,AD,q,w,r,z,AC){if(!h.w3cdom||!x||!AE||!AB||!AD||!q){return}AB+="";AD+="";if(c(q)){W(AE,false);var AA={};if(AC&&typeof AC===Q){for(var v in AC){if(AC[v]!=Object.prototype[v]){AA[v]=AC[v]}}}AA.data=x;AA.width=AB;AA.height=AD;var y={};if(z&&typeof z===Q){for(var u in z){if(z[u]!=Object.prototype[u]){y[u]=z[u]}}}if(r&&typeof r===Q){for(var t in r){if(r[t]!=Object.prototype[t]){if(typeof y.flashvars!=b){y.flashvars+="&"+t+"="+r[t]}else{y.flashvars=t+"="+r[t]}}}}f(function(){U(AA,y,AE);if(AA.id==AE){W(AE,true)}})}else{if(w&&!A&&c("6.0.65")&&(h.win||h.mac)){A=true;W(AE,false);f(function(){var AF={};AF.id=AF.altContentId=AE;AF.width=AB;AF.height=AD;AF.expressInstall=w;k(AF)})}}},getFlashPlayerVersion:function(){return{major:h.pv[0],minor:h.pv[1],release:h.pv[2]}},hasFlashPlayerVersion:c,createSWF:function(t,r,q){if(h.w3cdom){return U(t,r,q)}else{return undefined}},removeSWF:function(q){if(h.w3cdom){X(q)}},createCSS:function(r,q){if(h.w3cdom){V(r,q)}},addDomLoadEvent:f,addLoadEvent:R,getQueryParamValue:function(v){var u=K.location.search||K.location.hash;if(v==null){return g(u)}if(u){var t=u.substring(1).split("&");for(var r=0;r<t.length;r++){if(t[r].substring(0,t[r].indexOf("="))==v){return g(t[r].substring((t[r].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(A&&M){var q=C(m);if(q){q.parentNode.replaceChild(M,q);if(l){W(l,true);if(h.ie&&h.win){M.style.display="block"}}M=null;l=null;A=false}}}}}();function insertLit(utfcode,littype){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();if(utfcode!=""){objParams.objType="literal";objParams.charType=littype;objParams.UTFcode=utfcode;pad.insertElem("literal",objParams);}}}}
function insertTrig(trigFunc){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();if(trigFunc!=""){objParams.objType="trig";objParams.trigFunc=trigFunc;pad.insertElem("trig",objParams);}}}}
function insertLn(){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="ln";pad.insertElem("ln",objParams);}}}
function insertLog(base){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="log";pad.insertElem("log",objParams);if(base==true){objParams.objType="sub";objParams.operands=new Array();pad.insertElem("sub",objParams);}}}}
function insertFrac(fractype){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="fraction";objParams.fracType=fractype;objParams.operands=new Array();pad.insertElem("fraction",objParams);}}}
function insertSuper(){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="super";objParams.operands=new Array();pad.insertElem("super",objParams);}}}
function insertSub(){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="sub";objParams.operands=new Array();pad.insertElem("sub",objParams);}}}
function insertSuperSub(){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="supersub";objParams.operands=new Array();pad.insertElem("supersub",objParams);}}}
function insertRoot(rType){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="root";objParams.rootType=rType;objParams.operands=new Array();pad.insertElem("root",objParams);}}}
function insertGrouping(gtype){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();if(gtype!=""){pad.insertElem(gtype,objParams);}}}}
function insertAbs(){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="abs";objParams.operands=new Array();pad.insertElem("abs",objParams);}}}
function insertConst(cnst){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();if(cnst!=""){objParams.objType="constant";objParams.constString=cnst;pad.insertElem("constant",objParams);}}}}
function insertState(st){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();if(st!=""){objParams.objType="state";objParams.stString=st;pad.insertElem("state",objParams);}}}}
function insertCharge(base,type){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="charge";objParams.base=base;objParams.chargeType=type;pad.insertElem("charge",objParams);}}}
function insertIsotope(){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="isotope";objParams.operands=new Array();pad.insertElem("isotope",objParams);}}}
function insertFactorial(){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="factorial";objParams.operands=new Array();pad.insertElem("factorial",objParams);}}}
function insertIntegral(type,closed){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="integral";objParams.operands=new Array();objParams.integralType=type;objParams.integralClosed=closed;pad.insertElem("integral",objParams);}}}
function insertSummation(indexed){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="summation";objParams.bIndexed=indexed;objParams.operands=new Array();pad.insertElem("summation",objParams);}}}
function insertProduct(){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="product";objParams.operands=new Array();pad.insertElem("product",objParams);}}}
function insertBiCo(){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="bico";objParams.operands=new Array();pad.insertElem("bico",objParams);}}}
function insertLimit(){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="limit";objParams.operands=new Array();pad.insertElem("limit",objParams);}}}
function insertTop(type){if(fIndex>-1&&type!=""){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="top";objParams.topType=type;objParams.operands=new Array();pad.insertElem("top",objParams);}}}
function insertDeriv(type,top){if(fIndex>-1&&type!=""){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="deriv";objParams.derivType=type;objParams.hasTop=top;objParams.operands=new Array();pad.insertElem("deriv",objParams);}}}
function insertHODeriv(type){if(fIndex>-1&&type!=""){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="hoderiv";objParams.derivType=type;objParams.operands=new Array();pad.insertElem("hoderiv",objParams);}}}
function insertPrime(num){if(fIndex>-1&&!isNaN(num)){var pad=document.getElementById(mpObjects[fIndex]);if(pad){var objParams=new Object();objParams.objType="prime";objParams.numPrimes=num;pad.insertElem("prime",objParams);}}}
function boldSelection(){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){pad.boldSelection();}}}
function setPadHeight(padid,h){var mp=document.getElementById(mpObjects[mpXML.indexOf(padid)]);if(mp){mp.height=h;}}
function setPadWidth(padid,w){var mp=document.getElementById(mpObjects[mpXML.indexOf(padid)]);if(mp){mp.width=w;}}
function focusMP(padid,ptype){if(fIndex>-1){var pad=document.getElementById(mpObjects[fIndex]);if(pad){pad.loseFocus();}}
else{switch(ptype){case"devmath":pdevmath.enter();break;case"chem":pchem.enter();break;case"calc":pcalc.enter();break;case"phys":pphys.enter();break;}}
fIndex=mpXML.indexOf(padid);}
function unFocusAllMPs(){var z,pad;for(z=0;z<mpObjects.length;z++){pad=document.getElementById(mpObjects[z]);if(pad){try{pad.loseFocus();}
catch(err){}}}
if(fIndex!=-1){var mpId=mpXML[fIndex];fIndex=-1;if(typeof mark_is_changed=='function'){if(mark_is_changed(document.forms[0].elements[mpId])==true)return;var new_response=escape(getXML(mpId));change_mark(document.forms[0].elements[mpId],new_response);}
var box=$(mpId).retrieve('box');if(box){box.element.fireEvent('padChanged');}}}
function focusPad(padid){setTimeout('focusTA()',100);}
function focusTA(){var ft=document.getElementById('focusText');if(ft){ft.focus();ft.select();}}
function setPadEnabled(padid,en){if(fIndex>-1&&en==false){if(mpObjects[fIndex]==padid){fIndex=-1;pallette.exit();}}
var pad=document.getElementById(padid);if(pad){pad.setEnabled(en);}}
function getXML(padid){var pad=document.getElementById(mpObjects[mpXML.indexOf(padid)]);if(pad){try{return pad.getXML();}
catch(err){return"";}}
else{return"";}}
function processXML(padid,xml){var pad=document.getElementById(mpObjects[mpXML.indexOf(padid)]);if(pad){pad.processXML(xml);}}
function removeAllSWFs(){var z;for(z=0;z<mpObjects.length;z++){swfobject.removeSWF(mpObjects[z]);}}
function traceMPArray(){var z;var strTrace="mpArray contents:\n";for(z=0;z<mpArray.length;z++){strTrace+=mpArray[z]+"\n";}
alert(strTrace);}
function flashAlert(trace){alert(trace);}
function disableSelection(srcElement){srcElement.style.MozUserSelect="none";srcElement.onselectstart=function(){return false;};}
function enableSelection(srcElement){srcElement.style.MozUserSelect="";srcElement.onselectstart=null;}
pad=new Class({Implements:[Options,Events],options:{container:'',id:'',trigger:'',showFields:[],hideFields:[],buttons:[],help:'',deBug:false,mode:''},initialize:function(options){this.setOptions(options)
this.id=this.options.id;this.name=(this.id)?this.options.container+this.options.id:this.options.container;this.container=$(this.name);this.body=$(document.body);this.honeyPot=null;this.tablet=(this.id)?true:false;this.deBug=this.options.deBug?this.options.deBug:false;this.trigger=this.options.trigger?this.options.trigger:'tools';this.showFields=$$('input.'+this.trigger);this.hideFields=$$('input.noTools');this.effects=[];this.help=(this.options.help)?this.options.help:'https://www.webassign.net';this.start='h3.atStart';this.startWrap='div.atStart';this.otherPads=this.options.otherPads;this.flyOuts=[];this.mode=(this.options.mode)?this.options.mode:'';this.selected={};this.shownKeyCheck=false;this.notExceptedChars=new RegExp(/[^\t\dA-Za-z\~\`\!\@\#\$\%\^\&\*\(\)\_\+\-\=\[\]\{\}\;\'\:\"\,\.\/\<\>\?\\\| ]/g);this.prevHint=[];this.noExit=false;if(!this.container){if(this.deBug){wacon.log('pad Error: '+this.name+' is not defined properly or not found\r'+'ID:'+this.id);}
return;}
if(this.deBug){wacon.log('pad Message: '+this.name+' has been initialized\r'+'ID:'+this.id);}
if(this.tablet){wacon.exec('tablet (chemPad)');this.initInput();this.initButtons();this.initTips();this.initTabs();this.initHelp();}else{wacon.exec('non-tablet ('+this.name+')');this.initHoneyPot();this.initAccordion();this.initFields();this.initFlyOuts();this.initDrawers();this.initButtons();this.initTips();this.initAppClick();this.initHelp();}},initHoneyPot:function(){var focusText=this.honeyPot=$('focusText');if(!focusText){this.honeyPot=new Element('textarea',{id:'focusText'}).inject(document.body);}
this.container.addEvent('click',this.focusHoneyPot.bind(this));},focusHoneyPot:function(){this.honeyPot.focus();},initAppClick:function(){this.body.addEvent('mousedown',function(e){var isPadClick=false;var isObjectClick=false;var target=$(e.target);var tagName=target.tagName;var test;try{isPadClick=(Element.getParent(target,'div#'+this.name))?true:false;isObjectClick=(target.get('id').test(this.name,'i'))?true:false;}catch(e){}
wacon.log('Pad Clicked: '+isPadClick);wacon.log('Flash Object Clicked: '+isObjectClick);if(!isPadClick&&!isObjectClick&&tagName!="OBJECT"){this.exit();}}.bind(this));},initAccordion:function(){var padElement=this.container;this.accordion=new Accordion(this.start,this.startWrap,{opacity:false,alwaysHide:true,duration:100,start:'all-closed',onActive:function(toggler,element){if(toggler.hasClass('greekTitle')){var greekOpenFx=new Fx.Morph(padElement,{duration:'short',transition:Fx.Transitions.Sine.easeOut});greekOpenFx.start({'top':35});}else{if(padElement.getStyle('top').toInt()!=100){var greekCloseFx=new Fx.Morph(padElement,{duration:'short',transition:Fx.Transitions.Sine.easeOut});greekCloseFx.start({'top':100});}}},onBackground:function(toggler,element){if(padElement.getStyle('top').toInt()!=100){var greekCloseFx=new Fx.Morph(padElement,{duration:'short',transition:Fx.Transitions.Sine.easeOut});greekCloseFx.start({'top':100});}}},$('accordion'));},initFields:function(){this.showFields.each(function(inputField){inputField.addEvent('click',this.enter.bind(this));},this);this.hideFields.each(function(inputField){inputField.addEvent('click',this.exit.bind(this));},this);},initButtons:function(){wacon.exec('initButtons()');var pad=this;var singleButtons=this.container.getElements('.single');var flyoutButtons=this.container.getElements('.padButton');var allButtons=[];allButtons.combine(singleButtons);allButtons.combine(flyoutButtons);this.buttons=allButtons;this.buttons.each(function(button){var buttonClass=button.get('class');var toolTipClass=buttonClass.split(' ',1);var tipKey=(button.id)?button.id:toolTipClass;var buttonTitle=buttonIdName[tipKey]?buttonIdName[tipKey]:'No Tip Available';button.setAttribute('title',buttonTitle);if(button){button.addEvent('click',function(){if(this.tablet){var padContainer=this.container;var input=this.input;var preview=this.preview;if(buttonFn[tipKey]){var selectedRange=input.getSelectedText();var selectedRangeStart=this.selected.start;var selectedRangeEnd=this.selected.end;if(selectedRangeStart!=selectedRangeEnd){input.selectRange(selectedRangeStart,selectedRangeEnd);}else{input.setCaretPosition(selectedRangeEnd);}
input.insertAtCursor(buttonFn[tipKey]);var rangeParams=input.getSelectedRange();input.setCaretPosition(rangeParams.end);this.selected=input.getSelectedRange();if(this.mode.match('rqn')){preview.set('html',this.applyWatexRQN(input.value));}else{preview.set('html',this.applyWatex(input.value));}}}else{this.partialCollapse();if(fIndex>-1){this.getUTF(button.id);}}}.bind(this));}},this);},initFlyOuts:function(){var pad=this;$$('#'+this.name+' div.arrow').each(function(arrow){var buttonWidth=25;var collapsedWidth=58;var expandWidth=151;var arrowLeftImagePath='';var arrowRightImagePath='';var flyOutWrapWidth=100;var flyOutWrap=arrow.getParent().getParent();var flyOutContent=arrow.getParent();var buttons=arrow.getParent().getFirst().getChildren('div.padButton');var hiddenButtons=arrow.getParent().getFirst().getLast().getChildren('div.padButton');var buttonCount=buttons?(buttons.length-1):0;var hiddenButtonCount=hiddenButtons?hiddenButtons.length:0;var buttonTotal=(buttonCount+hiddenButtonCount);arrow.toggle=false;var className=arrow.className;if(className.match('four')){collapsedWidth=51;expandWidth=(Math.ceil(buttonTotal/4)*buttonWidth)+1;arrowLeftImagePath='/wastatic/pads/img/mathPad/fourLeftArrow.gif';arrowRightImagePath='/wastatic/pads/img/mathPad/fourRightArrow.gif';flyOutWrapWidth=(Math.ceil(buttonTotal/4)*buttonWidth)+10;}else if(className.match('two')){collapsedWidth=58;expandWidth=(Math.ceil(buttonTotal/2)*buttonWidth)+1;arrowLeftImagePath='/wastatic/pads/img/mathPad/twoLeftArrow.gif';arrowRightImagePath='/wastatic/pads/img/mathPad/twoRightArrow.gif';flyOutWrapWidth=(Math.ceil(buttonTotal/2)*buttonWidth)+10;}else if(className.match('one')){collapsedWidth=58;expandWidth=((buttonTotal+1)*buttonWidth)+1;arrowLeftImagePath='/wastatic/pads/img/mathPad/singleArrowLeft.gif';arrowRightImagePath='/wastatic/pads/img/mathPad/singleArrowRight.gif';flyOutWrapWidth=((buttonTotal+1)*buttonWidth)+10;}
var elementDiv=arrow.getParent().getParent().getParent().getParent().getParent().getParent();arrow.collapse=function(){if(elementDiv.className=='element'){elementDiv.setStyle('width',60);}
arrow.getParent().getFirst().setStyle('width',51);var hiddenButtons=arrow.getParent().getFirst().getChildren('div.expandState');flyOutWrap.setStyle('width',58);flyOutContent.setStyle('width',58);arrow.setStyle('background','url('+arrowRightImagePath+') no-repeat');arrow.toggle=false;}
arrow.expand=function(){if(elementDiv.className=='element'){elementDiv.setStyle('width',170);}
arrow.getParent().getFirst().setStyle('width',expandWidth);var hiddenButtons=arrow.getParent().getFirst().getChildren('div.expandState');hiddenButtons.setStyle('display','block');flyOutWrap.setStyle('width',flyOutWrapWidth);flyOutContent.setStyle('width',flyOutWrapWidth);arrow.setStyle('background','url('+arrowLeftImagePath+') no-repeat');arrow.toggle=true;}
arrow.addEvent('click',function(){if(arrow.toggle){pad.partialCollapse();}else{arrow.expand();}
wacon.data('flyout arrow clicked: '+arrow.toggle);});pad.flyOuts.push(arrow);},this);},initDrawers:function(){var DRAWER=12;var SINGLE=30;var DOUBLE=55;var QUAD=105;$$('h3.toggler').each(function(drawer){drawer.addEvent('click',this.partialCollapse.bind(this));var container=drawer.getNext('div');var oneStartCount=container.getElements('div.oneStartBlock').length;var twoStartCount=container.getElements('div.twoStartBlock').length;var fourStartCount=container.getElements('div.fourStartBlock').length;var singleButtonCount=container.getElements('div.single').length;var singleButtonHeight=(Math.ceil(singleButtonCount/2)*SINGLE);var flyoutTotalHeight=(oneStartCount*SINGLE)+(twoStartCount*DOUBLE)+(fourStartCount*QUAD);var totalDrawerHeight=flyoutTotalHeight+singleButtonHeight+DRAWER;container.setStyle('max-height',totalDrawerHeight);},this);},initTips:function(){wacon.exec('initTips()');var Tips2=new Tips($$(this.buttons),{className:'tool-tip',fixed:false,hideDelay:100,showDelay:900});},initInput:function(){wacon.exec('initInput()');this.input=this.container.getElement('input');this.preview=this.container.getElement('span.chemPreview');var input=this.input;var preview=this.preview;if(this.mode.match('rqn')){preview.set('html',this.applyWatexRQN(input.value));}else{preview.set('html',this.applyWatex(input.value));}
input.addEvent('click',function(e){wacon.html(preview);wacon.data(input.value);if((input.value.match(this.notExceptedChars))){var test=input.value.match(this.notExceptedChars);this.showHint('Use chemPad buttons to draw symbols.','#d00');}
if(this.mode.match('rqn')){preview.set('html',this.applyWatexRQN(input.value));}else{preview.set('html',this.applyWatex(input.value));}}.bind(this));input.addEvent('keyup',function(e){wacon.data(input.value);var selectedRange=input.getSelectedRange();this.selected=selectedRange;if((input.value.match(this.notExceptedChars))){var test=input.value.match(this.notExceptedChars);this.showHint('Use chemPad buttons to draw symbols.','#d00');}
if(input.value.match(/&/g)){input.value=this.denyKeyStrokes(input.value);}
if(this.mode.match('rqn')){preview.set('html',this.applyWatexRQN(input.value));}else{preview.set('html',this.applyWatex(input.value));}}.bind(this));input.addEvent('mouseup',function(e){var selectedRange=input.getSelectedRange();this.selected=selectedRange;}.bind(this));},initTabs:function(){wacon.exec('initTabs()');var pad=this.container;var tabs=pad.getElements('li.expandButton');tabs.each(function(tab){tab.addEvent('click',function(e){if(tab.hasClass('open')&&e.target.hasClass('expandButton')){tab.removeClass('open');}else if(e.target.hasClass('expandButton')){tab.addClass('open');}});});},showKey:function(input){var pad=this.container;if(pad&&!(this.shownKeyCheck)){this.shownKeyCheck=true;var console=pad.getElements('div.console')[0];var preview=console.getFirst();var inputElement=pad.getElements('input')[0];var key=new Element('span',{'class':'seenKey container','title':input});if(this.mode.match('rqn')){key.set('html',"<span class='answerWrap'><span class='answer'>"+this.applyWatexRQN(input)+"</span></span>");}else{key.set('html',"<span class='answerWrap'><span class='answer'>"+this.applyWatex(input)+"</span></span>");}
if(input!=' '){new Tips(key,{className:'key-tip tool-tip',fixed:false,hideDelay:100,showDelay:100});}
key.inject(preview,'after');key.setStyle('cursor','pointer');key.addEvent('click',function(){inputElement.setProperty('value',input);inputElement.setCaretPosition('end');});}},showHint:function(input,color){var pad=this.container;if(pad){var feedback=pad.getElement('div.feedback');var pTag=feedback.getFirst();pTag.setStyle('color',color);input=(input)?input:'&nbsp;';pTag.set('html',input);}},showResponse:function(input,response,id,feedback,override,question_title,mark){var pad=this.container;if(pad){var console=pad.getElements('div.console')[0];var chemInput=pad.getElements('input')[0];var preview=console.getFirst();var responseElement;var responseChange;if(feedback){var clicker=document.createElement('div');clicker.className='clicker';clicker.id='mark_'+id;preview.appendChild(clicker);var feedbackBody=document.createElement('div');feedbackBody.className='bContent w385|x8|y0';feedbackBody.id='feedbackContent'+id;feedbackBody.innerHTML=feedback;preview.appendChild(feedbackBody);if(window.WA&&window.WA.Components){new WA.Components.DragTip($('mark_'+id),{'title':question_title});}
else{new tip({container:$('mark_'+id),content:$('feedbackContent'+id),drag:true,maxHeight:'160px',title:question_title,contentClass:'qContent'});}}
if(response=='noresponse'||response=='unavailable'||response=='internal'){chemInput.value=input;response=false;}
if(mark==0&&feedback.length>0){if(override){preview.addClass('unknown_feedback');}else{preview.addClass('unknown_feedback_override');}}
else{if(!response){var suffix=(feedback?'_feedback':'')+(override?'_override':'');preview.addClass('incorrect'+suffix);responseChange=function(e){var suffix=(feedback?'_feedback':'')+(override?'_override':'');if(e.target.value!=input){preview.removeClass('incorrect'+suffix);preview.addClass('pending'+suffix);}else{preview.removeClass('pending'+suffix);preview.addClass('incorrect'+suffix);}}
chemInput.addEvent('keyup',responseChange);chemInput.addEvent('change',responseChange);}
else{preview.addClass(feedback?'correct_feedback':'correct');}}
preview.setStyle('margin','0 0 1px 0');}},disable:function(input,response,id,title){var pad=this.container;if(pad){var console=pad.getElements('div.console')[0];var toolBar=pad.getElements('div.toolBar')[0];var chemInput=pad.getElements('input')[0];var preview=console.getFirst();this.buttons.each(function(button){button.removeEvents();});chemInput.setProperty('disabled','disabled');console.setStyle('background','#eee');}},initHelp:function(){wacon.exec('initHelp()');var pad=this.container;var helpLink;if(this.tablet){helpLink=pad.getElements('a.help');helpLink.set('href',this.help);}else{var bottomBar=this.container.getElement('div.bottomBar');bottomBar.addEvent('click',function(){window.open(this.help,'calcPad_help','width=850,height=600,scrollbars=yes,menubar=no,toolbar=no,location=no,resizable=no');}.bind(this));}},enter:function(){if($(this.otherPads)){$(this.name).setStyle('margin-left','-70px');}
var fx=new Fx.Morph(this.name,{transition:Fx.Transitions.Back.easeOut,duration:200});fx.start({'margin-left':0});disableSelection(document.body);},exit:function(){if(!this.noExit){var fx=new Fx.Morph(this.container,{transition:Fx.Transitions.Back.easeIn,duration:200});fx.start({'margin-left':-70});this.partialCollapse();unFocusAllMPs();enableSelection(document.body);}else{this.noExit=false;}},fullCollapse:function(){},partialCollapse:function(){this.flyOuts.each(function(flyOut){flyOut.collapse();});},flyOutCollapse:function(){},applyWatexRQN:function(input){input=this.validateChars(input);var myLatex=this.formLatexRQN(input);var myPreview=this.formHtmlRQN(myLatex);if(myPreview.length==0){myPreview="&nbsp;"}
return myPreview;},applyWatex:function(input){input=this.validateChars(input);var myLatex=this.formLatex(input);var myPreview=this.formHtml(myLatex);if(myPreview.length==0){myPreview="&nbsp;"}
return myPreview;},validateChars:function(myInput){myInput=myInput.replace(this.notExceptedChars,"&lt;incorrectly formatted&gt;");return myInput;},formLatex:function(myInput){myInput=this.replaceSubSupInput(myInput);myInput=this.replaceFractionInput(myInput);return myInput;},formHtml:function(myInput){myInput=this.replaceArrowInput(myInput);myInput=this.replaceGTLTInput(myInput);myInput=this.replaceXmlInput(myInput);myInput=this.replaceXmlLatex(myInput);myInput=this.replaceWhiteSpaceLatex(myInput);myInput=this.replaceFractionLatex(myInput);myInput=this.replaceSubSupLatex(myInput);myInput=this.replaceStateLatex(myInput);myInput=this.replaceMiddotLatex(myInput);myInput=this.replaceGreekInput(myInput);myInput=this.replaceGreekLatex(myInput);myInput=this.replaceArrowLatex(myInput);return myInput;},formLatexRQN:function(myInput){myInput=this.replaceXmlInput(myInput);myInput=this.replaceXmlLatex(myInput);myInput=this.replaceWhiteSpaceLatex(myInput);myInput=this.replaceRQNSubSupInput(myInput);myInput=this.replaceRQNFractionInput(myInput);return myInput;},formHtmlRQN:function(myInput){myInput=this.replaceArrowInput(myInput);myInput=this.replaceSubSupLatex(myInput);myInput=this.replaceStateLatex(myInput);myInput=this.replaceMiddotLatex(myInput);myInput=this.replaceGreekInput(myInput);myInput=this.replaceGreekLatex(myInput);myInput=this.replaceArrowLatex(myInput);return myInput;},replaceGTLTInput:function(myInput){myInput=myInput.replace(/</g,"&lt;");myInput=myInput.replace(/>/g,"&gt;");return myInput;},replaceXmlInput:function(myInput){myInput=myInput.replace(/([<])([a-zA-Z\d])/g,"$1 $2");return myInput;},replaceArrowInput:function(myInput){myInput=myInput.replace(/<=>/g,"\\equilibriumarrow\\");myInput=myInput.replace(/<--/g,"\\leftarrow\\");myInput=myInput.replace(/-->/g,"\\rightarrow\\");return myInput;},replaceRQNSubSupInput:function(myInput){myInput=myInput.replace(/\^([\d]+[\^]*)_([\d]+[_]*)([a-zA-Z]+)/g,"^{$1}_{$2}{$3}");myInput=myInput.replace(/_([\d]+[_]*)\^([\d]+[\^]*)([a-zA-Z]+)/g,"_{$1}^{$2}{$3}");myInput=myInput.replace(/_([\d]+)([\+\-]{1}|\/\d+)*/g,"_{$1$2}");myInput=myInput.replace(/\^([\d]+)([\+\-]{1}|\/\d+)*/g,"^{$1$2}");if(myInput.match(/\^\{([\d]+)(\/)([^\d]+)/g)){myInput=myInput.replace(/\^\{([\d]+)(\/)([^\d]+)/g,"^{$1 $2$3");}
myInput=myInput.replace(/_([\+\-]{1})([\d]*[_]*)/g,"_{$1$2}");myInput=myInput.replace(/\^([\+\-]{1})([\d]*[\^]*)/g,"^{$2$1}");myInput=myInput.replace(/_([\d]+[\+\-]?[_]*)/g,"_{$1}");myInput=myInput.replace(/\^([\d]+[\+\-]?[\^]*)/g,"^{$1}");return myInput;},replaceXmlLatex:function(myInput){myInput=myInput.replace(/\\amp/g,"&"+"amp;");myInput=myInput.replace(/\\lt/g,"&"+"lt;");myInput=myInput.replace(/\\gt/g,"&"+"gt;");return myInput;},replaceWhiteSpaceLatex:function(myInput){if(!myInput.match(/\-or\-|NOWHITESPACE/gi)){myInput=myInput.replace(/\s+/g,"&"+"nbsp;");}else if(myInput.match(/NOWHITESPACE/g)){myInput=myInput.replace(/NOWHITESPACE/g,"");}
return myInput;},replaceRQNFractionInput:function(myInput){var debug=false;var solutionString="";if(myInput.match(/[\-or\-]/g)){var solutionArray=myInput.split('-or-');for(var i=0;i<solutionArray.length;i++){if(solutionArray[i].match(/([a-zA-Z]+)(_{[a-zA-Z0-9]+}|.*)(\s*[\=]{1}\s*)(.+)([^\d]{1})\s*\/\s*([^\d]{1})(.+)/g)){solutionArray[i]=solutionArray[i].replace(/([a-zA-Z]+)(_{[a-zA-Z0-9]+}|.*)(\s*[\=]{1}\s*)(.+)([^\d]{1})\s*\/\s*([^\d]{1})(.+)/g,"$1$2$3\\frac{$4$5}{$6$7}");}else if(solutionArray[i].match(/(.+)([^\d]{1})\s*\/\s*([^\d]{1})(.+)/g)){solutionArray[i]=solutionArray[i].replace(/(.+)([^\d]{1})\s*\/\s*([^\d]{1})(.+)/g,"\\frac{$1$2}{$3$4}");}
solutionArray[i]=this.replaceFractionLatexRQN(solutionArray[i]);}
myInput=solutionArray.join(' -or- ');}else{if(myInput.match(/([a-zA-Z]+)(_{[a-zA-Z0-9]+}|.*)(\s*[\=]{1}\s*)(.+)([^\d]{1})\s*\/\s*([^\d]{1})(.+)/g)){myInput=myInput.replace(/([a-zA-Z]+)(_{[a-zA-Z0-9]+}|.*)(\s*[\=]{1}\s*)(.+)([^\d]{1})\s*\/\s*([^\d]{1})(.+)/g,"$1$2$3\\frac{$4$5}{$6$7}");}else if(myInput.match(/(.+)([^\d]{1})\s*?\/\s*?([^\d]{0})(.+)/g)){myInput=myInput.replace(/(.+)([^\d]{1})\s*?\/\s*?([^\d]{0})(.+)/g,"\\frac{$1$2}{$3$4}");}
myInput=this.replaceFractionLatexRQN(myInput);}
return myInput;},replaceFractionInput:function(myInput){if(myInput.match(/([\^\{]\d*)\s*\/\s*(\d*)[\}]/g)){}else{myInput=myInput.replace(/(\d*)\s*\/\s*(\d*)/g,"\\frac{$1}{$2}");}
if(myInput.match(/([a-z \+\-\*\\\<\>])(\d*)\s*\/\s*(\d*)/gi)){myInput=myInput.replace(/([a-z \+\-\*\\\<\>])(\d*)\s*\/\s*(\d*)/gi,"$1\\frac{$2}{$3}");}
if(myInput.match(/(\d*)\s*\/\s*(\d*)([a-z \+\-\*\\\<\>])/gi)){myInput=myInput.replace(/(\d*)\s*\/\s*(\d*)([a-z \+\-\*\\\<\>])/gi,"\\frac{$1}{$2}$3");}
return myInput;},replaceFractionLatex:function(myInput){myInput=myInput.replace(/\\frac{([^}]*)}{([^}]*)}/g,"<span class='ssc'><table><tr><td class='vinculum ntr'>$1</td></tr><tr><td class='dtr'>$2</td></tr></table></span>");return myInput;},replaceFractionLatexRQN:function(myInput){myInput=myInput.replace(/\\frac{(.*)}{(.*)}/g,"<span class='ssc'><table><tr><td class='vinculum ntr'>$1</td></tr><tr><td class='dtr'>$2</td></tr></table></span>");return myInput;},replaceSubSupLatex:function(myInput){myInput=myInput.replace(/\_\^/g,"_ ^");myInput=myInput.replace(/\^\_/g,"^ _");myInput=myInput.replace(/\_(?!(\{|\+|\-|[0-9]|$))/g,"_{_}$1");myInput=myInput.replace(/\^(?!(\{|\+|\-|[0-9]|$))/g,"^{^}$1");myInput=myInput.replace(/\^\{((\w|\+|\-|\*|\/|\.|\<|\>|\(|\))*?)\&nbsp\;/g,"^{^}{$1 ");myInput=myInput.replace(/\_\{((\w|\+|\-|\*|\/|\.|\<|\>|\(|\))*?)\&nbsp\;/g,"_{_}{$1 ");myInput=myInput.replace(/_{([^}]*)}\^{([^}]*)}{?([a-zA-Z]+)}?\^{([^}]*)}_{([^}]*)}/g,"<span class='ssc'><table class='sst'><tr><td class='am'>$2</td></tr><tr><td class='am'>$1</td></tr></table></span>$3<span class='ssc'><table class='sst'><tr><td class='ac'>&nbsp;$4</td></tr><tr><td class='ac'>$5</td></tr></table></span>");myInput=myInput.replace(/\^{([^}]*)}_{([^}]*)}{?([a-zA-Z]+)}?\^{([^}]*)}_{([^}]*)}/g,"<span class='ssc'><table class='sst'><tr><td class='am'>$1</td></tr><tr><td class='am'>$2</td></tr></table></span>$3<span class='ssc'><table class='sst'><tr><td class='ac'>&nbsp;$4</td></tr><tr><td class='ac'>$5</td></tr></table></span>");myInput=myInput.replace(/_{([^}]*)}\^{([^}]*)}{?([a-zA-Z]+)}?_{([^}]*)}\^{([^}]*)}/g,"<span class='ssc'><table class='sst'><tr><td class='am'>$2</td></tr><tr><td class='am'>$1</td></tr></table></span>$3<span class='ssc'><table class='sst'><tr><td class='ac'>&nbsp;$5</td></tr><tr><td class='ac'>$4</td></tr></table></span>");myInput=myInput.replace(/\^{([^}]*)}_{([^}]*)}{?([a-zA-Z]+)}?_{([^}]*)}\^{([^}]*)}/g,"<span class='ssc'><table class='sst'><tr><td class='am'>$1</td></tr><tr><td class='am'>$2</td></tr></table></span>$3<span class='ssc'><table class='sst'><tr><td class='ac'>&nbsp;$5</td></tr><tr><td class='ac'>$4</td></tr></table></span>");myInput=myInput.replace(/_{([^}]*)}{?([a-zA-Z]+)}?\^{([^}]*)}_{([^}]*)}/g,"<span class='ssc'><table class='sst'><tr><td class='am'>&nbsp;</td></tr><tr><td class='am'>$1</td></tr></table></span>$2<span class='ssc'><table class='sst'><tr><td class='ac'>&nbsp;$3</td></tr><tr><td class='ac'>$4</td></tr></table></span>");myInput=myInput.replace(/\^{([^}]*)}{?([a-zA-Z]+)}?_{([^}]*)}\^{([^}]*)}/g,"<span class='ssc'><table class='sst'><tr><td class='am'>$1</td></tr><tr><td class='am'>&nbsp;</td></tr></table></span>$2<span class='ssc'><table class='sst'><tr><td class='ac'>&nbsp;$4</td></tr><tr><td class='ac'>$3</td></tr></table></span>");myInput=myInput.replace(/{([a-zA-Z]+)}_{([^}]*)}\^{([^}]*)}/g,"$1<span class='ssc'><table style='font-size:10px; text-align:left; border-collapse: collapse;'><tr><td style='padding: 0em 0.2em;'>&nbsp;$3</td></tr><tr><td style='padding:0;'>$2</td></tr></table></span>");myInput=myInput.replace(/{([a-zA-Z]+)}\^{([^}]*)}_{([^}]*)}/g,"$1<span class='ssc'><table style='font-size:10px; text-align:left; border-collapse: collapse;'><tr><td style='padding: 0em 0.2em;'>&nbsp;$2</td></tr><tr><td style='padding:0;'>$3</td></tr></table></span>");myInput=myInput.replace(/_{([^}]*)}\^{([^}]*)}{?([a-zA-Z]+)}?/g,"<span class='ssc'><table style='font-size:10px; text-align:right; border-collapse: collapse;'><tr><td style='padding: 0em 0.2em;'>$2</td></tr><tr><td style='padding:0;'>$1</td></tr></table></span>$3");myInput=myInput.replace(/\^{([^}]*)}_{([^}]*)}{?([a-zA-Z]+)}?/g,"<span class='ssc'><table style='font-size:10px; text-align:right; border-collapse: collapse;'><tr><td style='padding: 0em 0.2em;'>$1</td></tr><tr><td style='padding:0;'>$2</td></tr></table></span>$3");myInput=myInput.replace(/_([A-Z]+)/gi,"$1");myInput=myInput.replace(/\^([A-Z]+)/gi,"$1");myInput=myInput.replace(/_{?([^}=]+)}?(=)?/g,"<sub>$1</sub>$2");myInput=myInput.replace(/\^{?([^}=]+)}?(=)?/g,"<sup>$1</sup>$2");myInput=myInput.replace(/{([a-z]+)}/gi,"$1");return myInput;},replaceStateLatex:function(myInput){myInput=myInput.replace(/\((s|l|g|aq)(\,|\))/g,"(<i>$1</i>$2");myInput=myInput.replace(/(nbsp\;|\d)M\)/g,"$1<i>M</i>)");return myInput;},replaceMiddotLatex:function(myInput){myInput=myInput.replace(/\*/g,"&"+"middot;");return myInput;},replaceArrowLatex:function(myInput){myInput=myInput.replace(/\\equilibriumarrow\\/g,"&nbsp;<span style='font-size:13px;'>&#8652;</span>&nbsp;");myInput=myInput.replace(/\\leftrightarrow\\/g,"&nbsp;<span style='font-size:13px;'>&harr;</span>&nbsp;");myInput=myInput.replace(/\\rightarrow\\/g,"&nbsp;<span style='font-size:13px;'>&rarr;</span>&nbsp;");myInput=myInput.replace(/\\leftarrow\\/g,"&nbsp;<span style='font-size:13px;'>&larr;</span>&nbsp;");return myInput;},replaceGreekInput:function(myInput){var exceptions=/(rhombic|orthorhombic|rhodium|phosphite|sulphite|graphite|phosphide|sulphide|chiral|achiral|chirality|malochite|precipitate|precipitation|picogram|formula|litmus|macroscopic|microscopic|pipette|pipet)/gi;var exceptionsExp=new RegExp(exceptions);if(!myInput.match(exceptionsExp)){myInput=myInput.replace(/Alpha/g,"\\greek{25}");myInput=myInput.replace(/Beta/g,"\\greek{26}");myInput=myInput.replace(/Gamma/g,"\\greek{27}");myInput=myInput.replace(/Delta/g,"\\greek{28}");myInput=myInput.replace(/Epsilon/g,"\\greek{29}");myInput=myInput.replace(/Zeta/g,"\\greek{30}");myInput=myInput.replace(/Eta/g,"\\greek{31}");myInput=myInput.replace(/Theta/g,"\\greek{32}");myInput=myInput.replace(/Iota/g,"\\greek{33}");myInput=myInput.replace(/Kappa/g,"\\greek{34}");myInput=myInput.replace(/Lambda/g,"\\greek{35}");myInput=myInput.replace(/Mu/g,"\\greek{36}");myInput=myInput.replace(/Nu/g,"\\greek{37}");myInput=myInput.replace(/Xi/g,"\\greek{38}");myInput=myInput.replace(/Omicron/g,"\\greek{39}");myInput=myInput.replace(/Pi/g,"\\greek{40}");myInput=myInput.replace(/Rho/g,"\\greek{41}");myInput=myInput.replace(/Sigma/g,"\\greek{42}");myInput=myInput.replace(/Tau/g,"\\greek{43}");myInput=myInput.replace(/Upsilon/g,"\\greek{44}");myInput=myInput.replace(/Phi/g,"\\greek{45}");myInput=myInput.replace(/Chi/g,"\\greek{46}");myInput=myInput.replace(/Psi/g,"\\greek{47}");myInput=myInput.replace(/Omega/g,"\\greek{48}");myInput=myInput.replace(/alpha/g,"\\greek{1}");myInput=myInput.replace(/beta/g,"\\greek{2}");myInput=myInput.replace(/gamma/g,"\\greek{3}");myInput=myInput.replace(/delta/g,"\\greek{4}");myInput=myInput.replace(/epsilon/g,"\\greek{5}");myInput=myInput.replace(/zeta/g,"\\greek{6}");myInput=myInput.replace(/theta/g,"\\greek{8}");myInput=myInput.replace(/eta/g,"\\greek{7}");myInput=myInput.replace(/iota/g,"\\greek{9}");myInput=myInput.replace(/kappa/g,"\\greek{10}");myInput=myInput.replace(/lambda/g,"\\greek{11}");myInput=myInput.replace(/mu/g,"\\greek{12}");myInput=myInput.replace(/nu/g,"\\greek{13}");myInput=myInput.replace(/xi/g,"\\greek{14}");myInput=myInput.replace(/omicron/g,"\\greek{15}");myInput=myInput.replace(/pi/g,"\\greek{16}");myInput=myInput.replace(/rho/g,"\\greek{17}");myInput=myInput.replace(/sigma/g,"\\greek{18}");myInput=myInput.replace(/tau/g,"\\greek{19}");myInput=myInput.replace(/upsilon/g,"\\greek{20}");myInput=myInput.replace(/phi/g,"\\greek{21}");myInput=myInput.replace(/chi/g,"\\greek{22}");myInput=myInput.replace(/psi/g,"\\greek{23}");myInput=myInput.replace(/omega/g,"\\greek{24}");}
return myInput;},replaceGreekLatex:function(myInput){myInput=myInput.replace(/\\greek\{1\}/g,'<span class="cpgreeklower">&alpha;</span>');myInput=myInput.replace(/\\greek\{2\}/g,'<span class="cpgreeklower">&beta;</span>');myInput=myInput.replace(/\\greek\{3\}/g,'<span class="cpgreeklower">&gamma;</span>');myInput=myInput.replace(/\\greek\{4\}/g,'<span class="cpgreeklower">&delta;</span>');myInput=myInput.replace(/\\greek\{5\}/g,'<span class="cpgreeklower">&epsilon;</span>');myInput=myInput.replace(/\\greek\{6\}/g,'<span class="cpgreeklower">&zeta;</span>');myInput=myInput.replace(/\\greek\{7\}/g,'<span class="cpgreeklower">&eta;</span>');myInput=myInput.replace(/\\greek\{8\}/g,'<span class="cpgreeklower">&theta;</span>');myInput=myInput.replace(/\\greek\{9\}/g,'<span class="cpgreeklower">&iota;</span>');myInput=myInput.replace(/\\greek\{10\}/g,'<span class="cpgreeklower">&kappa;</span>');myInput=myInput.replace(/\\greek\{11\}/g,'<span class="cpgreeklower">&lambda;</span>');myInput=myInput.replace(/\\greek\{12\}/g,'<span class="cpgreeklower">&mu;</span>');myInput=myInput.replace(/\\greek\{13\}/g,'<span class="cpgreeklower">&nu;</span>');myInput=myInput.replace(/\\greek\{14\}/g,'<span class="cpgreeklower">&xi;</span>');myInput=myInput.replace(/\\greek\{15\}/g,'<span class="cpgreeklower">&omicron;</span>');myInput=myInput.replace(/\\greek\{16\}/g,'<span class="cpgreeklower">&pi;</span>');myInput=myInput.replace(/\\greek\{17\}/g,'<span class="cpgreeklower">&rho;</span>');myInput=myInput.replace(/\\greek\{18\}/g,'<span class="cpgreeklower">&sigma;</span>');myInput=myInput.replace(/\\greek\{19\}/g,'<span class="cpgreeklower">&tau;</span>');myInput=myInput.replace(/\\greek\{20\}/g,'<span class="cpgreeklower">&upsilon;</span>');myInput=myInput.replace(/\\greek\{21\}/g,'<span class="cpgreeklower">&#981;</span>');myInput=myInput.replace(/\\greek\{22\}/g,'<span class="cpgreeklower">&chi;</span>');myInput=myInput.replace(/\\greek\{23\}/g,'<span class="cpgreeklower">&psi;</span>');myInput=myInput.replace(/\\greek\{24\}/g,'<span class="cpgreeklower">&omega;</span>');myInput=myInput.replace(/\\greek\{25\}/g,'<span class="cpgreekupper">&Alpha;</span>');myInput=myInput.replace(/\\greek\{26\}/g,'<span class="cpgreekupper">&Beta;</span>');myInput=myInput.replace(/\\greek\{27\}/g,'<span class="cpgreekupper">&Gamma;</span>');myInput=myInput.replace(/\\greek\{28\}/g,'<span class="cpgreekupper">&Delta;</span>');myInput=myInput.replace(/\\greek\{29\}/g,'<span class="cpgreekupper">&Epsilon;</span>');myInput=myInput.replace(/\\greek\{30\}/g,'<span class="cpgreekupper">&Zeta;</span>');myInput=myInput.replace(/\\greek\{31\}/g,'<span class="cpgreekupper">&Eta;</span>');myInput=myInput.replace(/\\greek\{32\}/g,'<span class="cpgreekupper">&Theta;</span>');myInput=myInput.replace(/\\greek\{33\}/g,'<span class="cpgreekupper">&Iota;</span>');myInput=myInput.replace(/\\greek\{34\}/g,'<span class="cpgreekupper">&Kappa;</span>');myInput=myInput.replace(/\\greek\{35\}/g,'<span class="cpgreekupper">&Lambda;</span>');myInput=myInput.replace(/\\greek\{36\}/g,'<span class="cpgreekupper">&Mu;</span>');myInput=myInput.replace(/\\greek\{37\}/g,'<span class="cpgreekupper">&Nu;</span>');myInput=myInput.replace(/\\greek\{38\}/g,'<span class="cpgreekupper">&Xi;</span>');myInput=myInput.replace(/\\greek\{39\}/g,'<span class="cpgreekupper">&Omicron;</span>');myInput=myInput.replace(/\\greek\{40\}/g,'<span class="cpgreekupper">&Pi;</span>');myInput=myInput.replace(/\\greek\{41\}/g,'<span class="cpgreekupper">&Rho;</span>');myInput=myInput.replace(/\\greek\{42\}/g,'<span class="cpgreekupper">&Sigma;</span>');myInput=myInput.replace(/\\greek\{43\}/g,'<span class="cpgreekupper">&Tau;</span>');myInput=myInput.replace(/\\greek\{44\}/g,'<span class="cpgreekupper">&Upsilon;</span>');myInput=myInput.replace(/\\greek\{45\}/g,'<span class="cpgreekupper">&Phi;</span>');myInput=myInput.replace(/\\greek\{46\}/g,'<span class="cpgreekupper">&Chi;</span>');myInput=myInput.replace(/\\greek\{47\}/g,'<span class="cpgreekupper">&Psi;</span>');myInput=myInput.replace(/\\greek\{48\}/g,'<span class="cpgreekupper">&Omega;</span>');return myInput;},replaceSubSupInput:function(myInput){myInput=myInput.replace(/_([\d]+)\^([\d]+)([a-z]+)\^([\d]*[\+\-]{1}|\/[\d]*[\^]*)_([\d]+)/gi,"_{$1}^{$2}{$3}^{$4}_{$5}");myInput=myInput.replace(/\^([\d]+)_([\d]+)([a-z]+)\^([\d]*[\+\-]{1}|\/[\d]*[\^]*})_([\d]+)/gi,"^{$1}_{$2}{$3}^{$4}_{$5}");myInput=myInput.replace(/\^([\d]+)_([\d]+)([a-z]+)_([\d]+)\^([\d]*[\+\-]{1}|\/[\d]*[\^]*)/gi,"^{$1}_{$2}{$3}_{$4}^{$5}");myInput=myInput.replace(/_([\d]+)\^([\d]+)([a-z]+)_([\d]+)\^([\d]*[\+\-]{1}|\/[\d]*[\^]*)/gi,"_{$1}^{$2}{$3}_{$4}^{$5}");var debug=false;if(myInput.match(/([a-zA-Z]+)_([\d]+)([\+\-]{1}|\/[\d]*)\^([\d]+)([\+\-]{1}|\/[\d]*)/g)){myInput=myInput.replace(/([a-zA-Z]+)_([\d]+)([\+\-]{1}|\/[\d]*)\^([\d]+)([\+\-]{1}|\/[\d]*)/g,"{$1}_{$2$3}^{$4$5}");if(debug){alert(1);}}else if(myInput.match(/([a-zA-Z]+)\^([\d]+)([\+\-]{1}|\/[\d]*)_([\d]+)([\+\-]{1}|\/[\d]*)/g)){myInput=myInput.replace(/([a-zA-Z]+)\^([\d]+)([\+\-]{1}|\/[\d]*)_([\d]+)([\+\-]{1}|\/[\d]*)/g,"{$1}^{$2$3}_{$4$5}");if(debug){alert(2);}}else if(myInput.match(/([a-zA-Z]+)_([\+\-]{1})([\d]+)\^([\+\-]{1})([\d]+)/g)){myInput=myInput.replace(/([a-zA-Z]+)_([\+\-]{1})([\d]+)\^([\+\-]{1})([\d]+)/g,"{$1}_{$3$2}^{$5$4}");if(debug){alert(3);}}else if(myInput.match(/([a-zA-Z]+)\^([\+\-]{1})([\d]+)_([\+\-]{1})([\d]+)/g)){myInput=myInput.replace(/([a-zA-Z]+)\^([\+\-]{1})([\d]+)_([\+\-]{1})([\d]+)/g,"{$1}^{$3$2}_{$5$4}");if(debug){alert(4);}}else if(myInput.match(/([a-zA-Z]+)_([\+\-]{1})([\d]+)\^([\d]+)([\+\-]{1}|\/[\d]*)/g)){myInput=myInput.replace(/([a-zA-Z]+)_([\+\-]{1})([\d]+)\^([\d]+)([\+\-]{1}|\/[\d]*)/g,"{$1}_{$3$2}^{$4$5}");if(debug){alert(5);}}else if(myInput.match(/([a-zA-Z]+)_([\d]+)([\+\-]{1}|\/[\d]*)\^([\+\-]{1})([\d]+)/g)){myInput=myInput.replace(/([a-zA-Z]+)_([\d]+)([\+\-]{1}|\/[\d]*)\^([\+\-]{1})([\d]+)/g,"{$1}_{$2$3}^{$5$4}");if(debug){alert(6);}}else if(myInput.match(/([a-zA-Z]+)\^([\+\-]{1})([\d]+)_([\d]+)([\+\-]{1}|\/[\d]*)/g)){myInput=myInput.replace(/([a-zA-Z]+)\^([\+\-]{1})([\d]+)_([\d]+)([\+\-]{1}|\/[\d]*)/g,"{$1}^{$3$2}_{$4$5}");if(debug){alert(7);}}else if(myInput.match(/([a-zA-Z]+)\^([\d]+)([\+\-]{1}|\/[\d]*)_([\+\-]{1})([\d]+)/g)){myInput=myInput.replace(/([a-zA-Z]+)\^([\d]+)([\+\-]{1}|\/[\d]*)_([\+\-]{1})([\d]+)/g,"{$1}^{$2$3}_{$5$4}");if(debug){alert(8);}}else if(myInput.match(/([a-zA-Z]+)_([\d]+)\^([\+\-]+)([\d]+)/g)){myInput=myInput.replace(/([a-zA-Z]+)_([\d]+)\^([\+\-]+)([\d]+)/g,"{$1}_{$2}^{$4$3}");if(debug){alert(9);}}else if(myInput.match(/([a-zA-Z]+)_([\d]+)\^([\d]+)([\+\-]{1}|\/[\d]*)/g)){myInput=myInput.replace(/([a-zA-Z]+)_([\d]+)\^([\d]+)([\+\-]{1}|\/[\d]*)/g,"{$1}_{$2}^{$3$4}");if(debug){alert(10);}}else if(myInput.match(/([a-zA-Z]+)\^([\d]+)([\+\-]{1}|\/[\d]*)_([\d]+)/g)){myInput=myInput.replace(/([a-zA-Z]+)\^([\d]+)([\+\-]{1}|\/[\d]*)_([\d]+)/g,"{$1}^{$2$3}_{$4}");if(debug){alert(11);}}else if(myInput.match(/([a-zA-Z]+)\^([\+\-]+)([\d]+)_([\d]+)/g)){myInput=myInput.replace(/([a-zA-Z]+)\^([\+\-]+)([\d]+)_([\d]+)/g,"{$1}^{$3$2}_{$4}");if(debug){alert(12);}}else if(myInput.match(/([a-zA-Z]+)_([\+\-]+)([\d]+)\^([\d]+)/g)){myInput=myInput.replace(/([a-zA-Z]+)_([\+\-]+)([\d]+)\^([\d]+)/g,"{$1}_{$3$2}^{$4}");if(debug){alert(13);}}else if(myInput.match(/([a-zA-Z]+)_([\d]+)([\+\-]{1}|\/[\d]*)\^([\d]+)/g)){myInput=myInput.replace(/([a-zA-Z]+)_([\d]+)([\+\-]{1}|\/[\d]*)\^([\d]+)/g,"{$1}_{$2$3}^{$4}");if(debug){alert(14);}}else if(myInput.match(/([a-zA-Z]+)\^([\d]+)_([\d]+)([\+\-]{1}|\/[\d]*)/g)){myInput=myInput.replace(/([a-zA-Z]+)\^([\d]+)_([\d]+)([\+\-]{1}|\/[\d]*)/g,"{$1}^{$2}_{$3$4}");if(debug){alert(15);}}else if(myInput.match(/([a-zA-Z]+)\^([\d]+)_([\+\-]+)([\d]+)/g)){myInput=myInput.replace(/([a-zA-Z]+)\^([\d]+)_([\+\-]+)([\d]+)/g,"{$1}^{$2}_{$4$3}");if(debug){alert(16);}}else if(myInput.match(/([a-zA-Z]+)\^([\d]+)_([\d]+[\/]?[\d]*[_]*)/g)){myInput=myInput.replace(/([a-zA-Z]+)\^([\d]+)_([\d]+[\/]?[\d]*[_]*)/g,"{$1}^{$2}_{$3}");if(debug){alert(17);}}else if(myInput.match(/([a-zA-Z]+)_([\d]+)\^([\d]+[\/]?[\d]*[\^]*)/g)){myInput=myInput.replace(/([a-zA-Z]+)_([\d]+)\^([\d]+[\/]?[\d]*[\^]*)/g,"{$1}_{$2}^{$3}");if(debug){alert(18);}}
else if(myInput.match(/([a-zA-Z]+)\^([{])(.*)([}])_([{])(.*)([}])/g)){myInput=myInput.replace(/([a-zA-Z]+)\^([{])(.*)([}])_([{])(.*)([}])/g,"{$1}^{$3}_{$6}");if(debug){alert(19);}}else if(myInput.match(/([a-zA-Z]+)_([{])(.*)([}])\^([{])(.*)([}])/g)){myInput=myInput.replace(/([a-zA-Z]+)_([{])(.*)([}])\^([{])(.*)([}])/g,"{$1}_{$3}^{$6}");if(debug){alert(20);}}else{if(debug){alert('no match');}}
myInput=myInput.replace(/\^([\d]+)_([\d]+)({[a-zA-Z]+}\^{[^}]*}_{[^}]*})/g,"^{$1}_{$2}$3");myInput=myInput.replace(/_([\d]+)\^([\d]+)({[a-zA-Z]+}\^{[^}]*}_{[^}]*})/g,"_{$1}^{$2}$3");myInput=myInput.replace(/\^([\d]+)_([\d]+)({[a-zA-Z]+}_{[^}]*}\^{[^}]*})/g,"^{$1}_{$2}$3");myInput=myInput.replace(/_([\d]+)\^([\d]+)({[a-zA-Z]+}_{[^}]*}\^{[^}]*})/g,"_{$1}^{$2}$3");myInput=myInput.replace(/_([\d]+)({[a-zA-Z]+}\^{[^}]*}_{[^}]*})/g,"_{$1}$2");myInput=myInput.replace(/\^([\d]+)({[a-zA-Z]+}\^{[^}]*}_{[^}]*})/g,"^{$1}$2");myInput=myInput.replace(/_([\d]+)({[a-zA-Z]+}_{[^}]*}\^{[^}]*})/g,"_{$1}$2");myInput=myInput.replace(/\^([\d]+)({[a-zA-Z]+}_{[^}]*}\^{[^}]*})/g,"^{$1}$2");myInput=myInput.replace(/\^([\d]+[\^]*)_([\d]+[\+\-]?[_]*)([a-zA-Z]+)/g,"^{$1}_{$2}{$3}");myInput=myInput.replace(/_([\d]+[\+\-]?[_]*)\^([\d]+[\^]*)([a-zA-Z]+)/g,"_{$1}^{$2}{$3}");myInput=myInput.replace(/\^([\d]+[\^]*)_([\+\-]{1})([\d]+[_]*)([a-zA-Z]+)/g,"^{$1}_{$3$2}{$4}");myInput=myInput.replace(/_([\+\-]?)([\d]+[_]*)\^([\d]+[\^]*)([a-zA-Z]+)/g,"_{$2$1}^{$3}{$4}");myInput=myInput.replace(/\^([\d]+)([\+\-]{1}|\/[\d]*[\^]*)/g,"^{$1$2}");myInput=myInput.replace(/_([\d]+)([\+\-]{1}|\/[\d]*[_]*)/g,"_{$1$2}");myInput=myInput.replace(/_([\d]+[\+\-]?[_]*)/g,"_{$1}");myInput=myInput.replace(/\^([\d]+[\+\-]?[\^]*)/g,"^{$1}");myInput=myInput.replace(/_([\+\-]{1})([\d]*[_]*)/g,"_{$2$1}");myInput=myInput.replace(/\^([\+\-]{1})([\d]*[\^]*)/g,"^{$2$1}");return myInput;},denyKeyStrokes:function(input){input=input.replace(/&/g,"");return input;},getUTF:function(buttonID){switch(buttonID){case"sub":insertSub();break;case"sup":insertSuper();break;case"bracket":insertGrouping("brackets");break;case"parenthesis":insertGrouping("parens");break;case"dot":insertLit(8226,"operator");break;case"gas":insertState("g");break;case"liquid":insertState("l");break;case"aqueous":insertState("aq");break;case"solid":insertState("s");break;case"alphaUpper":insertLit(913,"greek-upper");break;case"betaUpper":insertLit(914,"greek-upper");break;case"gammaUpper":insertLit(915,"greek-upper");break;case"deltaUpper":insertLit(916,"greek-upper");break;case"epsilonUpper":insertLit(917,"greek-upper");break;case"zetaUpper":insertLit(918,"greek-upper");break;case"etaUpper":insertLit(919,"greek-upper");break;case"thetaUpper":insertLit(920,"greek-upper");break;case"iotaUpper":insertLit(921,"greek-upper");break;case"kappaUpper":insertLit(922,"greek-upper");break;case"lambdaUpper":insertLit(923,"greek-upper");break;case"muUpper":insertLit(924,"greek-upper");break;case"nuUpper":insertLit(925,"greek-upper");break;case"xiUpper":insertLit(926,"greek-upper");break;case"omicronUpper":insertLit(927,"greek-upper");break;case"piUpper":insertLit(928,"greek-upper");break;case"rhoUpper":insertLit(929,"greek-upper");break;case"sigmaUpper":insertLit(931,"greek-upper");break;case"tauUpper":insertLit(932,"greek-upper");break;case"upsilonUpper":insertLit(933,"greek-upper");break;case"phiUpper":insertLit(934,"greek-upper");break;case"chiUpper":insertLit(935,"greek-upper");break;case"psiUpper":insertLit(936,"greek-upper");break;case"omegaUpper":insertLit(937,"omega-upper");break;case"alphaLower":insertLit(945,"greek-lower");break;case"betaLower":insertLit(946,"greek-lower");break;case"gammaLower":insertLit(947,"greek-lower");break;case"deltaLower":insertLit(948,"greek-lower");break;case"epsilonLower":insertLit(949,"greek-lower");break;case"zetaLower":insertLit(950,"greek-lower");break;case"etaLower":insertLit(951,"greek-lower");break;case"thetaLower":case"thetaL":insertLit(952,"greek-lower");break;case"iotaLower":insertLit(953,"greek-lower");break;case"kappaLower":insertLit(954,"greek-lower");break;case"lambdaLower":insertLit(955,"greek-lower");break;case"muLower":insertLit(956,"greek-lower");break;case"nuLower":insertLit(957,"greek-lower");break;case"xiLower":insertLit(958,"greek-lower");break;case"omicronLower":insertLit(959,"greek-lower");break;case"piLower":case"pi":insertLit(960,"greek-lower");break;case"rhoLower":insertLit(961,"greek-lower");break;case"sigmaLower":insertLit(963,"greek-lower");break;case"tauLower":insertLit(964,"greek-lower");break;case"upsilonLower":insertLit(965,"greek-lower");break;case"phiLower":insertLit(966,"greek-lower");break;case"chiLower":insertLit(967,"greek-lower");break;case"psiLower":insertLit(968,"greek-lower");break;case"omegaLower":insertLit(969,"greek-lower");break;case"reverseReaction":insertLit(8592,"symbol");break;case"forwardReaction":insertLit(8594,"symbol");break;case"equilibriumReaction":insertLit(8652,"symbol");break;case"resonanceArrow":insertLit(8596,"symbol");break;case"chargeMinus":insertCharge("","-");break;case"chargePlus":insertCharge("","+");break;case"oneMinus":insertCharge("null","-");break;case"onePlus":insertCharge("null","+");break;case"twoMinus":insertCharge("2","-");break;case"twoPlus":insertCharge("2","+");break;case"threeMinus":insertCharge("3","-");break;case"threePlus":insertCharge("3","+");break;case"isotope":insertIsotope();break;case"plus":insertLit(43,"operator");break;case"minus":insertLit(45,"operator");break;case"multiply":insertLit(42,"operator");break;case"divide":insertLit(247,"operator");break;case"frac":insertFrac("standard");break;case"mFrac":insertFrac("mixed");break;case"sqrt":insertRoot("square");break;case"supSub":insertSuperSub();break;case"nRoot":insertRoot("nth");break;case"abs":insertAbs();break;case"exp":insertLit(119890,"symbol");insertSuper();break;case"ln":insertLit(108,"ln");insertLit(110,"ln");break;case"log":case"generalLogarithm":insertLit(108,"log");insertLit(111,"log");insertLit(103,"log");if(buttonID=="generalLogarithm"){insertSub();}
break;case"infinity":insertLit(8734,"symbol");break;case"undefined":insertConst("UNDEFINED");break;case"imaginary":insertLit(119946,"var");break;case"degree":insertLit(176,"symbol");break;case"lessThan":insertLit(60,"operator");break;case"greaterThan":insertLit(62,"operator");break;case"lessOrEqual":insertLit(8804,"operator");break;case"greaterOrEqual":insertLit(8805,"operator");break;case"equals":insertLit(61,"operator");break;case"noSolution":insertConst("NO SOLUTION");break;case"brace":insertGrouping("braces");break;case"intersect":insertLit(8745,"operator");break;case"union":insertLit(8746,"operator");break;case"empty":insertLit(8709,"symbol");break;case"in":insertLit(8712,"operator");break;case"notIn":insertLit(8713,"operator");break;case"subset":insertLit(8834,"operator");break;case"superset":insertLit(8835,"operator");break;case"natural":insertLit(8469,"symbol");break;case"integer":insertLit(8484,"symbol");break;case"rational":insertLit(8474,"symbol");break;case"real":insertLit(8477,"symbol");break;case"complex":insertLit(8450,"symbol");break;case"powerOfTen":insertLit(49,"number");insertLit(48,"number");insertSuper();break;case"doesNotExist":insertConst("DNE");break;case"factorial":insertFactorial();break;case"sin":case"cos":case"tan":case"sec":case"csc":case"cot":case"asin":case"acos":case"atan":case"asec":case"acsc":case"acot":case"sinh":case"cosh":case"tanh":case"sech":case"csch":case"coth":case"asinh":case"acosh":case"atanh":case"asech":case"acsch":case"acoth":case"iSin":case"iCos":case"iTan":case"iSec":case"iCsc":case"iCot":case"iSinH":case"iCosH":case"iTanH":case"iSecH":case"iCscH":case"iCotH":insertTrig(buttonID);break;case"plusMinus":insertLit(177,"symbol");break;case"minusPlus":insertLit(8723,"symbol");break;case"notEquals":insertLit(8800,"operator");break;case"limit":insertLimit();break;case"derivative":insertDeriv("full",true);break;case"higherOrderDerivative":insertHODeriv("full");break;case"prime":insertPrime(1);break;case"doublePrime":insertPrime(2);break;case"triplePrime":insertPrime(3);break;case"partialDerivative":insertDeriv("partial",true);break;case"higherOrderPartialDerivative":insertHODeriv("partial");break;case"indefiniteIntegral":insertIntegral("indefinite",false);break;case"definiteIntegral":insertIntegral("definite",false);break;case"regionIntegral":insertIntegral("region",false);break;case"closedIntegral":insertIntegral("indefinite",true);break;case"closedRegionIntegral":insertIntegral("region",true);break;case"boldVector":boldSelection();break;case"generalVector":insertTop("arrow");break;case"unitVector":insertTop("hat");break;case"summationIndex":insertSummation(true);break;case"summation":insertSummation(false);break;case"product":insertProduct();break;case"binomialCoefficient":insertBiCo();break;case"iVector":insertLit(119842,"symbol");break;case"jVector":insertLit(119843,"symbol");break;case"kVector":insertLit(119844,"symbol");break;case"dotProduct":insertLit(8901,"operator");break;case"crossProduct":insertLit(10799,"operator");break;case"del":insertLit(8711,"symbol");break;case"vectorBracket":insertGrouping("vbrackets");break;case"alephNaught":insertLit(8501,"symbol");break;case"hbar":insertLit(8463,"symbol");break;case"parallel":insertLit(8741,"symbol");break;case"perpendicular":insertLit(8869,"symbol");break;case"scriptE":insertLit(8496,"symbol");break;case"scriptl":insertLit(8467,"symbol");break;case"bar":insertTop("bar");break;}}});wa=new Class({});wa.console=new Class({Implements:[Options],Singleton:true,options:{mode:['quiet']},initialize:function(options){this.setOptions(options);this.mode=(this.options.mode)?this.options.mode:['quiet'];if(this.mode=='quiet'||!(window.console)){return;}
this.firebug=!!((Browser.name=="firefox")&&window.console);this.info=!!(console.info);this.dirxml=!!(console.dirxml);this.assert=!!(console.assert);this.init();},init:function(){this.setMode(this.mode);},log:function(params,mode){if(this.mode.contains('exec')||this.mode.contains('verbose')){if(mode=='exec'){this.consoleInfo(params);}}
if(this.mode.contains('html')||this.mode.contains('verbose')){if(mode=='html'){this.consoleHtml(params);}}
if(this.mode.contains('data')||this.mode.contains('verbose')){if(mode=='data'){console.log(params);}}
if(this.mode.contains('assert')||this.mode.contains('verbose')){if(mode=='assert'){this.consoleAssert(params);}}
if(!mode&&this.mode.contains('verbose')){console.log(params);}},exec:function(params){this.log(params,'exec');},html:function(params){this.log(params,'html');},data:function(params){this.log(params,'data');},assert:function(params){this.log(params,'assert');},setMode:function(mode){if(typeOf(mode)!='ARRAY'){if(mode.contains(',')){mode=mode.replace(' ','');mode=mode.split(',');}else{mode=[mode];}}
this.mode=mode;return this.mode;},getMode:function(){return this.mode;},consoleInfo:function(params){try{if(this.info){console.info(params);}else{console.log(params);}}catch(e){}},consoleHtml:function(params){try{if(this.dirxml){console.dirxml(params);}else{console.log(params);}}catch(e){}},consoleAssert:function(params){try{if(this.assert){console.assert(params);}else{console.log(params);}}catch(e){}}});var wacon=new wa.console();window.addEvent('domready',function(){pchem=new pad({container:'chemPad'});});var buttonFn={'sub':'_','sup':'^','forwardReaction':'-->','equilibriumReaction':'<=>','reverseReaction':'<--','resonanceArrow':'<-->','deltaUpper':'Delta','piUpper':'Pi','sigmaUpper':'Sigma','omegaUpper':'Omega','alphaLower':'alpha','betaLower':'beta','deltaLower':'delta','gammaLower':'gamma','epsilonLower':'epsilon','zetaLower':'zeta','kappaLower':'kappa','lambdaLower':'lambda','muLower':'mu','nuLower':'nu','piLower':'pi','sigmaLower':'sigma','tauLower':'tau','phiLower':'phi','chiLower':'chi','psiLower':'psi','omegaLower':'omega'};var buttonIdName={'abs':'Absolute Value','acos':'Arccosine','acot':'Arccotangent','acsc':'Arccosecant','alephNaught':'aleph-naught','alphaLower':'<i>alpha</i>','alphaUpper':'Alpha','aqueous':'Aqueous','asec':'Arcsecant','asin':'Arcsine','asterisk':'Multiply','atan':'Arctangent','bar':'Bar','betaLower':'<i>beta</i>','betaUpper':'Beta','binomialCoefficient':'Binomial Coefficient','boldVector':'Bold Vector','brace':'Brace','bracket':'Bracket','chargeMinus':'Charge Minus','chargePlus':'Charge Plus','chiLower':'<i>chi</i>','chiUpper':'Chi','complex':'Complex Numbers','cos':'Cosine','cot':'Cotangent','crossProduct':'Cross Product','csc':'Cosecant','degree':'Degree','del':'del','deltaLower':'<i>delta</i>','deltaUpper':'Delta','derivative':'Derivative','divide':'Divide','doesNotExist':'Does Not Exist','doublePrime':'Double Prime','dot':'Dot','dotProduct':'Dot Product','empty':'Empty Set','epsilonLower':'<i>epsilon</i>','epsilonUpper':'Epsilon','equals':'Equals','equilibriumReaction':'Equilibrium Reaction','etaLower':'<i>eta</i>','etaUpper':'Eta','exp':'Exponential','factorial':'Factorial','forwardReaction':'Forward Reaction','frac':'Fraction','gammaLower':'<i>gamma</i>','gammaUpper':'Gamma','gas':'Gas','generalLogarithm':'General Logarithm','generalVector':'Vector','greaterOrEqual':'Greater Than or Equal','greaterThan':'Greater Than','higherOrderDerivative':'Higher Order Derivative','higherOrderPartialDerivative':'Higher Order Partial Derivative','hacos':'Hyperbolic Arccosine','hacot':'Hyperbolic Arccotangent','hacsc':'Hyperbolic Arccosecant','hasec':'Hyperbolic Arcsecant','hasin':'Hyperbolic Arcsine','hatan':'Hyperbolic Arctangent','hbar':'hbar','hcos':'Hyperbolic Cosine','hcot':'Hyperbolic Cotangent','hcsc':'Hyperbolic Cosecant','hsec':'Hyperbolic Secant','hsin':'Hyperbolic Sine','htan':'Hyperbolic Tangent','cosh':'Hyperbolic Cosine','coth':'Hyperbolic Cotangent','csch':'Hyperbolic Cosecant','sech':'Hyperbolic Secant','sinh':'Hyperbolic Sine','tanh':'Hyperbolic Tangent','iSin':'Inverse Sine','iCos':'Inverse Cosine','iTan':'Inverse Tangent','iSec':'Inverse Secant','iCsc':'Inverse Cosecant','iCot':'Inverse Cotangent','iHSin':'Inverse Hyperbolic Sine','iHCos':'Inverse Hyperbolic Cosine','iHTan':'Inverse Hyperbolic Tangent','iHSec':'Inverse Hyperbolic Secant','iHCsc':'Inverse Hyperbolic Cosecant','iHCot':'Inverse Hyperbolic Cotangent','iSinH':'Inverse Hyperbolic Sine','iCosH':'Inverse Hyperbolic Cosine','iTanH':'Inverse Hyperbolic Tangent','iSecH':'Inverse Hyperbolic Secant','iCscH':'Inverse Hyperbolic Cosecant','iCotH':'Inverse Hyperbolic Cotangent','iVector':'i Unit Vector','imaginary':'Imaginary Unit','in':'Element','infinity':'Infinity','integer':'Integer Numbers','integral':'Integral','indefiniteIntegral':'Indefinite Integral','definiteIntegral':'Definite Integral','regionIntegral':'Integral over a Region','closedIntegral':'Closed Integral','closedRegionIntegral':'Closed Integral over a Region','intersect':'Intersect','iotaLower':'<i>iota</i>','iotaUpper':'Iota','isotope':'Isotope Notation','jVector':'j Unit Vector','kVector':'k Unit Vector','kappaLower':'<i>kappa</i>','kappaUpper':'Kappa','lambdaLower':'<i>lambda</i>','lambdaUpper':'Lambda','lessOrEqual':'Less Than or Equal','lessThan':'Less Than','limit':'Limit','liquid':'Liquid','ln':'Natural Log','log':'Logarithm','mFrac':'Mixed Fraction','mFrac':'Mixed Number','minus':'Minus','minusPlus':'Minus or Plus','muLower':'<i>mu</i>','muUpper':'Mu','multiply':'Multiply','nRoot':'nth Root','natural':'Natural Numbers','noSolution':'No Solution','notEquals':'Not Equals','notIn':'Not an Element','nuLower':'<i>nu</i>','nuUpper':'Nu','omegaLower':'<i>omega</i>','omegaUpper':'Omega','omicronLower':'<i>omicron</i>','omicronUpper':'Omicron','oneMinus':'One Minus','onePlus':'One Plus','parallel':'Parallel','parenthesis':'Parenthesis','partialDerivative':'Partial Derivative','perpendicular':'Perpendicular','phiLower':'<i>phi</i>','phiUpper':'Phi','pi':'<i>pi</i>','piLower':'<i>pi</i>','piUpper':'Pi','plus':'Plus','plusMinus':'Plus or Minus','powerOfTen':'Power of Ten','prime':'Prime','product':'Product','psiLower':'<i>psi</i>','psiUpper':'Psi','rational':'Rational Numbers','real':'Real Numbers','resonanceArrow':'Resonance Structures','reverseReaction':'Reverse Reaction','rhoLower':'<i>rho</i>','rhoUpper':'Rho','scriptE':'Script E','scriptl':'Script l','sec':'Secant','sigmaLower':'<i>sigma</i>','sigmaUpper':'Sigma','sin':'Sine','slash':'Divide','solid':'Solid','sqrt':'Square Root','sub':'Subscript','subset':'Subset','summation':'Summation','summationIndex':'Summation with Index','sup':'Superscript','supSub':'Superscript Subscript','superset':'Superset','tan':'Tangent','tauLower':'<i>tau</i>','tauUpper':'Tau','thetaL':'<i>theta</i>','thetaLower':'<i>theta</i>','thetaUpper':'Theta','threeMinus':' Three Minus','threePlus':'Three Plus','topArrow':'top arrow','topHat':'top hat','triplePrime':'Triple Prime','twoMinus':'Two Minus','twoPlus':'Two Plus','undefined':'Undefined','unitVector':'Unit Vector','union':'Union','upsilonLower':'<i>upsilon</i>','upsilonUpper':'Upsilon','vectorBracket':'Vector Bracket','xiLower':'<i>xi</i>','xiUpper':'Xi','zetaLower':'<i>zeta</i>','zetaUpper':'Zeta'};var mpObjects=new Array();var mpFlashDivs=new Array();var mpXML=new Array();var mpTypes=new Array();var mpValues=new Array();var mpEnabled=new Array();var fIndex=-1;var mpIndex=0;function registerFlashPad(object,div,xml,type,value,enabled){var index=mpObjects.indexOf(object);if(index<0){index=mpObjects.length;}
mpObjects[index]=object;mpFlashDivs[index]=div;mpXML[index]=xml;mpTypes[index]=type;mpValues[index]=value;mpEnabled[index]=enabled;}
function getThisPadXML(mpId){if(document.forms[0]){if(document.forms[0].elements[mpId]){var contents;try{contents=getXML(mpId);}catch(err){}
if(contents!=undefined&&contents!='undefined'){document.forms[0].elements[mpId].value=contents;}}
else{}}
else{}}
function getPadXML(){var z;for(z=0;z<mpXML.length;z++){getThisPadXML(mpXML[z]);}
return true;}
function loadPads(qid,pos){var z,pad_swiff,type,url,install,objId,divId;var flashvars,params,attributes;for(z=0;z<mpFlashDivs.length;z++){padId=mpXML[z];if(qid!=undefined&&pos!=undefined&&padId.indexOf('_'+qid+'_'+pos+'_')<0){continue;}
type=mpTypes[z];objId=mpObjects[z];divId=mpFlashDivs[z];if(!$(divId)){continue;}
install='/v4swf/expressInstall.swf';switch(type){case'devmath':url='/v4swf/mathpad/mathpad-'+devmathpad_version+'.swf';break;case'calc':url='/v4swf/calcpad/calcpad-'+calcpad_version+'.swf';break;case'phys':url='/v4swf/physpad/physpad-'+physpad_version+'.swf';break;}
if(url.length&&isLDB){var timestamp=Number(new Date());url+='?ts='+timestamp+objId;}
flashvars={padid:padId,xml:escape(mpValues[z]),enabled:$(mpEnabled[z]).get('value'),showresp:1};params={allowScriptAccess:'always',wmode:'opaque'};attributes={id:objId,name:objId};swfobject.embedSWF(url,divId,'110','40','10.0.0.0',install,flashvars,params,attributes);}}
window.addEvent('domready',function(){function keyHandler(){var clickEvents=function(event){var sourceClassName='';if($(event.srcElement)){sourceClassName=$(event.srcElement).className;sourceClass=$(event.srcElement);}else{sourceClassName=$(event.target).className;sourceClass=$(event.target);}
if(sourceClassName=='repository'){turnOnKeys();}
if(sourceClassName!='repository'){turnOffKeys();}}
turnOnKeys();}
function turnOnKeys(){turnOffKeys();$$('html').addEvent('keydown',function(e){var code="";function cmd(e){if(e.code==224){return true;}else{return false;}}
if(e.shift){switch(e.code)
{case 9:code='tab';break;case 48:code=')';break;case 49:code='!';break;case 50:code='@';break;case 51:code='#';break;case 52:code='$';break;case 53:code='%';break;case 54:code='^';break;case 55:code='&';break;case 56:code='*';break;case 57:code='(';break;case 59:code=':';break;case 61:code='+';break;case 65:code='A';break;case 66:code='B';break;case 67:code='C';break;case 68:code='D';break;case 69:code='E';break;case 70:code='F';break;case 71:code='G';break;case 72:code='H';break;case 73:code='I';break;case 74:code='J';break;case 75:code='K';break;case 76:code='L';break;case 77:code='M';break;case 78:code='N';break;case 79:code='O';break;case 80:code='P';break;case 81:code='Q';break;case 82:code='R';break;case 83:code='S';break;case 84:code='T';break;case 85:code='U';break;case 86:code='V';break;case 87:code='W';break;case 88:code='X';break;case 89:code='Y';break;case 90:code='Z';break;case 107:code='+';break;case 109:code='_';break;case 173:code='_';break;case 186:code=':';break;case 187:code='+';break;case 188:code='<';break;case 189:code='_';break;case 190:code='>';break;case 192:code='~';break;case 219:code='{';break;case 220:code='|';break;case 221:code='}';break;case 222:code='\'';break;}}else if(!e.meta){switch(e.code)
{case 8:code='backspace';break;case 9:code='tab';break;case 32:code='space';break;case 35:code='end';break;case 36:code='home';break;case 37:code='left';break;case 38:code='up';break;case 39:code='right';break;case 40:code='down';break;case 46:code='delete';break;case 48:code='0';break;case 49:code='1';break;case 50:code='2';break;case 51:code='3';break;case 52:code='4';break;case 53:code='5';break;case 54:code='6';break;case 55:code='7';break;case 56:code='8';break;case 57:code='9';break;case 61:code='=';break;case 65:code='a';break;case 66:code='b';break;case 67:code='c';break;case 68:code='d';break;case 69:code='e';break;case 70:code='f';break;case 71:code='g';break;case 72:code='h';break;case 73:code='i';break;case 74:code='j';break;case 75:code='k';break;case 76:code='l';break;case 77:code='m';break;case 78:code='n';break;case 79:code='o';break;case 80:code='p';break;case 81:code='q';break;case 82:code='r';break;case 83:code='s';break;case 84:code='t';break;case 85:code='u';break;case 86:code='v';break;case 87:code='w';break;case 88:code='x';break;case 89:code='y';break;case 90:code='z';break;case 96:code='0';break;case 97:code='1';break;case 98:code='2';break;case 99:code='3';break;case 100:code='4';break;case 101:code='5';break;case 102:code='6';break;case 103:code='7';break;case 104:code='8';break;case 105:code='9';break;case 106:code='*';break;case 107:code='=';break;case 109:code='-';break;case 110:code='.';break;case 111:code='/';break;case 173:code='-';break;case 187:code='=';break;case 188:code=',';break;case 189:code='-';break;case 190:code='.';break;case 191:code='/';break;case 219:code='[';break;case 221:code=']';break;}}
var padid,padobj;try{if(fIndex>-1){padid=mpXML[fIndex];padobj=document.getElementById(mpObjects[fIndex]);if(padobj){if(e.meta&&e.code==67){padobj.sendKey("copy",true,false);}
else if(e.meta&&e.code==88){padobj.sendKey("cut",true,false);}
else if(e.meta&&e.code==86){padobj.sendKey("paste",true,false);}
else if(e.meta&&e.code==65){padobj.sendKey("selectall",true,false);}
else if(e.meta&&e.code==66){padobj.boldSelection();}
if(e.control&&e.code==67){padobj.sendKey("copy",true,false);}
else if(e.control&&e.code==88){padobj.sendKey("cut",true,false);}
else if(e.control&&e.code==86){padobj.sendKey("paste",true,false);}
else if(e.control&&e.code==65){padobj.sendKey("selectall",true,false);}
else if(e.control&&e.code==66){padobj.boldSelection();}
else if(e.shift&&e.code==37){padobj.sendKey("shiftleft",false,true);}
else if(e.shift&&e.code==39){padobj.sendKey("shiftright",false,true);}
else if(e.shift&&e.code==9){padobj.sendKey("tab",false,true);}
else if(code!=""){padobj.sendKey(code,false,false);}}}}catch(err){};});}
function turnOffKeys(){$$('html').removeEvents('keydown');}
keyHandler();});var matrix_input_maximum_rows=8;var matrix_input_maximum_columns=8;var matrix_input_arrow_image_base='/wastatic/common/img/arrow_green_';function button(dc,dr,id,enabled){var arrow=(dr?dr>0?'down':'up':dc>0?'right':'left')
+(enabled?'':'_gray')
+'.png';return'<img src="'
+matrix_input_arrow_image_base+arrow
+'" alt=""'
+(enabled?' onclick="matrix_change('+dc+','+dr+',\''+id+'\')"':'')
+'/>';}
function setMatrixDimensions(id,matrixDimensions){var div=document.getElementById('matrix_'+id);div.setAttribute('data-matrix-rows',matrixDimensions.rows);div.setAttribute('data-matrix-cols',matrixDimensions.columns);}
function getMatrixDimensions(id){var div=document.getElementById('matrix_'+id);var rc={rows:parseInt(div.getAttribute('data-matrix-rows'),10),columns:parseInt(div.getAttribute('data-matrix-cols'),10)};if(rc.rows===undefined||isNaN(rc.rows)){var max_rows=0;for(var r=0;r<=matrix_input_maximum_rows;r++){if(document.getElementById(id+'0'+r)){max_rows++};}
rc.rows=max_rows;}
if(rc.columns===undefined||isNaN(rc.columns)){var max_columns=0;for(var c=0;c<=matrix_input_maximum_columns;c++){if(document.getElementById(id+c+'0')){max_columns++};}
rc.columns=max_columns;}
setMatrixDimensions(id,rc);return rc;}
function matrix_flatten(id,valueOnly){var div=document.getElementById('matrix_'+id);var flat='[';var rc=getMatrixDimensions(id);var rows=rc.rows;var columns=rc.columns;for(var r=0;r<rows;r++)
for(var c=0;c<columns;c++)
flat+=(c?',':'')
+document.getElementById(id+c+r).value.replace(/[,;\]\[]/g,'')
+((c+1==columns&&r+1<rows)?';':'');document.getElementById(id).value=flat.match(/\w/)?(flat+']'):'';if(!valueOnly){var box=$(id).retrieve('box');if(box){box.element.fireEvent('matrixChanged');}}}
function matrix_draw(id){var div=document.getElementById('matrix_'+id);var rc=getMatrixDimensions(id);var rows=rc.rows;var columns=rc.columns;var divStatic=div.static;var disabled=div.disabled;var matrix='<table class="matrix '+div.type+'">';if(disabled)
divStatic=1;for(var r=0;r<rows;r++){var top_bottom=r+1==rows?' matrix_bottom':'';top_bottom+=r?'':' matrix_top';matrix+='<tr>';for(var c=0;c<columns;c++){var left_style='matrix_left'+top_bottom+(c?'':' matrix_first');var right_style='matrix_right'+top_bottom+(c+1==columns?' matrix_last':'');if(!r&&div.type=='columnvectors')
matrix+='<td rowspan="'+rows+'">'+(div.label.length?div.label+'<sub>'+(c+1)+'</sub>&nbsp;=&nbsp;':'')+'</td>'
else
if(!c&&div.label.length){if(div.type=='rowvectors')
matrix+='<td>'+div.label+'<sub>'+(r+1)+'</sub>&nbsp;=&nbsp;</td>'
else
if(!r&&(div.type=='matrix'||div.type=='determinant'))
matrix+='<td rowspan="'+rows+'">'+div.label+'&nbsp;=&nbsp;</td>'}
matrix+='<td class="'+left_style+'"></td>'
+'<td><input id="'+id+c+r+'" '
+(disabled?'disabled="disabled" class="static"':'onkeyup="matrix_flatten(\''+id+'\')"')
+'/></td>'
+'<td class="'+right_style+'"></td>';}
if(!r&&!divStatic)
matrix+='<td class="matrix_left_right_buttons" rowspan="'+rows+'">'
+button(-1,0,id,columns-1)+'<br/>'
+button(1,0,id,columns-matrix_input_maximum_columns)
+'</td>';matrix+='</tr>';}
if(!divStatic)
matrix+='<tr>'
+(div.label.length?'<td></td>':'')
+'<td class="matrix_up_down_buttons" colspan="'+(3*columns+(div.type=='columnvectors'?columns-1:0))+'">'
+button(0,1,id,rows-matrix_input_maximum_rows)
+button(0,-1,id,rows-1)
+'</td></tr>'
matrix+='</table>';div.innerHTML=matrix;}
function matrix_initialize(id,columns,rows,type,name,divStatic,disabled){var div=document.getElementById('matrix_'+id);var response=document.getElementById(id).value.replace(/\s/g,'');if(response.length){rows=response.split(';').length;columns=(response.split(',').length-1)/rows+1;}
setMatrixDimensions(id,{rows:rows,columns:columns});div.type=type;div.label=name;div.static=divStatic;div.disabled=disabled;matrix_draw(id);if(response.length){matrix_from_flat(id,columns,rows);}}
function matrix_initialize_from_string(id,value){var matrix=value.replace(/[\[\]]/g,'').split(';');var rows=matrix.length;var columns=matrix[0].split(',').length;var elements=value.replace(/[\[\]]/g,'').replace(/;/g,',').split(',');var div=document.getElementById('matrix_'+id);setMatrixDimensions(id,{rows:rows,columns:columns});matrix_draw(id,columns,rows);for(var r=0,i=0;r<rows;r++){for(var c=0;c<columns;c++,i++){var element=document.getElementById(id+c+r);if(element&&elements[i])
element.value=elements[i];}}}
function matrix_change(dc,dr,id){var div=document.getElementById('matrix_'+id);var rc=getMatrixDimensions(id);rc.rows+=dr;rc.columns+=dc;setMatrixDimensions(id,rc);matrix_draw(id);matrix_from_flat(id,rc.columns-dc,rc.rows-dr);matrix_flatten(id);}
function matrix_from_flat(id,columns,rows){var elements=document.getElementById(id).value.replace(/[\[\]]/g,'').replace(/;/g,',').split(',');for(var r=0,i=0;r<rows;r++)
for(var c=0;c<columns;c++,i++){var element=document.getElementById(id+c+r);if(element&&elements[i])
element.value=elements[i];}}
var ebook_timer="restart";var winArray=[];var timer_short_handle;var timer_long_handle;var modal_short;var modal_long;var short_min=600;var long_min=605;function start_child_touch(){setInterval("child_touch()",3000);}
function child_touch(){winArray.each(function(win){var winFlag=1;try{if(!$defined(win.location.hostname)){winFlag=0;}}catch(err){winFlag=0;}
var patt1=new RegExp("AAA");if(!win.closed&&winFlag&&!patt1.test(win.name)){var win_string="AAA"+win.name;win.name=win_string;}});}
function close_ebooks(){if(timer_short_handle!=undefined){clearTimeout(timer_short_handle);}
if(timer_long_handle!=undefined){clearTimeout(timer_long_handle);}
modal_short.hide();winArray.each(function(win){var winFlag=1;try{if(!$defined(win.location.hostname)){winFlag=0;}}catch(err){winFlag=0;}
if(!win.closed&&winFlag){win.close();}});}
function start_timer_short(){if(timer_short_handle!=undefined){clearTimeout(timer_short_handle);}
timer_short_handle=setTimeout("timer_short()",short_min*60*1000);ebook_timer="running"}
function start_timer_long(){if(timer_long_handle!=undefined){clearTimeout(timer_long_handle);}
timer_long_handle=setTimeout("timer_long()",long_min*60*1000);ebook_timer="running"}
function verify_cred(id){var security='';var upass=$('UserPass').value;var url='/wx/ebooks/security';var ebook_security=new Request({url:url,async:false,onSuccess:function(creds){security=creds;},onRequest:function(){}});ebook_security.send('id='+id+'&UserPass='+upass);alert("Security:"+security);return security;}
function openEbook(server_name,wa_alias,ebookurl,ebookid,secflag){var win_url=ebookurl;var win_options='';if(secflag==="on"){var patt1=new RegExp("demo");if(patt1.test(ebookurl)){win_url='https://'+server_name+'/'+wa_alias+'/extra/ebookwrapper/demo.html?';win_url+='ebook_url='+ebookurl;}else{var upass=$('UserPass').value;if(!upass){upass=$('sid').value;}
win_url='https://'+server_name+'/'+wa_alias+'/extra/ebookwrapper/index.tpl?';win_url+='ebook_url='+ebookurl;win_url+='&UserPass='+upass;}
win_options='toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbar=no,resizable,copyhistory=yes,width=960,height=720,left=25,top=25,screenX=25,screenY=25';}
var win_ebook=window.open(win_url,ebookid,win_options);win_ebook.focus();return false;}
function openMindtapReader(isbn,extra){if(arguments.length>2){var server=arguments[0];var tk=arguments[1];var ebook_code=arguments[2];var page=arguments[3];var win_url='https://'+server+'/nb/service/launch?';win_url+='token='+tk;win_url+='&eISBN='+ebook_code;if(page!==''){win_url+='&'+page;}
var win_options='';this.openWindow(win_url,'Mindtap Reader',win_options);return false;}else{var win_url='/web/User/Cengage/mtr?isbn='+isbn;if(extra!==''){win_url+='&'+extra;}
var win_options='';this.openWindow(win_url,'Mindtap Reader',win_options);return false;}}
function timer_short(){var ebook_ids='';winArray.each(function(win){var winFlag=1;try{if(!$defined(win.location.hostname)){winFlag=0;}}catch(err){winFlag=0;}
if(!win.closed&&winFlag){ebook_ids=ebook_ids+','+win.name}});if(ebook_ids.length===0){clearTimeout(timer_long_handle);return;}
var url='/wx/ebooks/html';var userPass=$('UserPass').value;var ebook_html=new Request({url:url,onSuccess:function(html){modal_short=new ebooksModal(html,'n','I am still here!','Close eBooks');modal_short.show();},onRequest:function(){}});ebook_html.send('ebook_string='+ebook_ids+'&UserPass='+userPass+'&type=text');}
function timer_long(){var ebook_ids='';winArray.each(function(win){var winFlag=1;try{if(!$defined(win.location.hostname)){winFlag=0;}}catch(err){winFlag=0;}
if(!win.closed&&winFlag){ebook_ids=ebook_ids+','+win.name}});if(ebook_ids.length===0){return;}
var url='/wx/ebooks/html';var userPass=$('UserPass').value;var ebook_html=new Request({url:url,onSuccess:function(html){modal_short.hide();modal_long=new ebooksModal(html,'n','Close this Message');modal_long.show();close_ebooks();},onRequest:function(){}});ebook_html.send('ebook_string='+ebook_ids+'&UserPass='+userPass+'&type=links');}
window.addEvent('domready',function(){var saveEbook=function(){var textbook=this.getParent('.iButton').getPrevious('input[name=textbook_id]').value;var section_links=$('vitalsourceLinks'+textbook).value;var section_id=$('vitalsourceSection'+textbook).value;var textbook_id=$('vitalsourceTextbook'+textbook).value;var book_code=$('vitalsourceBookCode'+textbook).value;var publisher=$('vitalsourcePublisher'+textbook).value;var params='section_id='+section_id
+'&textbook_id='+textbook_id
+'&book_code='+book_code
+'&publisher='+publisher
+'&section_links='+section_links;var url='/wx/ebooks/save_dynamic_book';var req=new Request.JSON({url:url,onSuccess:function(response){if(response.error){$$('.vitalsourceMessage').set('html',response.error);$$('.vitalsourceMessage').setStyles({'background-color':'#f5b5b5','font-weight':'bold'});}
else if(response.message){$$('.vitalsourceMessage').set('html',response.message);$$('.vitalsourceMessage').setStyles({'background-color':'#bcdebc'});var removeLink="<a class='removeVitalSourceVBID'>Remove</a>";var vbidValue=response.book_code+' '+removeLink;$$('.vbidValue'+textbook).set('html',vbidValue);$$('.removeVitalSourceVBID').each(function(el){el.addEvent('click',removeVBID.bind(el))});$$('input[name=vitalsourceBookCode]').set('value','');}}}).send(params);}
var removeVBID=function(){var textbook=this.getParent('.vitalsourceVBID').getNext('input[name=textbook_id]').value;var section_links=$('vitalsourceLinks'+textbook).value;var section_id=$('vitalsourceSection'+textbook).value;var textbook_id=$('vitalsourceTextbook'+textbook).value;var publisher=$('vitalsourcePublisher'+textbook).value;var ebook_id=$('vitalsourceEbook'+textbook).value;var params='section_id='+section_id
+'&textbook_id='+textbook_id
+'&ebook_id='+ebook_id
+'&publisher='+publisher
+'&section_links='+section_links;var url='/wx/ebooks/remove_dynamic_book';var req=new Request.JSON({url:url,onSuccess:function(response){if(response.error){$$('.vitalsourceMessage').set('html',response.error);$$('.vitalsourceMessage').setStyles({'background-color':'#f5b5b5','font-weight':'bold'});}
else if(response.message){$$('.vitalsourceMessage').set('html',response.message);$$('.vitalsourceMessage').setStyles({'background-color':'#bcdebc'});$$('.vbidValue'+textbook).set('html',response.book_code);}}}).send(params);}
$$('.vitalsourceBtn').each(function(el){el.addEvent('click',saveEbook.bind(el))});$$('.removeVitalSourceVBID').each(function(el){el.addEvent('click',removeVBID.bind(el))});});var debugFlag=false;function debug(input){if(debugFlag){debug(input);}}
var AscDialog=new Class({options:{closeButtonText:'Save Assignment',speed:500,maskOpacity:0.3,maskColor:'#000000',isModal:false,useArrows:false,addCloseBtn:true,submitjs:false,popOpacity:1,cornerRadius:10,classPrefix:'Asc',containerClass:false,boxColor:'red',alignChoice:'center',msgAlign:{'left':'pLeft','center':'pCenter','right':'pRight'},colorStyles:{'red':{nw:'nw',n:'north',ne:'ne',sw:'sw',s:'s',se:'se'},'blue':{nw:'bnw',n:'bnorth',ne:'bne',sw:'bsw',s:'bs',se:'bse'},'grey':{nw:'gnw',n:'gnorth',ne:'gne',sw:'gsw',s:'gs',se:'gse'}},place:{'ss':{target:'window',io:1,align:'n',offset:0,margin:0},'se':{trans:'fly',target:'window',io:-1,align:'c',offset:0,margin:0},'he':{trans:'fly',target:'window',io:1,align:'n',offset:0,margin:0}},onHide:$empty,onShow:$empty,transition:Fx.Transitions.Quad.easeInOut},initialize:function(options){this.setOptions(options);this.isShowing=false;this.mask=false;this.pop=false;this.event=window.event;this.isIE=/MSIE (5.5|6.)/.test(navigator.userAgent);if(this.isIE){this.options.useArrows=false;}
this.fx_dir=0;this.fx_in_process=false;this.windowEventHandler=this.onWindowEvent.bindWithEvent(this);this.init();},init:function(){if(this.pop){}
this.add_pop();var fxels=[this.pop];if(this.options.isModal){this.add_mask();fxels[1]=this.mask;}else if(this.isIE){this.options.maskColor='#FFF';this.add_mask();}
this.fx=new Fx.Elements(fxels,{wait:false,duration:this.options.speed,transition:this.options.transition,onStart:function(){this.fx_in_process=true;}.bind(this),onComplete:function(){switch(this.fx_dir){case 1:this.isShowing=true;this.pop.focus();break;case 0:this.isShowing=false;this.pop.setStyles({'visibility':'hidden','display':'none'});if(this.options.isModal){this.mask.setStyle('display','none');}
if(!this.options.isModal&&this.isIE){this.mask.setOpacity(0);}
break;}
this.fx_in_process=false;}.bind(this)});},add_mask:function(){if(!this.mask){if(this.isIE){this.mask=new Element('iframe',{'class':this.options.classPrefix+'Mask','src':"about:blank",'frameborder':0,'src':"about:blank"}).inject(document.body);}else{this.mask=new Element('div',{'class':this.options.classPrefix+'Mask'}).inject(document.body);}
this.mask.setStyles({'position':'absolute','top':0,'left':0,'opacity':0,'z-index':9999,'background-color':this.options.maskColor,'display':'none'});}},add_pop:function(){classes=this.options.containerClass?this.options.containerClass+' '+this.options.classPrefix+'Pop':this.options.classPrefix+'Pop'
this.pop=new Element('div',{'class':classes,'styles':{'position':'absolute','visibility':'hidden','top':-1000,'left':0,'z-index':10000,'display':'none'}}).inject(document.body);this.pop.addEvent('keydown',function(e){this.esc(e);}.bind(this));this.poptbl=new Element('table',{'class':'grid '+this.options.msgAlign[this.options.alignChoice]}).injectInside(this.pop);this.poptbody=new Element('tbody').injectInside(this.poptbl);var color=this.options.boxColor;[[this.options.colorStyles[color].nw,this.options.colorStyles[color].n,this.options.colorStyles[color].ne],[this.options.colorStyles[color].sw,this.options.colorStyles[color].s,this.options.colorStyles[color].se]].each(function(tds){this.insertPopTblRow(tds);}.bind(this));this.popc=this.poptbl.getElement('td[class='+this.options.colorStyles[color].n+']');if(this.options.useArrows){this.addPopArrows();}
if(this.options.addCloseBtn){this.close=new Element('div',{'class':this.options.classPrefix+'Close'}).injectInside(this.pop);var close_button=new Element('button',{'name':'closeButton','class':'sButton','styles':{'position':'relative','display':'inline','float':'none','border-width':'2px'},'events':{'click':this.hide.bindWithEvent(this)}}).injectInside(this.close);close_button.set('html',this.options.closeButtonText);close_button.addEvent('click',function(e){if(e)e=new Event(e).stop();this.hide();}.bind(this));}},insertPopTblRow:function(tds){var tr=new Element('tr').injectInside(this.poptbody);tds.each(function(cls){var td=new Element('td',{'class':cls}).injectInside(tr);});},set_contents:function(msg,cls){var color=this.options.boxColor;if(($type(cls)=='undefined')||(cls=='')){cls='n';}
if(this.popc){this.popc.className=this.options.colorStyles[color].n+' '+cls;}
if(this.popc){this.popc.empty();switch($type(msg)){case'element':var msg_cl=msg.clone().cloneEvents(msg).inject(this.popc);break;case'string':this.popc.set('html',msg);break;}}
var was_dn=false;if(this.pop.getStyle('display')=='none'){was_dn=true;this.pop.setStyle('display','block');}
this.popsize=this.pop.getSize();if(was_dn){this.pop.setStyle('display','none');}},show:function(){if(!this.isShowing){window.addEvent('resize',this.windowEventHandler);window.addEvent('scroll',this.windowEventHandler);var start={'visibility':'visible','display':'block','opacity':0};var fx={'0':{'opacity':this.options.popOpacity}};var se=this.options.place.se;var ss=this.options.place.ss;var end_xy=this.coord(se.target,se.io,se.align,se.offset,true);start.top=end_xy.top;start.left=end_xy.left;this.pop.setStyles(start);if(this.options.isModal){this.add_mask();this.mask.setStyles({'height':window.getScrollHeight(),'width':window.getScrollWidth(),'display':'block'});fx['1']={'opacity':this.options.maskOpacity};}else{if(!this.options.isModal&&this.isIE){this.mask.setStyles({'height':this.popsize.y,'width':this.popsize.x,'display':'block','visibility':'visible','top':end_xy.top,'left':end_xy.left});}}
this.fx_dir=1;this.fx.start(fx);return false;}},hide:function(e){if(!this.isShowing){return false;}
window.removeEvent('resize',this.windowEventHandler);window.removeEvent('scroll',this.windowEventHandler);this.fx_dir=0;var fx={'0':{'opacity':0}};var he=this.options.place.he;fx['1']={'opacity':0};if(this.options.submitjs){if($chk($('modal'))){$('modal').value='1';}
eval($('submitJS').value);this.fx.start(fx);}else{this.fx.start(fx);}},onWindowEvent:function(e){this.update(e);if(this.isShowing){this.isShowing=false;this.show();}},update:function(e){if(this.isShowing){if(this.options.isModal){var size=window.getSize();var scroll=this.pop.getScroll();this.mask.setStyles({'height':'10000','width':size.x});}
var se=this.options.place.se;if((se.target=='window')&&(se.io==-1)){var coord=this.coord('window',-1,se.align,se.offset,false);this.fx.start({'0':{'top':coord.top,'left':coord.left,'margin':se.margin}});}}},coord:function(target,io,align,offset,arr_mode){var top=0;var left=0;var tdim=0;if(target=='window'){top=window.getScrollTop();left=window.getScrollLeft();tdim={'x':window.getWidth(),'y':window.getHeight()};}else{if($type(target)=='string'){var t=$(target);}else{var t=target;}
if(t){if(t.getStyle('display')=='inline'){var tpos=this.cursor_pos(this.event);top=tpos.y;left=tpos.x;tdim={'x':1,'y':1};}else{var tpos=t.getPosition();if(tpos){top=tpos.y;left=tpos.x;tdim={'x':t.offsetWidth,'y':t.offsetHeight};}}
if(!$defined(align)){align=this.auto_align(t,'auto');}}}
if(tdim){if((arr_mode===true)&&this.options.useArrows){var pa=this.show_arrow(io,align);}
var nesw=align.substr(0,1);switch(io){case 1:switch(nesw){case'n':top-=(this.popsize.y+offset);break;case'e':left+=(tdim.x+offset);break;case's':top+=(tdim.y+offset);break;case'w':left-=(this.popsize.x+offset);break;}
switch(align){case'nw':case'sw':if((tdim.x<this.popsize.x)&&pa){left-=pa.a.x/2;}
break;case'ne':case'se':if((tdim.x<this.popsize.x)&&pa){left+=pa.a.x/2;}
break;}
switch(align){case'n':left+=(tdim.x/2-this.popsize.x/2);break;case'ne':left+=(tdim.x-this.popsize.x);break;case'w':top+=(tdim.y/2-this.popsize.y/2);break;case'ws':top+=(tdim.y-this.popsize.y);break;case'e':top+=(tdim.y/2-this.popsize.y/2);break;case'es':top+=(tdim.y-this.popsize.y);break;case's':left+=(tdim.x/2-this.popsize.x/2);break;case'se':left+=(tdim.x-this.popsize.x);break;}
break;case-1:switch(nesw){case'n':top+=offset;break;case's':top+=(tdim.y-this.popsize.y-offset);break;}
switch(align){case'nw':left+=offset;break;case'n':left+=(tdim.x/2-this.popsize.x/2);break;case'ne':left+=(tdim.x-this.popsize.x-offset);break;case'w':top+=(tdim.y/2-this.popsize.y/2);left+=offset;break;case'c':top+=(tdim.y/2-this.popsize.y/2);left+=(tdim.x/2-this.popsize.x/2);break;case'e':top+=(tdim.y/2-this.popsize.y/2);left+=(tdim.x-this.popsize.x-offset);break;case'sw':left+=offset;break;case's':left+=(tdim.x/2-this.popsize.x/2);break;case'se':left+=(tdim.x-this.popsize.x-offset);break;}
break;}
if(pa){top+=pa.p.top;left+=pa.p.left;}
return{'top':top,'left':left};}
return false},destroy:function(){if(this.mask){this.mask.remove();}
this.pop.remove();}});AscDialog.implement(new Options,new Events);var AscModal=new Class({Extends:AscDialog,options:{closeButtonText:'Save Assignment',isModal:true,addCloseBtn:true,popOpacity:1.0,classPrefix:'Modal',submitjs:true,place:{'ss':{target:'window',io:1,align:'n'},'se':{trans:'fly',target:'window',io:-1,align:'c'},'he':{trans:'fly',target:'window',io:1,align:'n'}}},initialize:function(msg,cls,bMsg,options){this.setOptions(options);this.options.closeButtonText=bMsg;this.parent(options);this.set_contents(msg,cls);}});var memoModal=new Class({Extends:AscDialog,options:{closeButtonText:'Save Assignment',isModal:true,addCloseBtn:true,popOpacity:1.0,classPrefix:'Modal',submitjs:true,boxColor:'blue',alignChoice:'left',place:{'ss':{target:'window',io:1,align:'n'},'se':{trans:'fly',target:'window',io:-1,align:'c'},'he':{trans:'fly',target:'window',io:1,align:'n'}}},initialize:function(msg,cls,bMsg,options){if(bMsg){this.options.closeButtonText=bMsg;}else{this.options.addCloseBtn=false;}
this.parent(options);this.set_contents(msg,cls);}});var RequirementModal=new Class({Extends:memoModal,options:{containerClass:'EbooksModal',submitjs:false,boxColor:'red'},initialize:function(msg,cls,bMsg,bMsg2,bAction,options){if(bMsg){this.options.bAction=bAction;}
if(bMsg2){this.options.closeButtonText2=bMsg2;this.options.addCloseBtn2=true;}
this.parent(msg,cls,bMsg,options);},add_pop:function(){this.parent();if(this.options.addCloseBtn2){var close_button2=new Element('button',{'name':'closeButton2','class':'sButton','styles':{'position':'relative','display':'inline','float':'none','border-width':'2px'},'events':{'click':this.hide.bindWithEvent(this)}}).inject(this.close,'top');close_button2.set('html',this.options.closeButtonText2);close_button2.addEvent('click',this.options.bAction);}}});var questionLinksModal=new Class({Extends:memoModal,options:{addCloseBtn:false,containerClass:'questionLinksModal',submitjs:false,boxColor:'red'}});var ebooksModal=new Class({Extends:memoModal,options:{submitjs:false,boxColor:'blue',containerClass:'EbooksModal'},initialize:function(msg,cls,bMsg,bMsg2,options){if(bMsg2){this.options.closeButtonText2=bMsg2;this.options.addCloseBtn2=true;this.options.boxColor='red';}
this.parent(msg,cls,bMsg,options);},hide:function(e){clearTimeout(timer_long_handle);start_timer_short();start_timer_long();this.parent(e);},add_pop:function(){this.parent();if(this.options.addCloseBtn2){var close_button2=new Element('button',{'name':'closeButton2','class':'sButton','styles':{'position':'relative','display':'inline','float':'none','border-width':'2px'},'events':{'click':this.hide.bindWithEvent(this)}}).inject(this.close,'top');close_button2.set('html',this.options.closeButtonText2);close_button2.addEvent('click',function(e){if(e)e=new Event(e).stop();this.hide();close_ebooks();}.bind(this));}}});var feedbackModal=new Class({Extends:memoModal,options:{addCloseBtn:false,closeButtonText:'Cancel',containerClass:'feedbackModal',submitjs:false,boxColor:'blue',asset_id:0},initialize:function(msg,cls,bMsg,asset_id){this.options.asset_id=asset_id;this.parent(msg,cls,bMsg,this.options);this.close=new Element('div',{'class':this.options.classPrefix+'Close'}).injectInside($('feedbackModalContent'));var close_button=new Element('button',{'name':'closeButton','class':'sButton','styles':{'position':'relative','display':'inline','float':'none','border-width':'2px','width':'90px'},'events':{'click':function(){reload_teachme();this.hide.bindWithEvent(this);}}}).injectInside(this.close);close_button.set('html',this.options.closeButtonText);close_button.addEvent('click',function(){if($('dont_show_box_Y').checked){set_no_modal_prefs();}});close_button.addEvent('click',function(e){if(e)e=new Event(e).stop();this.hide();}.bind(this));var submit_button=new Element('button',{'name':'submitFeedback','class':'sButton','styles':{'position':'relative','display':'inline','float':'none','border-width':'2px','width':'90px','margin-left':'15px'},'events':{'click':this.hide.bindWithEvent(this)}}).inject(this.close,'bottom');submit_button.set('html','Send');submit_button.addEvent('click',function(){submit_asset_feedback(this.options.asset_id);}.bind(this));submit_button.addEvent('click',function(e){if(e)e=new Event(e).stop();this.hide();}.bind(this));},add_pop:function(){this.parent();classes=this.options.containerClass?this.options.containerClass+' '+this.options.classPrefix+'Pop':this.options.classPrefix+'Pop'
this.pop=new Element('div',{'class':classes,'styles':{'position':'absolute','visibility':'hidden','top':-1000,'left':0,'z-index':10000,'display':'none'}}).inject(document.body);this.pop.addEvent('keydown',function(e){this.esc(e);}.bind(this));this.poptbl=new Element('table',{'class':'grid '+this.options.msgAlign[this.options.alignChoice]}).injectInside(this.pop);this.poptbody=new Element('tbody').injectInside(this.poptbl);var color=this.options.boxColor;[[this.options.colorStyles[color].nw,this.options.colorStyles[color].n,this.options.colorStyles[color].ne]].each(function(tds){this.insertPopTblRow(tds);}.bind(this));this.popc=this.poptbl.getElement('td[class='+this.options.colorStyles[color].n+']');if(this.options.useArrows){this.addPopArrows();}}});var restrictionsModal=new Class({Extends:memoModal,options:{closeButtonText:'OK',containerClass:'restrictionsModal',submitjs:false,boxColor:'grey'},initialize:function(msg,cls,bMsg,bMsg2,bAction,passwordFieldID,options){if(bMsg){this.options.bAction=bAction;}
if(bMsg2){this.options.closeButtonText2=bMsg2;this.options.addCloseBtn2=true;}
if(passwordFieldID){this.options.passwordFieldID=passwordFieldID;}
this.parent(msg,cls,bMsg,options);},show:function(){var pass=$(this.options.passwordFieldID);if(pass){pass.value='';pass.setStyles({'border-color':'#7f9db9','background':'#fff'});pass.getPrevious().getFirst().setStyles({'display':'none','color':'#d00'});var warningMessage=pass.getParent('div.form').getPrevious('span.warning');if(warningMessage){warningMessage.destroy();}}
var downloadLDBLinks=$$('a.downloadLink');if(downloadLDBLinks){var uPass=$('UserPass').value;downloadLDBLinks.addEvent('click',function(){window.open("/v4cgi/ldb/download.tpl?UserPass="+uPass,'Download_LDB','location=no,menubar=no,toolbar=no,scrollbars=no,resizable=yes,status=no,titlebar=no,width=483,height=400');return false;});}
this.parent();},add_pop:function(){classes=this.options.containerClass?this.options.containerClass+' '+this.options.classPrefix+'Pop':this.options.classPrefix+'Pop'
this.pop=new Element('div',{'class':classes,'styles':{'position':'absolute','visibility':'hidden','top':-1000,'left':0,'z-index':10000,'display':'none'}}).inject(document.body);this.poptbl=new Element('table',{'class':'grid '+this.options.msgAlign[this.options.alignChoice]}).injectInside(this.pop);this.poptbody=new Element('tbody').injectInside(this.poptbl);var color=this.options.boxColor;[[this.options.colorStyles[color].nw,this.options.colorStyles[color].n,this.options.colorStyles[color].ne],[this.options.colorStyles[color].sw,this.options.colorStyles[color].s,this.options.colorStyles[color].se]].each(function(tds){this.insertPopTblRow(tds);}.bind(this));this.popc=this.poptbl.getElement('td[class='+this.options.colorStyles[color].n+']');if(this.options.useArrows){this.addPopArrows();}
if(this.options.addCloseBtn){this.close=new Element('div',{'class':this.options.classPrefix+'Close'}).injectInside(this.pop);var close_button=new Element('button',{'name':'closeButton','class':'sButton','styles':{'position':'relative','display':'inline','float':'none','border-width':'2px','width':'70px'}}).injectInside(this.close);close_button.set('html',this.options.closeButtonText);close_button.addEvent('click',function(){this.options.bAction();}.bind(this));}
if(this.options.addCloseBtn2){var close_button2=new Element('button',{'name':'closeButton2','class':'sButton','styles':{'position':'relative','display':'inline','float':'none','border-width':'2px','width':'60px'},'events':{'click':this.hide.bindWithEvent(this)}}).inject(this.close,'top');close_button2.set('html',this.options.closeButtonText2);close_button2.addEvent('click',function(){this.hide();}.bind(this));}}});var vitalsourceModal=new Class({Extends:memoModal,options:{closeButtonText:'Cancel',submitjs:false,containerClass:'VitalSourceModal',boxColor:'grey',classPrefix:'Modal'},initialize:function(msg,cls,bMsg,bMsg2,bAction,passwordFieldID,options,publisher){this.options.publisher=publisher;if(bMsg){this.options.bAction=bAction;}
if(bMsg2){this.options.closeButtonText2=bMsg2;this.options.addCloseBtn2=true;}
if(passwordFieldID){this.options.passwordFieldID=passwordFieldID;}
this.parent(msg,cls,bMsg,options);},set_contents:function(msg){this.parent(msg);},show:function(){if(this.isShowing){this.isShowing=false;}
this.parent();},add_pop:function(){classes=this.options.containerClass?this.options.containerClass+' '+this.options.classPrefix+'Pop':this.options.classPrefix+'Pop'
this.pop=new Element('div',{'class':classes,'styles':{'position':'absolute','visibility':'hidden','top':-1000,'left':0,'z-index':10000,'display':'none'}}).inject(document.body);this.poptbl=new Element('table',{'class':'grid '+this.options.msgAlign[this.options.alignChoice]}).injectInside(this.pop);this.poptbody=new Element('tbody').injectInside(this.poptbl);var color=this.options.boxColor;[[this.options.colorStyles[color].nw,this.options.colorStyles[color].n,this.options.colorStyles[color].ne],[this.options.colorStyles[color].sw,this.options.colorStyles[color].s,this.options.colorStyles[color].se]].each(function(tds){this.insertPopTblRow(tds);}.bind(this));this.popc=this.poptbl.getElement('td[class='+this.options.colorStyles[color].n+']');this.popbutton=this.poptbl.getElement('td[class='+this.options.colorStyles[color].s+']');if(this.options.useArrows){this.addPopArrows();}
if(this.options.addCloseBtn2){this.close=new Element('div',{'class':this.options.classPrefix+'Close'}).injectInside(this.popbutton);var close_button2=new Element('button',{'name':'closeButton2','class':'sButton','styles':{'position':'relative','display':'inline','float':'none','border-width':'2px','width':'60px'},'events':{'click':this.hide.bindWithEvent(this)}}).inject(this.close);close_button2.set('html',this.options.closeButtonText2);close_button2.addEvent('click',function(){var passwd=$('vitalsource_password').value;this.options.bAction(passwd,this.options.publisher);}.bind(this));}
if(this.options.addCloseBtn){var close_button=new Element('button',{'name':'closeButton','class':'sButton','styles':{'position':'relative','display':'inline','float':'none','border-width':'2px','width':'70px'}}).injectInside(this.close);close_button.set('html',this.options.closeButtonText);close_button.addEvent('click',function(){this.hide();return;}.bind(this));}}});var userEmailModal=new Class({Extends:memoModal,options:{closeButtonText:'Cancel',submitjs:false,containerClass:'userEmailModal',boxColor:'grey'},initialize:function(msg,cls,bMsg,bMsg2,bAction,emailFieldID,options){if(bMsg){this.options.bAction=bAction;}
if(bMsg2){this.options.closeButtonText2=bMsg2;this.options.addCloseBtn2=true;}
if(emailFieldID){this.options.emailFieldID=emailFieldID;}
this.parent(msg,cls,bMsg,options);},add_pop:function(){classes=this.options.containerClass?this.options.containerClass+' '+this.options.classPrefix+'Pop':this.options.classPrefix+'Pop'
this.pop=new Element('div',{'class':classes,'styles':{'position':'absolute','visibility':'hidden','top':-1000,'left':0,'z-index':10000,'display':'none'}}).inject(document.body);this.poptbl=new Element('table',{'class':'grid '+this.options.msgAlign[this.options.alignChoice]}).injectInside(this.pop);this.poptbody=new Element('tbody').injectInside(this.poptbl);var color=this.options.boxColor;[[this.options.colorStyles[color].nw,this.options.colorStyles[color].n,this.options.colorStyles[color].ne],[this.options.colorStyles[color].sw,this.options.colorStyles[color].s,this.options.colorStyles[color].se]].each(function(tds){this.insertPopTblRow(tds);}.bind(this));this.popc=this.poptbl.getElement('td[class='+this.options.colorStyles[color].n+']');if(this.options.useArrows){this.addPopArrows();}
if(this.options.addCloseBtn){this.close=new Element('div',{'class':this.options.classPrefix+'Close'}).injectInside(this.pop);var close_button=new Element('button',{'name':'closeButton','class':'sButton','styles':{'position':'relative','display':'inline','float':'none','border-width':'2px','width':'70px'}}).injectInside(this.close);close_button.set('html',this.options.closeButtonText);close_button.addEvent('click',function(){this.hide();}.bind(this));}
if(this.options.addCloseBtn2){var close_button2=new Element('button',{'name':'closeButton2','class':'sButton','styles':{'position':'relative','display':'inline','float':'none','border-width':'2px','width':'60px'},'events':{'click':this.hide.bindWithEvent(this)}}).inject(this.close,'top');close_button2.set('html',this.options.closeButtonText2);close_button2.addEvent('click',function(){this.options.bAction();}.bind(this));}}});var newTemplateModal=new Class({Extends:AscModal,options:{addCloseBtn:false,containerClass:'deleteTemplateModal',submitjs:false,boxColor:'blue',alignChoice:'left',btn1:{text:'Save',width:'60px'},btn2:{text:'Cancel',width:'70px'}},initialize:function(msg,cls,options){this.onSave=options.onSave;if(options.btn1)this.options.btn1=options.btn1;if(options.btn2)this.options.btn2=options.btn2;this.parent(options);this.set_contents(msg,cls);},esc:function(e){},add_pop:function(){this.parent();var color=this.options.boxColor;this.popb=this.poptbl.getElement('td[class='+this.options.colorStyles[color].s+']');this.close=new Element('div',{'class':this.options.classPrefix+'Close'}).injectInside(this.popb);var save_button=new Element('button',{'name':'cancelButton','class':'sButton','html':this.options.btn1.text,'styles':{'position':'relative','display':'inline','float':'left','border-width':'2px','width':this.options.btn1.width}}).injectInside(this.close);save_button.addEvent('click',function(){this.onSave(this);}.bind(this));var cancel_button=new Element('button',{'name':'cancelButton','class':'sButton','html':this.options.btn2.text,'styles':{'position':'relative','display':'inline','float':'left','border-width':'2px','width':this.options.btn2.width}}).injectInside(this.close);cancel_button.addEvent('click',this.hide.bindWithEvent(this));}});var deleteTemplateModal=new Class({Extends:AscModal,options:{closeBtnText:'Yes, Delete Template',containerClass:'deleteTemplateModal',addCloseBtn2:'true',addCloseBtn:'true',closeBtnText2:'No, Go Back',boxColor:'blue',isModal:'true',alignChoice:'left',popOpacity:1.0,submitjs:false},initialize:function(msg,cls,template_id,options){if(template_id){this.options.template_id=template_id;}
this.parent(options);this.set_contents(msg,cls);},add_pop:function(){classes=this.options.containerClass?this.options.containerClass+' '+this.options.classPrefix+'Pop':this.options.classPrefix+'Pop'
this.pop=new Element('div',{'class':classes,'styles':{'position':'absolute','visibility':'hidden','top':-1000,'left':0,'z-index':10000,'display':'none'}}).inject(document.body);this.poptbl=new Element('table',{'class':'grid '+this.options.msgAlign[this.options.alignChoice]}).injectInside(this.pop);this.poptbody=new Element('tbody').injectInside(this.poptbl);var color=this.options.boxColor;[[this.options.colorStyles[color].nw,this.options.colorStyles[color].n,this.options.colorStyles[color].ne],[this.options.colorStyles[color].sw,this.options.colorStyles[color].s,this.options.colorStyles[color].se]].each(function(tds){this.insertPopTblRow(tds);}.bind(this));this.popc=this.poptbl.getElement('td[class='+this.options.colorStyles[color].n+']');this.popb=this.poptbl.getElement('td[class='+this.options.colorStyles[color].s+']');if(this.options.useArrows){this.addPopArrows();}
if(this.options.addCloseBtn){this.close=new Element('div',{'class':this.options.classPrefix+'Close'}).injectInside(this.popb);var delete_button=new Element('button',{'name':'cancelButton','class':'sButton','styles':{'position':'relative','display':'inline','float':'left','border-width':'2px','width':'160px'}}).injectInside(this.close);delete_button.set('html',this.options.closeBtnText);delete_button.addEvent('click',function(e){document.forms[0].rm.value='delete';document.forms[0].template_id.value=this.options.template_id;document.forms[0].submit(this);}.bind(this));}
if(this.options.addCloseBtn2){var cancel_button=new Element('button',{'name':'cancelButton','class':'sButton','styles':{'position':'relative','display':'inline','float':'left','border-width':'2px','width':'160px'}}).injectInside(this.close);cancel_button.set('html',this.options.closeBtnText2);cancel_button.addEvent('click',this.hide.bindWithEvent(this));}}});var Modal=new Class({Extends:AscModal,options:{addCloseBtn:false,submitjs:false},actAndClose:function(event,action){$(event.target).disabled=true;if(action)action();this.hide();},show:function(){this.parent();this.close.getElements('.sButton').set('disabled',false);},initialize:function(msg,options){this.setOptions(options);this.parent();this.close=new Element('div',{'class':this.options.classPrefix+'Close'}).injectInside(this.pop);var btns=options.buttons;for(var i=0;i<btns.length;i++){var btn=new Element('button',{'html':btns[i].title,'class':'sButton','styles':{'position':'relative','display':'inline','float':'none','border-width':'2px','width':'auto'},'events':{click:this.actAndClose.bindWithEvent(this,btns[i].action)}});btn.inject(this.close,'bottom');}
this.set_contents(msg,'n');}});function closeGenericModal()
{var $=jQuery;$('.modal-overlay').fadeOut();$('body').removeClass('modal-shown');$(document).unbind('keyup.closeModal');}
function showGenericModal(i_addClose)
{var $=jQuery,$modal=$('.modal-overlay');$('body').addClass('modal-shown');$('.modal-container').show();$modal.fadeIn();if(i_addClose)
{$('.modal-overlay, .close-profile-modal').off('click');$('.modal-overlay, .close-profile-modal').on('click',function(event){event.stopPropagation();if($(event.target).hasClass('modal-overlay')||$(event.target).hasClass('close-profile-modal')){closeGenericModal();}
return true;});$(document).on('keyup.closeModal',function(e){if(e.keyCode==27){closeGenericModal();}});}
else
{$('.modal-overlay').off('click');$('.close-profile-modal').hide();}}
var Cengage=Cengage||{};Cengage.WebAssign=Cengage.WebAssign||{};Cengage.WebAssign.FileUpload=Cengage.WebAssign.FileUpload||{};(function(){var Client=function(args){this.progressCallback=args.progressCallback;this.doneCallback=args.doneCallback;this.fileId=args.fileId;this.context=args.context;this.action=(this.context.instructor_upload?"/web/Faculty/Upload-SmwScore/upload":"/web/Student/Upload-SmwResponse/upload");this.action3=(this.context.instructor_upload?"/web/Rest/SmwScore/info":"/web/Rest/SmwResponse/info");this.xhr=undefined;this.state="";this.type=0;this._init();};var types={UPLOAD:0,DELETE:1,GET_UPLOADS:2};Client.prototype.getAllUploads=function(){this._handleGetAllUploads();};Client.prototype.getUpload=function(){this._handleGetAllUploads();};Client.prototype.deleteUpload=function(file){this._handleDeleteUpload(file);};Client.prototype.addUpload=function(file){this._handleStartUpload(file);};Client.prototype.cancelUpload=function(file){this._handleCancelUpload(file);};Client.prototype._init=function(){this.xhr=new XMLHttpRequest();var self=this;this.xhr.upload.addEventListener("abort",function(evt){self.state="CANCELED";self._handleDone();});this.xhr.upload.addEventListener("error",function(evt){self.state="NETWORK_ERROR";self._handleDone();});this.xhr.upload.addEventListener("load",function(evt){self.state="UPLOADED";});this.xhr.upload.addEventListener("progress",function(evt){self._handleProgress(evt);});this.xhr.upload.addEventListener("timeout",function(evt){self.state="TIMEOUT";});this.xhr.onreadystatechange=function(evt){if(evt.target.readyState===XMLHttpRequest.DONE){if(evt.target.status===0){}else if(evt.target.status===200){if(self.type===types.UPLOAD){}else if(self.type===types.DELETE){self.state="DELETED";}
return self._handleDone(evt.target.response);}else{self.state="SERVER_ERROR";return self._handleDone();}}};};Client.prototype._handleStartUpload=function(file){this.formData=new FormData();this.formData.append("Filedata",file);this.type=types.UPLOAD;this._sendXHRequest();};Client.prototype._handleProgress=function(evt){if(this.type!==types.UPLOAD){return;}
var data=0;if(evt.lengthComputable){var data=(evt.loaded/evt.total)*100;data=Math.round(data);}
this.progressCallback(this.fileId,data);};Client.prototype._handleCancelUpload=function(file){this.xhr.abort();};Client.prototype._handleDone=function(data){var error;if(this.state==="UPLOADED"){}else{error=this.state;}
this.doneCallback(this.fileId,error,data);};Client.prototype._handleDeleteUpload=function(file){this.type=types.DELETE;this._sendXHRequest2(file);};Client.prototype._handleGetAllUploads=function(){var data={deployment:this.context.deployment,question:this.context.question,question_num:this.context.question_num,user:this.context.user};this.type=types.GET_UPLOADS;this._sendXHRequest3(data);};Client.prototype._sendXHRequest=function(){var uri=this.action;uri+='?session='+this.context.session;uri+='&question='+this.context.question;uri+='&deployment='+this.context.deployment;uri+='&user='+this.context.user;this.xhr.open("POST",uri,true);this.xhr.send(this.formData);};Client.prototype._sendXHRequest2=function(file){var uri=file.delete_url;var data={deployment:this.context.deployment,question:this.context.question,user:this.context.user,file:file.backend_id};this.xhr.open("POST",uri,true);this.xhr.setRequestHeader("Content-Type","application/json;charset=UTF-8");this.xhr.send(JSON.stringify(data));};Client.prototype._sendXHRequest3=function(data){var uri=this.action3;this.xhr.open("POST",uri,true);this.xhr.setRequestHeader("Content-Type","application/json;charset=UTF-8");this.xhr.send(JSON.stringify(data));};Cengage.WebAssign.FileUpload.Client=Client;})();var Cengage=Cengage||{};Cengage.WebAssign=Cengage.WebAssign||{};Cengage.WebAssign.FileUpload=Cengage.WebAssign.FileUpload||{};(function(){var Util=function(){};Util.displayBytes=function(bytes,decimals){var nBytes=0;var precision=decimals||0;nBytes+=bytes;var sOutput=nBytes+" bytes";for(let aMultiples=["KB","MB","GB","TB","PB","EB","ZB","YB"],nMultiple=0,nApprox=nBytes/1024;nApprox>1;nApprox/=1024,nMultiple++){sOutput=nApprox.toFixed(precision);if(precision>0){sOutput+=" ";}
sOutput+=aMultiples[nMultiple];}
return sOutput;};Util.removeFileByNameFromList=function(file,list){var filteredList=[];for(var i=0;i<list.length;i++){var listItem=list[i];if(file.name!==listItem.name){filteredList.push(listItem);}}
return filteredList;};Util.findFileNameInList=function(file,list){var index=-1;for(var i=0;i<list.length;i++){var listItem=list[i];if(file.name===listItem.name){index=i;}}
return index;};Util.findFileIdInList=function(fileId,list){var index=-1;for(var i=0;i<list.length;i++){var listItem=list[i];if(fileId===listItem.id){index=i;}}
return index;};Cengage.WebAssign.FileUpload.Util=Util;})();var Cengage=Cengage||{};Cengage.WebAssign=Cengage.WebAssign||{};Cengage.WebAssign.FileUpload=Cengage.WebAssign.FileUpload||{};(function(){var File=function(args){this.id=args.id;this.name=args.name;this.size=args.size;this.client=args.client;this.upload=args.upload;this.state=args.state||0;this.type=args.type;this.download_url=args.download_url;this.delete_url=args.delete_url;this.backend_id=args.backend_id;this.progress=0;};var states={READY_FOR_UPLOAD:0,IN_PROGRESS:1,UPLOADED:2,CANCELING:3,CANCELED:4,DELETEING:5,DELETED:6,ERRORED:7};File.prototype.isReady=function(){if(this.state===states.READY_FOR_UPLOAD){return true;}
return false;};File.prototype.isUploaded=function(){if(this.state===states.UPLOADED){return true;}
return false;};Cengage.WebAssign.FileUpload.File=File;Cengage.WebAssign.FileUpload.File.States=states;})();var Cengage=Cengage||{};Cengage.WebAssign=Cengage.WebAssign||{};Cengage.WebAssign.FileUpload=Cengage.WebAssign.FileUpload||{};(function(){var Manager=function(args){this.filesChangedCallback=args.filesChangedCallback;this.context=args.context;this.initialFiles=args.initialFiles;this.fileList=[];this._fileCounter=100;this.doneCallback=this.doneCallback.bind(this);this.progressCallback=this.progressCallback.bind(this);};Manager.prototype.init=function(){if(typeof this.initialFiles!=='undefined'){for(var i=0,numFiles=this.initialFiles.length;i<numFiles;i++){var object=new Cengage.WebAssign.FileUpload.File({name:this.initialFiles[i].name,state:Cengage.WebAssign.FileUpload.File.States.UPLOADED,download_url:this.initialFiles[i].download_link,delete_url:this.initialFiles[i].delete_link,type:this.initialFiles[i].extension_type,backend_id:parseInt(this.initialFiles[i].id,10),id:this.createFileId(),});object.client=new Cengage.WebAssign.FileUpload.Client({progressCallback:this.progressCallback,doneCallback:this.doneCallback,fileId:object.id,context:this.context});this.fileList.push(object);}}else{}
this.filesChangedCallback(this.fileList);};Manager.prototype.add=function(files){for(var i=0,numFiles=files.length;i<numFiles;i++){var index=Cengage.WebAssign.FileUpload.Util.findFileNameInList(files[i],this.fileList);if(index<0){var object=new Cengage.WebAssign.FileUpload.File({name:files[i].name,size:files[i].size,upload:files[i],id:this.createFileId()});this.fileList.push(object);}else{console.error(files[i].name+" is in the list already inprogress/uploaded");}}
for(var i=0,numFiles=this.fileList.length;i<numFiles;i++){if(this.fileList[i].isReady()){this.fileList[i].client=new Cengage.WebAssign.FileUpload.Client({progressCallback:this.progressCallback,doneCallback:this.doneCallback,fileId:this.fileList[i].id,context:this.context});this.fileList[i].client.addUpload(this.fileList[i].upload);}}
this.filesChangedCallback(this.fileList);};Manager.prototype.cancel=function(fileId){var index=Cengage.WebAssign.FileUpload.Util.findFileIdInList(fileId,this.fileList);if(this.fileList[index].state!==Cengage.WebAssign.FileUpload.File.States.IN_PROGRESS&&this.fileList[index].state!==Cengage.WebAssign.FileUpload.File.States.READY_FOR_UPLOAD){console.error("Cannot cancel something not in progress");}else{this.fileList[index].state=Cengage.WebAssign.FileUpload.File.States.CANCELING;this.fileList[index].client.cancelUpload(this.fileList[index]);}};Manager.prototype.delete=function(fileId){var index=Cengage.WebAssign.FileUpload.Util.findFileIdInList(fileId,this.fileList);if(this.fileList[index].state!==Cengage.WebAssign.FileUpload.File.States.UPLOADED){console.error("Cannot delete something that is not uploaded");}else{this.fileList[index].state=Cengage.WebAssign.FileUpload.File.States.DELETEING;this.fileList[index].client.deleteUpload(this.fileList[index]);}};Manager.prototype.progressCallback=function(fileId,progress){var index=Cengage.WebAssign.FileUpload.Util.findFileIdInList(fileId,this.fileList);this.fileList[index].state=Cengage.WebAssign.FileUpload.File.States.IN_PROGRESS;this.fileList[index].progress=progress;this.filesChangedCallback(this.fileList);};Manager.prototype.doneCallback=function(fileId,error,data){var index=Cengage.WebAssign.FileUpload.Util.findFileIdInList(fileId,this.fileList);if(index<0){console.warn("doneCallback: no index");return;}
if(error){if(error==="CANCELED"){this.fileList[index].state=Cengage.WebAssign.FileUpload.File.States.CANCELED;}else if(error==="DELETED"){this.fileList[index].state=Cengage.WebAssign.FileUpload.File.States.DELETED;}else{console.error(error);this.fileList[index].state=Cengage.WebAssign.FileUpload.File.States.ERRORED;}}else{this.fileList[index].state=Cengage.WebAssign.FileUpload.File.States.UPLOADED;if(data==="upload complete"){this.fileList[index].client.getUpload();}else{try{var files_info=JSON.parse(data);var info_files=files_info.extended.files;var file_info=info_files[info_files.length-1];if(this.fileList[index].name!==file_info.name){console.warn("Unexpected mismatch "+this.fileList[index].name+" != "+file_info.name);}else{this.fileList[index].type=file_info.type;this.fileList[index].download_url=file_info.url;this.fileList[index].delete_url=file_info.delete_url;this.fileList[index].backend_id=parseInt(file_info.id,10);this.fileList[index].upload_timestamp=file_info.upload_date;}
}catch(e){}}}
if(this.fileList[index].state===Cengage.WebAssign.FileUpload.File.States.CANCELED||this.fileList[index].state===Cengage.WebAssign.FileUpload.File.States.DELETED){this.fileList=Cengage.WebAssign.FileUpload.Util.removeFileByNameFromList(this.fileList[index],this.fileList);}
this.filesChangedCallback(this.fileList);};Manager.prototype.createFileId=function(){return this._fileCounter++;};Cengage.WebAssign.FileUpload.Manager=Manager;})();var Cengage=Cengage||{};Cengage.WebAssign=Cengage.WebAssign||{};Cengage.WebAssign.FileUpload=Cengage.WebAssign.FileUpload||{};(function(){var Selector=function(args){this.rootDom=args.rootDom;this.callback=args.callback;this.maxFiles=args.maxFiles||10;this.maxFileSize=args.maxFileSize||10485760;this.handleMultipleFiles=args.multiFile||false;this.fileInput=this.render();};Selector.prototype.click=function(){if(this.fileInput){this.fileInput.click();}};Selector.prototype.render=function(){var fileInput=document.createElement("input");fileInput.setAttribute("type","file");fileInput.setAttribute("style","display:none");if(this.handleMultipleFiles){fileInput.multiple=this.handleMultipleFiles;}
this.rootDom.appendChild(fileInput);var self=this;fileInput.addEventListener("change",function(evt){evt.stopPropagation();self.handleFiles(this.files);});return fileInput;};Selector.prototype.handlesMultipleFiles=function(){return this.handleMultipleFiles;};Selector.prototype.handleFiles=function(filesList){var error;if(filesList.length>this.maxFiles){error="MaxNumFilesError";return this.callback(filesList,error);}
for(var i=0,numFiles=filesList.length;i<numFiles;i++){var file=filesList[i];if(file.size>this.maxFileSize){error="MaxFileSizeError";return this.callback(filesList,error);}
if(typeof fileUploadValidator==='object'){var errors=fileUploadValidator.validateShowMyWork(file);if(errors.length>0){error=errors[0];return this.callback(filesList,error);}}}
this.callback(filesList,error);};Cengage.WebAssign.FileUpload.Selector=Selector;})();

