!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.splitio=e():t.splitio=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=17)}([function(t,e,n){"use strict";n.d(e,"o",(function(){return o})),n.d(e,"a",(function(){return a})),n.d(e,"e",(function(){return s})),n.d(e,"c",(function(){return c})),n.d(e,"b",(function(){return u})),n.d(e,"j",(function(){return l})),n.d(e,"l",(function(){return f})),n.d(e,"m",(function(){return h})),n.d(e,"t",(function(){return d})),n.d(e,"i",(function(){return g})),n.d(e,"k",(function(){return v})),n.d(e,"s",(function(){return m})),n.d(e,"r",(function(){return y})),n.d(e,"q",(function(){return S})),n.d(e,"p",(function(){return T})),n.d(e,"d",(function(){return b})),n.d(e,"g",(function(){return E})),n.d(e,"f",(function(){return _})),n.d(e,"n",(function(){return O})),n.d(e,"h",(function(){return N}));var r=n(6),i=n.n(r);function o(t,e){return!(!l(t)||!l(e))&&t.slice(0,e.length)===e}function a(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!(!l(t)||!l(e))&&(n&&(t=t.toLowerCase(),e=e.toLowerCase()),t.slice(t.length-e.length)===e)}function s(t,e,n){var r=n;try{var i=e.split("."),o=t;i.forEach((function(t){return o=o[t]})),void 0!==o&&(r=o)}catch(t){}return r}function c(t,e){if(Array.isArray(t)&&"function"==typeof e)for(var n=0;n<t.length;n++)if(!0===e(t[n],n,t))return n;return-1}function u(t,e){var n;if(g(t))for(var r=Object.keys(t),i=0;i<r.length&&!n;i++){var o=r[i];e(t[o],o,t)&&(n=t[o])}else if(Array.isArray(t))for(var a=0;a<t.length&&!n;a++){e(t[a],a,t)&&(n=t[a])}return n}function l(t){return"string"==typeof t||t instanceof String}function f(t){return t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&(Number.isFinite?Number.isFinite(t):isFinite(t))}function h(t){return t instanceof Number&&(t=t.valueOf()),t!=t}var p=-1;function d(){return p++}function g(t){return t&&"object"===i()(t)&&t.constructor===Object}function v(t,e){var n=t;g(e)&&Object.keys(e).forEach((function(t){var r=e[t];g(r)&&(r=n[t]&&g(n[t])?v({},n[t],r):v({},r)),void 0!==r&&(n[t]=r)}));for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];if(i&&i.length){var a=i.splice(0,1)[0];n=v.apply(void 0,[n,a].concat(i))}return n}function m(t){var e={};return t.filter((function(t){return!Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=!0)}))}function y(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:JSON.stringify,n={};return t.filter((function(t){var r=e(t);return!Object.prototype.hasOwnProperty.call(n,r)&&(n[r]=!0)}))}function S(t){if(null==t)return"";if("string"==typeof t)return t;if(Array.isArray(t))return t.map((function(t){return l(t)?t:""}))+"";var e=t+"";return"0"===e&&1/t===Number.NEGATIVE_INFINITY?"-0":e}function T(t){if("number"==typeof t)return t;if(g(t)&&"function"==typeof t.valueOf){var e=t.valueOf();t=g(e)?e+"":e}return"string"!=typeof t?0===t?t:+t:+(t=t.replace(/^\s+|\s+$/g,""))}function b(t,e){return Object.keys(t).forEach((function(n){return e(t[n],n,t)})),t}function E(t,e){var n={};if(Array.isArray(t)&&l(e))for(var r=0;r<t.length;r++){var i=t[r][e];l(i)&&(n[i]||(n[i]=[]),n[i].push(t[r]))}return n}function _(t){return t.name?t.name:(t.toString().match(/function (.+?)\(/)||["",""])[1]}function O(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++)n[e[r]]=t[e[r]];return n}function N(t){return!0===t||!1===t}},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return h}));var r=n(5),i=n(12),o=n(0),a=function(t){return!!Object(o.b)(r.a,(function(e){return t===e}))},s={showLevel:!0,displayAllErrors:!1},c=!1;void 0!==t&&void 0!==t.version&&t.version&&(c=!0);var u=String(c?t.env.SPLITIO_DEBUG:Object(i.a)()?localStorage.getItem("splitio_debug"):""),l=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new r.b(t,Object(o.k)(e,s))},f=l("splitio-utils:logger"),h={enable:function(){Object(r.c)(r.a.DEBUG)},setLogLevel:function(t){a(t)?Object(r.c)(t):f.error("Invalid Log Level - No changes to the logs will be applied.")},disable:function(){Object(r.c)(r.a.NONE)},LogLevel:r.a};/^(enabled?|on)/i.test(u)?h.enable(r.a.DEBUG):a(u)?h.setLogLevel(u):h.disable(),e.b=l}).call(this,n(18))},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function a(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var n,s,c=a(t),u=1;u<arguments.length;u++){for(var l in n=Object(arguments[u]))i.call(n,l)&&(c[l]=n[l]);if(r){s=r(n);for(var f=0;f<s.length;f++)o.call(n,s[f])&&(c[s[f]]=n[s[f]])}}return c}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){"use strict";n.d(e,"a",(function(){return u})),n.d(e,"c",(function(){return f})),n.d(e,"b",(function(){return p}));var r=n(2),i=n.n(r),o=n(4),a=n.n(o),s=n(3),c=n.n(s),u={DEBUG:"DEBUG",INFO:"INFO",WARN:"WARN",ERROR:"ERROR",NONE:"NONE"},l=u.DEBUG,f=function(t){l=t},h={showLevel:!0,displayAllErrors:!1},p=function(){function t(e,n){i()(this,t),this.category=e,this.options=c()({},h,n)}return a()(t,[{key:"debug",value:function(t){this._shouldLog(u.DEBUG)&&this._log(u.DEBUG,t)}},{key:"info",value:function(t){this._shouldLog(u.INFO)&&this._log(u.INFO,t)}},{key:"warn",value:function(t){this._shouldLog(u.WARN)&&this._log(u.WARN,t)}},{key:"error",value:function(t){(this.options.displayAllErrors||this._shouldLog(u.ERROR))&&this._log(u.ERROR,t)}},{key:"_log",value:function(t,e){var n=this._generateLogMessage(t,e);console.log(n)}},{key:"_generateLogMessage",value:function(t,e){var n="";return this.options.showLevel&&(n+="["+t+"]"+(t===u.INFO||t===u.WARN?" ":"")+" "),this.category&&(n+=this.category+" => "),n+e}},{key:"_shouldLog",value:function(t){var e=l,n=Object.keys(u).map((function(t){return u[t]}));return n.indexOf(t)>=n.indexOf(e)}}]),t}()},function(t,e){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(t.exports=n=function(t){return typeof t},t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.default=t.exports,t.exports.__esModule=!0),n(e)}t.exports=n,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},t.exports.default=t.exports,t.exports.__esModule=!0,n(e)}t.exports=n,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){var r=n(13);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){var r=n(6).default,i=n(23);t.exports=function(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?i(t):e},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN||function(t){return t!=t};function s(){s.init.call(this)}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function u(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function l(t){return void 0===t._maxListeners?s.defaultMaxListeners:t._maxListeners}function f(t,e,n,r){var i,o,a,s;if(u(n),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),a=o[e]),void 0===a)a=o[e]=n,++t._eventsCount;else if("function"==typeof a?a=o[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=l(t))>0&&a.length>i&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=a.length,s=c,console&&console.warn&&console.warn(s)}return t}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=h.bind(r);return i.listener=n,r.wrapFn=i,i}function d(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):v(i,i.length)}function g(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");c=t}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=i[t];if(void 0===c)return!1;if("function"==typeof c)o(c,this,e);else{var u=c.length,l=v(c,u);for(n=0;n<u;++n)o(l[n],this,e)}return!0},s.prototype.addListener=function(t,e){return f(this,t,e,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(t,e){return f(this,t,e,!0)},s.prototype.once=function(t,e){return u(e),this.on(t,p(this,t,e)),this},s.prototype.prependOnceListener=function(t,e){return u(e),this.prependListener(t,p(this,t,e)),this},s.prototype.removeListener=function(t,e){var n,r,i,o,a;if(u(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,a||e)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},s.prototype.listeners=function(t){return d(this,t,!0)},s.prototype.rawListeners=function(t){return d(this,t,!1)},s.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):g.call(t,e)},s.prototype.listenerCount=g,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(t,e,n){"use strict";function r(){var t="__SPLITSOFTWARE__";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(t){return!1}}n.d(e,"a",(function(){return r}))},function(t,e){function n(e,r){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},t.exports.default=t.exports,t.exports.__esModule=!0,n(e,r)}t.exports=n,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){var r=n(19),i=n(20),o=n(21),a=n(22);t.exports=function(t){return r(t)||i(t)||o(t)||a()},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){var r=n(7),i=n(13),o=n(24),a=n(25);function s(e){var n="function"==typeof Map?new Map:void 0;return t.exports=s=function(t){if(null===t||!o(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return a(t,arguments,r(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i(e,t)},t.exports.default=t.exports,t.exports.__esModule=!0,s(e)}t.exports=s,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){t.exports=n(27)},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var c,u=[],l=!1,f=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):f=-1,u.length&&p())}function p(){if(!l){var t=s(h);l=!0;for(var e=u.length;e;){for(c=u,u=[];++f<e;)c&&c[f].run();f=-1,e=u.length}c=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function g(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new d(t,e)),1!==u.length||l||s(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){var r=n(14);t.exports=function(t){if(Array.isArray(t))return r(t)},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){var r=n(14);t.exports=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){var r=n(13),i=n(26);function o(e,n,a){return i()?(t.exports=o=Reflect.construct,t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=o=function(t,e,n){var i=[null];i.push.apply(i,e);var o=new(Function.bind.apply(t,i));return n&&r(o,n.prototype),o},t.exports.default=t.exports,t.exports.__esModule=!0),o.apply(null,arguments)}t.exports=o,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,n){"use strict";n.r(e);var r=n(3),i=n.n(r),o=function(t){return null!=t&&"function"==typeof t.then},a=n(0),s=n(1),c=Object(s.b)("",{displayAllErrors:!0}),u={};function l(t){u[t]&&u[t]--,0===u[t]&&delete u[t]}var f=Object(s.b)("");var h=Object(s.b)(""),p=/^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/;function d(t,e){if(null==t)h.error("".concat(e,": you passed a null or undefined event_type, event_type must be a non-empty string."));else if(Object(a.j)(t))if(0===t.length)h.error("".concat(e,": you passed an empty event_type, event_type must be a non-empty string."));else{if(p.test(t))return t;h.error("".concat(e,': you passed "').concat(t,'", event_type must adhere to the regular expression /^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/g. This means an event_type must be alphanumeric, cannot be more than 80 characters long, and can only include a dash, underscore, period, or colon as separators of alphanumeric characters.'))}else h.error("".concat(e,": you passed an invalid event_type, event_type must be a non-empty string."));return!1}var g=Object(s.b)("");function v(t,e){return Object(a.l)(t)||null==t?t:(g.error("".concat(e,": value must be a finite number.")),!1)}var m=Object(s.b)(""),y=0,S=2,T=4,b=8;function E(t,e){if(null==t)return{properties:null,size:1024};if(!Object(a.i)(t))return m.error("".concat(e,": properties must be a plain object.")),{properties:!1,size:1024};var n=Object.keys(t),r=Object(a.n)(t),i={properties:r,size:1024};n.length>300&&m.warn("".concat(e,": Event has more than 300 properties. Some of them will be trimmed when processed."));for(var o=0;o<n.length;o++){i.size+=n[o].length*S;var s=r[n[o]],c=Object(a.j)(s),u=Object(a.l)(s),l=Object(a.h)(s),f=null===s;if(c||u||l||f||(r[n[o]]=null,s=null,f=!0,m.warn("".concat(e,": Property ").concat(n[o]," is of invalid type. Setting value to null."))),f?i.size+=y:u?i.size+=b:l?i.size+=T:c&&(i.size+=s.length*S),i.size>32768){m.error("".concat(e,": The maximum size allowed for the properties is 32768 bytes, which was exceeded. Event not queued.")),i.properties=!1;break}}return i}var _=Object(s.b)("");function O(t,e,n){if(null==t)return _.error("".concat(e,": you passed a null or undefined ").concat(n,", ").concat(n," must be a non-empty string.")),!1;if(Object(a.l)(t))return _.warn("".concat(e,": ").concat(n,' "').concat(t,'" is not of type string, converting.')),Object(a.q)(t);if(Object(a.j)(t)){if((t=t.trim()).length>0&&t.length<=250)return t;0===t.length?_.error("".concat(e,": you passed an empty string, ").concat(n," must be a non-empty string.")):t.length>250&&_.error("".concat(e,": ").concat(n," too long, ").concat(n," must be 250 characters or less."))}else _.error("".concat(e,": you passed an invalid ").concat(n," type, ").concat(n," must be a non-empty string."));return!1}function N(t,e){if(Object(a.i)(t)){var n=O(t.matchingKey,e,"matchingKey"),r=O(t.bucketingKey,e,"bucketingKey");return n&&r?{matchingKey:n,bucketingKey:r}:(_.error("".concat(e,": Key must be an object with bucketingKey and matchingKey with valid string properties.")),!1)}return O(t,e,"key")}var k=Object(s.b)(""),R=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/;function A(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"split name";if(null==t)k.error("".concat(e,": you passed a null or undefined ").concat(n,", ").concat(n," must be a non-empty string."));else if(Object(a.j)(t)){if(R.test(t)&&(k.warn("".concat(e,": ").concat(n,' "').concat(t,'" has extra whitespace, trimming.')),t=t.trim()),t.length>0)return t;k.error("".concat(e,": you passed an empty ").concat(n,", ").concat(n," must be a non-empty string."))}else k.error("".concat(e,": you passed an invalid ").concat(n,", ").concat(n," must be a non-empty string."));return!1}function w(t,e,n,r){return!t.get(t.constants.READY,!0)||"definition not found"!==n&&null!=n||(k.warn("".concat(r,': you passed "').concat(e,'" that does not exist in this environment, please double check what Splits exist in the web console.')),!1)}var I=Object(s.b)("");function C(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"split_names",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"split name";if(Array.isArray(t)&&t.length>0){var i=[];if(t.forEach((function(t){var n=A(t,e,r);n&&i.push(n)})),i.length)return Object(a.s)(i)}return I.error("".concat(e,": ").concat(n," must be a non-empty array.")),!1}var M="standalone",D="producer",L="consumer",x="control",j={treatment:x,config:null},P=[{type:"byName",maxLength:400,queryParam:"names="},{type:"byPrefix",maxLength:50,queryParam:"prefixes="}],U="DEBUG",K="OPTIMIZED",F=Object(s.b)(""),G=/[A-Z]/;function H(t,e){if(null==t)F.error("".concat(e,": you passed a null or undefined traffic_type_name, traffic_type_name must be a non-empty string."));else if(Object(a.j)(t)){if(0!==t.length)return G.test(t)&&(F.warn("".concat(e,": traffic_type_name should be all lowercase - converting string to lowercase.")),t=t.toLowerCase()),t;F.error("".concat(e,": you passed an empty traffic_type_name, traffic_type_name must be a non-empty string."))}else F.error("".concat(e,": you passed an invalid traffic_type_name, traffic_type_name must be a non-empty string."));return!1}function B(t,e){F.warn("".concat(t,": Traffic Type ").concat(e," does not have any corresponding Splits in this environment, make sure you're tracking your events to a valid traffic type defined in the Split console."))}function Y(t,e,n){var r=e.get(e.constants.READY,!0),i=e.get(e.constants.SETTINGS),a=e.get(e.constants.STORAGE).splits;if(!r||"localhost"===i.mode)return!0;var s=a.trafficTypeExists(t);return o(s)?s.then((function(e){return e||B(n,t),e})):s||B(n,t),s}var W=Object(s.b)("",{displayAllErrors:!0});function q(t){return!t.get(t.constants.DESTROYED,!0)||(W.error("Client has already been destroyed - no calls possible."),!1)}function z(t,e){return!(!t.get(t.constants.READY,!0)&&!t.get(t.constants.READY_FROM_CACHE,!0))||(W.warn("".concat(e,": the SDK is not ready, results may be incorrect. Make sure to wait for SDK readiness before using this method.")),!1)}var V=function(t){var e=t.conditions,n=Object(a.b)(e,(function(t){return"ROLLOUT"===t.conditionType}));return n||(n=e[0]),n?n.partitions.map((function(t){return t.treatment})):[]},Q=function(t){var e;try{e=JSON.parse(t)}catch(t){return null}return null==e?null:{name:e.name,trafficType:e.trafficTypeName||null,killed:e.killed,changeNumber:e.changeNumber||0,treatments:V(e),configs:e.configurations||{}}},J=function(t){var e=[];return t.forEach((function(t){var n=Q(t);null!=n&&e.push(n)})),e};var $=function(t,e){var n=e.get(e.constants.STATUS_MANAGER);return i()(Object.create(n),{split:function(n){var r=A(n,"split");if(!q(e)||!z(e,"split")||!r)return null;var i=t.getSplit(r);return o(i)?i.then((function(t){return w(e,r,t,"split"),Q(t)})):(w(e,r,i,"split"),Q(i))},splits:function(){if(!q(e)||!z(e,"splits"))return[];var n=t.getAll();return o(n)?n.then(J):J(n)},names:function(){return q(e)&&z(e,"names")?t.getKeys():[]}})},Z=n(2),X=n.n(Z),tt=n(4),et=n.n(tt);var nt=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=0;e<t.length;e++)for(var n=t[e].matcherGroup.matchers,r=0;r<n.length;r++)if("IN_SEGMENT"===n[r].matcherType)return!0;return!1};function rt(t,e,n){var r=this,i=this.getSplit(t);return(o(i)?i:Promise.resolve(i)).then((function(i){if(i){var o=JSON.parse(i);if(!o.changeNumber||o.changeNumber<n){o.killed=!0,o.defaultTreatment=e,o.changeNumber=n;var a=JSON.stringify(o);return r.addSplit(t,a)}}return!1}))}var it=function(){function t(){X()(this,t),this.flush()}return et()(t,[{key:"addSplit",value:function(t,e){var n=this.getSplit(t);if(n){var r=JSON.parse(n);if(r.trafficTypeName){var i=r.trafficTypeName;this.ttCache[i]--,this.ttCache[i]||delete this.ttCache[i]}nt(r.conditions)&&this.splitsWithSegmentsCount--}var o=JSON.parse(e);if(o){this.splitCache[t]=e;var a=o.trafficTypeName;return a&&(this.ttCache[a]||(this.ttCache[a]=0),this.ttCache[a]++),nt(o.conditions)&&this.splitsWithSegmentsCount++,!0}return!1}},{key:"addSplits",value:function(t){var e=this,n=[];return t.forEach((function(t){n.push(e.addSplit(t[0],t[1]))})),n}},{key:"removeSplit",value:function(t){var e=this.getSplit(t);if(e){delete this.splitCache[t];var n=JSON.parse(e),r=n.trafficTypeName;return r&&(this.ttCache[r]--,this.ttCache[r]||delete this.ttCache[r]),nt(n.conditions)&&this.splitsWithSegmentsCount--,1}return 0}},{key:"removeSplits",value:function(t){var e=this;return t.forEach((function(t){return e.removeSplit(t)})),t.length}},{key:"getSplit",value:function(t){return this.splitCache[t]}},{key:"setChangeNumber",value:function(t){return this.changeNumber=t,!0}},{key:"getChangeNumber",value:function(){return this.changeNumber}},{key:"getAll",value:function(){var t=this;return this.getKeys().map((function(e){return t.splitCache[e]}))}},{key:"getKeys",value:function(){return Object.keys(this.splitCache)}},{key:"trafficTypeExists",value:function(t){return Object(a.l)(this.ttCache[t])&&this.ttCache[t]>0}},{key:"usesSegments",value:function(){return-1===this.getChangeNumber()||this.splitsWithSegmentsCount>0}},{key:"flush",value:function(){this.splitCache={},this.ttCache={},this.changeNumber=-1,this.splitsWithSegmentsCount=0}},{key:"fetchMany",value:function(t){var e=this,n={};return t.forEach((function(t){n[t]=e.splitCache[t]||null})),n}},{key:"checkCache",value:function(){return!1}}]),t}();it.prototype.killLocally=rt;var ot=it,at=Object(s.b)("splitio-storage:localstorage"),st=function(){function t(e,n,r){X()(this,t),this.keys=e,this.splitFiltersValidation=r,this.__checkExpiration(n),this.__checkFilterQuery()}return et()(t,[{key:"decrementCount",value:function(t){var e=Object(a.p)(localStorage.getItem(t))-1;e>0?localStorage.setItem(t,e):localStorage.removeItem(t)}},{key:"decrementCounts",value:function(t){try{if(t){if(t.trafficTypeName){var e=this.keys.buildTrafficTypeKey(t.trafficTypeName);this.decrementCount(e)}if(nt(t.conditions)){var n=this.keys.buildSplitsWithSegmentCountKey();this.decrementCount(n)}}}catch(t){at.error(t)}}},{key:"incrementCounts",value:function(t){try{if(t){if(t.trafficTypeName){var e=this.keys.buildTrafficTypeKey(t.trafficTypeName);localStorage.setItem(e,Object(a.p)(localStorage.getItem(e))+1)}if(nt(t.conditions)){var n=this.keys.buildSplitsWithSegmentCountKey();localStorage.setItem(n,Object(a.p)(localStorage.getItem(n))+1)}}}catch(t){at.error(t)}}},{key:"addSplit",value:function(t,e){try{var n=this.keys.buildSplitKey(t),r=localStorage.getItem(n),i=r?JSON.parse(r):null;this.decrementCounts(i),localStorage.setItem(n,e);var o=e?JSON.parse(e):null;return this.incrementCounts(o),!0}catch(t){return at.error(t),!1}}},{key:"addSplits",value:function(t){var e=this,n=[];return t.forEach((function(t){n.push(e.addSplit(t[0],t[1]))})),n}},{key:"removeSplit",value:function(t){try{var e=this.getSplit(t);localStorage.removeItem(this.keys.buildSplitKey(t));var n=JSON.parse(e);return this.decrementCounts(n),1}catch(t){return at.error(t),0}}},{key:"removeSplits",value:function(t){for(var e=0,n=t.length,r=0;e<n;e++)r+=this.removeSplit(t[e]);return r}},{key:"getSplit",value:function(t){return localStorage.getItem(this.keys.buildSplitKey(t))}},{key:"setChangeNumber",value:function(t){if(this.cacheReadyButNeedsToFlush&&(this.flush(),this.cacheReadyButNeedsToFlush=!1),this.updateNewFilter){at.info("Split filter query was modified. Updating cache.");var e=this.keys.buildSplitsFilterQueryKey(),n=this.splitFiltersValidation.queryString;try{n?localStorage.setItem(e,n):localStorage.removeItem(e)}catch(t){at.error(t)}this.updateNewFilter=!1}try{return localStorage.setItem(this.keys.buildSplitsTillKey(),t+""),localStorage.setItem(this.keys.buildLastUpdatedKey(),Date.now()+""),this.hasSync=!0,!0}catch(t){return at.error(t),!1}}},{key:"getChangeNumber",value:function(){var t=localStorage.getItem(this.keys.buildSplitsTillKey());return null!==t?(t=parseInt(t,10),Object(a.m)(t)?-1:t):-1}},{key:"getAll",value:function(){for(var t=localStorage.length,e=[],n=0;n<t;){var r=localStorage.key(n),i=r&&localStorage.getItem(r);null!=r&&this.keys.isSplitKey(r)&&i&&e.push(i),n++}return e}},{key:"getKeys",value:function(){for(var t=localStorage.length,e=[],n=0;n<t;){var r=localStorage.key(n);null!=r&&this.keys.isSplitKey(r)&&e.push(this.keys.extractKey(r)),n++}return e}},{key:"trafficTypeExists",value:function(t){var e=Object(a.p)(localStorage.getItem(this.keys.buildTrafficTypeKey(t)));return Object(a.l)(e)&&e>0}},{key:"usesSegments",value:function(){if(!this.hasSync)return!0;var t=localStorage.getItem(this.keys.buildSplitsWithSegmentCountKey()),e=null===t?0:Object(a.p)(t);return!Object(a.l)(e)||e>0}},{key:"flush",value:function(){at.info("Flushing Splits data from localStorage");for(var t=localStorage.length,e=[],n=0;n<t;n++){var r=localStorage.key(n);null!=r&&this.keys.isSplitCacheKey(r)&&e.push(r)}e.forEach((function(t){localStorage.removeItem(t)})),this.hasSync=!1}},{key:"fetchMany",value:function(t){var e=this,n={};return t.forEach((function(t){n[t]=localStorage.getItem(e.keys.buildSplitKey(t))})),n}},{key:"checkCache",value:function(){return this.getChangeNumber()>-1||this.cacheReadyButNeedsToFlush}},{key:"__checkExpiration",value:function(t){var e=localStorage.getItem(this.keys.buildLastUpdatedKey());null!==e&&(e=parseInt(e,10),!Object(a.m)(e)&&e<t&&this.flush())}},{key:"__checkFilterQuery",value:function(){var t=this,e=this.splitFiltersValidation,n=e.queryString,r=e.groupedFilters,i=this.keys.buildSplitsFilterQueryKey();if(localStorage.getItem(i)!==n)try{this.updateNewFilter=!0,this.checkCache()&&(localStorage.setItem(this.keys.buildSplitsTillKey(),"-1"),this.getKeys().forEach((function(e){n&&(r.byName.indexOf(e)>-1||r.byPrefix.some((function(t){return e.startsWith(t+"__")})))?t.cacheReadyButNeedsToFlush=!0:t.removeSplit(e)})))}catch(t){at.error(t)}}}]),t}();st.prototype.killLocally=rt;var ct=st,ut=function(){function t(e){X()(this,t),this.keys=e,this.flush()}return et()(t,[{key:"flush",value:function(){this.segmentCache={}}},{key:"addToSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);return this.segmentCache[e]=!0,!0}},{key:"removeFromSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);return delete this.segmentCache[e],!0}},{key:"resetSegments",value:function(t){var e,n=this,r=!1,i=Object.keys(this.segmentCache);if(0===t.length&&i.length===t.length)return r;if(i.length!==t.length)r=!0,this.segmentCache={},t.forEach((function(t){n.addToSegment(t)}));else{for(e=0;e<t.length&&this.isInSegment(t[e]);e++);e<t.length&&(r=!0,this.segmentCache={},t.forEach((function(t){n.addToSegment(t)})))}return r}},{key:"isInSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);return!0===this.segmentCache[e]}},{key:"setChangeNumber",value:function(){return!0}},{key:"getChangeNumber",value:function(){return-1}},{key:"registerSegment",value:function(){return!1}},{key:"registerSegments",value:function(){return!1}},{key:"getRegisteredSegments",value:function(){return[]}}]),t}(),lt=Object(s.b)("splitio-storage:localstorage"),ft=function(){function t(e){X()(this,t),this.keys=e}return et()(t,[{key:"addToSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);try{return localStorage.setItem(e,"1"),!0}catch(t){return lt.error(t),!1}}},{key:"removeFromSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);try{return localStorage.removeItem(e),!0}catch(t){return lt.error(t),!1}}},{key:"resetSegments",value:function(t){var e,n=this,r=!1,i=Object.keys(localStorage).reduce((function(t,e){var r=n.keys.extractSegmentName(e);return r&&t.push(r),t}),[]);if(0===t.length&&i.length===t.length)return r;if(i.length!==t.length)r=!0,i.forEach((function(t){return n.removeFromSegment(t)})),t.forEach((function(t){return n.addToSegment(t)}));else{for(e=0;e<t.length&&-1!==i.indexOf(t[e]);e++);e<t.length&&(r=!0,i.forEach((function(t){return n.removeFromSegment(t)})),t.forEach((function(t){return n.addToSegment(t)})))}return r}},{key:"isInSegment",value:function(t){return"1"===localStorage.getItem(this.keys.buildSegmentNameKey(t))}},{key:"setChangeNumber",value:function(){return!0}},{key:"getChangeNumber",value:function(){return-1}},{key:"registerSegment",value:function(){return!1}},{key:"registerSegments",value:function(){return!1}},{key:"getRegisteredSegments",value:function(){return[]}},{key:"flush",value:function(){lt.info("Flushing MySegments data from localStorage"),this.resetSegments([])}}]),t}(),ht=n(15),pt=n.n(ht),dt=function(){function t(){X()(this,t),this.queue=[]}return et()(t,[{key:"state",value:function(){return this.queue}},{key:"track",value:function(t){var e;return(e=this.queue).push.apply(e,pt()(t)),this}},{key:"clear",value:function(){return this.queue.length=0,this}},{key:"toJSON",value:function(){return this.queue}},{key:"isEmpty",value:function(){return 0===this.queue.length}}]),t}();var gt=function(t,e){for(var n=0,r=t.length-1,i=Math.floor((r+n)/2),o=n,a=r;t[i]!==e&&n<r;)e<t[i]?r=i-1:e>t[i]&&(n=i+1),i=Math.floor((r+n)/2);return i<o?i=o:i>a&&(i=a),e<t[i]&&i>o?i-1:i}.bind(null,[1,1.5,2.25,3.38,5.06,7.59,11.39,17.09,25.63,38.44,57.67,86.5,129.75,194.62,291.93,437.89,656.84,985.26,1477.89,2216.84,3325.26,4987.89,7481.83]),vt=function(){function t(){X()(this,t),this.clear()}return et()(t,[{key:"clear",value:function(){return this.counters={},this}},{key:"state",value:function(){return this.counters}},{key:"track",value:function(t,e){return void 0===this.counters[t]&&(this.counters[t]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.counters[t][gt(e)]++,this}},{key:"isEmpty",value:function(){return 0===Object.keys(this.counters).length}},{key:"toJSON",value:function(){return this.counters}}]),t}(),mt=function(){function t(){X()(this,t),this.clear()}return et()(t,[{key:"clear",value:function(){return this.counters={},this}},{key:"state",value:function(){return this.counters}},{key:"track",value:function(t){return void 0===this.counters[t]?this.counters[t]=1:this.counters[t]++,this.counters[t]}},{key:"isEmpty",value:function(){return 0===Object.keys(this.counters).length}},{key:"toJSON",value:function(){return this.counters}}]),t}(),yt=function(){function t(e){var n=this;X()(this,t);var r=e.get(e.constants.SETTINGS),i=e.get(e.constants.EVENTS);this.onFullQueue=!1,this.maxQueue=r.scheduler.eventsQueueSize,this.queue=[],this.queueByteSize=0,o(i)?i.then((function(t){n.onFullQueue=t.flushAndResetTimer,n._checkForFlush()})):"function"==typeof i.flushAndResetTimer&&(this.onFullQueue=i.flushAndResetTimer)}return et()(t,[{key:"state",value:function(){return this.queue}},{key:"track",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.queueByteSize+=e,this.queue.push(t),this._checkForFlush(),!0}},{key:"clear",value:function(){return this.queue=[],this.queueByteSize=0,this}},{key:"toJSON",value:function(){return this.queue}},{key:"isEmpty",value:function(){return 0===this.queue.length}},{key:"_checkForFlush",value:function(){(this.queueByteSize>5242880||this.maxQueue>0&&this.queue.length>=this.maxQueue)&&this.onFullQueue&&this.onFullQueue()}}]),t}(),St=/[^.]+$/,Tt=/count\.([^/]+)$/,bt=/latency\.([^/]+)\.bucket\.([0-9]+)$/,Et=function(){function t(e){X()(this,t),this.settings=e}return et()(t,[{key:"buildSplitKey",value:function(t){return"".concat(this.settings.storage.prefix,".split.").concat(t)}},{key:"buildTrafficTypeKey",value:function(t){return"".concat(this.settings.storage.prefix,".trafficType.").concat(t)}},{key:"buildSplitsTillKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.till")}},{key:"buildSplitsReady",value:function(){return"".concat(this.settings.storage.prefix,".splits.ready")}},{key:"isSplitKey",value:function(t){return Object(a.o)(t,"".concat(this.settings.storage.prefix,".split."))}},{key:"buildSegmentNameKey",value:function(t){return"".concat(this.settings.storage.prefix,".segment.").concat(t)}},{key:"buildSegmentTillKey",value:function(t){return"".concat(this.settings.storage.prefix,".segment.").concat(t,".till")}},{key:"buildRegisteredSegmentsKey",value:function(){return"".concat(this.settings.storage.prefix,".segments.registered")}},{key:"buildSegmentsReady",value:function(){return"".concat(this.settings.storage.prefix,".segments.ready")}},{key:"buildVersionablePrefix",value:function(){return"".concat(this.settings.storage.prefix,"/").concat(this.settings.version,"/").concat(this.settings.runtime.ip)}},{key:"buildImpressionsKey",value:function(){return"".concat(this.settings.storage.prefix,".impressions")}},{key:"buildEventsKey",value:function(){return"".concat(this.settings.storage.prefix,".events")}},{key:"buildLatencyKeyPrefix",value:function(){return"".concat(this.buildVersionablePrefix(),"/latency")}},{key:"buildLatencyKey",value:function(t,e){return"".concat(this.buildLatencyKeyPrefix(),".").concat(t,".bucket.").concat(e)}},{key:"buildCountKey",value:function(t){return"".concat(this.buildVersionablePrefix(),"/count.").concat(t)}},{key:"buildGaugeKey",value:function(t){return"".concat(this.buildVersionablePrefix(),"/gauge.").concat(t)}},{key:"searchPatternForCountKeys",value:function(){return"".concat(this.buildVersionablePrefix(),"/count.*")}},{key:"searchPatternForSplitKeys",value:function(){return"".concat(this.settings.storage.prefix,".split.*")}},{key:"searchPatternForLatency",value:function(){return"".concat(this.buildLatencyKeyPrefix(),".*")}},{key:"extractKey",value:function(t){var e=t.match(St);if(e&&e.length)return e[0];throw new Error("Invalid latency key provided")}},{key:"extractCounterName",value:function(t){var e=t.match(Tt);if(e&&e.length)return e[1];throw new Error("Invalid counter key provided")}},{key:"extractLatencyMetricNameAndBucket",value:function(t){var e=t.match(bt);if(e&&e.length>2)return{metricName:e[1],bucketNumber:e[2]};throw new Error("Invalid counter key provided")}}]),t}(),_t=n(8),Ot=n.n(_t),Nt=n(10),kt=n.n(Nt),Rt=n(7),At=n.n(Rt);function wt(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n){return Object(a.i)(n)?n[t]:e?void 0:n}}var It=wt("matchingKey"),Ct=wt("bucketingKey",!0);function Mt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=At()(t);if(e){var i=At()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return kt()(this,n)}}var Dt=function(t){Ot()(n,t);var e=Mt(n);function n(t){var r;return X()(this,n),(r=e.call(this,t)).regexSplitCacheKey=new RegExp("^".concat(r.settings.storage.prefix,"\\.(splits?|trafficType)\\.")),r}return et()(n,[{key:"buildSegmentNameKey",value:function(t){return"".concat(It(this.settings.core.key),".").concat(this.settings.storage.prefix,".segment.").concat(t)}},{key:"extractSegmentName",value:function(t){var e="".concat(It(this.settings.core.key),".").concat(this.settings.storage.prefix,".segment.");if(Object(a.o)(t,e))return t.substr(e.length)}},{key:"buildSplitsWithSegmentCountKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.usingSegments")}},{key:"buildLastUpdatedKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.lastUpdated")}},{key:"isSplitCacheKey",value:function(t){return this.regexSplitCacheKey.test(t)}},{key:"buildSplitsFilterQueryKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.filterQuery")}}]),n}(Et),Lt=function(t){var e=t.get(t.constants.SETTINGS);switch(e.storage.type){case"MEMORY":var n=new Et(e);return{splits:new ot,segments:new ut(n),impressions:new dt,metrics:new vt,count:new mt,events:new yt(t),shared:function(t){var e=new Et(t);return{splits:this.splits,segments:new ut(e),impressions:this.impressions,metrics:this.metrics,count:this.count,events:this.events,destroy:function(){this.splits=new ot,this.segments.flush()}}},destroy:function(){this.splits.flush(),this.segments.flush(),this.impressions.clear(),this.metrics.clear(),this.count.clear(),this.events.clear()}};case"LOCALSTORAGE":var r=new Dt(e),i=Date.now()-864e6;return{splits:new ct(r,i,e.sync.__splitFiltersValidation),segments:new ft(r),impressions:new dt,metrics:new vt,count:new mt,events:new yt(t),shared:function(t){var e=new Dt(t);return{splits:this.splits,segments:new ft(e),impressions:this.impressions,metrics:this.metrics,count:this.count,events:this.events,destroy:function(){this.splits=new ot,this.segments=new ut(e)}}},destroy:function(){this.splits=new ot,this.segments=new ut(new Et(e)),this.impressions.clear(),this.metrics.clear(),this.count.clear(),this.events.clear()}};default:throw new Error("Unsupported storage type")}},xt=n(11),jt=n.n(xt),Pt="init::timeout",Ut="init::ready",Kt="init::cache-ready",Ft="state::splits-arrived",Gt="state::segments-arrived",Ht="state::splits-cache-loaded",Bt="state::update",Yt="state::check";var Wt=function(){var t=0,e=new jt.a;e.SDK_SPLITS_CACHE_LOADED=Ht,e.SDK_SPLITS_ARRIVED=Ft;var n=0;function r(e,n){var r=new jt.a,i=0,o=0;return r.on(Yt,(function(){14!==o&&t+i===6?(o=14,r.emit(Ut)):14===o&&r.emit(Bt)})),e.on(Ft,(function(e){e||(t=2),r.emit(Yt)})),e.once(Ht,(function(){setTimeout((function(){return r.emit(Kt)}),0)})),n.on(Gt,(function(){i=4,r.emit(Yt)})),r}return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=0,o=new jt.a;o.SDK_SEGMENTS_ARRIVED=Gt;var a=r(e,o);return t>0&&(i=setTimeout((function(){a.emit(Pt,"Split SDK emitted SDK_READY_TIMED_OUT event.")}),t),a.once(Ut,(function(){return clearTimeout(i)}))),a.SDK_READY=Ut,a.SDK_READY_FROM_CACHE=Kt,a.SDK_UPDATE=Bt,a.SDK_READY_TIMED_OUT=Pt,n++,{splits:e,segments:o,gate:a,destroy:function(){o.removeAllListeners(),a.removeAllListeners(),clearTimeout(i),n>0&&n--,0===n&&e.removeAllListeners()}}}};var qt={startup:{requestTimeoutBeforeReady:5,retriesOnFailureBeforeReady:1,readyTimeout:10,eventsFirstPushWindow:10}},zt=n(12),Vt=Object(s.b)("splitio-settings"),Qt=function(t){var e=t.mode,n=t.storage,r=n.type,i=void 0===r?"MEMORY":r,o=n.options,a=void 0===o?{}:o,s=n.prefix;return s?s+=".SPLITIO":s="SPLITIO","localhost"===e?{type:"MEMORY",prefix:s}:(("MEMORY"!==i&&"LOCALSTORAGE"!==i||"LOCALSTORAGE"===i&&!Object(zt.a)())&&(i="MEMORY",Vt.warn("Invalid or unavailable storage. Fallbacking into MEMORY storage")),{type:i,options:a,prefix:s})},Jt=Object(s.b)("splitio-settings"),$t=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=t.integrations;if(!Array.isArray(n)||0===n.length)return[];var r=n.filter((function(t){return t&&Object(a.j)(t.type)&&e.indexOf(t.type)>-1})),i=n.length-r.length;return i&&Jt.warn("".concat(i," integration ").concat(1===i?"item":"items"," at settings ").concat(1===i?"is":"are"," invalid: integration items must have a valid 'type' value")),r},Zt=function(t){return $t(t,["GOOGLE_ANALYTICS_TO_SPLIT","SPLIT_TO_GOOGLE_ANALYTICS"])};var Xt=function(t,e){if("localhost"===t)return"localhost";if(-1===[M,D,L].indexOf(e))throw Error("Invalid mode provided");return e},te=Object(s.b)("splitio-settings");function ee(t,e){var n,r,i={validFilters:[],queryString:null,groupedFilters:{}};return t?e!==M?(te.warn("split filters have been configured but will have no effect if mode is not '".concat(M,"', since synchronization is being deferred to an external tool.")),i):Array.isArray(t)&&0!==t.length?(P.forEach((function(t){i.groupedFilters[t.type]=[]})),i.validFilters=t.filter((function(t,e){return t&&(n=t.type,P.some((function(t){return t.type===n})))&&Array.isArray(t.values)?(i.groupedFilters[t.type]=i.groupedFilters[t.type].concat(t.values),!0):(te.warn("split filter at position '".concat(e,"' is invalid. It must be an object with a valid filter type ('byName' or 'byPrefix') and a list of 'values'.")),!1);var n})),P.forEach((function(t){var e=t.type,n=t.maxLength;i.groupedFilters[e].length>0&&(i.groupedFilters[e]=function(t,e,n){var r=C(e,"settings","".concat(t," filter"),"".concat(t," filter value"));if(r){if(r.length>n)throw new Error("".concat(n," unique values can be specified at most for '").concat(t,"' filter. You passed ").concat(r.length,". Please consider reducing the amount or using other filter."));r.sort()}return r||[]}(e,i.groupedFilters[e],n))})),i.queryString=(n=i.groupedFilters,r=[],P.forEach((function(t){var e=t.type,i=t.queryParam,o=n[e];o.length>0&&r.push(i+o.map((function(t){return encodeURIComponent(t)})).join(","))})),r.length>0?"&"+r.join("&"):null),te.debug("splits filtering criteria is '".concat(i.queryString,"'.")),i):(te.warn("splitFilters configuration must be a non-empty array of filter objects."),i):i}var ne=Object(s.b)("splitio-settings");var re=function(t){return t=t.toUpperCase(),-1===[U,K].indexOf(t)&&(ne.error("You passed an invalid impressionsMode, impressionsMode should be one of the following values: '".concat(U,"' or '").concat(K,"'. Defaulting to '").concat(K,"' mode.")),t=K),t},ie=/^\/(testImpressions|metrics|events)/,oe=/^\/auth/,ae=/^\/(sse|event-stream)/,se={mode:M,core:{authorizationKey:void 0,key:void 0,trafficType:void 0,labelsEnabled:!0,IPAddressesEnabled:void 0},scheduler:{featuresRefreshRate:30,segmentsRefreshRate:60,metricsRefreshRate:120,impressionsRefreshRate:60,offlineRefreshRate:15,eventsPushRate:60,eventsQueueSize:500,pushRetryBackoffBase:1},urls:{sdk:"https://sdk.split.io/api",events:"https://events.split.io/api",auth:"https://auth.split.io/api",streaming:"https://streaming.split.io"},storage:{type:"MEMORY"},debug:void 0,impressionListener:void 0,version:"".concat("javascript","-").concat("10.15.7"),integrations:void 0,streamingEnabled:!0,sync:{splitFilters:void 0,impressionsMode:K}};function ce(t){return Math.round(1e3*t)}function ue(t){var e,n=Object(a.k)({},se,qt,t);n.scheduler.featuresRefreshRate=ce(n.scheduler.featuresRefreshRate),n.scheduler.segmentsRefreshRate=ce(n.scheduler.segmentsRefreshRate),n.scheduler.metricsRefreshRate=ce(n.scheduler.metricsRefreshRate),n.scheduler.impressionsRefreshRate=ce(n.scheduler.impressionsRefreshRate),n.scheduler.offlineRefreshRate=ce(n.scheduler.offlineRefreshRate),n.scheduler.eventsPushRate=ce(n.scheduler.eventsPushRate),n.startup.requestTimeoutBeforeReady=ce(n.startup.requestTimeoutBeforeReady),n.startup.readyTimeout=ce(n.startup.readyTimeout),n.startup.eventsFirstPushWindow=ce(n.startup.eventsFirstPushWindow),n.mode=Xt(n.core.authorizationKey,n.mode),n.storage=Qt(n),"boolean"==typeof(e=n.debug)?e?s.a.enable():s.a.disable():"string"==typeof e&&s.a.setLogLevel(e),n.runtime=(n.core.IPAddressesEnabled,n.mode,{ip:!1,hostname:!1}),n.integrations=Zt(n),!1!==n.streamingEnabled&&(n.streamingEnabled=!0,n.scheduler.pushRetryBackoffBase=ce(n.scheduler.pushRetryBackoffBase));var r=ee(n.sync.splitFilters,n.mode);return n.sync.splitFilters=r.validFilters,n.sync.__splitFiltersValidation=r,n.sync.impressionsMode=re(n.sync.impressionsMode),n}var le={url:function(t){return ie.test(t)?"".concat(this.urls.events).concat(t):oe.test(t)?"".concat(this.urls.auth).concat(t):ae.test(t)?"".concat(this.urls.streaming).concat(t):"".concat(this.urls.sdk).concat(t)},overrideKeyAndTT:function(t,e){return i()(Object.create(le),this,{core:i()({},this.core,{key:t,trafficType:e})})}},fe=function(t){return i()(Object.create(le),ue(t))},he={COLLECTORS:"metrics_collectors",DESTROYED:"is_destroyed",EVENTS:"events_publisher",HAS_TIMEDOUT:"has_timedout",INTEGRATIONS_MANAGER:"integrations_manager",MY_SEGMENTS_CHANGE_WORKER:"my_segments_change_worker",PRODUCER:"producer",READINESS:"readiness_gate",READY:"is_ready",READY_FROM_CACHE:"is_ready_from_cache",SETTINGS:"settings",STATUS_MANAGER:"status_manager",STORAGE:"storage",IMPRESSIONS_COUNTER:"impressions_counter"},pe=function(){function t(){X()(this,t),this._map={},this.constants=he}return et()(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("string"==typeof t&&("string"!=typeof t||t.length)){var n=this._map[t];if(void 0!==n)return n;if(!e){var r,i=new Promise((function(t){return r=t}));return i.manualResolve=r,this._map[t]=i,i}}}},{key:"getAll",value:function(){return i()({},this._map)}},{key:"put",value:function(t,e){var n=this;if("string"!=typeof t||"string"==typeof t&&!t.length||void 0===e)return!1;var r=this._map[t];return(void 0===r||"function"==typeof r.manualResolve)&&(o(r)&&r.manualResolve&&r.manualResolve(e),o(e)&&e.then((function(e){return n._map[t]=e,e})).catch((function(e){return n._map[t]=void 0,e})),this._map[t]=e,!0)}}]),t}(),de=function(t){return Object(a.i)(t)?{matchingKey:t.matchingKey,bucketingKey:t.bucketingKey}:{matchingKey:t,bucketingKey:t}},ge=n(9),ve=n.n(ge),me=n(5),ye=n(6),Se=n.n(ye);var Te="object"===("undefined"==typeof performance?"undefined":Se()(performance))&&"function"==typeof performance.now?performance.now.bind(performance):Date.now;var be,Ee=function(){var t=Te();return function(){return Math.round(Te()-t)}},_e=new me.b("[TIME TRACKER]",{showLevel:!1}),Oe={},Ne={SDK_READY:"Getting ready - Split SDK",SDK_GET_TREATMENT:"SDK - Get Treatment",SDK_GET_TREATMENTS:"SDK - Get Treatments",SDK_GET_TREATMENT_WITH_CONFIG:"SDK - Get Treatment with config",SDK_GET_TREATMENTS_WITH_CONFIG:"SDK - Get Treatments with config",SPLITS_READY:"Getting ready - Splits",SEGMENTS_READY:"Getting ready - Segments",METRICS_PUSH:"Pushing - Metrics",IMPRESSIONS_PUSH:"Pushing - Impressions",EVENTS_PUSH:"Pushing - Events",MY_SEGMENTS_FETCH:"Fetching - My Segments",SEGMENTS_FETCH:"Fetching - Segments",SPLITS_FETCH:"Fetching - Splits"},ke=(be={},ve()(be,Ne.SDK_READY,{collector:"client",method:"ready"}),ve()(be,Ne.SDK_GET_TREATMENT,{collector:"client",method:"getTreatment"}),ve()(be,Ne.SDK_GET_TREATMENTS,{collector:"client",method:"getTreatments"}),ve()(be,Ne.SDK_GET_TREATMENT_WITH_CONFIG,{collector:"client",method:"getTreatmentWithConfig"}),ve()(be,Ne.SDK_GET_TREATMENTS_WITH_CONFIG,{collector:"client",method:"getTreatmentsWithConfig"}),ve()(be,Ne.MY_SEGMENTS_FETCH,{collector:"mySegments",method:"latency"}),ve()(be,Ne.SEGMENTS_FETCH,{collector:"segmentChanges",method:"latency"}),ve()(be,Ne.SPLITS_FETCH,{collector:"splitChanges",method:"latency"}),be),Re=function(t,e){return"string"==typeof e?t+e:t},Ae=function(t,e){var n=ke[t];return!(!n||!e)&&e[n.collector]},we=function(t,e){var n=ke[t];return!(!n||!e)&&e[n.method]},Ie={__attachToPromise:function(t,e,n,r){var i=this;return t.then((function(t){return i.stop(e,r),n&&n.count&&n.count(t.status),t})).catch((function(t){throw i.stop(e,r),n&&n.countException&&n.countException(),t}))},start:function(t,e,n){var r,i=Object(a.t)(),s=Ae(t,e);o(n)?r=this.__attachToPromise(n,t,s,i):(r=this.stop.bind(this,t,i),ke[t]&&!s&&(r.setCollectorForTask=this.setCollectorForTask.bind(this,t,i)));var c=Re(t,i),u=we(t,s);return Oe[c]={cb:u,timer:Ee()},r},setCollectorForTask:function(t,e,n){var r=Ae(t,n);if(r){var i=Re(t,e);Oe[i].cb=we(t,r)}},stop:function(t,e){var n=Re(t,e),r=Oe[n];if(r){var i=r.timer();return _e.debug("[".concat(t,"] took ").concat(i,"ms to finish.")),r.cb&&r.cb(i),delete Oe[n],i}},TaskNames:Ne},Ce={ALL:1,SEGMENT:2,WHITELIST:3,EQUAL_TO:4,GREATER_THAN_OR_EQUAL_TO:5,LESS_THAN_OR_EQUAL_TO:6,BETWEEN:7,UNDEFINED:8,EQUAL_TO_SET:9,CONTAINS_ANY_OF_SET:10,CONTAINS_ALL_OF_SET:11,PART_OF_SET:12,ENDS_WITH:13,STARTS_WITH:14,CONTAINS_STRING:15,IN_SPLIT_TREATMENT:16,EQUAL_TO_BOOLEAN:17,MATCHES_STRING:18},Me={BOOLEAN:"BOOLEAN",STRING:"STRING",NUMBER:"NUMBER",SET:"SET",DATETIME:"DATETIME",NOT_SPECIFIED:"NOT_SPECIFIED"};var De=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.segmentName},Le=function(){function t(){var e=this;X()(this,t),this.__setData__=[];var n=arguments[0];Array.isArray(n)&&n.forEach((function(t){e.add(t)}))}return et()(t,[{key:"clear",value:function(){this.__setData__.length&&(this.__setData__.length=0)}},{key:"add",value:function(t){return this.has(t)||this.__setData__.push(t),this}},{key:"delete",value:function(t){var e=this.__setData__.indexOf(t);return-1!==e&&(this.__setData__.splice(e,1),!0)}},{key:"has",value:function(t){return-1!==this.__setData__.indexOf(t)}},{key:"forEach",value:function(t){var e=arguments[1];if("function"!=typeof t)throw new TypeError(t+" is not a function");for(var n=0;n<this.__setData__.length;n++){var r=this.__setData__[n];t.call(e,r,r,this)}}},{key:"size",get:function(){return this.__setData__.length}}]),t}();function xe(t){return t instanceof Le?t.__setData__.slice():Array.from(t)}var je="function"==typeof Array.from&&"function"==typeof Set&&Set.prototype&&Set.prototype.values?Set:Le;var Pe=function(t){return new je(t.whitelist)};var Ue=function(t){return t.whitelist};var Ke=function(t){return t.value};function Fe(t){return new Date(t).setUTCHours(0,0,0,0)}function Ge(t){return new Date(t).setUTCSeconds(0,0)}var He=function(t){var e=t.map((function(t){var e=t.matcherType,n=t.negate,r=t.keySelector,i=t.userDefinedSegmentMatcherData,o=t.whitelistMatcherData,a=t.unaryNumericMatcherData,s=t.betweenMatcherData,c=t.dependencyMatcherData,u=t.booleanMatcherData,l=t.stringMatcherData,f=r&&r.attribute,h=function(t){switch(t){case"ALL_KEYS":return Ce.ALL;case"IN_SEGMENT":return Ce.SEGMENT;case"WHITELIST":return Ce.WHITELIST;case"EQUAL_TO":return Ce.EQUAL_TO;case"GREATER_THAN_OR_EQUAL_TO":return Ce.GREATER_THAN_OR_EQUAL_TO;case"LESS_THAN_OR_EQUAL_TO":return Ce.LESS_THAN_OR_EQUAL_TO;case"BETWEEN":return Ce.BETWEEN;case"EQUAL_TO_SET":return Ce.EQUAL_TO_SET;case"CONTAINS_ANY_OF_SET":return Ce.CONTAINS_ANY_OF_SET;case"CONTAINS_ALL_OF_SET":return Ce.CONTAINS_ALL_OF_SET;case"PART_OF_SET":return Ce.PART_OF_SET;case"ENDS_WITH":return Ce.ENDS_WITH;case"STARTS_WITH":return Ce.STARTS_WITH;case"CONTAINS_STRING":return Ce.CONTAINS_STRING;case"IN_SPLIT_TREATMENT":return Ce.IN_SPLIT_TREATMENT;case"EQUAL_TO_BOOLEAN":return Ce.EQUAL_TO_BOOLEAN;case"MATCHES_STRING":return Ce.MATCHES_STRING;default:return Ce.UNDEFINED}}(e),p=Me.STRING,d=void 0;return h===Ce.SEGMENT?d=De(i):h===Ce.WHITELIST?d=Pe(o):h===Ce.EQUAL_TO?(d=Ke(a),p=Me.NUMBER,"DATETIME"===a.dataType&&(d=Fe(d),p=Me.DATETIME)):h===Ce.GREATER_THAN_OR_EQUAL_TO||h===Ce.LESS_THAN_OR_EQUAL_TO?(d=Ke(a),p=Me.NUMBER,"DATETIME"===a.dataType&&(d=Ge(d),p=Me.DATETIME)):h===Ce.BETWEEN?(d=s,p=Me.NUMBER,"DATETIME"===s.dataType&&(d.start=Ge(d.start),d.end=Ge(d.end),p=Me.DATETIME)):h===Ce.EQUAL_TO_SET||h===Ce.CONTAINS_ANY_OF_SET||h===Ce.CONTAINS_ALL_OF_SET||h===Ce.PART_OF_SET?(d=Ue(o),p=Me.SET):h===Ce.STARTS_WITH||h===Ce.ENDS_WITH||h===Ce.CONTAINS_STRING?d=Ue(o):h===Ce.IN_SPLIT_TREATMENT?(d=c,p=Me.NOT_SPECIFIED):h===Ce.EQUAL_TO_BOOLEAN?(p=Me.BOOLEAN,d=u):h===Ce.MATCHES_STRING&&(d=l),{attribute:f,negate:n,type:h,value:d,dataType:p}}));return-1===Object(a.c)(e,(function(t){return t.type===Ce.UNDEFINED}))?e:[]};function Be(t,e){if(!(this instanceof Be))return new Be(t,e);if(100!==t[t.length-1])throw new RangeError("Provided invalid dataset as input");this._ranges=t,this._treatments=e}Be.parse=function(t){var e=t.reduce((function(t,e){var n=e.size,r=e.treatment;return t.ranges.push(t.inc+=n),t.treatments.push(r),t}),{inc:0,ranges:[],treatments:[]});return new Be(e.ranges,e.treatments)},Be.prototype.getTreatmentFor=function(t){if(t<0||t>100)throw new RangeError("Please provide a value between 0 and 100");var e=Object(a.c)(this._ranges,(function(e){return t<=e}));return this._treatments[e]};var Ye=Be,We=Object(s.b)("splitio-engine:matcher");function qe(t){return We.debug("[allMatcher] is always true"),null!=t}var ze=function(){return qe},Ve=Object(s.b)("splitio-engine:matcher");var Qe=function(t,e){return function(n){var r=e.segments.isInSegment(t,n);return o(r)?r.then((function(e){return Ve.debug("[asyncSegmentMatcher] evaluated ".concat(t," / ").concat(n," => ").concat(r)),e})):Ve.debug("[segmentMatcher] evaluated ".concat(t," / ").concat(n," => ").concat(r)),r}},Je=Object(s.b)("splitio-engine:matcher");var $e=function(t){return function(e){var n=t.has(e);return Je.debug("[whitelistMatcher] evaluated ".concat(e," in [").concat(xe(t).join(","),"] => ").concat(n)),n}},Ze=Object(s.b)("splitio-engine:matcher");var Xe=function(t){return function(e){var n=e===t;return Ze.debug("[equalToMatcher] is ".concat(e," equal to ").concat(t,"? ").concat(n)),n}},tn=Object(s.b)("splitio-engine:matcher");var en=function(t){return function(e){var n=e>=t;return tn.debug("[greaterThanEqualMatcher] is ".concat(e," greater than ").concat(t,"? ").concat(n)),n}},nn=Object(s.b)("splitio-engine:matcher");var rn=function(t){return function(e){var n=e<=t;return nn.debug("[lessThanEqualMatcher] is ".concat(e," less than ").concat(t,"? ").concat(n)),n}},on=Object(s.b)("splitio-engine:matcher");var an=function(t){return function(e){var n=e>=t.start&&e<=t.end;return on.debug("[betweenMatcher] is ".concat(e," between ").concat(t.start," and ").concat(t.end,"? ").concat(n)),n}},sn=Object(s.b)("splitio-engine:matcher");var cn=function(t){return function(e){for(var n=e.length===t.length,r=function(r){Object(a.c)(t,(function(t){return t===e[r]}))<0&&(n=!1)},i=0;i<e.length&&n;i++)r(i);return sn.debug("[equalToSetMatcher] is ".concat(e," equal to set ").concat(t,"? ").concat(n)),n}},un=Object(s.b)("splitio-engine:matcher");var ln=function(t){return function(e){var n=!0;if(e.length<t.length)n=!1;else for(var r=function(r){Object(a.c)(e,(function(e){return e===t[r]}))<0&&(n=!1)},i=0;i<t.length&&n;i++)r(i);return un.debug("[containsAllMatcher] ".concat(e," contains all elements of ").concat(t,"? ").concat(n)),n}},fn=Object(s.b)("splitio-engine:matcher");var hn=function(t){return function(e){for(var n=!1,r=function(r){Object(a.c)(e,(function(e){return e===t[r]}))>=0&&(n=!0)},i=0;i<t.length&&!n;i++)r(i);return fn.debug("[containsAnyMatcher] ".concat(e," contains at least an element of ").concat(t,"? ").concat(n)),n}},pn=Object(s.b)("splitio-engine:matcher");var dn=function(t){return function(e){for(var n=e.length<=t.length,r=function(r){Object(a.c)(t,(function(t){return t===e[r]}))<0&&(n=!1)},i=0;i<e.length&&n;i++)r(i);return pn.debug("[partOfMatcher] ".concat(e," is part of ").concat(t,"? ").concat(n)),n}},gn=Object(s.b)("splitio-engine:matcher");var vn=function(t){return function(e){var n=t.some((function(t){return Object(a.o)(e,t)}));return gn.debug("[startsWithMatcher] ".concat(e," starts with ").concat(t,"? ").concat(n)),n}},mn=Object(s.b)("splitio-engine:matcher");var yn=function(t){return function(e){var n=t.some((function(t){return Object(a.a)(e,t)}));return mn.debug("[endsWithMatcher] ".concat(e," ends with ").concat(t,"? ").concat(n)),n}},Sn=Object(s.b)("splitio-engine:matcher");var Tn=function(t){return function(e){var n=t.some((function(t){return Object(a.j)(e)&&e.indexOf(t)>-1}));return Sn.debug("[containsStringMatcher] ".concat(e," contains ").concat(t,"? ").concat(n)),n}},bn=Object(s.b)("splitio-engine:matcher");function En(t,e,n){var r=!1;return Array.isArray(e)&&(r=-1!==e.indexOf(t.treatment)),bn.debug('[dependencyMatcher] Parent split "'.concat(n,'" evaluated to "').concat(t.treatment,'" with label "').concat(t.label,'". ').concat(n," evaluated treatment is part of [").concat(e,"] ? ").concat(r,".")),r}var _n=function(t,e){var n=t.split,r=t.treatments;return function(t,i){var a=t.key,s=t.attributes;bn.debug('[dependencyMatcher] will evaluate parent split: "'.concat(n,'" with key: ').concat(JSON.stringify(a)," ").concat(s?"\n attributes: ".concat(JSON.stringify(s)):""));var c=i(a,n,s,e);return o(c)?c.then((function(t){return En(t,r,n)})):En(c,r,n)}},On=Object(s.b)("splitio-engine:matcher");var Nn=function(t){return function(e){var n=t===e;return On.debug("[booleanMatcher] ".concat(t," === ").concat(e)),n}},kn=Object(s.b)("splitio-engine:matcher");var Rn=function(t){return function(e){var n;try{n=new RegExp(t)}catch(e){return kn.debug("[stringMatcher] ".concat(t," is an invalid regex")),!1}var r=n.test(e);return kn.debug("[stringMatcher] does ".concat(e," matches with ").concat(t,"? ").concat(r?"yes":"no")),r}};var An=function(t,e){var n,r=t.type,i=t.value;return r===Ce.ALL?n=ze(i):r===Ce.SEGMENT?n=Qe(i,e):r===Ce.WHITELIST?n=$e(i):r===Ce.EQUAL_TO?n=Xe(i):r===Ce.GREATER_THAN_OR_EQUAL_TO?n=en(i):r===Ce.LESS_THAN_OR_EQUAL_TO?n=rn(i):r===Ce.BETWEEN?n=an(i):r===Ce.EQUAL_TO_SET?n=cn(i):r===Ce.CONTAINS_ANY_OF_SET?n=hn(i):r===Ce.CONTAINS_ALL_OF_SET?n=ln(i):r===Ce.PART_OF_SET?n=dn(i):r===Ce.STARTS_WITH?n=vn(i):r===Ce.ENDS_WITH?n=yn(i):r===Ce.CONTAINS_STRING?n=Tn(i):r===Ce.IN_SPLIT_TREATMENT?n=_n(i,e):r===Ce.EQUAL_TO_BOOLEAN?n=Nn(i):r===Ce.MATCHES_STRING&&(n=Rn(i)),n},wn=Object(s.b)("splitio-engine:sanitize"),In=Ce,Cn=Me;function Mn(t,e){return{key:t,attributes:e}}var Dn=function(t,e,n,r){var i,o,s,c=function(t,e){switch(t){case In.EQUAL_TO:return"DATETIME"===e?Fe:void 0;case In.GREATER_THAN_OR_EQUAL_TO:case In.LESS_THAN_OR_EQUAL_TO:case In.BETWEEN:return"DATETIME"===e?Ge:void 0;case In.IN_SPLIT_TREATMENT:return Mn;default:return}}(t,n);switch(n){case Cn.NUMBER:case Cn.DATETIME:o=e,s=Object(a.p)(o),i=isNaN(s)?void 0:s;break;case Cn.STRING:i=function(t){var e=t;Object(a.i)(t)&&(e=t.matchingKey?t.matchingKey:void 0);var n=Object(a.q)(e);return n||void 0}(e);break;case Cn.SET:i=function(t){var e=Array.isArray(t)?Object(a.s)(t.map((function(t){return t+""}))):[];return e.length?e:void 0}(e);break;case Cn.BOOLEAN:i=function(t){if(!0===t||!1===t)return t;if("string"==typeof t){var e=t.toLocaleLowerCase();if("true"===e)return!0;if("false"===e)return!1}}(e);break;case Cn.NOT_SPECIFIED:i=e;break;default:i=void 0}return c&&(i=c(i,r)),wn.debug("Attempted to sanitize [".concat(e,"] which should be of type [").concat(n,"]. \n Sanitized and processed value => [").concat(i instanceof Object?JSON.stringify(i):i,"]")),i},Ln=Object(s.b)("splitio-engine:value");var xn=function(t,e,n){var r=e.attribute,i=function(t,e,n){var r=void 0;return e?n?(r=n[e],Ln.debug("Extracted attribute [".concat(e,"], [").concat(r,"] will be used for matching."))):Ln.warn("Defined attribute [".concat(e,"], no attributes received.")):r=t,r}(t,r,n),o=Dn(e.type,i,e.dataType,n);return void 0!==o?o:void Ln.warn("Value ".concat(i," ").concat(r?"for attribute ".concat(r," "):0,"doesn't match with expected type."))};function jn(t){return e=function(t){return(t=Number(t))<0?Math.ceil(t):Math.floor(t)}(t),n=Math.pow(2,32),e-Math.floor(e/n)*n;var e,n}function Pn(t){var e=jn(t);return e>=Math.pow(2,31)?e-Math.pow(2,32):e}function Un(t,e){for(var n=0,r=0;r<t.length;r++)n=Pn(Pn(31*n)+t.charCodeAt(r));return Pn(n^e)}var Kn,Fn,Gn=function(t,e){return Math.abs(Un(t,e)%100)+1},Hn=(Kn={encodeUTF8:function(t,e){var n=null;for("number"==typeof t&&(n=t,t=function(){return null});null!==n||null!==(n=t());)n<128?e(127&n):n<2048?(e(n>>6&31|192),e(63&n|128)):n<65536?(e(n>>12&15|224),e(n>>6&63|128),e(63&n|128)):(e(n>>18&7|240),e(n>>12&63|128),e(n>>6&63|128),e(63&n|128)),n=null},UTF16toUTF8:function(t,e){for(var n,r=null;null!==(n=null!==r?r:t());)n>=55296&&n<=57343&&null!==(r=t())&&r>=56320&&r<=57343?(e(1024*(n-55296)+r-56320+65536),r=null):e(n);null!==r&&e(r)},encodeUTF16toUTF8:function(t,e){Kn.UTF16toUTF8(t,(function(t){Kn.encodeUTF8(t,e)}))}},Fn=String.fromCharCode,Kn.stringSource=function(t){if("string"!=typeof t)throw TypeError("Illegal argument: "+Se()(t));var e=0;return function(){return e>=t.length?null:t.charCodeAt(e++)}},Kn.stringDestination=function(){var t=[],e=[];return function(){if(0===arguments.length)return e.join("")+Fn.apply(String,t);t.length+arguments.length>1024&&(e.push(Fn.apply(String,t)),t.length=0),Array.prototype.push.apply(t,arguments)}},Kn),Bn=Hn.stringSource,Yn=Hn.stringDestination,Wn=Hn.encodeUTF16toUTF8;
/*!
 * +----------------------------------------------------------------------------------+
 * | murmurHash3.js v3.0.0 (http://github.com/karanlyons/murmurHash3.js)              |
 * | A TypeScript/JavaScript implementation of MurmurHash3's hashing algorithms.      |
 * |----------------------------------------------------------------------------------|
 * | Copyright (c) 2012-2020 Karan Lyons. Freely distributable under the MIT license. |
 * +----------------------------------------------------------------------------------+
 */
function qn(t,e){return(65535&t)*e+(((t>>>16)*e&65535)<<16)}function zn(t,e){return t<<e|t>>>32-e}
/*!
 * +----------------------------------------------------------------------------------+
 * | murmurHash3.js v3.0.0 (http://github.com/karanlyons/murmurHash3.js)              |
 * | A TypeScript/JavaScript implementation of MurmurHash3's hashing algorithms.      |
 * |----------------------------------------------------------------------------------|
 * | Copyright (c) 2012-2020 Karan Lyons. Freely distributable under the MIT license. |
 * +----------------------------------------------------------------------------------+
 */
function Vn(t,e){e=e||0;for(var n,r=(t=t||"").length%4,i=t.length-r,o=e,a=0,s=3432918353,c=461845907,u=0;u<i;u+=4)a=qn(a=255&t.charCodeAt(u)|(255&t.charCodeAt(u+1))<<8|(255&t.charCodeAt(u+2))<<16|(255&t.charCodeAt(u+3))<<24,s),a=qn(a=zn(a,15),c),o=qn(o=zn(o^=a,13),5)+3864292196;switch(a=0,r){case 3:a^=(255&t.charCodeAt(u+2))<<16;case 2:a^=(255&t.charCodeAt(u+1))<<8;case 1:a=qn(a^=255&t.charCodeAt(u),s),o^=a=qn(a=zn(a,15),c)}return o^=t.length,n=o,n=qn(n^=n>>>16,2246822507),n=qn(n^=n>>>13,3266489909),(o=n^=n>>>16)>>>0}function Qn(t,e){return Vn((Wn(Bn(t),n=Yn()),n()),e>>>0);var n}var Jn={hash:Qn,bucket:function(t,e){return Math.abs(Qn(t,e)%100)+1}},$n=Object(s.b)("splitio-engine");function Zn(t){return 2===t?Jn.bucket:Gn}var Xn={getTreatment:function(t,e,n,r){var i=Zn(r)(t,e),o=n.getTreatmentFor(i);return $n.debug("[engine] using algo ".concat(2!==r?"legacy":"murmur"," bucket ").concat(i," for key ").concat(t," using seed ").concat(e," - treatment ").concat(o)),o},shouldApplyRollout:function(t,e,n,r){if(t<100&&Zn(r)(e,n)>t)return!1;return!0}};function tr(t,e,n,r,i,o){if(t)return{treatment:Xn.getTreatment(e,n,r,o),label:i}}var er=function(t,e,n,r){return function(i,a,s,c,u,l,f){if("ROLLOUT"===r&&!Xn.shouldApplyRollout(s,i.bucketingKey,c,f))return{treatment:void 0,label:"not in split"};var h=t(i,l,u);return o(h)?h.then((function(t){return tr(t,i.bucketingKey,a,e,n,f)})):tr(h,i.bucketingKey,a,e,n,f)}},nr=Object(s.b)("splitio-engine:combiner");function rr(){return nr.error("Invalid Split provided, no valid conditions found"),{treatment:x,label:"exception"}}function ir(t){for(var e=t.length,n=0;n<e;n++){var r=t[n];if(void 0!==r)return nr.debug("Treatment found: ".concat(r.treatment)),r}nr.debug("All predicates evaluated, no treatment found.")}var or=function(t){return!Array.isArray(t)||Array.isArray(t)&&0===t.length?rr:function(e,n,r,i,s,c,u){var l=t.map((function(t){return t(e,n,r,i,u,s,c)}));return-1!==Object(a.c)(l,o)?Promise.all(l).then((function(t){return ir(t)})):ir(l)}},ar=Object(s.b)("splitio-engine:combiner");function sr(t){for(var e,n=0,r=t.length;n<r&&t[n];n++);return e=n===r,ar.debug("[andCombiner] evaluates to ".concat(e)),e}var cr=function(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=t.map((function(t){return t.apply(void 0,n)}));return-1!==Object(a.c)(i,o)?Promise.all(i).then(sr):sr(i)}};var ur=function(t,e){for(var n=[],r=0;r<t.length;r++){var i=t[r],a=i.matcherGroup.matchers,s=i.partitions,c=i.label,u=i.conditionType,l=(a=He(a)).map((function(t){var n=An(t,e);return function(e,r,i){var a=xn(e,t,r),s=void 0!==a&&n(a,i);return o(s)?s.then((function(e){return Boolean(e^t.negate)})):Boolean(s^t.negate)}}));if(0===l.length){n=[];break}n.push(er(cr(l),Ye.parse(s),c,u))}return or(n)};function lr(t,e){return{treatment:Object(a.e)(t,"treatment",e),label:Object(a.e)(t,"label","default rule")}}function fr(t,e){if(!(this instanceof fr))return new fr(t,e);var n;this.baseInfo=t,this.evaluator=e,"string"!=typeof(n=this).baseInfo.defaultTreatment&&(n.baseInfo.defaultTreatment=x)}fr.parse=function(t,e){var n=t.conditions,r=ur(n,e);return new fr(i()({},t),r)},fr.prototype.getKey=function(){return this.baseInfo.name},fr.prototype.getTreatment=function(t,e,n){var r,i,a,s=this.baseInfo,c=s.killed,u=s.seed,l=s.defaultTreatment,f=s.trafficAllocation,h=s.trafficAllocationSeed,p=s.algo;try{r=de(t)}catch(t){return{treatment:x,label:"exception"}}if(this.isGarbage())i=x,a="archived";else{if(!c){var d=this.evaluator(r,u,f,h,e,p,n);return o(d)?d.then((function(t){return lr(t,l)})):lr(d,l)}i=l,a="killed"}return{treatment:i,label:a}},fr.prototype.isGarbage=function(){return"ARCHIVED"===this.baseInfo.status},fr.prototype.getChangeNumber=function(){return this.baseInfo.changeNumber};var hr=fr,pr={treatment:x,label:"exception",config:null};function dr(t,e,n,r){var i;try{i=r.splits.getSplit(e)}catch(t){return Promise.resolve(pr)}return o(i)?i.then((function(e){return vr(e,t,n,r)})):vr(i,t,n,r)}function gr(t,e,n,r){var i,a={};try{i=r.splits.fetchMany(e)}catch(t){return e.forEach((function(t){a[t]=pr})),Promise.resolve(a)}return o(i)?i.then((function(i){return mr(e,i,t,n,r)})):mr(e,i,t,n,r)}function vr(t,e,n,r){var i={treatment:x,label:"definition not found",config:null};if(t){var s=JSON.parse(t),c=hr.parse(s,r);if(i=c.getTreatment(e,n,dr),o(i))return i.then((function(t){return t.changeNumber=c.getChangeNumber(),t.config=Object(a.e)(s,"configurations.".concat(t.treatment),null),t}));i.changeNumber=c.getChangeNumber(),i.config=Object(a.e)(s,"configurations.".concat(i.treatment),null)}return i}function mr(t,e,n,r,i){var a={},s=[];return t.forEach((function(t){var c=vr(e[t],n,r,i);o(c)?s.push(c.then((function(e){a[t]=e}))):a[t]=c})),s.length>0?Promise.all(s).then((function(){return a})):a}var yr=function t(e,n,r,i){X()(this,t),this.list=i,this.value=e,n?(n.next=this,this.prev=n):this.prev=null,r?(r.prev=this,this.next=r):this.next=null},Sr=function(){function t(){X()(this,t),this.tail=null,this.head=null,this.length=0}return et()(t,[{key:"removeNode",value:function(t){if(t&&t instanceof yr){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,n=t.prev;return e&&(e.prev=n),n&&(n.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=n),t.list.length--,t.next=null,t.prev=null,t.list=null,e}}},{key:"unshiftNode",value:function(t){if(t&&t instanceof yr&&t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}}},{key:"unshift",value:function(){for(var t=0,e=arguments.length;t<e;t++)this.head=new yr(arguments[t],null,this.head,this),this.tail||(this.tail=this.head),this.length++;return this.length}}]),t}(),Tr="undefined"!=typeof Map?Map:function(){function t(){X()(this,t)}return et()(t,[{key:"set",value:function(t,e){this[t]=e}},{key:"get",value:function(t){return this[t]}},{key:"delete",value:function(t){delete this[t]}},{key:"size",get:function(){return Object.keys(this).length}}]),t}(),br=function(){function t(e){X()(this,t),this.maxLen=e||1,this.items=new Tr,this.lru=new Sr}return et()(t,[{key:"get",value:function(t){var e=this.items.get(t);if(e&&e instanceof yr)return this.lru.unshiftNode(e),e.value.value}},{key:"set",value:function(t,e){var n=this.items.get(t);if(n){if(!(n instanceof yr))return!1;this.lru.unshiftNode(n),this.lru.head.value.value=e}else{if(this.lru.length===this.maxLen){var r=this.lru.tail;if(!r)return!1;this.items.delete(r.value.key),this.lru.removeNode(this.lru.tail)}this.lru.unshift({key:t,value:e}),this.items.set(t,this.lru.head)}return!0}}]),t}(),Er=function(){function t(e,n){X()(this,t),this.cache=new br(e),this.hasher=n}return et()(t,[{key:"testAndSet",value:function(t){if(!t)return null;var e=this.hasher(t),n=this.cache.get(e);return this.cache.set(e,t.time),n}}]),t}();function _r(t){return t||"UNKNOWN"}function Or(t){return t?Jn.hash(function(t){return"".concat(_r(t.keyName),"\n    :").concat(_r(t.feature),"\n    :").concat(_r(t.treatment),"\n    :").concat(_r(t.label),"\n    :").concat(t.changeNumber||0)}(t)).toString():null}var Nr=function(){return new Er(500,Or)};function kr(t){return t-t%36e5}var Rr=Object(s.b)("splitio-client:impressions-tracker");function Ar(t){return[D,M].indexOf(t.mode)>-1}var wr=function(t){var e=t.get(t.constants.STORAGE).impressions,n=t.get(t.constants.SETTINGS),r=n.impressionListener,a=t.get(t.constants.INTEGRATIONS_MANAGER,!0),s=n.runtime,c=s.ip,u=s.hostname,l=n.version,f=[],h=Ar(n),p=function(t){return!!Ar(t)&&t.sync.impressionsMode===K}(n),d=Nr(),g=t.get(t.constants.IMPRESSIONS_COUNTER);return{queue:function(t,e){f.push({impression:t,attributes:e})},track:function(){var t=f.length,n=f.splice(0,t),s=[];n.forEach((function(t){var e=t.impression;h&&(e.pt=d.testAndSet(e));var n=Date.now();p&&g&&g.inc(e.feature,n,1),(!p||!e.pt||e.pt<kr(n))&&s.push(e)}));var v=e.track(s);if(o(v)&&v.then((function(){Rr.debug("Successfully stored ".concat(t," impression").concat(1===t?"":"s","."))})).catch((function(e){Rr.error("Could not store impressions bulk with ".concat(t," impression").concat(1===t?"":"s",". Error: ").concat(e))})),r||a)for(var m=function(t){var e={impression:i()({},n[t].impression),attributes:n[t].attributes,ip:c,hostname:u,sdkLanguageVersion:l};setTimeout((function(){a&&a.handleImpression(e);try{r&&r.logImpression(e)}catch(t){Rr.error("Impression listener logImpression method threw: ".concat(t,"."))}}),0)},y=0;y<t;y++)m(y)}}},Ir=Object(s.b)("splitio-client:event-tracker");var Cr=function(t){var e=t.get(t.constants.STORAGE).events,n=t.get(t.constants.INTEGRATIONS_MANAGER,!0);function r(t,e){var r=t.eventTypeId,o=t.trafficTypeName,a=t.key,s=t.value,c=t.timestamp,u=t.properties,l='event of type "'.concat(r,'" for traffic type "').concat(o,'". Key: ').concat(a,". Value: ").concat(s,". Timestamp: ").concat(c,". ").concat(u?"With properties.":"With no properties.");return e?(Ir.info("Successfully queued ".concat(l)),n&&setTimeout((function(){var e=i()({},t);t.properties&&(e.properties=i()({},t.properties)),n.handleEvent(e)}),0)):Ir.warn("Failed to queue ".concat(l)),e}return{track:function(t,n){var i=e.track(t,n);return o(i)?i.then(r.bind(null,t)):r(t,i)}}},Mr=Object(s.b)("splitio-client");var Dr=function(t){var e=t.get(t.constants.STORAGE),n=t.get(t.constants.COLLECTORS),r=wr(t),i=Cr(t);function a(t,i,a){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=Ie.TaskNames[s?"SDK_GET_TREATMENT_WITH_CONFIG":"SDK_GET_TREATMENT"],l=Ie.start(u,n),f=dr(t,i,a,e),h=function(e){var n=c(e,i,t,a,s,"getTreatment".concat(s?"withConfig":""));return r.track(),l(),n};return o(f)?f.then((function(t){return h(t)})):h(f)}function s(t,i,a){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=Ie.TaskNames[s?"SDK_GET_TREATMENTS_WITH_CONFIG":"SDK_GET_TREATMENTS"],l=Ie.start(u,n),f=function(e){var n={};return Object.keys(e).forEach((function(r){n[r]=c(e[r],r,t,a,s,"getTreatments".concat(s?"withConfig":""))})),r.track(),l(),n},h=gr(t,i,a,e);return o(h)?h.then((function(t){return f(t)})):f(h)}function c(e,n,i,o,a,s){var c=t.get(t.constants.READY,!0)||t.get(t.constants.READY_FROM_CACHE,!0),u=It(i),l=Ct(i);c||(e={treatment:x,label:"not ready"});var f=e,h=f.treatment,p=f.label,d=f.changeNumber,g=f.config,v=void 0===g?null:g;return Mr.info("Split: ".concat(n,". Key: ").concat(u,". Evaluation: ").concat(h,". Label: ").concat(p)),w(t,n,p,s)&&(Mr.info("Queueing corresponding impression."),r.queue({feature:n,keyName:u,treatment:h,time:Date.now(),bucketingKey:l,label:p,changeNumber:d},o)),a?{treatment:h,config:v}:h}return{getTreatment:a,getTreatmentWithConfig:function(t,e,n){return a(t,e,n,!0)},getTreatments:s,getTreatmentsWithConfig:function(t,e,n){return s(t,e,n,!0)},track:function(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1024,c=It(e),u=Date.now(),l={eventTypeId:r,trafficTypeName:n,value:o,timestamp:u,key:c,properties:a};return Y(n,t,"track"),i.track(l,s)}}};var Lr=function(t,e,n){var r="REDIS"!==t.get(t.constants.SETTINGS).storage.type,o=Dr(t),s=o.getTreatment,c=o.getTreatmentWithConfig,u=o.getTreatments,l=o.getTreatmentsWithConfig,h=o.track;function p(n,r,i,o){var s,c,u=Object(a.o)(o,"getTreatments"),l=e?n:N(n,o),h=u?C(r,o):A(r,o),p=(s=i,c=o,Object(a.i)(s)||null==s?s:(f.error("".concat(c,": attributes must be a plain object.")),!1)),d=q(t);return z(t,o),{valid:d&&l&&h&&!1!==p,key:l,splitOrSplits:h,attributes:p}}return o.getTreatment=function(t,e,n){var i=p(t,e,n,"getTreatment");return i.valid?s(i.key,i.splitOrSplits,i.attributes):r?x:Promise.resolve(x)},o.getTreatmentWithConfig=function(t,e,n){var o=p(t,e,n,"getTreatmentWithConfig");return o.valid?c(o.key,o.splitOrSplits,o.attributes):r?i()({},j):Promise.resolve(i()({},j))},o.getTreatments=function(t,e,n){var i=p(t,e,n,"getTreatments");if(i.valid)return u(i.key,i.splitOrSplits,i.attributes);var o={};return i.splitOrSplits&&i.splitOrSplits.forEach((function(t){return o[t]=x})),r?o:Promise.resolve(o)},o.getTreatmentsWithConfig=function(t,e,n){var o=p(t,e,n,"getTreatmentsWithConfig");if(o.valid)return l(o.key,o.splitOrSplits,o.attributes);var a={};return o.splitOrSplits&&o.splitOrSplits.forEach((function(t){return a[t]=i()({},j)})),r?a:Promise.resolve(a)},o.track=function(i,o,a,s,c){var u=e?i:N(i,"track"),l=n?o:H(o,"track"),f=d(a,"track"),p=v(s,"track"),g=E(c,"track"),m=g.properties,y=g.size;return q(t)&&u&&l&&f&&!1!==p&&!1!==m?h(u,l,f,p,m,y):!r&&Promise.resolve(!1)},o};var xr=function(t){var e,n=t.get(t.constants.SETTINGS),r=Object(a.e)(n,"core.key",void 0),i=Object(a.e)(n,"core.trafficType",void 0);"localhost"===n.mode&&void 0===r?n.core.key="localhost_key":n.core.key=N(r,"Client instantiation");var o=[n.core.key];if(void 0!==i){var s=H(i,"Client instantiation");n.core.trafficType=s,o.push(s)}var c=Lr(t,!0,o.length>1);return c.isBrowserClient=!0,c.getTreatment=c.getTreatment.bind(c,n.core.key),c.getTreatmentWithConfig=c.getTreatmentWithConfig.bind(c,n.core.key),c.getTreatments=c.getTreatments.bind(c,n.core.key),c.getTreatmentsWithConfig=c.getTreatmentsWithConfig.bind(c,n.core.key),c.track=(e=c.track).bind.apply(e,[c].concat(o)),c};var jr=function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var o,a=!1;function s(){for(var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,r=arguments.length,i=new Array(r>1?r-1:0),c=1;c<r;c++)i[c-1]=arguments[c];a||(o=setTimeout((function(){t.apply(void 0,i.concat([s]))}),n))}function c(){clearTimeout(o),o=void 0,a=!0}return c.reset=function(){clearTimeout(o),o=void 0,s.apply(void 0,[e].concat(r))},t.apply(void 0,r.concat([s])),c},Pr=function(t,e){return e=e||{},new Promise((function(n,r){var i=new XMLHttpRequest,o=[],a=[],s={},c=function(){return{ok:2==(i.status/100|0),statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:c,headers:{keys:function(){return o},entries:function(){return a},get:function(t){return s[t.toLowerCase()]},has:function(t){return t.toLowerCase()in s}}}};for(var u in i.open(e.method||"get",t,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(t,e,n){o.push(e=e.toLowerCase()),a.push([e,n]),s[e]=s[e]?s[e]+","+n:n})),n(c())},i.onerror=r,i.withCredentials="include"==e.credentials,e.headers)i.setRequestHeader(u,e.headers[u]);i.send(e.body||null)}))};var Ur=n(16);function Kr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=At()(t);if(e){var i=At()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return kt()(this,n)}}var Fr=function(t){Ot()(n,t);var e=Kr(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Split Error";return X()(this,n),(t=e.call(this,r)).message=r,t}return n}(n.n(Ur)()(Error)),Gr=function(t){Ot()(n,t);var e=Kr(n);function n(t){return X()(this,n),e.call(this,t||"Split Timeout Error")}return n}(Fr),Hr=function(t){Ot()(n,t);var e=Kr(n);function n(t,r){var i;return X()(this,n),(i=e.call(this,t||"Split Network Error")).statusCode=r,i}return n}(Fr),Br=Object(s.b)("splitio-services:service");function Yr(t){var e=t.url;return("undefined"!=typeof window&&window.fetch||Pr)(e,t).then((function(t){if(!t.ok)throw{response:t};return t})).catch((function(n){var r=n.response,i="";if(r)switch(r.status){case 404:i="Invalid API key or resource not found.";break;default:i=r.statusText}else i=n.message;throw r&&403===r.status||Br[t.logErrorsAsInfo?"info":"error"]("Response status is not OK. Status: ".concat(r?r.status:"NO_STATUS",". URL: ").concat(e,". Message: ").concat(i)),new Hr(i,r&&r.status)}))}var Wr=Yr;var qr=function(t,e,n,r){var o=t.core.authorizationKey,a=t.version,s=t.runtime,c=s.ip,u=s.hostname,l={},f={};return l.Accept="application/json",l["Content-Type"]="application/json",l.Authorization="Bearer ".concat(o),l.SplitSDKVersion=a,c&&(l.SplitSDKMachineIP=c),u&&(l.SplitSDKMachineName=u),r&&i()(l,r),i()({headers:l,url:t.url(e)},f,n)},zr={"Cache-Control":"no-cache"};function Vr(t){var e=[],n=t.toJSON();return Object(a.d)(n,(function(t,n){e.push({name:n,delta:t})})),e}var Qr=Yr;function Jr(t,e){return qr(t,"/testImpressions/bulk",i()({method:"POST"},e),{SplitSDKImpressionsMode:t.sync.impressionsMode===K?K:U})}function $r(t,e){return qr(t,"/testImpressions/count",i()({method:"POST"},e))}function Zr(t,e){var n=e.core.labelsEnabled,r=Object(a.g)(t.state(),"feature"),i=[];return Object(a.d)(r,(function(t,e){i.push({f:e,i:t.map((function(t){var e={k:t.keyName,t:t.treatment,m:t.time,c:t.changeNumber};return n&&(e.r=t.label),t.bucketingKey&&(e.b=t.bucketingKey),t.pt&&(e.pt=t.pt),e}))})})),i}function Xr(t){var e=[];if(0===(t?t.size():0))return e;for(var n=t.popAll(),r=Object.keys(n),i=0;i<r.length;i++){var o=r[i].split("::");if(2===o.length){var a=o[0],s=o[1],c={f:a,m:Number(s),rc:n[r[i]]};e.push(c)}}return e}function ti(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=At()(t);if(e){var i=At()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return kt()(this,n)}}var ei=function(){function t(e){X()(this,t),this.storage=e,this.latency=this.latency.bind(this),this.count=this.count.bind(this),this.countException=this.countException.bind(this)}return et()(t,[{key:"latency",value:function(t){this.storage.metrics.track("".concat(this.metricType,".time"),t)}},{key:"count",value:function(t){this.storage.count.track("".concat(this.metricType,".status.").concat(t))}},{key:"countException",value:function(){this.storage.count.track("".concat(this.metricType,".exception"))}}]),t}(),ni=function(t){Ot()(n,t);var e=ti(n);function n(t){var r;return X()(this,n),(r=e.call(this,t)).metricType="segmentChangeFetcher",r}return n}(ei),ri=function(t){Ot()(n,t);var e=ti(n);function n(t){var r;return X()(this,n),(r=e.call(this,t)).metricType="splitChangeFetcher",r}return n}(ei),ii=function(t){Ot()(n,t);var e=ti(n);function n(t){var r;return X()(this,n),(r=e.call(this,t)).metricType="mySegmentsFetcher",r}return n}(ei),oi=function(){function t(e){X()(this,t),this.storage=e,this.ready=this.ready.bind(this),this.getTreatment=this.getTreatment.bind(this),this.getTreatments=this.getTreatments.bind(this),this.getTreatmentWithConfig=this.getTreatmentWithConfig.bind(this),this.getTreatmentsWithConfig=this.getTreatmentsWithConfig.bind(this)}return et()(t,[{key:"ready",value:function(t){this.storage.metrics.track("sdk.ready",t)}},{key:"getTreatment",value:function(t){this.storage.metrics.track("sdk.getTreatment",t)}},{key:"getTreatments",value:function(t){this.storage.metrics.track("sdk.getTreatments",t)}},{key:"getTreatmentWithConfig",value:function(t){this.storage.metrics.track("sdk.getTreatmentWithConfig",t)}},{key:"getTreatmentsWithConfig",value:function(t){this.storage.metrics.track("sdk.getTreatmentsWithConfig",t)}}]),t}(),ai=Object(s.b)("splitio-metrics"),si=function(t){var e=0,n=t.get(t.constants.SETTINGS),r=t.get(t.constants.STORAGE),o=t.get(t.constants.IMPRESSIONS_COUNTER),s=n.sync.impressionsMode===K,c=function(){if(r.metrics.isEmpty()&&r.count.isEmpty())return Promise.resolve();ai.info("Pushing metrics");var t,e,o,s=Ie.start(Ie.TaskNames.METRICS_PUSH),c=r.metrics.isEmpty()?null:Wr(function(t,e){return qr(t,"/metrics/times",i()({method:"POST"},e,{logErrorsAsInfo:!0}))}(n,{body:JSON.stringify((t=r.metrics,e=[],o=t.toJSON(),Object(a.d)(o,(function(t,n){e.push({name:n,latencies:t})})),e))})).then((function(){return r.metrics.clear()})).catch((function(){return r.metrics.clear()})),u=r.count.isEmpty()?null:Wr(function(t,e){return qr(t,"/metrics/counters",i()({method:"POST"},e,{logErrorsAsInfo:!0}))}(n,{body:JSON.stringify(Vr(r.count))})).then((function(){return r.count.clear()})).catch((function(){return r.count.clear()}));return Promise.all([c,u]).then((function(t){return s(),t}))},u=function(){if(r.impressions.isEmpty())return Promise.resolve();var t=r.impressions.queue.length;ai.info("Pushing ".concat(t," impressions"));var i=Ie.start(Ie.TaskNames.IMPRESSIONS_PUSH);return Qr(Jr(n,{body:JSON.stringify(Zr(r.impressions,n))})).then((function(){e=0,r.impressions.clear()})).catch((function(n){e?(ai.warn("Droping ".concat(t," impressions after retry. Reason ").concat(n,".")),e=0,r.impressions.clear()):(e++,ai.warn("Failed to push ".concat(t," impressions, keeping data to retry on next iteration. Reason ").concat(n,".")))})).then((function(){return i()}))},l=function(){var t=Xr(o),r=t.length;return 0===r?Promise.resolve():(ai.info("Pushing count of impressions for ".concat(r," features")),Qr($r(n,{body:JSON.stringify({pf:t})})).then((function(){e=0})).catch((function(t){e?(ai.warn("Droping count of impressions for ".concat(r," features after retry. Reason ").concat(t,".")),e=0):(e++,ai.warn("Failed to push impressions count for ".concat(r," features, keeping data to retry on next iteration. Reason ").concat(t,".")))})))},f=!1,h=!1,p=!1;return{start:function(){f=jr((function(t){return u().then((function(){return t()}))}),n.scheduler.impressionsRefreshRate),h=jr((function(t){return c().then((function(){return t()}))}),n.scheduler.metricsRefreshRate),s&&(p=jr((function(t){return l().then((function(){return t()}))}),18e5))},flush:function(){return s&&l(),u()},stop:function(){f&&f(),h&&h(),p&&p()},collectors:{segmentChanges:new ni(r),splitChanges:new ri(r),mySegments:new ii(r),client:new oi(r)}}},ci=Yr;function ui(t,e){return qr(t,"/events/bulk",i()({method:"POST"},e))}var li=Object(s.b)("splitio-events"),fi=function(t){var e=t.get(t.constants.SETTINGS),n=t.get(t.constants.STORAGE),r=function(){if(n.events.isEmpty())return Promise.resolve();li.info("Pushing ".concat(n.events.state().length," queued events."));var t=Ie.start(Ie.TaskNames.EVENTS_PUSH),r=JSON.stringify(n.events.toJSON()),i=function(){return t()};return n.events.clear(),ci(ui(e,{body:r})).then(i).catch(i)},i=!1,o=!1,a=function(){return o=jr((function(t){return r().then((function(){return t()}))}),e.scheduler.eventsPushRate)};return{start:function(){e.startup.eventsFirstPushWindow>0?i=setTimeout(a,e.startup.eventsFirstPushWindow):a()},flush:function(){return r()},stop:function(){i&&clearTimeout(i),o&&o()},flushAndResetTimer:function(){return li.info("Flushing events and reseting timer."),o&&o.reset(),r()}}},hi=Yr;function pi(t){return"users="+encodeURIComponent(t)}function di(t){var e,n=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent((e=n,atob(e)).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(r)}function gi(t,e){return hi(function(t,e){var n="/auth";if(e){var r=e.map(pi).join("&");r&&(n+="?"+r)}return qr(t,n)}(t,e)).then((function(t){return t.json()})).then((function(t){if(t.token){var e=di(t.token);if("number"!=typeof e.iat||"number"!=typeof e.exp)throw new Error('token properties "issuedAt" (iat) or "expiration" (exp) are missing or invalid');var n=JSON.parse(e["x-ably-capability"]);return i()({decodedToken:e,channels:n},t)}return t}))}function vi(){return"undefined"!=typeof window&&"function"==typeof window.EventSource?window.EventSource:void 0}var mi=function(){function t(e,n,r){X()(this,t),this.baseMillis=n||t.DEFAULT_BASE_MILLIS,this.maxMillis=r||t.DEFAULT_MAX_MILLIS,this.attempts=0,this.cb=e}return et()(t,[{key:"scheduleCall",value:function(){var t=this,e=Math.min(this.baseMillis*Math.pow(2,this.attempts),this.maxMillis);return this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=setTimeout((function(){t.cb()}),e),this.attempts++,e}},{key:"reset",value:function(){this.attempts=0,this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=0)}}]),t}();mi.DEFAULT_BASE_MILLIS=1e3,mi.DEFAULT_MAX_MILLIS=18e5;var yi=mi,Si=function(){function t(e,n){X()(this,t),this.mySegmentsStorage=e,this.mySegmentsProducer=n,this.maxChangeNumber=0,this.segmentList=void 0,this.currentChangeNumber=-1,this.put=this.put.bind(this),this.__handleMySegmentUpdateCall=this.__handleMySegmentUpdateCall.bind(this),this.backoff=new yi(this.__handleMySegmentUpdateCall)}return et()(t,[{key:"__handleMySegmentUpdateCall",value:function(){var t=this;if(this.maxChangeNumber>this.currentChangeNumber){this.handleNewEvent=!1;var e=this.maxChangeNumber;this.mySegmentsProducer.synchronizeMySegments(this.segmentList,!0).then((function(n){!1!==n&&(t.currentChangeNumber=Math.max(t.currentChangeNumber,e)),t.handleNewEvent?t.__handleMySegmentUpdateCall():t.backoff.scheduleCall()}))}}},{key:"put",value:function(t,e){t<=this.currentChangeNumber||t<=this.maxChangeNumber||(this.maxChangeNumber=t,this.handleNewEvent=!0,this.backoff.reset(),this.segmentList=e,this.mySegmentsProducer.isSynchronizingMySegments()||this.__handleMySegmentUpdateCall())}}]),t}(),Ti=function(){function t(e,n,r){X()(this,t),this.splitStorage=e,this.splitProducer=n,this.maxChangeNumber=0,this.splitsEventEmitter=r,this.put=this.put.bind(this),this.killSplit=this.killSplit.bind(this),this.__handleSplitUpdateCall=this.__handleSplitUpdateCall.bind(this),this.backoff=new yi(this.__handleSplitUpdateCall)}return et()(t,[{key:"__handleSplitUpdateCall",value:function(){var t=this;this.maxChangeNumber>this.splitStorage.getChangeNumber()&&(this.handleNewEvent=!1,this.splitProducer.synchronizeSplits(!0).then((function(){t.handleNewEvent?t.__handleSplitUpdateCall():(t.splitProducer.synchronizeSegment&&t.splitProducer.synchronizeSegment(void 0,!1,!0),t.backoff.scheduleCall())})))}},{key:"put",value:function(t){t<=this.splitStorage.getChangeNumber()||t<=this.maxChangeNumber||(this.maxChangeNumber=t,this.handleNewEvent=!0,this.backoff.reset(),this.splitProducer.isSynchronizingSplits()||this.__handleSplitUpdateCall())}},{key:"killSplit",value:function(t,e,n){var r=this;this.splitStorage.killLocally(e,n,t).then((function(e){e&&r.splitsEventEmitter.emit(r.splitsEventEmitter.SDK_SPLITS_ARRIVED,!0),r.put(t)}))}}]),t}(),bi=/^control_/,Ei=function(){function t(e,n){X()(this,t),this.EventSource=e,this.streamingUrl=n.url("/sse"),this.reopen=this.reopen.bind(this)}return et()(t,[{key:"setEventHandler",value:function(t){this.handler=t}},{key:"open",value:function(t){this.close(),this.authToken=t;var e=Object.keys(t.channels).map((function(t){var e=bi.test(t)?"[?occupancy=metrics.publishers]":"";return encodeURIComponent(e+t)})).join(","),n="".concat(this.streamingUrl,"?channels=").concat(e,"&accessToken=").concat(t.token,"&v=").concat("1.1","&heartbeats=true");this.connection=new this.EventSource(n),this.handler&&(this.connection.onopen=this.handler.handleOpen,this.connection.onmessage=this.handler.handleMessage,this.connection.onerror=this.handler.handleError)}},{key:"close",value:function(){this.connection&&this.connection.close()}},{key:"reopen",value:function(){this.open(this.authToken)}}],[{key:"getInstance",value:function(e){var n=vi();if(n)return new t(n,e)}}]),t}(),_i="STREAMING_DISABLED",Oi="STREAMING_PAUSED",Ni="STREAMING_RESUMED";var ki=[/control_pri$/,/control_sec$/];var Ri=Object(s.b)("splitio-sync:sse-handler");function Ai(t){var e,n,r,i,o=(e=t,n=ki.map((function(t){return{regex:t,hasPublishers:!0,oTime:-1,cTime:-1}})),r=!0,i=!0,{handleOpen:function(){e.emit("PUSH_SUBSYSTEM_UP")},isStreamingUp:function(){return i&&r},handleOccupancyEvent:function(t,o,a){for(var s=0;s<n.length;s++){var c=n[s];if(c.regex.test(o)){if(a>c.oTime){c.oTime=a,c.hasPublishers=0!==t;var u=n.some((function(t){return t.hasPublishers}));i&&(!u&&r?e.emit("PUSH_SUBSYSTEM_DOWN"):u&&!r&&e.emit("PUSH_SUBSYSTEM_UP")),r=u}return}}},handleControlEvent:function(t,o,a){for(var s=0;s<n.length;s++){var c=n[s];if(c.regex.test(o))return void(a>c.cTime&&(c.cTime=a,t===_i?e.emit("PUSH_NONRETRYABLE_ERROR"):r&&(t===Oi&&i?e.emit("PUSH_SUBSYSTEM_DOWN"):t!==Ni||i||e.emit("PUSH_SUBSYSTEM_UP")),i=t===Ni))}}});return{handleOpen:function(){o.handleOpen()},handleError:function(e){var n=e;try{n=function(t){return Object(a.j)(t.data)&&(t.parsedData=JSON.parse(t.data)),t}(e)}catch(t){Ri.warn("Error parsing SSE error notification: ".concat(t))}var r=n.parsedData&&n.parsedData.message;Ri.error("Fail to connect to streaming".concat(r?', with error message: "'.concat(r,'"'):"")),!function(t){if(t.parsedData&&t.parsedData.code){var e=t.parsedData.code;if(40140<=e&&e<=40149)return!0;if(4e4<=e&&e<=49999)return!1}return!0}(n)?t.emit("PUSH_NONRETRYABLE_ERROR"):t.emit("PUSH_RETRYABLE_ERROR")},handleMessage:function(e){var n;try{n=function(t){var e=JSON.parse(t.data);return e.parsedData=JSON.parse(e.data),e.name&&"[meta]occupancy"===e.name&&(e.parsedData.type="OCCUPANCY"),e}(e)}catch(t){return void Ri.warn("Error parsing new SSE message notification: ".concat(t))}var r=n,i=r.parsedData,a=r.data,s=r.channel,c=r.timestamp;if(Ri.debug("New SSE message received, with data: ".concat(a,".")),o.isStreamingUp()||"OCCUPANCY"===i.type||"CONTROL"===i.type)switch(i.type){case"SPLIT_UPDATE":t.emit("SPLIT_UPDATE",i.changeNumber);break;case"SEGMENT_UPDATE":t.emit("SEGMENT_UPDATE",i.changeNumber,i.segmentName);break;case"MY_SEGMENTS_UPDATE":t.emit("MY_SEGMENTS_UPDATE",i,s);break;case"SPLIT_KILL":t.emit("SPLIT_KILL",i.changeNumber,i.splitName,i.defaultTreatment);break;case"OCCUPANCY":o.handleOccupancyEvent(i.metrics.publishers,s,c);break;case"CONTROL":o.handleControlEvent(i.controlType,s,c)}}}}function wi(t){return e=Jn.hash(t,0).toString(),btoa(e);var e}var Ii=Object(s.b)("splitio-sync:push-manager");function Ci(t,e){if(n=Ii,vi()?"function"==typeof atob&&"function"==typeof btoa||(n.warn('"atob" and "btoa" functions for Base64 encoding are not available. Falling back to polling mode.'),0):(n.warn("EventSource API is not available. Falling back to polling mode."),0)){var n,r=new jt.a,o=t.get(t.constants.READINESS).splits,a=t.get(t.constants.SETTINGS),s=t.get(t.constants.STORAGE),c=Ei.getInstance(a),u=Ai(r);c.setEventHandler(u);var l,f,h={},p=[],d=!1,g=new yi(S,a.scheduler.pushRetryBackoffBase);r.on("PUSH_SUBSYSTEM_DOWN",b),r.on("PUSH_SUBSYSTEM_UP",(function(){g.reset()})),r.on("PUSH_NONRETRYABLE_ERROR",(function(){T(),r.emit("PUSH_SUBSYSTEM_DOWN")})),r.on("PUSH_RETRYABLE_ERROR",(function(){c.close();var t=g.scheduleCall();Ii.info("Attempting to reconnect in ".concat(t/1e3," seconds.")),r.emit("PUSH_SUBSYSTEM_DOWN")}));var v=t.get(t.constants.PRODUCER),m=new Ti(s.splits,v,o);if(p.push(m),r.on("SPLIT_KILL",m.killSplit),r.on("SPLIT_UPDATE",m.put),e)r.on("MY_SEGMENTS_UPDATE",(function(n,r){var i=r.split("_")[2],o=h[i];if(o&&e[o]){var a=e[o].get(t.constants.MY_SEGMENTS_CHANGE_WORKER,!0);a&&a.put(n.changeNumber,n.includesPayload?n.segmentList?n.segmentList:[]:void 0)}}));else{var y=new Si(s.segments,v);p.push(y),r.on("SEGMENT_UPDATE",y.put)}return i()(Object.create(r),{stop:T,start:S,startNewClient:function(t,e){var n=wi(t),r=e.get(e.constants.STORAGE),i=e.get(e.constants.PRODUCER);h[n]||(h[n]=t,d=!0);var o=new Si(r.segments,i);p.push(o),e.put(e.constants.MY_SEGMENTS_CHANGE_WORKER,o),setTimeout((function(){d&&(d=!1,S())}),0)},removeClient:function(t){var e=wi(t);delete h[e]}})}function S(){l=!1,Ii.info("Connecting to push streaming.");var t=e?Object.keys(e):void 0;gi(a,t).then((function(n){if(!l){if(!n.pushEnabled)return Ii.info("Streaming is not available. Switching to polling mode."),void r.emit("PUSH_NONRETRYABLE_ERROR");if(!(t&&t.length<Object.keys(e).length)){var i=n.decodedToken;c.open(n),function(t,e){f&&clearTimeout(f);var n=e-t-600;Ii.info("Refreshing streaming token in ".concat(n," seconds.")),f=setTimeout(S,1e3*n)}(i.iat,i.exp)}}})).catch((function(t){l||(Ii.error('Failed to authenticate for streaming. Error: "'.concat(t.message,'".')),t.statusCode>=400&&t.statusCode<500?r.emit("PUSH_NONRETRYABLE_ERROR"):r.emit("PUSH_RETRYABLE_ERROR"))}))}function T(){l=!0,Ii.info("Disconnecting from push streaming."),c.close(),f&&clearTimeout(f),g.reset(),b()}function b(){p.forEach((function(t){return t.backoff.reset()}))}}var Mi=Object(s.b)("splitio-producer:task"),Di=function(t,e){var n=Object(a.f)(t),r=!1;return{start:function(){r||(Mi.debug("Starting ".concat(n," refreshing each ").concat(e)),r=jr((function(e){Mi.debug("Running ".concat(n)),t().then((function(){return e()}))}),e))},stop:function(){Mi.debug("Stopping ".concat(n)),r&&r(),r=!1},isRunning:function(){return!!r}}};var Li=function(t,e){return t<1?e:new Promise((function(n,r){var i=setTimeout((function(){r(new Gr("Operation timed out because it exceeded the configured time limit of ".concat(t,"ms.")))}),t);e.then((function(t){clearTimeout(i),n(t)}),(function(t){clearTimeout(i),r(t)}))}))},xi=Yr;function ji(t,e,n,r){return qr(t,"/splitChanges?since=".concat(e).concat(n||""),void 0,r?zr:void 0)}var Pi=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,a=t.sync.__splitFiltersValidation.queryString,s=xi(ji(t,e,a,o)),c=n||i;return s=Ie.start(Ie.TaskNames.SPLITS_FETCH,!!c&&r,s),n&&(s=Li(t.startup.requestTimeoutBeforeReady,s)),s.then((function(t){return t.json().catch((function(t){throw new Fr(t.message)}))}))},Ui=function(t){var e=new je;return t.forEach((function(t){t.matcherGroup.matchers.forEach((function(t){var n=t.matcherType,r=t.userDefinedSegmentMatcherData;"IN_SEGMENT"===n&&e.add(r.segmentName)}))})),e},Ki=Object(s.b)("splitio-producer:split-changes");function Fi(t){return t.getRegisteredSegments().every((function(e){return-1!==t.getChangeNumber(e)}))}function Gi(t){var e=t.reduce((function(t,e){return"ACTIVE"===e.status?(t.added.push([e.name,JSON.stringify(e)]),Ui(e.conditions).forEach((function(e){t.segments.add(e)}))):t.removed.push(e.name),t}),{added:[],removed:[],segments:new je});return e.segments=xe(e.segments),e}var Hi=Yr;function Bi(t,e){return qr(t,"/mySegments/".concat(encodeURIComponent(It(t.core.key))),void 0,e?zr:void 0)}var Yi=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=Hi(Bi(t,r));return i=Ie.start(Ie.TaskNames.MY_SEGMENTS_FETCH,!!e&&n,i),e&&(i=Li(t.startup.requestTimeoutBeforeReady,i)),i.then((function(t){return t.json().catch((function(t){throw new Fr(t.message)}))})).then((function(t){return t.mySegments.map((function(t){return t.name}))}))},Wi=Object(s.b)("splitio-producer:my-segments");var qi=Object(s.b)("splitio-producer:mySegmentsHandler"),zi=function(t){var e=t.get(t.constants.SETTINGS),n=t.get(t.constants.STORAGE).splits,r=t.get(t.constants.READINESS),i=r.splits,o=r.segments,a=function(t){var e=t.getAll(),n=e[t.constants.SETTINGS],r=e[t.constants.READINESS],i=e[t.constants.STORAGE],o=e[t.constants.COLLECTORS],a=r.segments,s=!0,c=!0;function u(t){var e=i.segments.resetSegments(t);i.splits.usesSegments()&&(e||s)&&(s=!1,a.emit(a.SDK_SEGMENTS_ARRIVED))}return function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;return(r?new Promise((function(t){u(r),t()})):Yi(n,c,o,i).then((function(t){c=!1,u(t)}))).catch((function(r){return r instanceof Fr||setTimeout((function(){throw r}),0),c&&n.startup.retriesOnFailureBeforeReady>e?(e+=1,Wi.warn("Retrying download of segments #".concat(e,". Reason: ").concat(r)),t(e)):(c=!1,!1)}))}}(t),s=Di(u,e.scheduler.segmentsRefreshRate);i.on(i.SDK_SPLITS_ARRIVED,(function(){if(!l)return;var t=n.usesSegments();t!==s.isRunning()&&(qi.info("Turning segments data polling ".concat(t?"ON":"OFF",".")),t?s.start():s.stop())})),n.usesSegments()?i.once(i.SDK_SPLITS_ARRIVED,f):setTimeout(f,0);var c=!1;function u(t,e){return c=!0,a(0,t,e).then((function(t){return c=!1,t}))}var l=!1;function f(){t.get(t.constants.READY,!0)||n.usesSegments()||o.emit(o.SDK_SEGMENTS_ARRIVED)}return{start:function(){l=!0,n.usesSegments()&&s.start()},stop:function(){l=!1,s.stop()},isRunning:function(){return l},isSynchronizingMySegments:function(){return c},synchronizeMySegments:u}},Vi=Object(s.b)("splitio-producer:updater"),Qi=function(t){var e=t.get(t.constants.SETTINGS),n=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.getAll(),r=n[t.constants.SETTINGS],i=n[t.constants.READINESS],a=n[t.constants.STORAGE],s=n[t.constants.COLLECTORS],c=i.splits,u=!0,l=!0;return function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;function f(o){Ki.debug("Spin up split update using since = ".concat(o));var f=Pi(r,o,u,s,e,i).then((function(t){u=!1;var n=Gi(t.splits);return Ki.debug("New splits ".concat(n.added.length)),Ki.debug("Removed splits ".concat(n.removed.length)),Ki.debug("Segment names collected ".concat(n.segments)),Promise.all([a.splits.setChangeNumber(t.till),a.splits.addSplits(n.added),a.splits.removeSplits(n.removed),a.segments.registerSegments(n.segments)]).then((function(){(l||o!==t.till&&(!e||Fi(a.segments)))&&(l=!1,c.emit(c.SDK_SPLITS_ARRIVED))}))})).catch((function(e){return e instanceof Fr||(setTimeout((function(){throw e}),0),u=!1),Ki.warn("Error while doing fetch of Splits. ".concat(e)),u&&r.startup.retriesOnFailureBeforeReady>n?(n+=1,Ki.info("Retrying download of splits #".concat(n,". Reason: ").concat(e)),t(n,i)):(u=!1,!1)}));return u&&a.splits.checkCache()&&c.emit(c.SDK_SPLITS_CACHE_LOADED),f}var h=a.splits.getChangeNumber(),p=o(h)?h:Promise.resolve(h);return p.then(f)}}(t),r=Di(s,e.scheduler.featuresRefreshRate),i=zi(t),a=!1;function s(t){return a=!0,n(0,t).then((function(t){return a=!1,t}))}return{start:function(){Vi.info("Starting BROWSER producer"),r.start(),i.start()},stop:function(){Vi.info("Stopping BROWSER producer"),r.stop(),i.stop()},isRunning:r.isRunning,isSynchronizingSplits:function(){return a},synchronizeSplits:s,isSynchronizingMySegments:i.isSynchronizingMySegments,synchronizeMySegments:i.synchronizeMySegments}},Ji=Object(s.b)("splitio-sync:sync-manager");var $i=Object(s.b)("splitio-client:cleanup"),Zi=function(){function t(e){X()(this,t),this.storage=e.get(e.constants.STORAGE),this.settings=e.get(e.constants.SETTINGS),this.flushData=this.flushData.bind(this),this.settings.sync.impressionsMode===K&&(this.impressionsCounter=e.get(e.constants.IMPRESSIONS_COUNTER))}return et()(t,[{key:"start",value:function(){"undefined"!=typeof window&&window.addEventListener&&($i.debug("Registering flush handler when unload page event is triggered."),window.addEventListener("unload",this.flushData))}},{key:"stop",value:function(){"undefined"!=typeof window&&window.removeEventListener&&($i.debug("Deregistering flush handler when unload page event is triggered."),window.removeEventListener("unload",this.flushData))}},{key:"flushData",value:function(){this._flushImpressions(),this._flushEvents(),this.impressionsCounter&&this._flushImpressionsCount()}},{key:"_flushImpressions",value:function(){var t=this.storage.impressions;if(!t.isEmpty()){var e=this.settings.url("/testImpressions/beacon"),n=Zr(t,this.settings),r={sim:this.settings.sync.impressionsMode===K?K:U};this._sendBeacon(e,n,r)||Qr(Jr(this.settings,{body:JSON.stringify(n)})),t.clear()}}},{key:"_flushImpressionsCount",value:function(){var t={pf:Xr(this.impressionsCounter)};if(0!==t.pf.length){var e=this.settings.url("/testImpressions/count/beacon");this._sendBeacon(e,t)||Qr($r(this.settings,{body:JSON.stringify(t)}))}}},{key:"_flushEvents",value:function(){var t=this.storage.events;if(!t.isEmpty()){var e=this.settings.url("/events/beacon"),n=t.toJSON();this._sendBeacon(e,n)||ci(ui(this.settings,{body:JSON.stringify(n)})),t.clear()}}},{key:"_sendBeacon",value:function(t,e,n){if("undefined"!=typeof navigator&&navigator.sendBeacon){var r={entries:e,token:this.settings.core.authorizationKey,sdk:this.settings.version};n&&i()(r,n);var o=JSON.stringify(r);return navigator.sendBeacon(t,o)}return!1}}]),t}(),Xi={};var to=function(t,e,n){var r,o=!!n,s=t.get(t.constants.SETTINGS),c=t.get(t.constants.READINESS),u=t.get(t.constants.STORAGE),f=t.get(t.constants.STATUS_MANAGER),h=c.gate,p=c.splits,d=c.segments,g=h.SDK_READY,v=o?void 0:si(t),m=o?void 0:fi(t),y=o?void 0:new Zi(t);switch(s.mode){case D:case M:t.put(t.constants.COLLECTORS,v&&v.collectors),o?r=Xi[s.core.authorizationKey].shared(t):(r=function(t){var e={},n=t.get(t.constants.SETTINGS),r=l(!1,t),i=n.streamingEnabled?Ci(t,e):void 0,o=t.get(t.constants.PRODUCER);function s(){o.isRunning()?Ji.info("Streaming couldn't connect. Continue periodic fetch of data."):(Ji.info("Streaming not available. Starting periodic fetch of data."),Object(a.d)(e,(function(t){t.get(t.constants.PRODUCER).start()})))}function c(){o.isRunning()&&(Ji.info("PUSH (re)connected. Syncing and stopping periodic fetch of data."),Object(a.d)(e,(function(t){t.get(t.constants.PRODUCER).stop()}))),u()}function u(){t.get(t.constants.PRODUCER).synchronizeSplits(),Object(a.d)(e,(function(t){t.get(t.constants.PRODUCER).synchronizeMySegments()}))}function l(t,n){var r=t?zi(n):Qi(n),l=n.get(n.constants.SETTINGS),f=Object(a.q)(It(l.core.key));return n.put(n.constants.PRODUCER,r),e[f]&&Ji.warn("A client with the same user key has already been created. Only the new instance will be properly synchronized."),e[f]=n,{start:function(){i?(t?o.isRunning()?r.start():r.synchronizeMySegments():(u(),i.on("PUSH_SUBSYSTEM_UP",c),i.on("PUSH_SUBSYSTEM_DOWN",s)),i.startNewClient(f,n)):r.start()},stop:function(){e[f]&&(delete e[f],i&&(i.removeClient(f),t||i.stop()),r.isRunning()&&r.stop())}}}return r.shared=l.bind(null,!0),r}(t),Xi[s.core.authorizationKey]=r);break;case L:t.put(t.constants.READY_FROM_CACHE,!0)}if(e&&r&&!o){var S=e.sdkReadyTracker,T=e.splitsReadyTracker,b=e.segmentsReadyTracker;S.setCollectorForTask(v.collectors),h.once(g,S),p.once(p.SDK_SPLITS_ARRIVED,T),d.once(d.SDK_SEGMENTS_ARRIVED,b)}r&&r.start(),v&&v.start(),m&&t.put(t.constants.EVENTS,m)&&m.start(),t.put(t.constants.COLLECTORS,n);var E=i()(Object.create(f),xr(t),{destroy:function(){return r&&r.stop(),v&&v.stop(),m&&m.stop(),Promise.all([v&&v.flush(),m&&m.flush()]).then((function(){c.destroy(),y&&y.stop(),u.destroy&&u.destroy(),t.put(t.constants.DESTROYED,!0),o||(l(s.core.authorizationKey),delete Xi[s.core.authorizationKey])}))}});return!o&&y.start(E.destroy),{api:E,metricCollectors:v&&v.collectors}};function eo(t){var e=t.treatment;return t.keys?{conditionType:"WHITELIST",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"WHITELIST",negate:!1,whitelistMatcherData:{whitelist:Object(a.j)(t.keys)?[t.keys]:t.keys}}]},partitions:[{treatment:e,size:100}],label:"whitelisted ".concat(e)}:{conditionType:"ROLLOUT",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"ALL_KEYS",negate:!1}]},partitions:[{treatment:e,size:100}],label:"default rule"}}function no(){var t={emptyMock:1};function e(e){var n=Object.keys(e);return n.length!==Object.keys(t).length?(t=e,!0):n.some((function(n){var r,i,o=!t[n],a=(r=t[n],i=e[n],Se()(r)!==Se()(i)||("string"==typeof r?r!==i:r.treatment!==i.treatment||r.config!==i.config)),s=o||a;return s&&(t=e),s}))}return function(t){var n=t.features||{};if(!e(n))return!1;var r={};return Object(a.d)(n,(function(t,e){var n=t,i=null;Object(a.i)(t)&&(n=t.treatment,i=t.config||i);var o={};null!==i&&(o[n]=i),r[e]={conditions:[eo({treatment:n})],configurations:o}})),r}}var ro=Object(s.b)("splitio-producer:offline");var io=function(t,e){var n=e.getAll(),r=n[e.constants.SETTINGS],i=n[e.constants.READINESS],o=n[e.constants.STORAGE],s=!0;return function(){var e=[],n=null,c={};try{c=t(r)}catch(t){n=t,ro.error("There was an issue loading the mock Splits data, no changes will be applied to the current cache. ".concat(t))}return!n&&c?(ro.debug("Splits data: "),ro.debug(JSON.stringify(c)),Object(a.d)(c,(function(t,n){e.push([n,JSON.stringify({name:n,status:"ACTIVE",killed:!1,trafficAllocation:100,defaultTreatment:"control",conditions:t.conditions||[],configurations:t.configurations,trafficTypeName:t.trafficTypeName})])})),Promise.all([o.splits.flush(),o.splits.addSplits(e)]).then((function(){i.splits.emit(i.splits.SDK_SPLITS_ARRIVED),s&&(s=!1,i.segments.emit(i.segments.SDK_SEGMENTS_ARRIVED))}))):Promise.resolve()}};var oo=function(t){var e=t.get(t.constants.SETTINGS),n=function(t){var e=no();return io(e,t)}(t);return Di(n,e.scheduler.offlineRefreshRate)};var ao=function(t,e){var n=!e,r=t.get(t.constants.READINESS),o=t.get(t.constants.STORAGE),a=t.get(t.constants.STATUS_MANAGER);n&&setTimeout((function(){r.splits.on(r.splits.SDK_SPLITS_ARRIVED,(function(){r.gate.emit(r.gate.SDK_UPDATE)})),r.gate.emit(r.gate.SDK_READY)}),0);var s=n?void 0:oo(t);return s&&s.start(),{api:i()(Object.create(a),xr(t),{destroy:function(){return s&&s.stop(),r.destroy(),o.destroy&&o.destroy(),t.put(t.constants.DESTROYED,!0),!n&&l(),Promise.resolve()}}),metricCollectors:!1}};function so(t,e){var n=!1,r=!1;var i=function t(i){var o=new Promise((function(t,n){return i.then(t,(function(t){r?n(t):e(t)}))})),a=o.then;return o.then=function(e,i){var s=a.call(o,e,i);return"function"==typeof e&&(n=!0),"function"==typeof i?(r=!0,s):t(s)},o}(t);return i.hasOnFulfilled=function(){return n},i}var co=Object(s.b)("");function uo(t){co.error(t)}function lo(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t.get(t.constants.READINESS).gate,r=0,o=!1,a=!1,s=n.SDK_READY,c=n.SDK_READY_FROM_CACHE,u=n.SDK_UPDATE,l=n.SDK_READY_TIMED_OUT;n.on("removeListener",(function(t){t===s&&r--})),n.on("newListener",(function(t){t!==s&&t!==l||(o?co.error("A listener was added for ".concat(t===s?"SDK_READY":"SDK_READY_TIMED_OUT"," on the SDK, which has already fired and won't be emitted again. The callback won't be executed.")):t===s&&r++)}));var f=h();function h(){var i=so(new Promise((function(c,u){n.once(s,(function(){co.info("Split SDK is ready."),r!==e||i.hasOnFulfilled()||co.warn("No listeners for SDK Readiness detected. Incorrect control treatments could have been logged if you called getTreatment/s while the SDK was not yet ready."),t.put(t.constants.READY,!0),o=!0,c()})),n.once(l,(function(e){t.put(t.constants.HAS_TIMEDOUT,!0),a=!0,u(e)}))})),uo);return i}return n.once(c,(function(){co.info("Split SDK is ready from cache."),t.put(t.constants.READY_FROM_CACHE,!0)})),i()(Object.create(n),{Event:{SDK_READY:s,SDK_READY_FROM_CACHE:c,SDK_UPDATE:u,SDK_READY_TIMED_OUT:l},ready:function(){return a?o?Promise.resolve():so(Promise.reject("Split SDK has emitted SDK_READY_TIMED_OUT event."),uo):f},__context:t})}var fo="splitio-ga-to-split:mapper",ho=Object(s.b)("splitio-ga-to-split");var po,go=(po={eventTypeId:{event:"eventAction",social:"socialAction"},eventValue:{event:"eventValue",timing:"timingValue"},eventProperties:{pageview:["page"],screenview:["screenName"],event:["eventCategory","eventLabel"],social:["socialNetwork","socialTarget"],timing:["timingCategory","timingVar","timingLabel"],exception:["exDescription","exFatal"]}},function(t){var e=t.get("hitType"),n=t.get(po.eventTypeId[e]||"hitType"),r=t.get(po.eventValue[e]),i={},o=po.eventProperties[e];if(o)for(var a=0;a<o.length;a++)i[o[a]]=t.get(o[a]);return{eventTypeId:n,value:r,properties:i,timestamp:Date.now()}});var vo=/^[^a-zA-Z0-9]+/,mo=/[^-_.:a-zA-Z0-9]+/g;var yo=function(t,e,n){var r,o,s,c={prefix:"ga",identities:n.key&&n.trafficType?[{key:n.key,trafficType:n.trafficType}]:void 0};r="splitTracker",o=function n(r,o){X()(this,n);var s=i()({},c,t,o);this.tracker=r;var u,l=(u=s.identities,Array.isArray(u)?Object(a.r)(u).filter((function(t){if(!t)return!1;var e=t.key,n=t.trafficType;return!(!Object(a.j)(e)&&!Object(a.l)(e)||!Object(a.j)(n))})):[]);if(0!==l.length){var f=l.length-s.identities.length;f&&ho.warn("".concat(f," identities were discarded because they are invalid or duplicated. Identities must be an array of objects with key and trafficType.")),s.identities=l,Object(a.j)(s.prefix)||(ho.warn("The provided `prefix` was ignored since it is invalid. Please check that you are passing a string object as `prefix`."),s.prefix=void 0);var h=r.get("sendHitTask");r.set("sendHitTask",(function(t){if(h(t),!1!==s.hits&&!t.get("splitHit")){try{if(s.filter&&!s.filter(t))return}catch(t){return void ho.warn("GaToSplit custom filter threw: ".concat(t))}var n=go(t);if(s.mapper){try{n=s.mapper(t,n)}catch(t){return void ho.warn("GaToSplit custom mapper threw: ".concat(t))}if(!n)return}s.prefix&&(n.eventTypeId="".concat(s.prefix,".").concat(n.eventTypeId)),n.eventTypeId=function(t){if(!Object(a.j)(t)||0===t.length)return t;var e=t.replace(vo,"").replace(mo,"_"),n=e.slice(0,80);return n.length<e.length&&ho.warn("EventTypeId was truncated because it cannot be more than 80 characters long."),n}(n.eventTypeId),function(t){return!(!d(t.eventTypeId,fo)||!1===v(t.value,fo)||!1===E(t.properties,fo).properties||t.timestamp&&!Object(a.l)(t.timestamp)||t.key&&!1===N(t.key,fo)||t.trafficTypeName&&!1===H(t.trafficTypeName,fo))}(n)&&(n.key&&n.trafficTypeName?e.events.track(n):s.identities.forEach((function(t){var r=i()({key:t.key,trafficTypeName:t.trafficType},n);e.events.track(r)})))}})),ho.info("Started GA-to-Split integration")}else ho.warn("No valid identities were provided. Please check that you are passing a valid list of identities or providing a traffic type at the SDK configuration.")},s=window.GoogleAnalyticsObject||"ga",window[s]=window[s]||function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];(window[s].q=window[s].q||[]).push(e)},window[s]("provide",r,o)},So=Object(s.b)("splitio-split-to-ga"),To=function(){function t(e){if(X()(this,t),"function"!=typeof t.getGa())return So.warn("`ga` command queue not found. No hits will be sent."),{};this.trackerNames=t.defaultTrackerNames,e&&("function"==typeof e.filter&&(this.filter=e.filter),"function"==typeof e.mapper&&(this.mapper=e.mapper),Array.isArray(e.trackerNames)&&(this.trackerNames=Object(a.s)(e.trackerNames)),this.impressions=e.impressions,this.events=e.events),So.info("Started Split-to-GA integration")}return et()(t,[{key:"queue",value:function(e){var n=t.getGa();if(n){if(!1===this.impressions&&"IMPRESSION"===e.type)return;if(!1===this.events&&"EVENT"===e.type)return;var r;try{if(this.filter&&!this.filter(e))return;if(r=t.defaultMapper(e),this.mapper&&(!(r=this.mapper(e,r))||!t.validateFieldsObject(r)))return}catch(t){return void So.warn("SplitToGa queue method threw: ".concat(t,". No hit was sent."))}this.trackerNames.forEach((function(t){var e=t?"".concat(t,".send"):"send";r.splitHit=!0,n(e,r)}))}}}],[{key:"defaultMapper",value:function(t){var e=t.type,n=t.payload;switch(e){case"IMPRESSION":return{hitType:"event",eventCategory:"split-impression",eventAction:"Evaluate "+n.impression.feature,eventLabel:"Treatment: "+n.impression.treatment+". Targeting rule: "+n.impression.label+".",nonInteraction:!0};case"EVENT":return{hitType:"event",eventCategory:"split-event",eventAction:n.eventTypeId,eventValue:n.value,nonInteraction:!0}}return null}},{key:"getGa",value:function(){return"undefined"!=typeof window?window[window.GoogleAnalyticsObject||"ga"]:void 0}},{key:"validateFieldsObject",value:function(t){return!(!t||!t.hitType)||(So.warn("your custom mapper returned an invalid FieldsObject instance. It must be an object with at least a `hitType` field."),!1)}}]),t}();To.defaultTrackerNames=[""];var bo=To,Eo=function(t){var e=t.get(t.constants.SETTINGS),n=[];if(e.integrations.forEach((function(r){var i;switch(r.type){case"GOOGLE_ANALYTICS_TO_SPLIT":var o=t.get(t.constants.STORAGE),a=e.core;i=yo(r,o,a);break;case"SPLIT_TO_GOOGLE_ANALYTICS":i=new bo(r)}i&&i.queue&&n.push(i)})),0!==n.length)return{handleImpression:function(t){n.forEach((function(e){return e.queue({type:"IMPRESSION",payload:t})}))},handleEvent:function(t){n.forEach((function(e){return e.queue({type:"EVENT",payload:t})}))}}},_o=function(){function t(){X()(this,t),this.cache={}}return et()(t,[{key:"_makeKey",value:function(t,e){return"".concat(t,"::").concat(kr(e))}},{key:"inc",value:function(t,e,n){var r=this._makeKey(t,e),i=this.cache[r];this.cache[r]=i?i+n:n}},{key:"popAll",value:function(){var t={};return i()(t,this.cache),this.cache={},t}},{key:"size",value:function(){return Object.keys(this.cache).length}}]),t}(),Oo=Object(s.b)("splitio"),No=function(t,e){return"".concat(t.matchingKey?t.matchingKey:t,"-").concat(t.bucketingKey?t.bucketingKey:t,"-").concat(void 0!==e?e:"")};e.default=function(t){var e,n,r={},i={splitsReadyTracker:Ie.start(Ie.TaskNames.SPLITS_READY),segmentsReadyTracker:Ie.start(Ie.TaskNames.SEGMENTS_READY),sdkReadyTracker:Ie.start(Ie.TaskNames.SDK_READY)},o=new pe,l=fe(t);o.put(o.constants.SETTINGS,l),e=l.core.authorizationKey,n=!1,null==e?c.error("Factory instantiation: you passed a null or undefined api_key, api_key must be a non-empty string."):Object(a.j)(e)?e.length>0?n=e:c.error("Factory instantiation: you passed an empty api_key, api_key must be a non-empty string."):c.error("Factory instantiation: you passed an invalid api_key, api_key must be a non-empty string."),n&&(u[n]?(c.warn("Factory instantiation: You already have ".concat(u[n]," ").concat(1===u[n]?"factory":"factories"," with this API Key. We recommend keeping only one instance of the factory at all times (Singleton pattern) and reusing it throughout your application.")),u[n]++):(u[n]=1,Object.keys(u).length>1&&c.warn("Factory instantiation: You already have an instance of the Split factory. Make sure you definitely want this additional instance. We recommend keeping only one instance of the factory at all times (Singleton pattern) and reusing it throughout your application.")));var f=Wt(),h=f(l.startup.readyTimeout);o.put(o.constants.READINESS,h);var p=lo(o);o.put(o.constants.STATUS_MANAGER,p);var d=Lt(o);o.put(o.constants.STORAGE,d);var g=new _o;o.put(o.constants.IMPRESSIONS_COUNTER,g);var v=Eo(o);o.put(o.constants.INTEGRATIONS_MANAGER,v);var m="localhost"===l.mode?ao:to,y=m(o,i),S=y.api,T=y.metricCollectors,b=$(d.splits,o),E=de(l.core.key),_=No(E,l.core.trafficType);return r[_]=S,Oo.info("New Split SDK instance created."),{client:function(t,e){if(void 0===t)return Oo.debug("Retrieving default SDK client."),S;if("function"!=typeof d.shared)throw new Error("Shared Client not supported by the storage mechanism. Create isolated instances instead.");var n,i=N(t,"Shared Client instantiation");if(!1===i)throw new Error("Shared Client needs a valid key.");if(void 0!==e&&!1===(n=H(e,"Shared Client instantiation")))throw new Error("Shared Client needs a valid traffic type or no traffic type at all.");var a=No(i,n);if(r[a])Oo.debug("Retrieving existing SDK client.");else{var s=l.overrideKeyAndTT(i,n),c=new pe,u=f(s.startup.readyTimeout);c.put(o.constants.READY_FROM_CACHE,o.get(o.constants.READY_FROM_CACHE,!0)),c.put(o.constants.READINESS,u),c.put(o.constants.STATUS_MANAGER,lo(c,-1)),c.put(o.constants.SETTINGS,s),c.put(o.constants.STORAGE,d.shared(s)),c.put(o.constants.IMPRESSIONS_COUNTER,g),r[a]=m(c,!1,T).api,Oo.info("New shared client instance created.")}return r[a]},manager:function(){return Oo.info("Manager instance retrieved."),b},Logger:s.a,settings:l}}}]).default}));